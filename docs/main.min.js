/**
 * Firedancer Demo
 * https://github.com/fal-works/firedancer
 *
 * @copyright 2020 FAL Works
 * @license MIT
 */
/**
 * The following software may be included in this product:
 *
 * The Haxe Standard Library
 * https://haxe.org
 * © 2005-2016 Haxe Foundation,
 * used under MIT License (https://haxe.org/foundation/open-source.html)
 */
!function(e){"use strict";var t,s={},r=function(){return Ss.__string_rec(this,"")},n=n||{};class i{static get(e){let t;switch(e){case"aim":t=i.aimDemo();break;case"bind-position":t=i.bindPosition();break;case"control-flow":t=i.controlFlow();break;case"default":t=i.firedancerDemo();break;case"fire-with-pattern":t=i.fireWithPattern();break;case"laundry":t=i.laundry();break;case"move":t=i.move();break;case"move-2":t=i.move2();break;case"nway-radial-line":t=i.nwayRadialLine();break;case"nway-whip":t=i.nWayWhip();break;case"parallel":t=i.parallelDemo();break;case"pods":t=i.pods();break;case"random":t=i.randomDemo();break;case"shot-direction":t=i.shotDirection();break;case"shot-position":t=i.shotPosition();break;case"shot-speed":t=i.shotSpeed();break;case"sin-cos":t=i.sinCos();break;case"static-geometric":t=i.staticGeometric();break;case"transform":t=i.transform();break;case"vanish":t=i.vanishDemo();break;case"variables":t=i.variables();break;default:t=null}return t}static defaultPattern(){return i.firedancerDemo()}static firedancerDemo(){St.shot.speed;let e=new As(3,ks.SetLength(new Zt(Xt.Constant(new as(3,1))))),t=Mt.radial(new $t(Jt.Constant(2)),Mt.nWay(new $t(Jt.Constant(7)),{angle:new Zt(Xt.Constant(new as(30,.017453292519943295)))})),s=(St.shot.direction,St.loop(new fs([t,new hs(3,os.AddAngle(new Zt(Xt.Constant(new as(30,.017453292519943295))))),St.wait(new $t(Jt.Constant(15)))]))),r=(St.shot.direction,new hs(3,os.AddAngle(new Zt(Xt.Constant(new as(90,.017453292519943295)))))),n=Mt.radial(new $t(Jt.Constant(2)),Mt.line(new $t(Jt.Constant(7)),{shotSpeedChange:new Zt(Xt.Constant(new as(1.2,1)))})),a=(St.shot.direction,[e,St.parallel([s,new fs([r,St.loop(new fs([n,new hs(3,os.AddAngle(new Zt(Xt.Constant(new as(30,.017453292519943295))))),St.wait(new $t(Jt.Constant(15)))]))])])]);return i.asMain(new fs(a),"[\r\n\tshot.speed.set(3),\r\n\tparallel([\r\n\t\t[\r\n\t\t\tloop([\r\n\t\t\t\tradial(2, nWay(7, { angle: 30 })),\r\n\t\t\t\tshot.direction.add(30),\r\n\t\t\t\twait(15)\r\n\t\t\t])\r\n\t\t],\r\n\t\t[\r\n\t\t\tshot.direction.add(90),\r\n\t\t\tloop([\r\n\t\t\t\tradial(2, line(7, { shotSpeedChange: 1.2 })),\r\n\t\t\t\tshot.direction.add(30),\r\n\t\t\t\twait(15)\r\n\t\t\t])\r\n\t\t]\r\n\t])\r\n];")}static controlFlow(){St.shot.velocity;let e=ss.fromPolarExpressionss({length:new Zt(Xt.Constant(new as(4,1))),angle:new Zt(Xt.Constant(new as(180,.017453292519943295)))}),t=[new ws(3,e),St.loop(new fs([St.wait(new $t(Jt.Constant(60))),St.rep(new $t(Jt.Constant(8)),new fs([St.fire(),St.wait(new $t(Jt.Constant(10)))]))]))];return i.asMain(new fs(t),"// Elements in an array are executed sequentially.\r\n\r\n[\r\n\tshot.velocity.set(4, 180), // (see other examples)\r\n\tloop([ // infinite loop\r\n\t\twait(60), // wait 60 frames = 1 second\r\n\t\trep(8, [ // repeat 8 times\r\n\t\t\tfire(), // emit a new actor (= bullet, enemy etc.)\r\n\t\t\twait(10)\r\n\t\t])\r\n\t])\r\n];")}static move(){let e=ss.fromPolarExpressionss({length:new Zt(Xt.Constant(new as(8,1))),angle:new Zt(Xt.Constant(new as(180,.017453292519943295)))}),t=new ws(1,e),s=St.wait(new $t(Jt.Constant(30))),r=ss.fromPolarExpressionss({length:new Zt(Xt.Constant(new as(16,1))),angle:new Zt(Xt.Constant(new as(0,.017453292519943295)))}),n=St.loop(new fs([t,s,new hs(1,os.AddVector(r)),St.wait(new $t(Jt.Constant(30))),new As(1,ks.SetLength(new Zt(Xt.Constant(new as(0,1))))),St.wait(new $t(Jt.Constant(60)))]));return i.asMain(n,"/*\r\n\tTerminology:\r\n\t\tposition = { r: distance, θ: bearing }\r\n\t\tvelocity = { r: speed,  θ: direction }\r\n\r\n\tAngle values are in degrees, north-based and clockwise.\r\n*/\r\n\r\nloop([\r\n\tvelocity.set(8, 180), // polar coords (length, angle) at default\r\n\twait(30),\r\n\tvelocity.add(16, 0), // you can either set or add\r\n\twait(30),\r\n\tspeed.set(0), // set/add length or angle independently\r\n\twait(30),\r\n\tfire(),\r\n\twait(30)\r\n]);")}static move2(){let e=ss.fromPolarExpressionss({length:new Zt(Xt.Constant(new as(16,1))),angle:new Zt(Xt.Constant(new as(180,.017453292519943295)))}),t=new ws(1,e).frames(new $t(Jt.Constant(60))),s=new As(1,ks.SetLength(new Zt(Xt.Constant(new as(0,1))))),r=St.wait(new $t(Jt.Constant(30))),n=(St.velocity.cartesian,ss.fromCartesianExpressions({x:new Zt(Xt.Constant(new as(0,1))),y:new Zt(Xt.Constant(new as(-16,1)))})),a=St.loop(new fs([t,s,r,new ws(1,n),new As(1,ks.SetLength(new Zt(Xt.Constant(new as(0,1))))).frames(new $t(Jt.Constant(60))),St.wait(new $t(Jt.Constant(30)))]));return i.asMain(a,"loop([\r\n\tvelocity.set(16, 180).frames(60), // change gradually\r\n\tspeed.set(0),\r\n\twait(30),\r\n\tvelocity.cartesian.set(0, -16), // cartesian coords\r\n\tspeed.set(0).frames(60),\r\n\twait(30),\r\n]);")}static shotSpeed(){St.shot.velocity;let e=ss.fromPolarExpressionss({length:new Zt(Xt.Constant(new as(3,1))),angle:new Zt(Xt.Constant(new as(180,.017453292519943295)))}),t=new ws(3,e),s=new $t(Jt.Constant(20)),r=St.fire(),n=(St.shot.speed,St.loop(new fs([t,St.rep(s,new fs([r,new hs(3,os.AddLength(new Zt(Xt.Constant(new as(.5,1))))),St.wait(new $t(Jt.Constant(4)))])),St.wait(new $t(Jt.Constant(60)))])));return i.asMain(n,"loop([\r\n\tshot.velocity.set(5, 180),\r\n\trep(30, [\r\n\t\tfire(),\r\n\t\tshot.speed.add(1),\r\n\t\twait(1)\r\n\t]),\r\n\twait(60)\r\n]);")}static shotDirection(){St.shot.velocity;let e=ss.fromPolarExpressionss({length:new Zt(Xt.Constant(new as(5,1))),angle:new Zt(Xt.Constant(new as(180,.017453292519943295)))}),t=new ws(3,e),s=St.fire(),r=(St.shot.direction,[t,St.loop(new fs([s,new hs(3,os.AddAngle(new Zt(Xt.Constant(new as(12,.017453292519943295))))),St.wait(new $t(Jt.Constant(1)))]))]);return i.asMain(new fs(r),"[\r\n\tshot.velocity.set(5, 180),\r\n\tloop([\r\n\t\tfire(),\r\n\t\tshot.direction.add(12),\r\n\t\twait(1)\r\n\t])\r\n];")}static shotPosition(){St.shot.velocity;let e=ss.fromPolarExpressionss({length:new Zt(Xt.Constant(new as(6,1))),angle:new Zt(Xt.Constant(new as(180,.017453292519943295)))}),t=new ws(3,e),s=(St.shot.position,ss.fromPolarExpressionss({length:new Zt(Xt.Constant(new as(150,1))),angle:new Zt(Xt.Constant(new as(180,.017453292519943295)))})),r=new ws(2,s),n=St.fire(),a=(St.shot.bearing,St.loop(new fs([t,r,St.loop(new fs([n,new hs(2,os.AddAngle(new Zt(Xt.Constant(new as(8,.017453292519943295))))),St.wait(new $t(Jt.Constant(2)))]))])));return i.asMain(a,"loop([\r\n\t\t\tshot.velocity.set(6, 180), // { speed: 6, direction: 180 }\r\n\t\t\tshot.position.set(150, 180), // { distance: 150, bearing: 180 }\r\n\t\t\tloop([\r\n\t\t\t\tfire(),\r\n\t\t\t\tshot.bearing.add(8),\r\n\t\t\t\twait(2)\r\n\t\t\t])\r\n\t\t]);")}static nwayRadialLine(){St.shot.velocity;let e=ss.fromPolarExpressionss({length:new Zt(Xt.Constant(new as(4,1))),angle:new Zt(Xt.Constant(new as(180,.017453292519943295)))}),t=St.loop(new fs([new ws(3,e),Mt.nWay(new $t(Jt.Constant(10)),{angle:new Zt(Xt.Constant(new as(90,.017453292519943295)))}),St.wait(new $t(Jt.Constant(60))),Mt.radial(new $t(Jt.Constant(36))),St.wait(new $t(Jt.Constant(60))),Mt.line(new $t(Jt.Constant(10)),{shotSpeedChange:new Zt(Xt.Constant(new as(10,1)))}),St.wait(new $t(Jt.Constant(60)))]));return i.asMain(t,"loop([\r\n\tshot.velocity.set(4, 180),\r\n\tnWay(10, { angle: 90 }),\r\n\twait(60),\r\n\tradial(36),\r\n\twait(60),\r\n\tline(10, { shotSpeedChange: 10 }),\r\n\twait(60)\r\n]);\r\n\r\n/*\r\n\tnWay() and line() are shorthands for dup() with limited parameters.\r\n*/\r\n")}static aimDemo(){St.shot.speed;let e=new As(3,ks.SetLength(new Zt(Xt.Constant(new as(8,1))))),t=(St.shot.position,new Zt(Xt.Constant(new as(150,1)))),s=(St.random.angle,new Zt(Xt.Constant(new as(0,.017453292519943295)))),r=ss.fromPolarExpressionss({length:t,angle:s.add(new Zt(Xt.Runtime(ls.UnaryOperation(Ye.Random(Ke.Float(st.Reg)),new Zt(Xt.Constant(new as(360,.017453292519943295))).subtract(s)))))}),n=[e,St.loop(new fs([new ws(2,r),St.aim(),Mt.line(new $t(Jt.Constant(8)),{shotSpeedChange:new Zt(Xt.Constant(new as(6,1)))}),St.wait(new $t(Jt.Constant(10)))]))];return i.asMain(new fs(n),"[\r\n\tshot.speed.set(8),\r\n\tloop([\r\n\t\tshot.position.set(150, random.angle.between(0, 360)),\r\n\t\taim(), // sets shot direction to the angle to the target\r\n\t\tline(8, { shotSpeedChange: 6 }),\r\n\t\twait(10)\r\n\t])\r\n];")}static fireWithPattern(){St.shot.velocity;let e=ss.fromPolarExpressionss({length:new Zt(Xt.Constant(new as(5,1))),angle:new Zt(Xt.Constant(new as(180,.017453292519943295)))}),t=new ws(3,e),s=St.fire(new fs([St.wait(new $t(Jt.Constant(30))),new hs(1,os.AddAngle(new Zt(Xt.Constant(new as(-120,.017453292519943295)))))])),r=(St.shot.direction,[t,St.loop(new fs([s,new hs(3,os.AddAngle(new Zt(Xt.Constant(new as(36,.017453292519943295))))),St.wait(new $t(Jt.Constant(8)))]))]);return i.asMain(new fs(r),"[\r\n\tshot.velocity.set(5, 180),\r\n\tloop([\r\n\t\tfire([\r\n\t\t\twait(30),\r\n\t\t\tdirection.add(-120)\r\n\t\t]),\r\n\t\tshot.direction.add(36),\r\n\t\twait(8)\r\n\t])\r\n];")}static bindPosition(){St.shot.position;let e=ss.fromPolarExpressionss({length:new Zt(Xt.Constant(new as(30,1))),angle:new Zt(Xt.Constant(new as(180,.017453292519943295)))}),t=new ws(2,e),s=new $t(Jt.Constant(12)),r=St.fire(St.loop(new fs([new hs(0,os.AddLength(new Zt(Xt.Constant(new as(4,1))))),new hs(0,os.AddAngle(new Zt(Xt.Constant(new as(1,.017453292519943295))))),St.wait(new $t(Jt.Constant(1)))])));r.bindPosition=!0;St.shot.bearing;let n=[t,St.loop(new fs([St.rep(s,new fs([r,new hs(2,os.AddAngle(new Zt(Xt.Constant(new as(30,.017453292519943295)))))])),St.wait(new $t(Jt.Constant(30)))]))];return i.asMain(new fs(n),"/*\r\n\tIf you call bind() after fire(),\r\n\tthe position of fired actor will be\r\n\trelative from the actor that fired it.\r\n*/\r\n\r\n[\r\n\tshot.position.set(30, 180),\r\n\tloop([\r\n\t\trep(12, [\r\n\t\t\tfire(loop([\r\n\t\t\t\tdistance.add(4),\r\n\t\t\t\tbearing.add(1),\r\n\t\t\t\twait(1)\r\n\t\t\t])).bind(),\r\n\t\t\tshot.bearing.add(30),\r\n\t\t]),\r\n\t\twait(30)\r\n\t])\r\n];")}static parallelDemo(){St.shot.velocity;let e=ss.fromPolarExpressionss({length:new Zt(Xt.Constant(new as(5,1))),angle:new Zt(Xt.Constant(new as(180,.017453292519943295)))}),t=new ws(3,e),s=St.loop(new fs([St.fire(),St.wait(new $t(Jt.Constant(8)))])),r=St.fire(),n=(St.shot.direction,[t,St.parallel([s,St.loop(new fs([r,new hs(3,os.AddAngle(new Zt(Xt.Constant(new as(32,.017453292519943295))))),St.wait(new $t(Jt.Constant(4)))]))])]);return i.asMain(new fs(n),"/*\r\n\tparallel() waits until all threads are completed, while\r\n\tasync() does not.\r\n*/\r\n\r\n[\r\n\tshot.velocity.set(5, 180),\r\n\tparallel([\r\n\t\tloop([\r\n\t\t\tfire(),\r\n\t\t\twait(8)\r\n\t\t]),\r\n\t\tloop([\r\n\t\t\tfire(),\r\n\t\t\tshot.direction.add(32),\r\n\t\t\twait(4)\r\n\t\t])\r\n\t])\r\n];")}static vanishDemo(){St.shot.velocity;let e=ss.fromPolarExpressionss({length:new Zt(Xt.Constant(new as(5,1))),angle:new Zt(Xt.Constant(new as(180,.017453292519943295)))}),t=new ws(3,e),s=St.fire(new fs([St.wait(new $t(Jt.Constant(30))),St.vanish()])),r=(St.shot.direction,[t,St.loop(new fs([s,new hs(3,os.AddAngle(new Zt(Xt.Constant(new as(12,.017453292519943295))))),St.wait(new $t(Jt.Constant(1)))]))]);return i.asMain(new fs(r),"[\r\n\tshot.velocity.set(5, 180),\r\n\tloop([\r\n\t\tfire([\r\n\t\t\twait(30),\r\n\t\t\tvanish()\r\n\t\t]),\r\n\t\tshot.direction.add(12),\r\n\t\twait(1)\r\n\t])\r\n];")}static randomDemo(){St.shot.velocity;let e=new Zt(Xt.Constant(new as(1,1))),t=e.add(new Zt(Xt.Runtime(ls.UnaryOperation(Ye.Random(Ke.Float(st.Reg)),new Zt(Xt.Constant(new as(4,1))).subtract(e))))),s=new Zt(Xt.Constant(new as(180,.017453292519943295))),r=(St.random.angle,ss.fromPolarExpressionss({length:t,angle:s.add(new Zt(Xt.Constant(new as(90,.017453292519943295))).divide(new Zt(Xt.Constant(new as(2,1)))).unaryOperation(Ye.RandomSigned(Ke.Float(st.Reg))))})),n=St.loop(new fs([new ws(3,r),St.fire(),St.wait(new $t(Jt.Constant(2)))]));return i.asMain(n,"loop([\r\n\tshot.velocity.set(\r\n\t\trandom.between(1, 4),\r\n\t\t180 + (random.angle.grouping(90)) // 180 ± 45\r\n\t),\r\n\tfire(),\r\n\twait(2)\r\n]);")}static variables(){let e=St.intVar("cnt"),t=(St.shot.velocity,ss.fromPolarExpressionss({length:new Zt(Xt.Constant(new as(5,1))),angle:new Zt(Xt.Constant(new as(180,.017453292519943295)))})),s=new ws(3,t),r=es.let(e),n=(St.shot.direction,new $t(Jt.Constant(20))),a=[s,r,St.loop(new fs([new As(3,ks.SetAngle(es.get(e).multiply(n).toAngleExpression())),St.fire(),St.wait(new $t(Jt.Constant(4))),es.increment(e)]))];return i.asMain(new fs(a),'/*\r\n\tYou can define any local variable with\r\n\tintVar(), floatVar() or angleVar().\r\n\r\n\tEach array behaves as a scope.\r\n\tShadowing is allowed.\r\n\r\n\tYou can change the assigned value by\r\n\tset(), add(), increment() or decrement()\r\n\t(the latter two are only for integer variables).\r\n*/\r\n\r\nfinal cnt = intVar("cnt");\r\n\r\n[\r\n\tshot.velocity.set(5, 180),\r\n\tcnt.let(), // declare in the current scope\r\n\tloop([\r\n\t\tshot.direction.set(cnt * 20),\r\n\t\tfire(),\r\n\t\twait(4),\r\n\t\tcnt.increment()\r\n\t])\r\n];')}static sinCos(){let e=St.angleVar("bearing"),t=(St.shot.position.cartesian,ss.fromCartesianExpressions({x:new Zt(Xt.Constant(new as(270,1))),y:new Zt(Xt.Constant(new as(0,1)))})),s=new ws(2,t),r=new $t(Jt.Constant(16)),n=jt.let(e),a=(St.position.cartesian,ss.fromCartesianExpressions({x:new Zt(Xt.Constant(new as(270,1))).multiply(St.cos(jt.toAngleExpression(e))),y:new Zt(Xt.Constant(new as(60,1))).multiply(St.sin(jt.toAngleExpression(e)))})),l=St.fire(new fs([n,St.loop(new fs([new ws(0,a),St.wait(new $t(Jt.Constant(1))),jt.add(e,new Zt(Xt.Constant(new as(4,.017453292519943295))))]))]));l.bindPosition=!0;let h=[s,St.rep(r,new fs([l,St.wait(new $t(Jt.Constant(4)))]))];return i.asMain(new fs(h),'final varBearing = angleVar("bearing");\r\n\r\n[\r\n\tshot.position.cartesian.set(270, 0),\r\n\trep(16, [\r\n\t\tfire([\r\n\t\t\tvarBearing.let(),\r\n\t\t\tloop([\r\n\t\t\t\tposition.cartesian.set(\r\n\t\t\t\t\t270 * cos(varBearing),\r\n\t\t\t\t\t60 * sin(varBearing)\r\n\t\t\t\t),\r\n\t\t\t\twait(1),\r\n\t\t\t\tvarBearing.add(4)\r\n\t\t\t])\r\n\t\t]).bind(),\r\n\t\twait(4)\r\n\t])\r\n];')}static transform(){let e=St.angleVar("bearing"),t=St.angleVar("rotation"),s=(St.shot.position,ss.fromPolarExpressionss({length:new Zt(Xt.Constant(new as(150,1))),angle:new Zt(Xt.Constant(new as(90,.017453292519943295)))})),r=new ws(2,s),n=new $t(Jt.Constant(24)),a=jt.let(e),l=jt.let(t),h=ss.fromPolarExpressionss({length:new Zt(Xt.Constant(new as(150,1))),angle:jt.toAngleExpression(e)}),o=St.fire(new fs([a,l,St.loop(new fs([new ws(0,h).rotate(jt.toAngleExpression(t)).scale(new Zt(Xt.Constant(new as(1,1))),new Zt(Xt.Constant(new as(.3,1)))),St.wait(new $t(Jt.Constant(1))),jt.add(e,new Zt(Xt.Constant(new as(4,.017453292519943295)))),jt.add(t,new Zt(Xt.Constant(new as(2,.017453292519943295))))]))]));o.bindPosition=!0;let _=[r,St.rep(n,new fs([o,St.wait(new $t(Jt.Constant(6)))]))];return i.asMain(new fs(_),'final varBearing = angleVar("bearing");\r\nfinal varRotation = angleVar("rotation");\r\n\r\n[\r\n\trep(24, [\r\n\t\tfire([\r\n\t\t\tvarBearing.let(),\r\n\t\t\tvarRotation.let(),\r\n\t\t\tloop([\r\n\t\t\t\tposition.set(150, varBearing)\r\n\t\t\t\t\t.rotate(varRotation)\r\n\t\t\t\t\t.scale(1.0, 0.3),\r\n\t\t\t\twait(1),\r\n\t\t\t\tvarBearing.add(4),\r\n\t\t\t\tvarRotation.add(2)\r\n\t\t\t])\r\n\t\t]).bind(),\r\n\t\twait(6)\r\n\t])\r\n];')}static nWayWhip(){St.shot.velocity;let e=ss.fromPolarExpressionss({length:new Zt(Xt.Constant(new as(4,1))),angle:new Zt(Xt.Constant(new as(180,.017453292519943295)))}),t=new ws(3,e),s=Mt.nWay(new $t(Jt.Constant(5)),{angle:new Zt(Xt.Constant(new as(90,.017453292519943295)))}),r=[t,St.loop(new fs([St.dup(new $t(Jt.Constant(8)),{intervalFrames:new $t(Jt.Constant(4)),shotSpeedChange:new Zt(Xt.Constant(new as(8,1))),shotDirectionRange:{start:new Zt(Xt.Constant(new as(-6,.017453292519943295))),end:new Zt(Xt.Constant(new as(6,.017453292519943295)))}},s),St.wait(new $t(Jt.Constant(30)))]))];return i.asMain(new fs(r),"[\r\n\tshot.velocity.set(4, 180),\r\n\tloop([\r\n\t\tnWay(5, { angle: 90 }).dup(8, {\r\n\t\t\tintervalFrames: 4,\r\n\t\t\tshotSpeedChange: 8,\r\n\t\t\tshotDirectionRange: { start: -6, end: 6 }\r\n\t\t}),\r\n\t\twait(30)\r\n\t])\r\n];")}static laundry(){St.shot.speed;let e=new As(3,ks.SetLength(new Zt(Xt.Constant(new as(12,1))))),t=Mt.radial(new $t(Jt.Constant(10))),s=(St.shot.direction,St.loop(new fs([t,new hs(3,os.AddAngle(new Zt(Xt.Constant(new as(8,.017453292519943295))))),St.wait(new $t(Jt.Constant(4)))]))),r=Mt.radial(new $t(Jt.Constant(4))),n=(St.shot.direction,St.loop(new fs([r,new hs(3,os.AddAngle(new Zt(Xt.Constant(new as(4,.017453292519943295))))),St.wait(new $t(Jt.Constant(2)))]))),a=Mt.radial(new $t(Jt.Constant(4))),l=(St.shot.direction,[e,St.parallel([s,n,St.loop(new fs([a,new hs(3,os.AddAngle(new Zt(Xt.Constant(new as(-4,.017453292519943295))))),St.wait(new $t(Jt.Constant(2)))]))])]);return i.asMain(new fs(l),"[\r\n\tshot.speed.set(12),\r\n\tparallel([\r\n\t\tloop([\r\n\t\t\tradial(10),\r\n\t\t\tshot.direction.add(8),\r\n\t\t\twait(4)\r\n\t\t]),\r\n\t\tloop([\r\n\t\t\tradial(4),\r\n\t\t\tshot.direction.add(4),\r\n\t\t\twait(2)\r\n\t\t]),\r\n\t\tloop([\r\n\t\t\tradial(4),\r\n\t\t\tshot.direction.add(-4),\r\n\t\t\twait(2)\r\n\t\t])\r\n\t])\r\n];")}static pods(){St.shot.velocity;let e=ss.fromPolarExpressionss({length:new Zt(Xt.Constant(new as(10,1))),angle:new Zt(Xt.Constant(new as(0,.017453292519943295)))}),t=new ws(3,e),s=new $t(Jt.Constant(2)),r=(St.shot.velocity,ss.fromPolarExpressionss({length:new Zt(Xt.Constant(new as(2,1))),angle:Nt.toExpression(St.direction)})),n=new ws(3,r),a=new As(1,ks.SetLength(new Zt(Xt.Constant(new as(0,1))))).frames(new $t(Jt.Constant(30))),l=St.fire(),h=new hs(0,os.AddAngle(new Zt(Xt.Constant(new as(-3,.017453292519943295))))),o=(St.shot.direction,St.fire(new fs([n,a,St.loop(new fs([l,h,new hs(3,os.AddAngle(new Zt(Xt.Constant(new as(12,.017453292519943295))))),St.wait(new $t(Jt.Constant(1)))]))])));o.bindPosition=!0;let _=[t,Mt.radial(s,o)];return i.asMain(new fs(_),"[\r\n\tshot.velocity.set(10, 0),\r\n\tradial(2, fire([\r\n\t\tshot.velocity.set(2, direction),\r\n\t\tspeed.set(0).frames(30),\r\n\t\tloop([\r\n\t\t\tfire(),\r\n\t\t\tbearing.add(-3),\r\n\t\t\tshot.direction.add(12),\r\n\t\t\twait(1)\r\n\t\t])\r\n\t]).bind())\r\n];")}static staticGeometric(){St.shot.velocity;let e=ss.fromPolarExpressionss({length:new Zt(Xt.Constant(new as(6,1))),angle:new Zt(Xt.Constant(new as(0,.017453292519943295)))}),t=new ws(3,e),s=new $t(Jt.Constant(8)),r=St.wait(new $t(Jt.Constant(20))),n=(St.shot.velocity,ss.fromPolarExpressionss({length:new Zt(Xt.Constant(new as(6,1))),angle:Nt.toExpression(St.direction)})),a=[t,St.loop(new fs([Mt.radial(s,St.fire(new fs([r,new ws(3,n),Mt.nWay(new $t(Jt.Constant(2)),{angle:new Zt(Xt.Constant(new as(120,.017453292519943295)))}),St.vanish()]))),St.wait(new $t(Jt.Constant(4)))]))];return i.asMain(new fs(a),"[\r\n\tshot.velocity.set(6, 0),\r\n\tloop([\r\n\t\tradial(8, fire([\r\n\t\t\twait(20),\r\n\t\t\tshot.velocity.set(6, direction),\r\n\t\t\tnWay(2, { angle: 120 }),\r\n\t\t\tvanish()\r\n\t\t])),\r\n\t\twait(4)\r\n\t])\r\n];")}static asMain(e,t){null==t&&(t=""),t=b.replace(t,"\t","  "),a.script(t);let s=new va;s.h.main=e;let r=St.compileToAssembly(s,!0);a.assembly(r.toString());let n=r.assemble();return a.program(n.toString()),n}}s.BulletPatterns=i,i.__name__="BulletPatterns";class a{static initialize(){let e=window.document.getElementById("demo-selector");e.onchange=function(){if(null==_.world)return;let t=i.get(e.value);if(null==t)return;let s=t;_.world.reset(s,s.getProgramByName("main"))}}static script(e){window.document.getElementById("script").textContent=e}static assembly(e){window.document.getElementById("assembly").textContent=e}static program(e){window.document.getElementById("program").textContent=e}}s.Dom=a,a.__name__="Dom";class l{constructor(e,t){this.r=new RegExp(e,t.split("u").join(""))}match(e){return this.r.global&&(this.r.lastIndex=0),this.r.m=this.r.exec(e),this.r.s=e,null!=this.r.m}matched(e){if(null!=this.r.m&&e>=0&&e<this.r.m.length)return this.r.m[e];throw $i.thrown("EReg::matched")}}s.EReg=l,l.__name__="EReg",Object.assign(l.prototype,{__class__:l});class h{emit(e,t,s,r,n,i,a){throw $i.thrown(new Kh(null,{fileName:"firedancer/vm/Emitter.hx",lineNumber:40,className:"firedancer.vm.Emitter",methodName:"emit"}))}}s["firedancer.vm.Emitter"]=h,h.__name__="firedancer.vm.Emitter",Object.assign(h.prototype,{__class__:h});class o extends h{constructor(){super(),this.aosoa=null}initialize(e){this.aosoa=e}emit(e,t,s,r,n,i,a){this.aosoa.use(e,t,s,r,i,a)}}s.Emitter=o,o.__name__="Emitter",o.__super__=h,Object.assign(o.prototype,{__class__:o});class _{}s.Global=_,_.__name__="Global";class c{static strDate(e){switch(e.length){case 8:let t=e.split(":"),s=new Date;return s.setTime(0),s.setUTCHours(t[0]),s.setUTCMinutes(t[1]),s.setUTCSeconds(t[2]),s;case 10:let r=e.split("-");return new Date(r[0],r[1]-1,r[2],0,0,0);case 19:let n=e.split(" "),i=n[0].split("-"),a=n[1].split(":");return new Date(i[0],i[1]-1,i[2],a[0],a[1],a[2]);default:throw $i.thrown("Invalid date format : "+e)}}static cca(e,t){let s=e.charCodeAt(t);if(s==s)return s}static substr(e,t,s){if(null==s)s=e.length;else if(s<0){if(0!=t)return"";s=e.length+s}return e.substr(t,s)}static remove(e,t){let s=e.indexOf(t);return-1!=s&&(e.splice(s,1),!0)}static now(){return Date.now()}}s.HxOverrides=c,c.__name__="HxOverrides";class u{static array(e){let t=[],s=(r=e)instanceof Array?new Oa(r):r.iterator();for(var r;s.hasNext();){let e=s.next();t.push(e)}return t}}s.Lambda=u,u.__name__="Lambda";class d{constructor(e,t,s){null==s&&(s=!0),d.width=e,d.height=t,this.startFullscreen=s,d.data=new pe(this)}initialize(){}update(){}}s["broker.App"]=d,d.__name__="broker.App",Object.assign(d.prototype,{__class__:d});class p extends d{constructor(e,t,s){super(e,t,s)}initialize(){el.set_loader(new bl(new cl(_a.run("oy10:bullet.pngty9:agent.pngtg")))),d.data.engine.backgroundColor=-1;let e=new Nh;e.fadeInFrom(-1,30,!0);let t=new ye(e,16);t.tag=new no("scene stack",null),this.sceneStack=t}update(){this.sceneStack.update()}static main(){new p(600,800,!1),a.initialize()}}s.Main=p,p.__name__="Main",p.__super__=d,Object.assign(p.prototype,{__class__:p}),Math.__name__="Math";class f{static field(e,t){try{return e[t]}catch(e){return null}}static fields(e){let t=[];if(null!=e){let r=Object.prototype.hasOwnProperty;for(var s in e)"__id__"!=s&&"hx__closures__"!=s&&r.call(e,s)&&t.push(s)}return t}static isFunction(e){return"function"==typeof e&&!(e.__name__||e.__ename__)}static compare(e,t){return e==t?0:e>t?1:-1}static compareMethods(e,t){return e==t||!(!f.isFunction(e)||!f.isFunction(t))&&(e.scope==t.scope&&e.method==t.method&&null!=e.method)}static isEnumValue(e){return null!=e&&null!=e.__enum__}static deleteField(e,t){return!!Object.prototype.hasOwnProperty.call(e,t)&&(delete e[t],!0)}}s.Reflect=f,f.__name__="Reflect";class x{static string(e){return Ss.__string_rec(e,"")}static parseInt(e){if(null!=e){let t=0,s=e.length;for(;t<s;){let s=t++,r=e.charCodeAt(s);if(r<=8||r>=14&&32!=r&&45!=r){let t=e.charCodeAt(s+1),r=parseInt(e,120==t||88==t?16:10);return isNaN(r)?null:r}}}return null}}s.Std=x,x.__name__="Std";class g{constructor(){this.b=""}add(e){this.b+=x.string(e)}}s.StringBuf=g,g.__name__="StringBuf",Object.assign(g.prototype,{__class__:g});class b{static startsWith(e,t){return e.length>=t.length&&0==e.lastIndexOf(t,0)}static isSpace(e,t){let s=c.cca(e,t);return s>8&&s<14||32==s}static ltrim(e){let t=e.length,s=0;for(;s<t&&b.isSpace(e,s);)++s;return s>0?c.substr(e,s,t-s):e}static rtrim(e){let t=e.length,s=0;for(;s<t&&b.isSpace(e,t-s-1);)++s;return s>0?c.substr(e,0,t-s):e}static trim(e){return b.ltrim(b.rtrim(e))}static replace(e,t,s){return e.split(t).join(s)}static hex(e,t){let s="";for(;s="0123456789ABCDEF".charAt(15&e)+s,(e>>>=4)>0;);if(null!=t)for(;s.length<t;)s="0"+s;return s}}s.StringTools=b,b.__name__="StringTools";class m{onGlobalEvent(e){throw $i.thrown(new Kh(null,{fileName:"firedancer/vm/EventHandler.hx",lineNumber:23,className:"firedancer.vm.EventHandler",methodName:"onGlobalEvent"}))}onLocalEvent(e,t,s,r,n,i){throw $i.thrown(new Kh(null,{fileName:"firedancer/vm/EventHandler.hx",lineNumber:46,className:"firedancer.vm.EventHandler",methodName:"onLocalEvent"}))}}s["firedancer.vm.EventHandler"]=m,m.__name__="firedancer.vm.EventHandler",Object.assign(m.prototype,{__class__:m});class A extends m{constructor(){super()}onGlobalEvent(e){to.println_String("Invoked global event. (code: "+e+")")}}s.TestEventHandler=A,A.__name__="TestEventHandler",A.__super__=m,Object.assign(A.prototype,{__class__:A});var w=n.ValueType={__ename__:"ValueType",__constructs__:["TNull","TInt","TFloat","TBool","TObject","TFunction","TClass","TEnum","TUnknown"],TNull:{_hx_index:0,__enum__:"ValueType",toString:r},TInt:{_hx_index:1,__enum__:"ValueType",toString:r},TFloat:{_hx_index:2,__enum__:"ValueType",toString:r},TBool:{_hx_index:3,__enum__:"ValueType",toString:r},TObject:{_hx_index:4,__enum__:"ValueType",toString:r},TFunction:{_hx_index:5,__enum__:"ValueType",toString:r},TClass:(t=function(e){return{_hx_index:6,c:e,__enum__:"ValueType",toString:r}},t.__params__=["c"],t),TEnum:(t=function(e){return{_hx_index:7,e,__enum__:"ValueType",toString:r}},t.__params__=["e"],t),TUnknown:{_hx_index:8,__enum__:"ValueType",toString:r}};w.__empty_constructs__=[w.TNull,w.TInt,w.TFloat,w.TBool,w.TObject,w.TFunction,w.TUnknown];class y{static createInstance(e,t){return new(Function.prototype.bind.apply(e,[null].concat(t)))}static createEnum(e,t,s){let r=f.field(e,t);if(null==r)throw $i.thrown("No such constructor "+t);if(f.isFunction(r)){if(null==s)throw $i.thrown("Constructor "+t+" need parameters");return r.apply(e,s)}if(null!=s&&0!=s.length)throw $i.thrown("Constructor "+t+" does not need parameters");return r}static createEnumIndex(e,t,s){let r=e.__constructs__[t];if(null==r)throw $i.thrown(t+" is not a valid enum constructor index");return y.createEnum(e,r,s)}static typeof(e){switch(typeof e){case"boolean":return w.TBool;case"function":return e.__name__||e.__ename__?w.TObject:w.TFunction;case"number":return Math.ceil(e)==e%2147483648?w.TInt:w.TFloat;case"object":if(null==e)return w.TNull;let t=e.__enum__;if(null!=t)return w.TEnum(n[t]);let s=Ss.getClass(e);return null!=s?w.TClass(s):w.TObject;case"string":return w.TClass(String);case"undefined":return w.TNull;default:return w.TUnknown}}static enumEq(e,t){if(e==t)return!0;try{let s=e.__enum__;if(null==s||s!=t.__enum__)return!1;if(e._hx_index!=t._hx_index)return!1;let r=n[s],i=r[r.__constructs__[e._hx_index]].__params__,a=0;for(;a<i.length;){let s=i[a];if(++a,!y.enumEq(e[s],t[s]))return!1}}catch(e){return!1}return!0}static enumParameters(e){let t=n[e.__enum__],s=t[t.__constructs__[e._hx_index]].__params__;if(null!=s){let t=[],r=0;for(;r<s.length;){let n=s[r];++r,t.push(e[n])}return t}return[]}}s.Type=y,y.__name__="Type";class k{constructor(){let e=new Br(600,800),t=this.area=e,s=Dr.fromColor(16711167,t.width,t.height,1),r=new mr(s);t.addChild(r);let n=new gr;this.armiesContainer=n;let a=this.armiesContainer;a.posChanged=!0,a.x=300,a.posChanged=!0,a.y=0,t.addChild(this.armiesContainer);let l=i.defaultPattern();this.reset(l,l.getProgramByName("main"))}reset(e,t){this.armiesContainer.removeChildren();let s=new Fr(null);s.x=0,s.y=600;let r=s;this.army=B.createArmy(this.armiesContainer,r,600,800,e),this.army.crashAll();let n=t;this.army.newAgent(0,200,0,0,n)}update(){this.army.update(),this.army.synchronize()}}s.World=k,k.__name__="World",Object.assign(k.prototype,{__class__:k});class B{static createArmy(e,t,s,r,n){let i=el.get_loader().loadCache("agent.png",gl).toTile().center(),a=new Er(Dr.fromTexture(i.innerTex));a.hasRotationScale=!0;let l=a;e.addChild(l);let h=el.get_loader().loadCache("bullet.png",gl).toTile().center(),_=new Er(Dr.fromTexture(h.innerTex));_.hasRotationScale=!0;let c=_;e.addChild(c);let u=new A,d=new o,p=E.createActors(4096,n,c,h,u,d),f=E.createActors(64,n,l,i,u,d);return d.initialize(p),new F(f,p,t)}}s["_World.WorldBuilder"]=B,B.__name__="_World.WorldBuilder";class C{}s["banker.aosoa.Structure"]=C,C.__name__="banker.aosoa.Structure",C.__isInterface__=!0;class v{}s["broker.entity.BasicEntity"]=v,v.__name__="broker.entity.BasicEntity",v.__interfaces__=[C];class S extends v{static spriteVectorFactory(e){return new Array(e)}}s["broker.entity.BasicBatchEntity"]=S,S.__name__="broker.entity.BasicBatchEntity",S.__super__=v,Object.assign(S.prototype,{__class__:S});class M{constructor(e,t,s,r,n,i,a,l){this.rotationVelocity=.03,this.disusedCount=0,this.usedCount=0,this.nextWriteIndex=0,this.endReadIndex=0,this.chunkId=e;let h=new Array(t),o=(this.x=h,this.x),_=0,c=o.length;for(;_<c;){o[_++]=0}let u=this.x,d=new Array(u.length);Sa.blit(u,0,d,0,u.length);this.xBuffer=d;let p=new Array(t),f=(this.y=p,this.y),x=0,g=f.length;for(;x<g;){f[x++]=0}let b=this.y,m=new Array(b.length);Sa.blit(b,0,m,0,b.length);this.yBuffer=m;let A=new Array(t),w=(this.vx=A,this.vx),y=0,k=w.length;for(;y<k;){w[y++]=0}let B=this.vx,C=new Array(B.length);Sa.blit(B,0,C,0,B.length);this.vxBuffer=C;let v=new Array(t),M=(this.vy=v,this.vy),I=0,T=M.length;for(;I<T;){M[I++]=0}let F=this.vy,E=new Array(F.length);Sa.blit(F,0,E,0,F.length);this.vyBuffer=E;this.usedSprites=S.spriteVectorFactory(t),this.disusedSprites=S.spriteVectorFactory(t),this.batch=r;let D=new Array(t),R=(this.sprite=D,this.sprite),V=0,O=R.length;for(;V<O;){R[V++]=n()}let P=this.sprite,Q=new Array(P.length);Sa.blit(P,0,Q,0,P.length);this.spriteBuffer=Q;this.programTable=i,this.eventHandler=a,this.emitter=l;let L=new Array(t),G=(this.threads=L,this.threads),z=0,U=G.length;for(;z<U;){let e=z++,t=4,s=128;if(0==t)throw $i.thrown("Thread pool capacity must be 1 or more.");let r=new Array(t),n=0,i=r.length;for(;n<i;){r[n++]=new Rs(s)}let a=r;G[e]=a}let W=this.threads,N=new Array(W.length);Sa.blit(W,0,N,0,W.length);this.threadsBuffer=N;let j=new Array(t),Y=(this.originPositionRef=j,this.originPositionRef),X=0,Z=Y.length;for(;X<Z;){Y[X++]=null}let H=this.originPositionRef,K=new Array(H.length);Sa.blit(H,0,K,0,H.length);this.originPositionRefBuffer=K;let q=new Array(t),J=(this.frameCount=q,this.frameCount),$=0,ee=J.length;for(;$<ee;){J[$++]=0}let te=this.frameCount,se=new Array(te.length);Sa.blit(te,0,se,0,te.length);this.frameCountBuffer=se;let re=new Array(t),ne=(this.dead=re,this.dead),ie=0,ae=ne.length;for(;ie<ae;){ne[ie++]=!1}let le=this.dead,he=new Array(le.length);Sa.blit(le,0,he,0,le.length);this.deadBuffer=he;let oe=new Array(t),_e=(this.id=oe,this.id),ce=0,ue=_e.length;for(;ce<ue;){_e[ce++]=-1}let de=this.id,pe=new Array(de.length);Sa.blit(de,0,pe,0,de.length);this.idBuffer=pe;let fe=new Array(t),xe=(this.entityId=fe,this.entityId),ge=0,be=xe.length;for(;ge<be;){xe[ge++]=0}let me=this.entityId,Ae=new Array(me.length);Sa.blit(me,0,Ae,0,me.length);this.entityIdBuffer=Ae;let we=new Array(t-0),ye=0,ke=0;for(;ke<t;)we[ye]=ke,++ye,++ke;this.entityIdReadIndexMap=we;let Be=s,Ce=new Array(Be.length);Sa.blit(Be,0,Ce,0,Be.length),this.readWriteIndexMap=Ce;let ve=this.id,Se=0;for(;Se<t;){let t=e<<16|Se;ve[Se]=t,++Se}Sa.blit(ve,0,this.idBuffer,0,t);let Me=this.entityId,Ie=Me.length,Te=0,Fe=0;for(;Te<Ie;)Me[Te]=Fe,++Te,++Fe;let Ee=this.entityIdBuffer,De=Ee.length,Re=0,Ve=0;for(;Re<De;)Ee[Re]=Ve,++Re,++Ve}synchronize(e,t){this.synchronizeBatch();let s=this.nextWriteIndex;Sa.blit(this.xBuffer,0,this.x,0,s),Sa.blit(this.yBuffer,0,this.y,0,s),Sa.blit(this.vxBuffer,0,this.vx,0,s),Sa.blit(this.vyBuffer,0,this.vy,0,s),Sa.blit(this.spriteBuffer,0,this.sprite,0,s),Sa.blit(this.threadsBuffer,0,this.threads,0,s),Sa.blit(this.originPositionRefBuffer,0,this.originPositionRef,0,s),Sa.blit(this.frameCountBuffer,0,this.frameCount,0,s),Sa.blit(this.deadBuffer,0,this.dead,0,s),Sa.blit(this.idBuffer,0,this.id,0,s),Sa.blit(this.entityIdBuffer,0,this.entityId,0,s);let r=this.entityId,n=this.entityIdReadIndexMap,i=0;for(;i<s;)n[r[i]]=i,++i;Sa.blit(t,0,this.readWriteIndexMap,0,e),this.endReadIndex=s;let a=this.spriteBuffer,l=this.xBuffer,h=this.yBuffer,o=this.readWriteIndexMap,_=this.endReadIndex,c=0,u=!1;for(;c<_;){let e=o[c],t=a[e],s=l[e],r=h[e];if(t.x=s,t.y=r,u){--this.nextWriteIndex;l[e]=l[this.nextWriteIndex],h[e]=h[this.nextWriteIndex],this.vxBuffer[e]=this.vxBuffer[this.nextWriteIndex],this.vyBuffer[e]=this.vyBuffer[this.nextWriteIndex];let t=this.nextWriteIndex,s=a[e];a[e]=a[t],a[t]=s;let r=this.threadsBuffer,n=this.nextWriteIndex,i=r[e];r[e]=r[n],r[n]=i,this.originPositionRefBuffer[e]=this.originPositionRefBuffer[this.nextWriteIndex],this.frameCountBuffer[e]=this.frameCountBuffer[this.nextWriteIndex],this.deadBuffer[e]=this.deadBuffer[this.nextWriteIndex];let _=this.idBuffer,c=this.nextWriteIndex,d=_[e];_[e]=_[c],_[c]=d;let p=this.entityIdBuffer,f=this.nextWriteIndex,x=p[e];p[e]=p[f],p[f]=x;let g=this.nextWriteIndex,b=o[e];o[e]=o[g],o[g]=b,u=!1}++c}return s}synchronizeBatch(){let e=this.batch,t=this.disusedCount;fe.removeSprites(e,this.disusedSprites,t),this.disusedCount=0;let s=this.usedCount;fe.addSprites(e,this.usedSprites,s),this.usedCount=0}}s["actor.ActorChunk"]=M,M.__name__="actor.ActorChunk",Object.assign(M.prototype,{__class__:M});class I{constructor(e,t,s,r,n,i,a){this.nextWriteChunkIndex=0,this.endReadChunkIndex=0;let l=[],h=0,o=e;for(;h<o;){let e=h++;l.push(e)}let _=l.slice(0),c=0,u=new Array(t),d=0,p=u.length;for(;d<p;){u[d++]=new M(c++,e,_,s,r,n,i,a)}this.chunks=u,this.chunkCapacity=e,this.capacity=t*e,this.defaultReadWriteIndexMap=_}synchronize(){let e,t=this.chunks,s=t.length,r=this.chunkCapacity,n=this.defaultReadWriteIndexMap,i=0,a=0;for(;a<s;)e=t[a].synchronize(r,n),0!=e&&(i=a),++a;let l=i+1;this.endReadChunkIndex=l}crashAll(){let e=this.chunks,t=this.chunkCapacity,s=this.endReadChunkIndex,r=0;for(;r<s;){let s=e[r],n=s.spriteBuffer,i=s.disusedSprites,a=s.disusedCount,l=s.readWriteIndexMap,h=s.endReadIndex,o=0,_=!1;for(;o<h;){let e=l[o],t=n[e];if(_=!0,i[a]=t,++a,t.x=-3402823e32,_){--s.nextWriteIndex;s.xBuffer[e]=s.xBuffer[s.nextWriteIndex],s.yBuffer[e]=s.yBuffer[s.nextWriteIndex],s.vxBuffer[e]=s.vxBuffer[s.nextWriteIndex],s.vyBuffer[e]=s.vyBuffer[s.nextWriteIndex];let t=s.nextWriteIndex,r=n[e];n[e]=n[t],n[t]=r;let i=s.threadsBuffer,a=s.nextWriteIndex,h=i[e];i[e]=i[a],i[a]=h,s.originPositionRefBuffer[e]=s.originPositionRefBuffer[s.nextWriteIndex],s.frameCountBuffer[e]=s.frameCountBuffer[s.nextWriteIndex],s.deadBuffer[e]=s.deadBuffer[s.nextWriteIndex];let o=s.idBuffer,c=s.nextWriteIndex,u=o[e];o[e]=o[c],o[c]=u;let d=s.entityIdBuffer,p=s.nextWriteIndex,f=d[e];d[e]=d[p],d[p]=f;let x=s.nextWriteIndex,g=l[e];l[e]=l[x],l[x]=g,_=!1}++o}s.disusedCount=a,s.nextWriteIndex<t&&r<this.nextWriteChunkIndex&&(this.nextWriteChunkIndex=r),++r}}update(e){let t=this.chunks,s=this.chunkCapacity,r=this.endReadChunkIndex,n=0;for(;n<r;){let r=t[n],i=r.programTable,a=r.spriteBuffer,l=r.xBuffer,h=r.yBuffer,o=r.vxBuffer,_=r.vyBuffer,c=r.threadsBuffer,u=r.originPositionRefBuffer,d=r.frameCountBuffer,p=r.disusedSprites,f=r.disusedCount,x=r.deadBuffer,g=r.rotationVelocity,b=r.eventHandler,m=r.emitter,A=r.readWriteIndexMap,w=r.endReadIndex,y=0,k=!1;for(;y<w;){let t,s=A[y],n=a[s],w=c[s];if(x[s])t=!0;else{let e=l[s],r=h[s];t=!(r<864&&-64<=r&&-364<=e&&e<364)}if(t){k=!0,p[f]=n,++f,n.x=-3402823e32}else{-1==Os.run(i,b,m,128,w,l,h,o,_,u,s,n,e)&&(x[s]=!0)}if(n.rotation+=g,d[s]+=1,k){--r.nextWriteIndex;r.xBuffer[s]=r.xBuffer[r.nextWriteIndex],r.yBuffer[s]=r.yBuffer[r.nextWriteIndex],r.vxBuffer[s]=r.vxBuffer[r.nextWriteIndex],r.vyBuffer[s]=r.vyBuffer[r.nextWriteIndex];let e=r.nextWriteIndex,t=a[s];a[s]=a[e],a[e]=t;let n=r.nextWriteIndex,i=c[s];c[s]=c[n],c[n]=i,r.originPositionRefBuffer[s]=r.originPositionRefBuffer[r.nextWriteIndex],r.frameCountBuffer[s]=r.frameCountBuffer[r.nextWriteIndex],r.deadBuffer[s]=r.deadBuffer[r.nextWriteIndex];let l=r.idBuffer,h=r.nextWriteIndex,o=l[s];l[s]=l[h],l[h]=o;let _=r.entityIdBuffer,u=r.nextWriteIndex,d=_[s];_[s]=_[u],_[u]=d;let p=r.nextWriteIndex,f=A[s];A[s]=A[p],A[p]=f,k=!1}++y}r.disusedCount=f,r.nextWriteIndex<s&&n<this.nextWriteChunkIndex&&(this.nextWriteChunkIndex=n),++n}}use(e,t,s,r,n,i){let a=this.chunks,l=this.chunkCapacity,h=this.nextWriteChunkIndex,o=a[h];for(;o.nextWriteIndex==l;)++h,o=a[h];let _=o.nextWriteIndex,c=o.spriteBuffer,u=o.xBuffer,d=o.yBuffer,p=o.vxBuffer,f=o.vyBuffer,x=o.threadsBuffer,g=o.originPositionRefBuffer,b=o.frameCountBuffer,m=o.deadBuffer,A=o.usedSprites,w=o.usedCount,y=c[_],k=x[_];if(u[_]=e,d[_]=t,p[_]=s,f[_]=r,null!=n){let e=n,t=k[0];t.active=!0;let s=e;t.code=s;let r=e.length;t.codeLength=r,t.programCounter=0,t.stackPointer=0,t.shotX=0,t.shotY=0,t.shotVx=0,t.shotVy=0;let i=k.length,a=1;for(;a<i;){let e=k[a];e.active=!1;let t=null;e.code=t,e.codeLength=0,e.programCounter=0,e.stackPointer=0,e.shotX=0,e.shotY=0,e.shotVx=0,e.shotVy=0,++a}}else{let e=k.length,t=0;for(;t<e;){let e=k[t];e.active=!1;let s=null;e.code=s,e.codeLength=0,e.programCounter=0,e.stackPointer=0,e.shotX=0,e.shotY=0,e.shotVx=0,e.shotVy=0,++t}}g[_]=i,b[_]=0,m[_]=!1,A[w]=y,++w,y.rotation=0;let B=_+1;o.nextWriteIndex=B,o.usedCount=w,this.nextWriteChunkIndex=h}}s["actor.ActorAosoa"]=I,I.__name__="actor.ActorAosoa",Object.assign(I.prototype,{__class__:I});class T{}s["ripper.Data"]=T,T.__name__="ripper.Data",T.__isInterface__=!0;class F{constructor(e,t,s){this.agents=e,this.bullets=t,this.targetPositionRef=s}update(){this.agents.update(this.targetPositionRef),this.bullets.update(this.targetPositionRef)}synchronize(){this.agents.synchronize(),this.bullets.synchronize()}crashAll(){this.agents.crashAll(),this.bullets.crashAll()}newAgent(e,t,s,r,n){this.agents.use(e,t,s,r,n,null)}}s["actor.Army"]=F,F.__name__="actor.Army",F.__interfaces__=[T],Object.assign(F.prototype,{__class__:F});class E{static createActors(e,t,s,r,n,i){let a=E.defaultChunkCapacity,l=a<e?a:e,h=Math.ceil(e/l),o=t.programTable;return new I(l,h,s,(function(){return new Fr(r)}),o,n,i)}}s["actor.ArmyBuilder"]=E,E.__name__="actor.ArmyBuilder";class D{static emptyString(){return"Invalid operation. String is empty."}}s["sinker.errors.Errors"]=D,D.__name__="sinker.errors.Errors";class R{static toHex(e,t,s){let r=new ro;if(s&&1<t){let s=t-1,n=0,i=s;for(;n<i;){let t=n++,s=e.b[t],i=s>>4,a=R.hexChars[i];r.b+=String.fromCodePoint(a);let l=15&s,h=R.hexChars[l];r.b+=String.fromCodePoint(h),r.b+=String.fromCodePoint(32)}let a=e.b[s],l=a>>4,h=R.hexChars[l];r.b+=String.fromCodePoint(h);let o=15&a,_=R.hexChars[o];r.b+=String.fromCodePoint(_)}else{let s=0,n=t;for(;s<n;){let t=s++,n=e.b[t],i=n>>4,a=R.hexChars[i];r.b+=String.fromCodePoint(a);let l=15&n,h=R.hexChars[l];r.b+=String.fromCodePoint(h)}}return r.b}}class V{constructor(e,t){this.value=e,this.size=t}}s["banker.binary.value_types.PopReturn"]=V,V.__name__="banker.binary.value_types.PopReturn",Object.assign(V.prototype,{__class__:V});class O{constructor(e,t,s){this.x=e,this.y=t,this.size=s}}s["banker.binary.value_types.PopReturn2D"]=O,O.__name__="banker.binary.value_types.PopReturn2D",Object.assign(O.prototype,{__class__:O});class P{constructor(e,t,s){this.x=e,this.y=t,this.size=s}}s["banker.binary.value_types.PopReturn2D_Float"]=P,P.__name__="banker.binary.value_types.PopReturn2D_Float",Object.assign(P.prototype,{__class__:P});class Q{constructor(e,t,s){this.x=e,this.y=t,this.size=s}}s["banker.binary.value_types.PopReturn2D_banker_binary_value_types_Float32"]=Q,Q.__name__="banker.binary.value_types.PopReturn2D_banker_binary_value_types_Float32",Object.assign(Q.prototype,{__class__:Q});class L{constructor(e,t){this.value=e,this.size=t}}s["banker.binary.value_types.PopReturn_Float"]=L,L.__name__="banker.binary.value_types.PopReturn_Float",Object.assign(L.prototype,{__class__:L});class G{constructor(e,t){this.value=e,this.size=t}}s["banker.binary.value_types.PopReturn_banker_binary_value_types_Float32"]=G,G.__name__="banker.binary.value_types.PopReturn_banker_binary_value_types_Float32",Object.assign(G.prototype,{__class__:G});class z{constructor(e,t){this.value=e,this.size=t}}s["banker.binary.value_types.PopReturn_haxe_Int32"]=z,z.__name__="banker.binary.value_types.PopReturn_haxe_Int32",Object.assign(z.prototype,{__class__:z});class U{constructor(e,t){this.value=e,this.size=t}}s["banker.binary.value_types.PopReturn_haxe_Int64"]=U,U.__name__="banker.binary.value_types.PopReturn_haxe_Int64",Object.assign(U.prototype,{__class__:U});class W{constructor(e,t){this.x=e,this.y=t}}s["banker.binary.value_types.TmpVec2D32"]=W,W.__name__="banker.binary.value_types.TmpVec2D32",Object.assign(W.prototype,{__class__:W});class N{constructor(e,t){this.x=e,this.y=t}}s["banker.binary.value_types.TmpVec2D64"]=N,N.__name__="banker.binary.value_types.TmpVec2D64",Object.assign(N.prototype,{__class__:N});class j{}s["sneaker.tag.interfaces.Tagged"]=j,j.__name__="sneaker.tag.interfaces.Tagged",j.__isInterface__=!0;class Y{}s["banker.common.LimitedCapacityBuffer"]=Y,Y.__name__="banker.common.LimitedCapacityBuffer",Y.__isInterface__=!0,Y.__interfaces__=[j];class X{constructor(){X._hx_skip_constructor||this._hx_constructor()}_hx_constructor(){this.tag=io.anonymous}}s["sneaker.tag.Tagged"]=X,X.__name__="sneaker.tag.Tagged",X.__interfaces__=[j],Object.assign(X.prototype,{__class__:X});class Z{}s["ripper.Body"]=Z,Z.__name__="ripper.Body",Z.__isInterface__=!0;class H extends X{constructor(e){X._hx_skip_constructor?super():(X._hx_skip_constructor=!0,super(),X._hx_skip_constructor=!1,this._hx_constructor(e))}_hx_constructor(e){this.nextFreeSlotIndex=0,super._hx_constructor();let t=new Array(e);this.vector=t}}s["banker.container.buffer.top_aligned.TopAlignedBuffer_broker_timer_builtin_heaps_PooledFadeOutTimer_h2d_Bitmap"]=H,H.__name__="banker.container.buffer.top_aligned.TopAlignedBuffer_broker_timer_builtin_heaps_PooledFadeOutTimer_h2d_Bitmap",H.__interfaces__=[Y],H.__super__=X,Object.assign(H.prototype,{__class__:H});class K extends X{constructor(e){X._hx_skip_constructor?super():(X._hx_skip_constructor=!0,super(),X._hx_skip_constructor=!1,this._hx_constructor(e))}_hx_constructor(e){this.nextFreeSlotIndex=0,super._hx_constructor();let t=new Array(e);this.vector=t}}s["banker.container.buffer.top_aligned.TopAlignedBuffer_h2d_Bitmap"]=K,K.__name__="banker.container.buffer.top_aligned.TopAlignedBuffer_h2d_Bitmap",K.__interfaces__=[Y],K.__super__=X,Object.assign(K.prototype,{__class__:K});class q{}s["banker.map.interfaces.Convert"]=q,q.__name__="banker.map.interfaces.Convert",q.__isInterface__=!0;class J{}s["banker.map.interfaces.Set"]=J,J.__name__="banker.map.interfaces.Set",J.__isInterface__=!0;class ${}s["banker.map.interfaces.Sequence"]=$,$.__name__="banker.map.interfaces.Sequence",$.__isInterface__=!0;class ee{}s["banker.map.interfaces.Map"]=ee,ee.__name__="banker.map.interfaces.Map",ee.__isInterface__=!0;class te extends X{constructor(e){X._hx_skip_constructor=!0,super(),X._hx_skip_constructor=!1,this._hx_constructor(e)}_hx_constructor(e){this.nextFreeSlotIndex=0,super._hx_constructor();let t=new Array(e);this.keyVector=t;let s=new Array(e);this.valueVector=s}}s["banker.map.buffer.top_aligned.TopAlignedBuffer_String_sinker_UInt"]=te,te.__name__="banker.map.buffer.top_aligned.TopAlignedBuffer_String_sinker_UInt",te.__interfaces__=[Y],te.__super__=X,Object.assign(te.prototype,{__class__:te});class se extends te{constructor(e){super(e)}}s["banker.map.ArrayMap_String_sinker_UInt"]=se,se.__name__="banker.map.ArrayMap_String_sinker_UInt",se.__interfaces__=[Z,q,J,$,ee],se.__super__=te,Object.assign(se.prototype,{__class__:se});class re extends X{constructor(e){X._hx_skip_constructor=!0,super(),X._hx_skip_constructor=!1,this._hx_constructor(e)}_hx_constructor(e){this.nextFreeSlotIndex=0,super._hx_constructor();let t=new Array(e);this.keyVector=t;let s=new Array(e);this.valueVector=s}}s["banker.map.buffer.top_aligned.TopAlignedBuffer_broker_sound_Sound_sinker_UInt"]=re,re.__name__="banker.map.buffer.top_aligned.TopAlignedBuffer_broker_sound_Sound_sinker_UInt",re.__interfaces__=[Y],re.__super__=X,Object.assign(re.prototype,{__class__:re});class ne extends re{constructor(e){super(e)}}s["banker.map.ArrayMap_broker_sound_Sound_sinker_UInt"]=ne,ne.__name__="banker.map.ArrayMap_broker_sound_Sound_sinker_UInt",ne.__interfaces__=[Z,q,J,$,ee],ne.__super__=re,Object.assign(ne.prototype,{__class__:ne});class ie{}s["banker.pool.interfaces.ObjectPool"]=ie,ie.__name__="banker.pool.interfaces.ObjectPool",ie.__isInterface__=!0,ie.__interfaces__=[Y],Object.assign(ie.prototype,{__class__:ie});class ae extends H{constructor(e,t){X._hx_skip_constructor?super():(X._hx_skip_constructor=!0,super(),X._hx_skip_constructor=!1,this._hx_constructor(e,t))}_hx_constructor(e,t){super._hx_constructor(e);let s=this.vector,r=0,n=s.length;for(;r<n;){s[r++]=t()}let i=s.length;if(0!=i){let e,t=0,r=i;for(;t<i;){--r;e=s[t],s[t]=s[r],s[r]=e,++t}}this.nextFreeSlotIndex=e}}s["banker.pool.ObjectPoolBuffer_broker_timer_builtin_heaps_PooledFadeOutTimer_h2d_Bitmap"]=ae,ae.__name__="banker.pool.ObjectPoolBuffer_broker_timer_builtin_heaps_PooledFadeOutTimer_h2d_Bitmap",ae.__interfaces__=[Z],ae.__super__=H,Object.assign(ae.prototype,{__class__:ae});class le extends ae{constructor(e,t){X._hx_skip_constructor?super():(X._hx_skip_constructor=!0,super(),X._hx_skip_constructor=!1,this._hx_constructor(e,t))}_hx_constructor(e,t){let s=this;super._hx_constructor(e,t),this.putCallback=function(e){s.put(e)}}get(){let e=this.nextFreeSlotIndex-1;return this.nextFreeSlotIndex=e,this.vector[e]}put(e){let t=this.nextFreeSlotIndex;this.vector[t]=e;let s=t+1;this.nextFreeSlotIndex=s}}s["banker.pool.ObjectPoolBase_broker_timer_builtin_heaps_PooledFadeOutTimer_h2d_Bitmap"]=le,le.__name__="banker.pool.ObjectPoolBase_broker_timer_builtin_heaps_PooledFadeOutTimer_h2d_Bitmap",le.__interfaces__=[ie],le.__super__=ae,Object.assign(le.prototype,{__class__:le});class he extends K{constructor(e,t){X._hx_skip_constructor?super():(X._hx_skip_constructor=!0,super(),X._hx_skip_constructor=!1,this._hx_constructor(e,t))}_hx_constructor(e,t){super._hx_constructor(e);let s=this.vector,r=0,n=s.length;for(;r<n;){s[r++]=t()}let i=s.length;if(0!=i){let e,t=0,r=i;for(;t<i;){--r;e=s[t],s[t]=s[r],s[r]=e,++t}}this.nextFreeSlotIndex=e}}s["banker.pool.ObjectPoolBuffer_h2d_Bitmap"]=he,he.__name__="banker.pool.ObjectPoolBuffer_h2d_Bitmap",he.__interfaces__=[Z],he.__super__=K,Object.assign(he.prototype,{__class__:he});class oe extends he{constructor(e,t){X._hx_skip_constructor=!0,super(),X._hx_skip_constructor=!1,this._hx_constructor(e,t)}_hx_constructor(e,t){let s=this;super._hx_constructor(e,t),this.putCallback=function(e){s.put(e)}}get(){let e=this.nextFreeSlotIndex-1;return this.nextFreeSlotIndex=e,this.vector[e]}put(e){let t=this.nextFreeSlotIndex;this.vector[t]=e;let s=t+1;this.nextFreeSlotIndex=s}}s["banker.pool.ObjectPoolBase_h2d_Bitmap"]=oe,oe.__name__="banker.pool.ObjectPoolBase_h2d_Bitmap",oe.__interfaces__=[ie],oe.__super__=he,Object.assign(oe.prototype,{__class__:oe});class _e extends le{_hx_constructor(e,t){super._hx_constructor(e,t),this.factory=t}get(){if(0!=this.nextFreeSlotIndex)return super.get();this.tag;return this.factory()}put(e){if(this.nextFreeSlotIndex<this.vector.length)super.put(e);else{this.tag}}newTag(e,t){return this.tag=new no(e,t),this}}s["banker.pool.SafeObjectPool_broker_timer_builtin_heaps_PooledFadeOutTimer_h2d_Bitmap"]=_e,_e.__name__="banker.pool.SafeObjectPool_broker_timer_builtin_heaps_PooledFadeOutTimer_h2d_Bitmap",_e.__super__=le,Object.assign(_e.prototype,{__class__:_e});class ce extends oe{constructor(e,t){super(e,t),this.factory=t}get(){if(0!=this.nextFreeSlotIndex)return super.get();this.tag;return this.factory()}put(e){if(this.nextFreeSlotIndex<this.vector.length)super.put(e);else{this.tag}}newTag(e,t){return this.tag=new no(e,t),this}}s["banker.pool.SafeObjectPool_h2d_Bitmap"]=ce,ce.__name__="banker.pool.SafeObjectPool_h2d_Bitmap",ce.__super__=oe,Object.assign(ce.prototype,{__class__:ce});class ue{}s["h3d.IDrawable"]=ue,ue.__name__="h3d.IDrawable",ue.__isInterface__=!0;class de{constructor(){let e=Wr.CURRENT,t=this;null!=e?(this.engine=e,e.onReady=ao(this,this.setup),ha.delay(ao(this,this.setup),0)):al.start((function(){e=new Wr,t.engine=e,e.onReady=ao(t,t.setup),e.init()}))}onResize(){}setScene(e,t){null==t&&(t=!0);let s=e instanceof Tr?e:null,r=e instanceof Ai?e:null;if(null!=s?(this.sevents.removeScene(this.s2d),this.sevents.addScene(e,0)):(null!=r&&this.sevents.removeScene(this.s3d),this.sevents.addScene(e)),t)if(null!=s)this.s2d.dispose();else{if(null==r)throw $i.thrown("Can't dispose previous scene");this.s3d.dispose()}null!=s&&(this.s2d=s),null!=r&&(this.s3d=r)}render(e){this.s3d.render(e),this.s2d.render(e)}setup(){let e=!1;this.engine.onReady=de.staticHandler;let t=this;this.engine.onResized=function(){null!=t.s2d&&(t.s2d.checkResize(),e&&t.onResize())},this.s3d=new Ai,this.s2d=new Tr,this.sevents=new tl,this.sevents.addScene(this.s2d),this.sevents.addScene(this.s3d),this.loadAssets((function(){e=!0,t.init(),nl.skip(),t.mainLoop(),al.setLoop(ao(t,t.mainLoop)),qa.initialize()}))}loadAssets(e){e()}init(){}mainLoop(){if(nl.update(),this.sevents.checkEvents(),this.isDisposed)return;if(this.update(nl.dt),this.isDisposed)return;let e=nl.dt;null!=this.s2d&&this.s2d.setElapsedTime(e),null!=this.s3d&&this.s3d.setElapsedTime(e),this.engine.render(this)}update(e){}static staticHandler(){}}s["hxd.App"]=de,de.__name__="hxd.App",de.__interfaces__=[ue],Object.assign(de.prototype,{__class__:de});class pe extends de{constructor(e){super(),this.app=e}init(){Le.initialize(this.app.startFullscreen),xe.initialize(),class{static initialize(){be.initialize()}}.initialize(),Be.setApplication(d.data),(new Be).activate(),this.app.initialize()}update(e){this.app.update();this.app;Re.update(),++d.frameCount}render(e){super.render(e)}}s["broker.HeapsApp"]=pe,pe.__name__="broker.HeapsApp",pe.__super__=de,Object.assign(pe.prototype,{__class__:pe});class fe{static addSprites(e,t,s){let r=0;for(;r<s;){let s=t[r];if(s.batch=e,null==e.first)e.first=s,e.last=s,s.prev=null,s.next=null;else{let t=e.last;t.next=s,s.prev=t,s.next=null,e.last=s}++r}}static removeSprites(e,t,s){let r=0;for(;r<s;)e.delete(t[r]),++r}}class xe{static initialize(){Ae.initialize()}}s["broker.input.physical.Key"]=xe,xe.__name__="broker.input.physical.Key";class ge{constructor(){this.rawYAxis=0,this.rawXAxis=0,this.prevButtons=[],this.values=[],this.buttons=[],this.config=ge.DEFAULT_CONFIG,this.index=-1,this.connected=!0}onDisconnect(){}static pickConfig(e){switch(e){case"054c-05c4-Wireless Controller":case"054c-09cc-Wireless Controller":return ge.CONFIG_JS_DS4_FF;case"Wireless Controller (STANDARD GAMEPAD Vendor: 054c Product: 05c4)":case"Wireless Controller (STANDARD GAMEPAD Vendor: 054c Product: 09cc)":return ge.CONFIG_JS_DS4;default:return ge.CONFIG_JS_STD}}static createDummy(){let e=new ge;return e.connected=!1,e}static wait(e){ge.waitPad=e,ge.initDone||(ge.initDone=!0,window.addEventListener("gamepadconnected",(function(e){let t=new ge;t.d=e.gamepad,t.config=ge.pickConfig(t.d.id),t.index=t.d.index,ge.pads.h[t.d.index]=t,ge.waitPad(t)})),window.addEventListener("gamepaddisconnected",(function(e){let t=ge.pads.h[e.gamepad.index];null!=t&&(ge.pads.remove(e.gamepad.index),t.connected=!1,t.onDisconnect())})),na.add(ge.syncPads))}static syncPads(){let t=[];try{t=e.navigator.getGamepads()}catch(e){}if(t.length>0){let e=0,s=t.length;for(;e<s;){let s=e++;null!=ge.pads.h[s]&&(ge.pads.h[s].d=t[s])}}let s=ge.pads.iterator();for(;s.hasNext();){let e=s.next(),t=0,r=e.d.buttons.length;for(;t<r;){let s=t++;e.prevButtons[s]=e.buttons[s],e.buttons[s]=e.d.buttons[s].pressed,e.values[s]=e.d.buttons[s].value}let n=0,i=e.d.axes.length>>1;for(;n<i;){let t=n++,s=e.d.axes[t<<1],r=e.d.axes[1+(t<<1)];e.values[(t<<1)+e.d.buttons.length]=s,e.values[(t<<1)+e.d.buttons.length+1]=-r,0==t&&(e.rawXAxis=s,e.rawYAxis=r)}}}}s["hxd.Pad"]=ge,ge.__name__="hxd.Pad",Object.assign(ge.prototype,{__class__:ge});class be{static initialize(){ge.wait(me.connect)}static setOnDisconnect(e,t){e.onDisconnect=t}}class me{static createPorts(e){let t=new Array(e),s=0,r=t.length;for(;s<r;){let e=s++,r=new Array(1);r[0]=be.NULL;let n=r;t[e]=n}return t}}me.onConnect=function(e,t){},me.onDisconnect=function(e,t){},me.connect=function(e){let t=me.ports,s=me.portIsEmpty,r=t.length,n=-1,i=0;for(;i<r;){if(s(t[i])){n=i;break}++i}if(-1==n)return;let a=n;me.ports[a][0]=e,me.onConnect(e,a),be.setOnDisconnect(e,(function(){me.onDisconnect(e,a),me.ports[a][0]=be.NULL}))},me.portIsEmpty=function(e){return e[0]==be.NULL},s["broker.input.physical.PadMultitap"]=me,me.__name__="broker.input.physical.PadMultitap";class Ae{static initialize(){qa.initialize(),qa.keyPressed.length=256}}s["broker.input.physical.heaps.Key"]=Ae,Ae.__name__="broker.input.physical.heaps.Key";class we{constructor(){let e=new gr;this.background=e;let t=new gr;this.main=t;let s=new gr;this.surface=s}addTo(e){e.addChild(this.background),e.addChild(this.main),e.addChild(this.surface)}}s["broker.scene.Layers"]=we,we.__name__="broker.scene.Layers",Object.assign(we.prototype,{__class__:we});class ye extends X{constructor(e,t){super(),this.scenes=[e];e.sceneStack=this,e.activate()}peek(){let e=this.scenes;return e[e.length-1]}update(){this.peek().step()}}s["broker.scene.SceneStack"]=ye,ye.__name__="broker.scene.SceneStack",ye.__super__=X,Object.assign(ye.prototype,{__class__:ye});class ke{constructor(e,t,s){null==s&&(s=16);let r=this;this.data=e,this.isInitialized=!1;this.sceneStack=null,this.layers=t,this.timers=new Pe(s),this.isActive=!1,this.isTransitioning=!1,this.setTransitionState=Ee.dummyCallback,this.unsetTransitionState=Ee.dummyCallback,this.setTransitionState=function(){r.isTransitioning=!0},this.unsetTransitionState=function(){r.isTransitioning=!1}}initialize(){this.isInitialized=!0}update(){}step(){this.isActive&&this.update(),this.timers.step()}activate(){this.isInitialized||this.initialize(),this.isTransitioning=!1,this.isActive=!0,this.step()}}s["broker.scene.internal.Scene"]=ke,ke.__name__="broker.scene.internal.Scene",Object.assign(ke.prototype,{__class__:ke});class Be extends ke{constructor(e,t){let s=null!=e?e:new Tr;s.ctx.defaultSmooth=!0,s.set_scaleMode(Mr.LetterBox(d.width,d.height));let r=new we;super(s,r,t);let n=new Br(d.width,d.height,s);r.addTo(n)}activate(){super.activate(),Fe.heapsApp.setScene(this.data,!1)}fadeInFrom(e,t,s){let r=this.useSurfaceBitmap(e);r.alpha=0;let n=Fe.bitmapFadeOutTimerPool.use(r,t,!0);if(n.setOnCompleteObject(Fe.bitmapPool.putCallback),s){let e=this.timers,t=e.bufferSize;e.bufferVector[t]=n;let s=t+1;e.bufferSize=s,n.setParent(e)}return n}useSurfaceBitmap(e){let t=this.resetCoverBitmap(Fe.bitmapPool.get(),e);return this.layers.surface.addChild(t),t}resetCoverBitmap(e,t){let s=16777215&t,r=.00392156862745098*(t>>>24),n=r<0?0:r>1?1:r,i=Pn.fromColor(s,n),a=e.tile;a.setTexture(i);let l=this.data;return a.setSize(l.width,l.height),e}static setApplication(e){Fe.setApplication(e)}}s["broker.scene.heaps.Scene"]=Be,Be.__name__="broker.scene.heaps.Scene",Be.__super__=ke,Object.assign(Be.prototype,{__class__:Be});class Ce{constructor(e,t,s){Ce._hx_skip_constructor||this._hx_constructor(e,t,s)}_hx_constructor(e,t,s){this.progress=0,this.progressChangeRate=1,this.onStartCallback=null!=t?t:Ce.dummyCallback,this.onCompleteCallback=null!=s?s:Ce.dummyCallback;this.next=null;this.parent=null,null!=e&&this.setDuration(e)}step(){let e=this.progress;return 0==e?(this.onStart(),this.onProgress(e),this.progress=e+this.progressChangeRate,!1):e<1?(this.onProgress(e),this.progress=e+this.progressChangeRate,!1):(this.onComplete(),!0)}clearCallbacks(){return this.onStartCallback=Ce.dummyCallback,this.onCompleteCallback=Ce.dummyCallback,this}clearNext(){return this.next=null,this}clearParent(){return this.parent=null,this}setParent(e){let t=e;return this.parent=t,this}setDuration(e){return this.progress=0,this.progressChangeRate=0==e?0:1/e,this}onStart(){this.onStartCallback()}onProgress(e){}onComplete(){let e=this.parent,t=this.next;if(null!=e&&null!=t){let s=e,r=t,n=s.bufferSize;s.bufferVector[n]=r;let i=n+1;s.bufferSize=i,r.setParent(s)}this.onCompleteCallback()}}Ce.dummyCallback=function(){},s["broker.timer.Timer"]=Ce,Ce.__name__="broker.timer.Timer",Object.assign(Ce.prototype,{__class__:Ce});class ve extends Ce{constructor(){Ce._hx_skip_constructor?super():(Ce._hx_skip_constructor=!0,super(),Ce._hx_skip_constructor=!1,this._hx_constructor())}_hx_constructor(){this.object=null,super._hx_constructor(),this.onStartObjectCallback=Se.dummyObjectCallback,this.onCompleteObjectCallback=Se.dummyObjectCallback}clearCallbacks(){return super.clearCallbacks(),this.onStartObjectCallback=Se.dummyObjectCallback,this.onCompleteObjectCallback=Se.dummyObjectCallback,this}setOnCompleteObject(e){return this.onCompleteObjectCallback=e,this}onStart(){super.onStart(),this.onStartObjectCallback(this.object)}onComplete(){super.onComplete(),this.onCompleteObjectCallback(this.object)}}s["broker.timer.builtin.heaps.ObjectTimer_h2d_Bitmap"]=ve,ve.__name__="broker.timer.builtin.heaps.ObjectTimer_h2d_Bitmap",ve.__super__=Ce,Object.assign(ve.prototype,{__class__:ve});class Se{}Se.dummyObjectCallback=function(e){},s["broker.timer.builtin.heaps._ObjectTimer.ObjectTimerStatics"]=Se,Se.__name__="broker.timer.builtin.heaps._ObjectTimer.ObjectTimerStatics";class Me extends _e{constructor(e){X._hx_skip_constructor=!0,super(),X._hx_skip_constructor=!1,this._hx_constructor(e)}_hx_constructor(e){let t=this;super._hx_constructor(e,(function(){return new Te(t)}))}get(){throw $i.thrown("Not implemented. Call use() instead of get().")}use(e,t,s){null==s&&(s=!1);let r=super.get();return Oe.reset(r,t),r.object=e,r.pool=this,r.removeOnComplete=s,r}}s["broker.timer.builtin.heaps.FadeOutTimerPool_h2d_Bitmap"]=Me,Me.__name__="broker.timer.builtin.heaps.FadeOutTimerPool_h2d_Bitmap",Me.__super__=_e,Object.assign(Me.prototype,{__class__:Me});class Ie extends ve{constructor(){Ce._hx_skip_constructor=!0,super(),Ce._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.removeOnComplete=!1,super._hx_constructor()}onProgress(e){this.object.alpha=1-e}onComplete(){super.onComplete();let e=this.object;this.removeOnComplete?null!=e&&null!=e.parent&&e.parent.removeChild(e):e.alpha=0}}s["broker.timer.builtin.heaps.FadeOutTimer_h2d_Bitmap"]=Ie,Ie.__name__="broker.timer.builtin.heaps.FadeOutTimer_h2d_Bitmap",Ie.__super__=ve,Object.assign(Ie.prototype,{__class__:Ie});class Te extends Ie{constructor(e){super(),this.pool=e}onComplete(){super.onComplete(),this.pool.put(this)}}s["broker.timer.builtin.heaps.PooledFadeOutTimer_h2d_Bitmap"]=Te,Te.__name__="broker.timer.builtin.heaps.PooledFadeOutTimer_h2d_Bitmap",Te.__super__=Ie,Object.assign(Te.prototype,{__class__:Te});class Fe{static setApplication(e){Fe.heapsApp=e;let t=new ce(4,(function(){return new mr(Dr.fromColor(16777215))}));t.newTag("Scene Bitmap pool"),Fe.bitmapPool=t}}s["broker.scene.heaps.SceneStatics"]=Fe,Fe.__name__="broker.scene.heaps.SceneStatics";class Ee{}Ee.dummyCallback=function(){},s["broker.scene.internal._Scene.SceneStatics"]=Ee,Ee.__name__="broker.scene.internal._Scene.SceneStatics";class De{constructor(e,t,s,r,n,i,a){null==i&&(i=!1),null==n&&(n=0),null==r&&(r=!1),null==s&&(s=1),null==t&&(t=1),this.data=e,this.defaultVolume=t,this.minInterval=s,this.isLooped=r,this.maxQueueCount=n,this.allowsLayered=i,this.onPlay=null!=a?a:De.emptyOnPlay;this.lastPlayedChannel=null,this.lastPlayedFrameCount=0}play(){let e=Re.frameCount,t=this.lastPlayedChannel;if(null!=t){if(e-this.lastPlayedFrameCount<this.minInterval){return Re.enqueue(this),null}this.allowsLayered||t.stop()}let s=this.data.play(this.isLooped,this.defaultVolume);this.onPlay(this,s);let r=s;return this.lastPlayedChannel=r,this.lastPlayedFrameCount=e,s}}De.emptyOnPlay=function(e,t){},s["broker.sound.Sound"]=De,De.__name__="broker.sound.Sound",Object.assign(De.prototype,{__class__:De});class Re{static enqueue(e){let t=e.maxQueueCount;if(0==t)return;let s=Re.queuedSounds,r=s.keyVector,n=s.nextFreeSlotIndex,i=!1,a=0;for(;a<n;){if(r[a]==e){i=!0;break}++a}if(i){let r=s.keyVector,n=s.nextFreeSlotIndex,i=-1,a=0;for(;a<n;){if(r[a]==e){i=a;break}++a}let l=i,h=s.valueVector[l]+1;if(h<=t){let t=s.nextFreeSlotIndex,r=s.keyVector,n=r,i=-1,a=0;for(;a<t;){if(n[a]==e){i=a;break}++a}let l=i;if(-1!=l)s.valueVector[l]=h;else{r[t]=e,s.valueVector[t]=h;let n=t+1;s.nextFreeSlotIndex=n}}}else{if(s.nextFreeSlotIndex==s.keyVector.length){let e=2;s=new ne(s.keyVector.length*e),Re.queuedSounds=s}let t=1,r=s.nextFreeSlotIndex,n=s.keyVector,i=n,a=-1,l=0;for(;l<r;){if(i[l]==e){a=l;break}++l}let h=a;if(-1!=h)s.valueVector[h]=t;else{n[r]=e,s.valueVector[r]=t;let i=r+1;s.nextFreeSlotIndex=i}}}static update(){let e=Re.masterVolumeChangeTimer,t=e[0];if(null!=t&&t.step()){let t=null;e[0]=t}let s=Re.queuedSounds,r=Re.updateQueues,n=s.keyVector,i=s.valueVector,a=!1,l=s.nextFreeSlotIndex,h=0;for(;h<l;){if(!r(n[h],i[h])){++h;continue}--l;n[h]=n[l],i[h]=i[l],a=!0}s.nextFreeSlotIndex=l,++Re.frameCount}}Re.updateQueues=function(e,t){if(Re.frameCount-e.lastPlayedFrameCount<e.minInterval)return!1;e.play();--t;let s=Re.queuedSounds,r=s.nextFreeSlotIndex,n=s.keyVector,i=n,a=-1,l=0;for(;l<r;){if(i[l]==e){a=l;break}++l}let h=a;if(-1!=h)s.valueVector[h]=t;else{n[r]=e,s.valueVector[r]=t;let i=r+1;s.nextFreeSlotIndex=i}return 0==t},s["broker.sound.SoundManager"]=Re,Re.__name__="broker.sound.SoundManager";class Ve{static disposeAll(){Vl.get().dispose()}}s["broker.sound.heaps.SoundManagerData"]=Ve,Ve.__name__="broker.sound.heaps.SoundManagerData";class Oe{static reset(e,t){return e.setDuration(t),e.clearCallbacks(),e.clearNext(),e.clearParent(),e}}s["broker.timer.TimerExtension"]=Oe,Oe.__name__="broker.timer.TimerExtension";class Pe{constructor(e){let t=new Array(e);this.vector=t,this.size=0;let s=new Array(e);this.bufferVector=s,this.bufferSize=0}step(){let e=this.vector,t=this.size,s=this.bufferSize;if(0!=s){let r=0;Sa.blit(this.bufferVector,r,e,t,s),this.bufferSize=0,t=t+s}let r=0,n=0;for(;r<t;){let t=e[r];++r,t.step()?t.clearParent():(e[n]=t,++n)}this.size=n}}s["broker.timer.Timers"]=Pe,Pe.__name__="broker.timer.Timers",Object.assign(Pe.prototype,{__class__:Pe});class Qe{static stop(){}}s["broker.tools.PerformanceProfiler"]=Qe,Qe.__name__="broker.tools.PerformanceProfiler";class Le{static initialize(e){il.getInstance().onClose=function(){return Le.prepareClose(),!0}}static prepareClose(){Ve.disposeAll(),Qe.stop(),Le.onClose()}}Le.onClose=function(){},s["broker.tools.Window"]=Le,Le.__name__="broker.tools.Window";class Ge{static assemble(e){let t=new ya,s=[],r=0,n=0,i=e.length;for(;n<i;){let i=e[n++];if(2==i._hx_index){let e=i.labelId;t.h[e]=r}else{s.push(i);r=r+Ze.bytecodeLength(i)}}let a=new ze,l=[],h=0,o=s.length;for(;h<o;){let e=s[h++],r=Xe.toWordArray(e,t,a),n=l.length,i=0,o=r.length,_=n+o;for(l.length=_;i<o;){let e=i;l[n]=r[e],++n,++i}}let _=0,c=0,u=l.length;for(;c<u;){let e,t=l[c++];switch(t._hx_index){case 0:t.code;e=1;break;case 1:t.value;e=4;break;case 2:t.value;e=8}_=_+e}let d=new da(new ArrayBuffer(_)),p=d,f=0,x=0,g=l.length;for(;x<g;){let e=l[x++];switch(e._hx_index){case 0:let t=e.code;p.b[f]=t,f=f+1;break;case 1:let s=e.value;p.setInt32(f,s),f=f+4;break;case 2:let r=e.value;p.setDouble(f,r),f=f+8}}return d}}s["firedancer.assembly.Assembler"]=Ge,Ge.__name__="firedancer.assembly.Assembler";class ze{constructor(){this.addressStackMap=new va,this.table=[]}let(e,t){let s=0,r=!1,n=0,i=this.table.length;for(;n<i;){let i,a=n++,l=a,h=this.table[l];switch(t){case 0:i=4;break;case 1:i=8;break;case 2:i=16}if(s+i<h.address){this.table.splice(a,0,{key:e,address:s,type:t}),r=!0;break}{let e,t=h.address;switch(h.type){case 0:e=4;break;case 1:e=8;break;case 2:e=16}s=t+e}}if(!r){this.table.push({key:e,address:s,type:t})}let a=this.addressStackMap.h[e];if(null!=a){a.push(s)}else this.addressStackMap.h[e]=[s]}getAddress(e){let t=this.addressStackMap.h[e];if(null==t)throw $i.thrown(ze.notFound(e));let s,r=t.length-1;if(-1!=r){s=t[r]}else{s=null}if(null==s)throw $i.thrown(ze.notFound(e));return s}free(e){let t=this.addressStackMap.h[e];if(null==t)throw $i.thrown(ze.notFound(e));let s=t.pop(),r=this.table,n=0,i=r.length;for(;n<i;){let t=n++,i=r[t];if(i.key==e&&i.address==s){let e=t,s=r.length,n=s-e-1,i=(r[e],e+1);if(i<e){let t=i+n,s=e+n;for(;t>i;){--t,--s;r[s]=r[t]}}else if(i>e){let t=i,s=e,a=i+n;for(;t<a;)r[s]=r[t],++t,++s}let a=s-1;r.length=a;break}}}static notFound(e){return"Variable not found: "+e}}s["firedancer.assembly.VariableTable"]=ze,ze.__name__="firedancer.assembly.VariableTable",Object.assign(ze.prototype,{__class__:ze});class Ue{static toString(e){let t=e.length,s=[];s.length=t;let r=s,n=0;for(;n<t;)r[n]=Ze.toString(e[n]),++n;return r.join("\n")+"\n"}}class We{constructor(e,t){this.codeList=e,this.nameIndexMap=t}optimize(){let e=this.codeList,t=lt.optimize,s=e.length,r=[];r.length=s;let n=r,i=0;for(;i<s;)n[i]=t(e[i]),++i;return new We(n,this.nameIndexMap)}assemble(){let e=this.codeList,t=Ge.assemble,s=e.length,r=[];r.length=s;let n=r,i=0;for(;i<s;)n[i]=t(e[i]),++i;let a=n.slice(0);return new Ds(a,this.nameIndexMap)}toString(){let e=this.codeList,t=e.length,s=new Array(t),r=va.kvIterator(this.nameIndexMap.h);for(;r.hasNext();){let e=r.next(),t=e.key;s[e.value]=t}let n=new ro,i=e.length-1,a=0,l=e.length;for(;a<l;){let t=a++,r=s[t],l=null!=r?r:"(anonymous)";n.b+=x.string(x.string("[ASSEMBLY CODE] ID: "+t+", name: "+l)+"\n");let h=t,o=""+Ue.toString(e[h]);n.b+=x.string(o),t<i&&(n.b+=String.fromCodePoint(10))}return n.b}}s["firedancer.assembly.AssemblyCodePackage"]=We,We.__name__="firedancer.assembly.AssemblyCodePackage",Object.assign(We.prototype,{__class__:We});class Ne{static constructLoop(e,t,s){let r=e.nextLabelIdStack,n=r.pop(),i=n++,a=n++,l=(r.push(n),[]),h=l.length,o=0,_=t.length,c=h+_;for(l.length=c;o<_;){let e=o;l[h]=t[e],++h,++o}l.push(Ye.Label(i)),l.push(Ye.CountDownGotoLabel(a));let u=[l,s,[Ye.GotoLabel(i),Ye.Label(a)]],d=u.length,p=0,f=0,x=d;for(;f<x;){p+=u[f++].length}let g=p,b=[];b.length=g;let m=b,A=0,w=0,y=d;for(;w<y;){let e=u[w++],t=0,s=e.length;for(;t<s;){let s=t++;m[A]=e[s],++A}}return m}static loop(e,t,s){let r=s.load(e);r.push(Ye.Push(Ke.Int(et.Reg)));return Ne.constructLoop(e,r,t)}}s["firedancer.assembly.Builder"]=Ne,Ne.__name__="firedancer.assembly.Builder";class je{static get(e){switch(e){case 0:return 0;case 1:return 2;case 2:return 4}}static getBuffer(e){let t=e;switch(t){case 0:return 1;case 2:return 3;default:throw $i.thrown("Buffer is not available for "+je.toString(t))}}static toString(e){switch(e){case 0:return"ri";case 1:return"rib";case 2:return"rf";case 3:return"rfb";case 4:return"rvec"}}}var Ye=n["firedancer.assembly.Instruction"]={__ename__:"firedancer.assembly.Instruction",__constructs__:["Break","CountDownBreak","Label","GotoLabel","CountDownGotoLabel","UseThread","AwaitThread","End","Load","Save","Let","Store","Free","Push","Pop","Peek","Drop","Fire","Event","Debug","Add","Sub","Minus","Mult","Div","Mod","Cast","RandomRatio","Random","RandomSigned","Sin","Cos","Increment","Decrement","Get","GetTarget","GetDiff","Set","Increase","Comment","None"],Break:{_hx_index:0,__enum__:"firedancer.assembly.Instruction",toString:r},CountDownBreak:{_hx_index:1,__enum__:"firedancer.assembly.Instruction",toString:r},Label:(t=function(e){return{_hx_index:2,labelId:e,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["labelId"],t),GotoLabel:(t=function(e){return{_hx_index:3,labelId:e,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["labelId"],t),CountDownGotoLabel:(t=function(e){return{_hx_index:4,labelId:e,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["labelId"],t),UseThread:(t=function(e,t){return{_hx_index:5,programId:e,output:t,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["programId","output"],t),AwaitThread:{_hx_index:6,__enum__:"firedancer.assembly.Instruction",toString:r},End:(t=function(e){return{_hx_index:7,endCode:e,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["endCode"],t),Load:(t=function(e){return{_hx_index:8,input:e,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["input"],t),Save:(t=function(e){return{_hx_index:9,input:e,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["input"],t),Let:(t=function(e,t){return{_hx_index:10,varKey:e,type:t,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["varKey","type"],t),Store:(t=function(e,t){return{_hx_index:11,input:e,varKey:t,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["input","varKey"],t),Free:(t=function(e,t){return{_hx_index:12,varKey:e,type:t,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["varKey","type"],t),Push:(t=function(e){return{_hx_index:13,input:e,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["input"],t),Pop:(t=function(e){return{_hx_index:14,type:e,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["type"],t),Peek:(t=function(e,t){return{_hx_index:15,type:e,bytesToSkip:t,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["type","bytesToSkip"],t),Drop:(t=function(e){return{_hx_index:16,type:e,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["type"],t),Fire:(t=function(e){return{_hx_index:17,fireType:e,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["fireType"],t),Event:(t=function(e){return{_hx_index:18,eventType:e,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["eventType"],t),Debug:(t=function(e){return{_hx_index:19,debugCode:e,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["debugCode"],t),Add:(t=function(e){return{_hx_index:20,input:e,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["input"],t),Sub:(t=function(e){return{_hx_index:21,input:e,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["input"],t),Minus:(t=function(e){return{_hx_index:22,input:e,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["input"],t),Mult:(t=function(e,t){return{_hx_index:23,inputA:e,inputB:t,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["inputA","inputB"],t),Div:(t=function(e,t){return{_hx_index:24,inputA:e,inputB:t,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["inputA","inputB"],t),Mod:(t=function(e,t){return{_hx_index:25,inputA:e,inputB:t,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["inputA","inputB"],t),Cast:(t=function(e){return{_hx_index:26,castType:e,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["castType"],t),RandomRatio:{_hx_index:27,__enum__:"firedancer.assembly.Instruction",toString:r},Random:(t=function(e){return{_hx_index:28,max:e,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["max"],t),RandomSigned:(t=function(e){return{_hx_index:29,maxMagnitude:e,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["maxMagnitude"],t),Sin:{_hx_index:30,__enum__:"firedancer.assembly.Instruction",toString:r},Cos:{_hx_index:31,__enum__:"firedancer.assembly.Instruction",toString:r},Increment:(t=function(e){return{_hx_index:32,address:e,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["address"],t),Decrement:(t=function(e){return{_hx_index:33,address:e,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["address"],t),Get:(t=function(e){return{_hx_index:34,property:e,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["property"],t),GetTarget:(t=function(e){return{_hx_index:35,prop:e,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["prop"],t),GetDiff:(t=function(e,t){return{_hx_index:36,input:e,property:t,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["input","property"],t),Set:(t=function(e,t){return{_hx_index:37,input:e,property:t,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["input","property"],t),Increase:(t=function(e,t){return{_hx_index:38,input:e,property:t,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["input","property"],t),Comment:(t=function(e){return{_hx_index:39,text:e,__enum__:"firedancer.assembly.Instruction",toString:r}},t.__params__=["text"],t),None:{_hx_index:40,__enum__:"firedancer.assembly.Instruction",toString:r}};Ye.__empty_constructs__=[Ye.Break,Ye.CountDownBreak,Ye.AwaitThread,Ye.RandomRatio,Ye.Sin,Ye.Cos,Ye.None];class Xe{static toWordArray(e,t,s){switch(e._hx_index){case 0:let r=0;return[dt.OpcodeWord(r)];case 1:let n=1;return[dt.OpcodeWord(n)];case 2:e.labelId;throw $i.thrown("Labels must be consumed before converting to WordArray.");case 3:let i=e.labelId,a=t.h[i];if(null==a)throw $i.thrown("Unknown label ID: "+(null==i?"null":x.string(i)));let l=2;return[dt.OpcodeWord(l),dt.IntWord(a)];case 4:let h=e.labelId,o=t.h[h];if(null==o)throw $i.thrown("Unknown label ID: "+(null==h?"null":x.string(h)));let _=3;return[dt.OpcodeWord(_),dt.IntWord(o)];case 5:let c=e.output,u=e.programId;switch(c._hx_index){case 0:let e=4;return[dt.OpcodeWord(e),dt.IntWord(u)];case 1:if(3==c.operand._hx_index){let e=5;return[dt.OpcodeWord(e),dt.IntWord(u)]}throw $i.thrown(Xe.unsupported());default:throw $i.thrown(Xe.unsupported())}break;case 6:let d=6;return[dt.OpcodeWord(d)];case 7:let p=e.endCode,f=7;return[dt.OpcodeWord(f),dt.IntWord(p)];case 8:let g=e.input;switch(g._hx_index){case 1:let e=g.operand;switch(e._hx_index){case 0:let t=e.value,r=8;return[dt.OpcodeWord(r),dt.IntWord(t)];case 1:return[];case 2:let n=9;return[dt.OpcodeWord(n)];case 4:let i=e.key,a=17;return[dt.OpcodeWord(a),dt.IntWord(s.getAddress(i))];default:throw $i.thrown(Xe.unsupported())}break;case 2:let t=g.operand;switch(t._hx_index){case 0:let e=t.value,r=10;return[dt.OpcodeWord(r),dt.FloatWord(e)];case 1:return[];case 2:let n=11;return[dt.OpcodeWord(n)];case 4:let i=t.key,a=18;return[dt.OpcodeWord(a),dt.IntWord(s.getAddress(i))];default:throw $i.thrown(Xe.unsupported())}break;case 3:let r=g.operand;switch(r._hx_index){case 0:let e=r.y,t=r.x,s=12;return[dt.OpcodeWord(s),dt.FloatWord(t),dt.FloatWord(e)];case 1:return[];default:throw $i.thrown(Xe.unsupported())}break;default:throw $i.thrown(Xe.unsupported())}break;case 9:let b=e.input;switch(b._hx_index){case 1:let e=b.operand;switch(e._hx_index){case 0:let t=e.value,s=13;return[dt.OpcodeWord(s),dt.IntWord(t)];case 1:let r=14;return[dt.OpcodeWord(r)];default:throw $i.thrown(Xe.unsupported())}break;case 2:let t=b.operand;switch(t._hx_index){case 0:let e=t.value,s=15;return[dt.OpcodeWord(s),dt.FloatWord(e)];case 1:let r=16;return[dt.OpcodeWord(r)];default:throw $i.thrown(Xe.unsupported())}break;default:throw $i.thrown(Xe.unsupported())}break;case 10:let m=e.type,A=e.varKey;return s.let(A,m),[];case 11:let w=e.varKey,y=e.input,k=s.getAddress(w);switch(y._hx_index){case 1:let e=y.operand;switch(e._hx_index){case 0:let t=e.value,s=19;return[dt.OpcodeWord(s),dt.IntWord(k),dt.IntWord(t)];case 1:let r=20;return[dt.OpcodeWord(r),dt.IntWord(k)];default:throw $i.thrown(Xe.unsupported())}break;case 2:let t=y.operand;switch(t._hx_index){case 0:let e=t.value,s=21;return[dt.OpcodeWord(s),dt.IntWord(k),dt.FloatWord(e)];case 1:let r=22;return[dt.OpcodeWord(r),dt.IntWord(k)];default:throw $i.thrown(Xe.unsupported())}break;default:throw $i.thrown(Xe.unsupported())}break;case 12:e.type;let B=e.varKey;return s.free(B),[];case 13:let C=e.input;switch(C._hx_index){case 1:let e=C.operand;switch(e._hx_index){case 0:let t=e.value,s=23;return[dt.OpcodeWord(s),dt.IntWord(t)];case 1:let r=24;return[dt.OpcodeWord(r)];default:throw $i.thrown(Xe.unsupported())}break;case 2:let t=C.operand;switch(t._hx_index){case 0:let e=t.value,s=25;return[dt.OpcodeWord(s),dt.FloatWord(e)];case 1:let r=26;return[dt.OpcodeWord(r)];default:throw $i.thrown(Xe.unsupported())}break;case 3:let s=C.operand;switch(s._hx_index){case 0:let e=s.y,t=s.x,r=27;return[dt.OpcodeWord(r),dt.FloatWord(t),dt.FloatWord(e)];case 1:let n=28;return[dt.OpcodeWord(n)];default:throw $i.thrown(Xe.unsupported())}break;default:throw $i.thrown(Xe.unsupported())}break;case 14:let v;switch(e.type){case 0:v=29;break;case 1:v=30;break;default:throw $i.thrown(Xe.unsupported())}return[dt.OpcodeWord(v)];case 15:let S,M=e.bytesToSkip;switch(e.type){case 1:S=31;break;case 2:S=33;break;default:throw $i.thrown(Xe.unsupported())}return[dt.OpcodeWord(S),dt.IntWord(M)];case 16:let I;switch(e.type){case 1:I=32;break;case 2:I=34;break;default:throw $i.thrown(Xe.unsupported())}return[dt.OpcodeWord(I)];case 17:let T=e.fireType;switch(T._hx_index){case 0:let e=35;return[dt.OpcodeWord(e)];case 1:let t=T.fireArgument,s=36;return[dt.OpcodeWord(s),dt.IntWord(t)];case 2:let r=T.fireCode,n=37;return[dt.OpcodeWord(n),dt.IntWord(r)];case 3:let i=T.fireCode,a=T.fireArgument,l=38;return[dt.OpcodeWord(l),dt.IntWord(a),dt.IntWord(i)]}break;case 18:switch(e.eventType){case 0:let e=39;return[dt.OpcodeWord(e)];case 1:let t=40;return[dt.OpcodeWord(t)]}break;case 19:let F=e.debugCode,E=41;return[dt.OpcodeWord(E),dt.IntWord(F)];case 20:let D=e.input;switch(D._hx_index){case 0:let e=D.b,t=D.a;switch(t._hx_index){case 0:let r=t.value;if(1==e._hx_index){let e=64;return[dt.OpcodeWord(e),dt.IntWord(r)]}throw $i.thrown(Xe.unsupported());case 1:if(0==e._hx_index){let t=e.value,s=64;return[dt.OpcodeWord(s),dt.IntWord(t)]}throw $i.thrown(Xe.unsupported());case 2:if(1==e._hx_index){let e=65;return[dt.OpcodeWord(e)]}throw $i.thrown(Xe.unsupported());case 4:let n=t.key,i=s.getAddress(n);switch(e._hx_index){case 0:let t=e.value,s=110;return[dt.OpcodeWord(s),dt.IntWord(i),dt.IntWord(t)];case 1:let r=111;return[dt.OpcodeWord(r),dt.IntWord(i)];default:throw $i.thrown(Xe.unsupported())}break;default:throw $i.thrown(Xe.unsupported())}break;case 1:let r=D.b,n=D.a;switch(n._hx_index){case 0:let e=n.value;if(1==r._hx_index){let t=78;return[dt.OpcodeWord(t),dt.FloatWord(e)]}throw $i.thrown(Xe.unsupported());case 1:if(0==r._hx_index){let e=r.value,t=78;return[dt.OpcodeWord(t),dt.FloatWord(e)]}throw $i.thrown(Xe.unsupported());case 2:if(1==r._hx_index){let e=79;return[dt.OpcodeWord(e)]}throw $i.thrown(Xe.unsupported());case 4:let t=n.key,i=s.getAddress(t);switch(r._hx_index){case 0:let e=r.value,t=114;return[dt.OpcodeWord(t),dt.IntWord(i),dt.FloatWord(e)];case 1:let s=115;return[dt.OpcodeWord(s),dt.IntWord(i)];default:throw $i.thrown(Xe.unsupported())}break;default:throw $i.thrown(Xe.unsupported())}break;default:throw $i.thrown(Xe.unsupported())}break;case 21:let R=e.input;switch(R._hx_index){case 0:let e=R.b,t=R.a;switch(t._hx_index){case 0:let s=t.value;if(1==e._hx_index){let e=67;return[dt.OpcodeWord(e),dt.IntWord(s)]}throw $i.thrown(Xe.unsupported());case 1:if(0==e._hx_index){let t=e.value,s=66;return[dt.OpcodeWord(s),dt.IntWord(t)]}throw $i.thrown(Xe.unsupported());case 2:if(1==e._hx_index){let e=68;return[dt.OpcodeWord(e)]}throw $i.thrown(Xe.unsupported());default:throw $i.thrown(Xe.unsupported())}break;case 1:let s=R.b,r=R.a;switch(r._hx_index){case 0:let e=r.value;if(1==s._hx_index){let t=81;return[dt.OpcodeWord(t),dt.FloatWord(e)]}throw $i.thrown(Xe.unsupported());case 1:if(0==s._hx_index){let e=s.value,t=80;return[dt.OpcodeWord(t),dt.FloatWord(e)]}throw $i.thrown(Xe.unsupported());case 2:if(1==s._hx_index){let e=82;return[dt.OpcodeWord(e)]}throw $i.thrown(Xe.unsupported());default:throw $i.thrown(Xe.unsupported())}break;default:throw $i.thrown(Xe.unsupported())}break;case 22:let V=e.input;switch(V._hx_index){case 1:if(1==V.operand._hx_index){let e=69;return[dt.OpcodeWord(e)]}throw $i.thrown(Xe.unsupported());case 2:if(1==V.operand._hx_index){let e=83;return[dt.OpcodeWord(e)]}throw $i.thrown(Xe.unsupported());case 3:if(1==V.operand._hx_index){let e=92;return[dt.OpcodeWord(e)]}throw $i.thrown(Xe.unsupported());default:throw $i.thrown(Xe.unsupported())}break;case 23:let O=e.inputB,P=e.inputA;switch(P._hx_index){case 1:let e=P.operand;switch(e._hx_index){case 0:let t=e.value;if(1==O._hx_index){if(1==O.operand._hx_index){let e=70;return[dt.OpcodeWord(e),dt.IntWord(t)]}throw $i.thrown(Xe.unsupported())}throw $i.thrown(Xe.unsupported());case 1:if(1==O._hx_index){let e=O.operand;if(0==e._hx_index){let t=e.value,s=70;return[dt.OpcodeWord(s),dt.IntWord(t)]}throw $i.thrown(Xe.unsupported())}throw $i.thrown(Xe.unsupported());case 2:if(1==O._hx_index){if(1==O.operand._hx_index){let e=71;return[dt.OpcodeWord(e)]}throw $i.thrown(Xe.unsupported())}throw $i.thrown(Xe.unsupported());default:throw $i.thrown(Xe.unsupported())}break;case 2:let t=P.operand;switch(t._hx_index){case 0:let e=t.value;if(2==O._hx_index){if(1==O.operand._hx_index){let t=84;return[dt.OpcodeWord(t),dt.FloatWord(e)]}throw $i.thrown(Xe.unsupported())}throw $i.thrown(Xe.unsupported());case 1:if(2==O._hx_index){let e=O.operand;if(0==e._hx_index){let t=e.value,s=84;return[dt.OpcodeWord(s),dt.FloatWord(t)]}throw $i.thrown(Xe.unsupported())}throw $i.thrown(Xe.unsupported());case 2:if(2==O._hx_index){if(1==O.operand._hx_index){let e=85;return[dt.OpcodeWord(e)]}throw $i.thrown(Xe.unsupported())}throw $i.thrown(Xe.unsupported());default:throw $i.thrown(Xe.unsupported())}break;case 3:if(1!=P.operand._hx_index)throw $i.thrown(Xe.unsupported());if(2!=O._hx_index)throw $i.thrown(Xe.unsupported());{let e=O.operand;switch(e._hx_index){case 0:let t=e.value,s=93;return[dt.OpcodeWord(s),dt.FloatWord(t)];case 1:let r=94;return[dt.OpcodeWord(r)];default:throw $i.thrown(Xe.unsupported())}}break;default:throw $i.thrown(Xe.unsupported())}break;case 24:let Q=e.inputB,L=e.inputA;switch(L._hx_index){case 1:let e=L.operand;switch(e._hx_index){case 0:let t=e.value;if(1==Q._hx_index){if(1==Q.operand._hx_index){let e=73;return[dt.OpcodeWord(e),dt.IntWord(t)]}throw $i.thrown(Xe.unsupported())}throw $i.thrown(Xe.unsupported());case 1:if(1==Q._hx_index){let e=Q.operand;if(0==e._hx_index){let t=e.value,s=72;return[dt.OpcodeWord(s),dt.IntWord(t)]}throw $i.thrown(Xe.unsupported())}throw $i.thrown(Xe.unsupported());case 2:if(1==Q._hx_index){if(1==Q.operand._hx_index){let e=74;return[dt.OpcodeWord(e)]}throw $i.thrown(Xe.unsupported())}throw $i.thrown(Xe.unsupported());default:throw $i.thrown(Xe.unsupported())}break;case 2:let t=L.operand;switch(t._hx_index){case 0:let e=t.value;if(2==Q._hx_index){if(1==Q.operand._hx_index){let t=87;return[dt.OpcodeWord(t),dt.FloatWord(e)]}throw $i.thrown(Xe.unsupported())}throw $i.thrown(Xe.unsupported());case 1:if(2==Q._hx_index){let e=Q.operand;if(0==e._hx_index){let t=e.value,s=86;return[dt.OpcodeWord(s),dt.FloatWord(t)]}throw $i.thrown(Xe.unsupported())}throw $i.thrown(Xe.unsupported());case 2:if(2==Q._hx_index){if(1==Q.operand._hx_index){let e=88;return[dt.OpcodeWord(e)]}throw $i.thrown(Xe.unsupported())}throw $i.thrown(Xe.unsupported());default:throw $i.thrown(Xe.unsupported())}break;case 3:if(1!=L.operand._hx_index)throw $i.thrown(Xe.unsupported());if(2!=Q._hx_index)throw $i.thrown(Xe.unsupported());{let e=Q.operand;switch(e._hx_index){case 0:let t=e.value,s=93;return[dt.OpcodeWord(s),dt.FloatWord(1/t)];case 1:let r=95;return[dt.OpcodeWord(r)];default:throw $i.thrown(Xe.unsupported())}}break;default:throw $i.thrown(Xe.unsupported())}break;case 25:let G=e.inputB,z=e.inputA;switch(z._hx_index){case 1:let e=z.operand;switch(e._hx_index){case 0:let t=e.value;if(1==G._hx_index){if(1==G.operand._hx_index){let e=76;return[dt.OpcodeWord(e),dt.IntWord(t)]}throw $i.thrown(Xe.unsupported())}throw $i.thrown(Xe.unsupported());case 1:if(1==G._hx_index){let e=G.operand;if(0==e._hx_index){let t=e.value,s=75;return[dt.OpcodeWord(s),dt.IntWord(t)]}throw $i.thrown(Xe.unsupported())}throw $i.thrown(Xe.unsupported());case 2:if(1==G._hx_index){if(1==G.operand._hx_index){let e=77;return[dt.OpcodeWord(e)]}throw $i.thrown(Xe.unsupported())}throw $i.thrown(Xe.unsupported());default:throw $i.thrown(Xe.unsupported())}break;case 2:let t=z.operand;switch(t._hx_index){case 0:let e=t.value;if(2==G._hx_index){if(1==G.operand._hx_index){let t=90;return[dt.OpcodeWord(t),dt.FloatWord(e)]}throw $i.thrown(Xe.unsupported())}throw $i.thrown(Xe.unsupported());case 1:if(2==G._hx_index){let e=G.operand;if(0==e._hx_index){let t=e.value,s=89;return[dt.OpcodeWord(s),dt.FloatWord(t)]}throw $i.thrown(Xe.unsupported())}throw $i.thrown(Xe.unsupported());case 2:if(2==G._hx_index){if(1==G.operand._hx_index){let e=91;return[dt.OpcodeWord(e)]}throw $i.thrown(Xe.unsupported())}throw $i.thrown(Xe.unsupported());default:throw $i.thrown(Xe.unsupported())}break;default:throw $i.thrown(Xe.unsupported())}break;case 26:switch(e.castType){case 0:let e=96;return[dt.OpcodeWord(e)];case 1:let t=97;return[dt.OpcodeWord(t)];case 2:let s=98;return[dt.OpcodeWord(s)]}break;case 27:let U=99;return[dt.OpcodeWord(U)];case 28:let W=e.max;switch(W._hx_index){case 1:let e=W.operand;switch(e._hx_index){case 0:let t=e.value,s=104;return[dt.OpcodeWord(s),dt.IntWord(t)];case 1:let r=105;return[dt.OpcodeWord(r)];default:throw $i.thrown(Xe.unsupported())}break;case 2:let t=W.operand;switch(t._hx_index){case 0:let e=t.value,s=100;return[dt.OpcodeWord(s),dt.FloatWord(e)];case 1:let r=101;return[dt.OpcodeWord(r)];default:throw $i.thrown(Xe.unsupported())}break;default:throw $i.thrown(Xe.unsupported())}break;case 29:let N=e.maxMagnitude;switch(N._hx_index){case 1:let e=N.operand;switch(e._hx_index){case 0:let t=e.value,s=106;return[dt.OpcodeWord(s),dt.IntWord(t)];case 1:let r=107;return[dt.OpcodeWord(r)];default:throw $i.thrown(Xe.unsupported())}break;case 2:let t=N.operand;switch(t._hx_index){case 0:let e=t.value,s=102;return[dt.OpcodeWord(s),dt.FloatWord(e)];case 1:let r=103;return[dt.OpcodeWord(r)];default:throw $i.thrown(Xe.unsupported())}break;default:throw $i.thrown(Xe.unsupported())}break;case 30:let j=108;return[dt.OpcodeWord(j)];case 31:let Y=109;return[dt.OpcodeWord(Y)];case 32:let X=e.address,Z=112;return[dt.OpcodeWord(Z),dt.IntWord(s.getAddress(X))];case 33:let H=e.address,K=113;return[dt.OpcodeWord(K),dt.IntWord(s.getAddress(H))];case 34:let q=e.property;return[dt.OpcodeWord(xt.getReadOpcode(q))];case 35:switch(e.prop){case 0:let e=140;return[dt.OpcodeWord(e)];case 1:let t=141;return[dt.OpcodeWord(t)];case 2:let s=142;return[dt.OpcodeWord(s)];case 3:let r=143;return[dt.OpcodeWord(r)]}break;case 36:let J=e.property,$=e.input;switch($._hx_index){case 2:let e=$.operand;switch(e._hx_index){case 0:let t=e.value;return[dt.OpcodeWord(xt.getDiffOpcode(J,1)),dt.FloatWord(t)];case 1:return[dt.OpcodeWord(xt.getDiffOpcode(J,2))];default:throw $i.thrown(Xe.unsupported())}break;case 3:let t=$.operand;if(0!=J.component)throw $i.thrown(Xe.unsupported());switch(t._hx_index){case 0:let e=t.y,s=t.x;return[dt.OpcodeWord(xt.getDiffOpcode(J,1)),dt.FloatWord(s),dt.FloatWord(e)];case 1:return[dt.OpcodeWord(xt.getDiffOpcode(J,2))];default:throw $i.thrown(Xe.unsupported())}break;default:throw $i.thrown(Xe.unsupported())}break;case 37:let ee=e.property,te=e.input;switch(te._hx_index){case 2:let e=te.operand;switch(e._hx_index){case 0:let t=e.value;return[dt.OpcodeWord(xt.getWriteOpcode(ee,0,1)),dt.FloatWord(t)];case 1:return[dt.OpcodeWord(xt.getWriteOpcode(ee,0,2))];default:throw $i.thrown(Xe.unsupported())}break;case 3:let t=te.operand;if(0!=ee.component)throw $i.thrown(Xe.unsupported());switch(t._hx_index){case 0:let e=t.y,s=t.x;return[dt.OpcodeWord(xt.getWriteOpcode(ee,0,1)),dt.FloatWord(s),dt.FloatWord(e)];case 1:return[dt.OpcodeWord(xt.getWriteOpcode(ee,0,2))];default:throw $i.thrown(Xe.unsupported())}break;default:throw $i.thrown(Xe.unsupported())}break;case 38:let se=e.property,re=e.input;switch(re._hx_index){case 2:let e=re.operand;switch(e._hx_index){case 0:let t=e.value;return[dt.OpcodeWord(xt.getWriteOpcode(se,1,1)),dt.FloatWord(t)];case 1:return[dt.OpcodeWord(xt.getWriteOpcode(se,1,2))];case 3:return[dt.OpcodeWord(xt.getWriteOpcode(se,1,4))];default:throw $i.thrown(Xe.unsupported())}break;case 3:let t=re.operand;if(0!=se.component)throw $i.thrown(Xe.unsupported());switch(t._hx_index){case 0:let e=t.y,s=t.x;return[dt.OpcodeWord(xt.getWriteOpcode(se,1,1)),dt.FloatWord(s),dt.FloatWord(e)];case 1:return[dt.OpcodeWord(xt.getWriteOpcode(se,1,2))];case 2:return[dt.OpcodeWord(xt.getWriteOpcode(se,1,4))]}break;default:throw $i.thrown(Xe.unsupported())}break;case 39:e.text;return[];case 40:return[]}}static unsupported(){return"Unsupported operation."}}s["firedancer.assembly.InstructionAssembler"]=Xe,Xe.__name__="firedancer.assembly.InstructionAssembler";class Ze{static toString(e){switch(e._hx_index){case 0:return"break";case 1:return"countdown break";case 2:let t=e.labelId;return"label "+x.string(t);case 3:let s=e.labelId;return"goto label "+x.string(s);case 4:let r=e.labelId;return"countdown goto label "+x.string(r);case 5:let n=e.output,i=e.programId;return"use thread "+x.string(i)+" -> "+qe.toString(n);case 6:return"await thread";case 7:let a=e.endCode;return"end "+(null==a?"null":""+a);case 8:let l=e.input,h=je.get(qe.getType(l));return"load "+qe.toString(l)+" -> "+je.toString(h);case 9:let o=e.input,_=je.getBuffer(je.get(qe.getType(o)));return"save "+qe.toString(o)+" -> "+je.toString(_);case 10:let c=e.type,u=e.varKey;return"let "+at.varToString(u,c);case 11:let d=e.varKey,p=e.input;return"store "+qe.toString(p)+" -> "+at.varToString(d,qe.getType(p));case 12:let f=e.type,g=e.varKey;return"free "+at.varToString(g,f);case 13:let b=e.input;return"push "+qe.toString(b)+" -> s";case 14:let m=e.type;return"pop s -> "+je.toString(je.get(m));case 15:let A=e.bytesToSkip,w=e.type,y=je.toString(je.get(w));return"peek "+ut.toString(w)+" s, "+A+" -> "+y;case 16:let k=e.type;return"drop "+ut.toString(k);case 17:let B=e.fireType;return mt.toString(B);case 18:let C=e.eventType;return"event "+class{static toString(e){switch(e){case 0:return"global";case 1:return"local"}}}.toString(C)+" ri -> n";case 19:let v=e.debugCode;return"debug "+(null==v?"null":""+v)+" -> n";case 20:let S,M=e.input;switch(M._hx_index){case 0:M.b;let e=M.a;if(4==e._hx_index){e.key;S=tt.toString(e)}else S=je.toString(0);break;case 1:M.b;let t=M.a;if(4==t._hx_index){t.key;S=rt.toString(t)}else S=je.toString(2);break;default:throw $i.thrown(Ze.unsupported())}return"add "+$e.toString(M)+" -> "+S;case 21:let I,T=e.input;switch(T._hx_index){case 0:T.b;let e=T.a;if(4==e._hx_index){e.key;I=tt.toString(e)}else I=je.toString(0);break;case 1:T.b;let t=T.a;if(4==t._hx_index){t.key;I=rt.toString(t)}else I=je.toString(2);break;default:throw $i.thrown(Ze.unsupported())}return"sub "+$e.toString(T)+" -> "+I;case 22:let F=e.input,E=qe.toString(F);return"minus "+E+" -> "+E;case 23:let D,R=e.inputB,V=e.inputA;switch(V._hx_index){case 1:V.operand;D=je.toString(0);break;case 2:V.operand;D=je.toString(2);break;case 3:V.operand;D=je.toString(4);break;default:throw $i.thrown(Ze.unsupported())}return"mult "+qe.toString(V)+", "+qe.toString(R)+" -> "+D;case 24:let O,P=e.inputB,Q=e.inputA;switch(Q._hx_index){case 1:Q.operand;O=je.toString(0);break;case 2:Q.operand;O=je.toString(2);break;case 3:Q.operand;O=je.toString(4);break;default:throw $i.thrown(Ze.unsupported())}return"div "+qe.toString(Q)+", "+qe.toString(P)+" -> "+O;case 25:let L,G=e.inputB,z=e.inputA;switch(z._hx_index){case 1:z.operand;L=je.toString(0);break;case 2:z.operand;L=je.toString(2);break;case 3:z.operand;L=je.toString(4);break;default:throw $i.thrown(Ze.unsupported())}return"mod "+qe.toString(z)+", "+qe.toString(G)+" -> "+L;case 26:let U=e.castType,W=je.toString(je.get(gt.getOutputType(U)));switch(U){case 0:return"cast ri -> "+W;case 1:return"cast cartesian rfb, rf -> "+W;case 2:return"cast polar rfb, rf -> "+W}break;case 27:return"random ratio n -> rf";case 28:let N=e.max;return"random "+qe.toString(N)+" -> rf";case 29:let j=e.maxMagnitude;return"random signed "+qe.toString(j)+" -> rf";case 30:return"sin rf -> rf";case 31:return"cos rf -> rf";case 32:let Y=e.address,X=at.varToString(Y,0);return"increment "+X+" -> "+X;case 33:let Z=e.address,H=at.varToString(Z,0);return"decrement "+H+" -> "+H;case 34:let K=e.property,q=je.toString(je.get(ft.getValueType(K.component)));return"get "+K.toString()+" -> "+q;case 35:let J=e.prop,$=je.toString(je.get(At.getType(J)));return"get target_"+At.toString(J)+" -> "+$;case 36:let ee=e.property,te=e.input,se=je.toString(je.get(qe.getType(te)));return"get diff "+qe.toString(te)+", "+ee.toString()+" -> "+se;case 37:let re=e.property,ne=e.input;return"set "+qe.toString(ne)+" -> "+re.toString();case 38:let ie=e.property,ae=e.input;return"increase "+qe.toString(ae)+" -> "+ie.toString();case 39:let le=e.text.split("\n"),he=new Array(le.length),oe=0,_e=le.length;for(;oe<_e;){let e=oe++;he[e]="// "+le[e]}return he.join("\n");case 40:return"none"}}static bytecodeLength(e){let t;switch(e._hx_index){case 0:case 1:t=0;break;case 2:e.labelId;throw $i.thrown("Label cannot be directly converted to bytecode.");case 3:e.labelId;t=4;break;case 4:e.labelId;t=4;break;case 5:let s=e.output;e.programId;t=4+qe.bytecodeLength(s);break;case 6:t=0;break;case 7:e.endCode;t=4;break;case 8:let r=e.input;t=qe.bytecodeLength(r);break;case 9:let n=e.input;t=qe.bytecodeLength(n);break;case 10:e.type,e.varKey;t=-1;break;case 11:e.varKey;let i=e.input;t=qe.bytecodeLength(i)+4;break;case 12:e.type,e.varKey;t=-1;break;case 13:let a=e.input;t=qe.bytecodeLength(a);break;case 14:e.type;t=0;break;case 15:e.type,e.bytesToSkip;t=4;break;case 16:e.type;t=0;break;case 17:let l=e.fireType;t=mt.bytecodeLength(l);break;case 18:e.eventType;t=0;break;case 19:e.debugCode;t=4;break;case 20:let h=e.input;t=$e.bytecodeLength(h);break;case 21:let o=e.input;t=$e.bytecodeLength(o);break;case 22:e.input;t=0;break;case 23:let _=e.inputB;e.inputA;t=qe.bytecodeLength(_);break;case 24:let c=e.inputB,u=e.inputA;t=qe.bytecodeLength(u)+qe.bytecodeLength(c);break;case 25:let d=e.inputB,p=e.inputA;t=qe.bytecodeLength(p)+qe.bytecodeLength(d);break;case 26:e.castType;t=0;break;case 27:t=0;break;case 28:let f=e.max;t=qe.bytecodeLength(f);break;case 29:let x=e.maxMagnitude;t=qe.bytecodeLength(x);break;case 30:case 31:t=0;break;case 32:e.address;t=4;break;case 33:e.address;t=4;break;case 34:e.property;t=0;break;case 35:e.prop;t=0;break;case 36:e.property;let g=e.input;t=qe.bytecodeLength(g);break;case 37:e.property;let b=e.input;t=qe.bytecodeLength(b);break;case 38:e.property;let m=e.input;t=qe.bytecodeLength(m);break;case 39:e.text;t=-1;break;case 40:t=-1}return 1+t}static readsReg(e,t){switch(e._hx_index){case 8:let s=e.input;return qe.tryGetRegType(s)==t;case 9:let r=e.input;return qe.tryGetRegType(r)==t;case 11:e.varKey;let n=e.input;return qe.tryGetRegType(n)==t;case 13:let i=e.input;return qe.tryGetRegType(i)==t;case 18:e.eventType;return 0==t;case 20:let a=e.input;return $e.tryGetRegType(a)==t;case 21:let l=e.input;return $e.tryGetRegType(l)==t;case 22:let h=e.input;return qe.tryGetRegType(h)==t;case 23:let o=e.inputB,_=e.inputA;return qe.tryGetRegType(_)==t||qe.tryGetRegType(o)==t;case 24:let c=e.inputB,u=e.inputA;return qe.tryGetRegType(u)==t||qe.tryGetRegType(c)==t;case 25:let d=e.inputB,p=e.inputA;return qe.tryGetRegType(p)==t||qe.tryGetRegType(d)==t;case 26:switch(e.castType){case 0:return 0==t;case 1:case 2:return 1==t}break;case 28:let f=e.max;return qe.tryGetRegType(f)==t;case 29:let x=e.maxMagnitude;return qe.tryGetRegType(x)==t;case 30:case 31:return 1==t;case 36:e.property;let g=e.input;return qe.tryGetRegType(g)==t;case 37:e.property;let b=e.input;return qe.tryGetRegType(b)==t;case 38:e.property;let m=e.input;return qe.tryGetRegType(m)==t;default:return!1}}static readsRegBuf(e,t){switch(e._hx_index){case 8:let s=e.input;return qe.tryGetRegBufType(s)==t;case 9:let r=e.input;return qe.tryGetRegBufType(r)==t;case 11:e.varKey;let n=e.input;return qe.tryGetRegBufType(n)==t;case 13:let i=e.input;return qe.tryGetRegBufType(i)==t;case 20:let a=e.input;return $e.tryGetRegBufType(a)==t;case 21:let l=e.input;return $e.tryGetRegBufType(l)==t;case 22:let h=e.input;return qe.tryGetRegBufType(h)==t;case 23:let o=e.inputB,_=e.inputA;return qe.tryGetRegBufType(_)==t||qe.tryGetRegBufType(o)==t;case 24:let c=e.inputB,u=e.inputA;return qe.tryGetRegBufType(u)==t||qe.tryGetRegBufType(c)==t;case 25:let d=e.inputB,p=e.inputA;return qe.tryGetRegBufType(p)==t||qe.tryGetRegBufType(d)==t;case 26:switch(e.castType){case 1:case 2:return 1==t;default:return!1}break;case 28:let f=e.max;return qe.tryGetRegBufType(f)==t;case 29:let x=e.maxMagnitude;return qe.tryGetRegBufType(x)==t;case 36:e.property;let g=e.input;return qe.tryGetRegBufType(g)==t;case 37:e.property;let b=e.input;return qe.tryGetRegBufType(b)==t;case 38:e.property;let m=e.input;return qe.tryGetRegBufType(m)==t;default:return!1}}static tryGetWriteRegType(e){let t;switch(e._hx_index){case 8:let s=e.input;t=qe.getType(s);break;case 14:t=e.type;break;case 15:e.bytesToSkip;t=e.type;break;case 20:let r=e.input,n=$e.getFirstOperand(r);switch(qe.getKind(n)){case 1:case 2:case 3:t=qe.getType(n);break;default:t=null}break;case 21:let i=e.input,a=$e.getFirstOperand(i);switch(qe.getKind(a)){case 1:case 2:case 3:t=qe.getType(a);break;default:t=null}break;case 22:let l=e.input;switch(qe.getKind(l)){case 1:case 2:case 3:t=qe.getType(l);break;default:t=null}break;case 23:e.inputB;let h=e.inputA;switch(qe.getKind(h)){case 1:case 2:case 3:t=qe.getType(h);break;default:t=null}break;case 24:e.inputB;let o=e.inputA;switch(qe.getKind(o)){case 1:case 2:case 3:t=qe.getType(o);break;default:t=null}break;case 25:e.inputB;let _=e.inputA;switch(qe.getKind(_)){case 1:case 2:case 3:t=qe.getType(_);break;default:t=null}break;case 26:let c=e.castType;t=gt.getOutputType(c);break;case 27:t=1;break;case 28:let u=e.max;t=qe.getType(u);break;case 29:let d=e.maxMagnitude;t=qe.getType(d);break;case 30:case 31:t=1;break;case 34:let p=e.property;t=ft.getValueType(p.component);break;case 35:let f=e.prop;t=At.getType(f);break;case 36:e.property;let x=e.input;t=qe.getType(x);break;default:t=null}return t}static tryGetWriteRegBufType(e){let t;if(9==e._hx_index){let s=e.input;t=qe.getType(s)}else t=null;return t}static tryGetReadVarKey(e){let t;switch(e._hx_index){case 8:let s=e.input;switch(s._hx_index){case 1:let e=s.operand;if(4==e._hx_index){t=e.key}else t=null;break;case 2:let r=s.operand;if(4==r._hx_index){t=r.key}else t=null;break;default:t=null}break;case 9:let r=e.input;switch(r._hx_index){case 1:let e=r.operand;if(4==e._hx_index){t=e.key}else t=null;break;case 2:let s=r.operand;if(4==s._hx_index){t=s.key}else t=null;break;default:t=null}break;case 11:e.varKey;let n=e.input;switch(n._hx_index){case 1:let e=n.operand;if(4==e._hx_index){t=e.key}else t=null;break;case 2:let s=n.operand;if(4==s._hx_index){t=s.key}else t=null;break;default:t=null}break;case 13:let i=e.input;switch(i._hx_index){case 1:let e=i.operand;if(4==e._hx_index){t=e.key}else t=null;break;case 2:let s=i.operand;if(4==s._hx_index){t=s.key}else t=null;break;default:t=null}break;case 20:let a=e.input;switch(a._hx_index){case 0:a.b;let e=a.a;if(4==e._hx_index){t=e.key}else t=null;break;case 1:a.b;let s=a.a;if(4==s._hx_index){t=s.key}else t=null;break;default:t=null}break;case 21:let l=e.input;switch(l._hx_index){case 0:l.b;let e=l.a;if(4==e._hx_index){t=e.key}else t=null;break;case 1:l.b;let s=l.a;if(4==s._hx_index){t=s.key}else t=null;break;default:t=null}break;case 22:let h=e.input;switch(h._hx_index){case 1:let e=h.operand;if(4==e._hx_index){t=e.key}else t=null;break;case 2:let s=h.operand;if(4==s._hx_index){t=s.key}else t=null;break;default:t=null}break;case 23:e.inputB;let o=e.inputA;switch(o._hx_index){case 1:let e=o.operand;if(4==e._hx_index){t=e.key}else t=null;break;case 2:let s=o.operand;if(4==s._hx_index){t=s.key}else t=null;break;default:t=null}break;case 24:e.inputB;let _=e.inputA;switch(_._hx_index){case 1:let e=_.operand;if(4==e._hx_index){t=e.key}else t=null;break;case 2:let s=_.operand;if(4==s._hx_index){t=s.key}else t=null;break;default:t=null}break;case 25:e.inputB;let c=e.inputA;switch(c._hx_index){case 1:let e=c.operand;if(4==e._hx_index){t=e.key}else t=null;break;case 2:let s=c.operand;if(4==s._hx_index){t=s.key}else t=null;break;default:t=null}break;case 32:t=e.address;break;case 33:t=e.address;break;case 36:e.property;let u=e.input;switch(u._hx_index){case 1:let e=u.operand;if(4==e._hx_index){t=e.key}else t=null;break;case 2:let s=u.operand;if(4==s._hx_index){t=s.key}else t=null;break;default:t=null}break;case 37:e.property;let d=e.input;switch(d._hx_index){case 1:let e=d.operand;if(4==e._hx_index){t=e.key}else t=null;break;case 2:let s=d.operand;if(4==s._hx_index){t=s.key}else t=null;break;default:t=null}break;case 38:e.property;let p=e.input;switch(p._hx_index){case 1:let e=p.operand;if(4==e._hx_index){t=e.key}else t=null;break;case 2:let s=p.operand;if(4==s._hx_index){t=s.key}else t=null;break;default:t=null}break;default:t=null}return t}static tryGetWriteVarKey(e){let t;switch(e._hx_index){case 11:let s=e.varKey;e.input;t=s;break;case 20:let r=e.input;switch(r._hx_index){case 0:r.b;let e=r.a;if(4==e._hx_index){t=e.key}else t=null;break;case 1:r.b;let s=r.a;if(4==s._hx_index){t=s.key}else t=null;break;default:t=null}break;case 21:let n=e.input;switch(n._hx_index){case 0:n.b;let e=n.a;if(4==e._hx_index){t=e.key}else t=null;break;case 1:n.b;let s=n.a;if(4==s._hx_index){t=s.key}else t=null;break;default:t=null}break;case 22:let i=e.input;switch(i._hx_index){case 1:let e=i.operand;if(4==e._hx_index){t=e.key}else t=null;break;case 2:let s=i.operand;if(4==s._hx_index){t=s.key}else t=null;break;default:t=null}break;case 23:e.inputB;let a=e.inputA;switch(a._hx_index){case 1:let e=a.operand;if(4==e._hx_index){t=e.key}else t=null;break;case 2:let s=a.operand;if(4==s._hx_index){t=s.key}else t=null;break;default:t=null}break;case 24:e.inputB;let l=e.inputA;switch(l._hx_index){case 1:let e=l.operand;if(4==e._hx_index){t=e.key}else t=null;break;case 2:let s=l.operand;if(4==s._hx_index){t=s.key}else t=null;break;default:t=null}break;case 25:e.inputB;let h=e.inputA;switch(h._hx_index){case 1:let e=h.operand;if(4==e._hx_index){t=e.key}else t=null;break;case 2:let s=h.operand;if(4==s._hx_index){t=s.key}else t=null;break;default:t=null}break;case 32:t=e.address;break;case 33:t=e.address;break;default:t=null}return t}static unsupported(){return"Unsupported operation."}}s["firedancer.assembly.InstructionExtension"]=Ze,Ze.__name__="firedancer.assembly.InstructionExtension";class He{static tryReplaceRegWithImm(e,t){let s;switch(e._hx_index){case 8:let r=e.input,n=qe.tryReplaceRegWithImm(r,t);s=null!=n?Ye.Load(n):null;break;case 9:let i=e.input,a=qe.tryReplaceRegWithImm(i,t);s=null!=a?Ye.Save(a):null;break;case 11:let l=e.varKey,h=e.input,o=qe.tryReplaceRegWithImm(h,t);s=null!=o?Ye.Store(o,l):null;break;case 13:let _=e.input,c=qe.tryReplaceRegWithImm(_,t);s=null!=c?Ye.Push(c):null;break;case 20:let u=e.input,d=$e.tryReplaceRegWithImm(u,t);s=null!=d?Ye.Add(d):null;break;case 21:let p=e.input,f=$e.tryReplaceRegWithImm(p,t);s=null!=f?Ye.Sub(f):null;break;case 22:let x=e.input,g=qe.tryReplaceRegWithImm(x,t);s=null!=g?Ye.Minus(g):null;break;case 23:let b=e.inputB,m=e.inputA,A=qe.tryReplaceRegWithImm(m,t);if(null!=A)s=Ye.Mult(A,b);else if(qe.isRegBuf(m))s=null;else{let e=qe.tryReplaceRegWithImm(b,t);s=null!=e?Ye.Mult(m,e):null}break;case 24:let w=e.inputB,y=e.inputA,k=qe.tryReplaceRegWithImm(y,t);if(null!=k)s=Ye.Div(k,w);else if(qe.isRegBuf(y))s=null;else{let e=qe.tryReplaceRegWithImm(w,t);s=null!=e?Ye.Div(y,e):null}break;case 25:let B=e.inputB,C=e.inputA,v=qe.tryReplaceRegWithImm(C,t);if(null!=v)s=Ye.Mod(v,B);else{let e=qe.tryReplaceRegWithImm(B,t);s=null!=e?Ye.Mod(C,e):null}break;case 26:if(0==e.castType)if(1==t._hx_index){let e=t.operand;if(0==e._hx_index){let t=e.value;s=Ye.Load(Ke.Float(st.Imm(t)))}else s=null}else s=null;else s=null;break;case 36:let S=e.property,M=e.input,I=qe.tryReplaceRegWithImm(M,t);s=null!=I?Ye.GetDiff(I,S):null;break;case 37:let T=e.property,F=e.input,E=qe.tryReplaceRegWithImm(F,t);s=null!=E?Ye.Set(E,T):null;break;case 38:let D=e.property,R=e.input,V=qe.tryReplaceRegWithImm(R,t);s=null!=V?Ye.Increase(V,D):null;break;default:s=null}return s}static tryReplaceRegBufWithImm(e,t){let s;switch(e._hx_index){case 8:let r=e.input,n=qe.tryReplaceRegBufWithImm(r,t);s=null!=n?Ye.Load(n):null;break;case 20:let i=e.input,a=$e.tryReplaceRegBufWithImm(i,t);s=null!=a?Ye.Add(a):null;break;case 21:let l=e.input,h=$e.tryReplaceRegBufWithImm(l,t);s=null!=h?Ye.Sub(h):null;break;case 23:let o=e.inputB,_=e.inputA,c=qe.tryReplaceRegBufWithImm(_,t);if(null!=c)s=Ye.Mult(c,o);else if(qe.isRegBuf(_))s=null;else{let e=qe.tryReplaceRegBufWithImm(o,t);s=null!=e?Ye.Mult(_,e):null}break;case 24:let u=e.inputB,d=e.inputA,p=qe.tryReplaceRegBufWithImm(d,t);if(null!=p)s=Ye.Div(p,u);else if(qe.isRegBuf(d))s=null;else{let e=qe.tryReplaceRegBufWithImm(u,t);s=null!=e?Ye.Div(d,e):null}break;case 25:let f=e.inputB,x=e.inputA,g=qe.tryReplaceRegBufWithImm(x,t);if(null!=g)s=Ye.Mod(g,f);else{let e=qe.tryReplaceRegBufWithImm(f,t);s=null!=e?Ye.Mod(x,e):null}break;default:s=null}return s}static tryReplaceRegBufAndRegWithImm(e,t,s){let r;switch(e._hx_index){case 20:let n=e.input;switch(n._hx_index){case 0:let e=n.b,i=n.a;if(tt.isRegBuf(i)&&tt.isReg(e)){let e=qe.tryGetIntImm(t),n=qe.tryGetIntImm(s);r=null!=e&&null!=n?Ye.Load(Ke.Int(et.Imm(e+n))):null}else r=null;break;case 1:let a=n.b,l=n.a;if(rt.isRegBuf(l)&&rt.isReg(a)){let e=qe.tryGetFloatImm(t),n=qe.tryGetFloatImm(s);r=null!=e&&null!=n?Ye.Load(Ke.Float(st.Imm(e+n))):null}else r=null;break;default:r=null}break;case 21:let i=e.input;switch(i._hx_index){case 0:let e=i.b,n=i.a;if(tt.isRegBuf(n)&&tt.isReg(e)){let e=qe.tryGetIntImm(t),n=qe.tryGetIntImm(s);r=null!=e&&null!=n?Ye.Load(Ke.Int(et.Imm(e-n))):null}else r=null;break;case 1:let a=i.b,l=i.a;if(rt.isRegBuf(l)&&rt.isReg(a)){let e=qe.tryGetFloatImm(t),n=qe.tryGetFloatImm(s);r=null!=e&&null!=n?Ye.Load(Ke.Float(st.Imm(e-n))):null}else r=null;break;default:r=null}break;case 23:let a=e.inputB,l=e.inputA;switch(l._hx_index){case 1:let e=l.operand;if(tt.isRegBuf(e))if(1==a._hx_index){let e=a.operand;if(tt.isReg(e)){let e=qe.tryGetIntImm(t),n=qe.tryGetIntImm(s);r=null!=e&&null!=n?Ye.Load(Ke.Int(et.Imm(e*n))):null}else r=null}else r=null;else r=null;break;case 2:let n=l.operand;if(rt.isRegBuf(n))if(2==a._hx_index){let e=a.operand;if(rt.isReg(e)){let e=qe.tryGetFloatImm(t),n=qe.tryGetFloatImm(s);r=null!=e&&null!=n?Ye.Load(Ke.Float(st.Imm(e*n))):null}else r=null}else r=null;else r=null;break;case 3:let i=l.operand;if(it.isReg(i))if(2==a._hx_index){let e=a.operand;if(rt.isReg(e)){let e=qe.tryGetVecImm(t),n=qe.tryGetFloatImm(s);if(null!=e&&null!=n){let t=e,s=n;r=Ye.Load(Ke.Vec(nt.Imm(t.x*s,t.y*s)))}else r=null}else r=null}else r=null;else r=null;break;default:r=null}break;case 24:let h=e.inputB,o=e.inputA;switch(o._hx_index){case 1:let e=o.operand;if(tt.isRegBuf(e))if(1==h._hx_index){let e=h.operand;if(tt.isReg(e)){let e=qe.tryGetIntImm(t),n=qe.tryGetIntImm(s);r=null!=e&&null!=n?Ye.Load(Ke.Int(et.Imm(e/n|0))):null}else r=null}else r=null;else r=null;break;case 2:let n=o.operand;if(rt.isRegBuf(n))if(2==h._hx_index){let e=h.operand;if(rt.isReg(e)){let e=qe.tryGetFloatImm(t),n=qe.tryGetFloatImm(s);r=null!=e&&null!=n?Ye.Load(Ke.Float(st.Imm(e/n))):null}else r=null}else r=null;else r=null;break;case 3:let i=o.operand;if(it.isReg(i))if(2==h._hx_index){let e=h.operand;if(rt.isReg(e)){let e=qe.tryGetVecImm(t),n=qe.tryGetFloatImm(s);if(null!=e&&null!=n){let t=e,s=n;r=Ye.Load(Ke.Vec(nt.Imm(t.x/s,t.y/s)))}else r=null}else r=null}else r=null;else r=null;break;default:r=null}break;case 25:let _=e.inputB,c=e.inputA;switch(c._hx_index){case 1:let e=c.operand;if(tt.isRegBuf(e))if(1==_._hx_index){let e=_.operand;if(tt.isReg(e)){let e=qe.tryGetIntImm(t),n=qe.tryGetIntImm(s);r=null!=e&&null!=n?Ye.Load(Ke.Int(et.Imm(e%n))):null}else r=null}else r=null;else r=null;break;case 2:let n=c.operand;if(rt.isRegBuf(n))if(2==_._hx_index){let e=_.operand;if(rt.isReg(e)){let e=qe.tryGetFloatImm(t),n=qe.tryGetFloatImm(s);r=null!=e&&null!=n?Ye.Load(Ke.Float(st.Imm(e%n))):null}else r=null}else r=null;else r=null;break;default:r=null}break;case 26:switch(e.castType){case 1:if(2==t._hx_index){let e=t.operand;if(0==e._hx_index){let t=e.value;if(2==s._hx_index){let e=s.operand;if(0==e._hx_index){let s=e.value;r=Ye.Load(Ke.Vec(nt.Imm(t,s)))}else r=null}else r=null}else r=null}else r=null;break;case 2:if(2==t._hx_index){let e=t.operand;if(0==e._hx_index){let t=e.value;if(2==s._hx_index){let e=s.operand;if(0==e._hx_index){let s=.017453292519943295*(57.29577951308232*e.value),n=Math.sin(s),i=-Math.cos(s),a=n;Math.abs(a)<177635683940025e-29&&(a=0),Math.abs(a-1)<177635683940025e-29&&(a=1),Math.abs(a- -1)<177635683940025e-29&&(a=-1),Math.abs(a-.5)<177635683940025e-29&&(a=.5),Math.abs(a- -.5)<177635683940025e-29&&(a=-.5);let l=i;Math.abs(l)<177635683940025e-29&&(l=0),Math.abs(l-1)<177635683940025e-29&&(l=1),Math.abs(l- -1)<177635683940025e-29&&(l=-1),Math.abs(l-.5)<177635683940025e-29&&(l=.5),Math.abs(l- -.5)<177635683940025e-29&&(l=-.5);let h=a*t,o=l*t;r=Ye.Load(Ke.Vec(nt.Imm(h,o)))}else r=null}else r=null}else r=null}else r=null;break;default:r=null}break;default:r=null}return r}static tryReplaceStackWithImm(e,t){let s;switch(e._hx_index){case 15:let r=e.bytesToSkip,n=e.type;if(0!=r)s=null;else switch(t._hx_index){case 0:s=null;break;case 1:let e=t.operand;if(0==n)if(0==e._hx_index){e.value;s=Ye.Load(t)}else s=null;else s=null;break;case 2:let r=t.operand;if(1==n)if(0==r._hx_index){r.value;s=Ye.Load(t)}else s=null;else s=null;break;case 3:let i=t.operand;if(2==n)if(0==i._hx_index){i.y,i.x;s=Ye.Load(t)}else s=null;else s=null}break;case 38:let i=e.property,a=e.input;switch(a._hx_index){case 2:if(3==a.operand._hx_index)if(2==t._hx_index){let e=t.operand;if(0==e._hx_index){e.value;s=Ye.Increase(t,i)}else s=null}else s=null;else s=null;break;case 3:if(2==a.operand._hx_index)if(3==t._hx_index){let e=t.operand;if(0==e._hx_index){e.y,e.x;s=Ye.Increase(t,i)}else s=null}else s=null;else s=null;break;default:s=null}break;default:s=null}return s}static tryFoldConstants(e){let t;switch(e._hx_index){case 20:let s=e.input;switch(s._hx_index){case 0:let e=s.b,r=s.a;if(0==r._hx_index){let s=r.value;if(0==e._hx_index){let r=e.value;t=Ye.Load(Ke.Int(et.Imm(s+r)))}else t=0==s?Ye.Load(Ke.Int(e)):null}else if(0==e._hx_index){t=0==e.value?Ye.Load(Ke.Int(r)):null}else t=null;break;case 1:let n=s.b,i=s.a;if(0==i._hx_index){let e=i.value;if(0==n._hx_index){let s=n.value;t=Ye.Load(Ke.Float(st.Imm(e+s)))}else t=0==e?Ye.Load(Ke.Float(n)):null}else if(0==n._hx_index){t=0==n.value?Ye.Load(Ke.Float(i)):null}else t=null;break;case 2:let a=s.b,l=s.a;if(0==l._hx_index){let e=l.y,s=l.x;if(0==a._hx_index){let r=a.y,n=a.x;t=Ye.Load(Ke.Vec(nt.Imm(s+n,e+r)))}else t=0==s&&0==e?Ye.Load(Ke.Vec(a)):null}else if(0==a._hx_index){let e=a.y;t=0==a.x&&0==e?Ye.Load(Ke.Vec(l)):null}else t=null}break;case 21:let r=e.input;switch(r._hx_index){case 0:let e=r.b,s=r.a;if(0==s._hx_index){let r=s.value;if(0==e._hx_index){let s=e.value;t=Ye.Load(Ke.Int(et.Imm(r-s)))}else t=0==r?Ye.Minus(Ke.Int(e)):null}else if(0==e._hx_index){t=0==e.value?Ye.Load(Ke.Int(s)):null}else t=null;break;case 1:let n=r.b,i=r.a;if(0==i._hx_index){let e=i.value;if(0==n._hx_index){let s=n.value;t=Ye.Load(Ke.Float(st.Imm(e-s)))}else t=0==e?Ye.Minus(Ke.Float(n)):null}else if(0==n._hx_index){t=0==n.value?Ye.Load(Ke.Float(i)):null}else t=null;break;case 2:let a=r.b,l=r.a;if(0==l._hx_index){let e=l.y,s=l.x;if(0==a._hx_index){let r=a.y,n=a.x;t=Ye.Load(Ke.Vec(nt.Imm(s-n,e-r)))}else t=0==s&&0==e?Ye.Minus(Ke.Vec(a)):null}else if(0==a._hx_index){let e=a.y;t=0==a.x&&0==e?Ye.Load(Ke.Vec(l)):null}else t=null}break;case 22:let n=e.input;switch(n._hx_index){case 1:let e=n.operand;if(0==e._hx_index){let s=e.value;t=Ye.Load(Ke.Int(et.Imm(-s)))}else t=null;break;case 2:let s=n.operand;if(0==s._hx_index){let e=s.value;t=Ye.Load(Ke.Float(st.Imm(-e)))}else t=null;break;case 3:let r=n.operand;if(0==r._hx_index){let e=r.y,s=r.x;t=Ye.Load(Ke.Vec(nt.Imm(-s,-e)))}else t=null;break;default:t=null}break;case 23:let i=e.inputB,a=e.inputA;switch(a._hx_index){case 1:let e=a.operand;if(0==e._hx_index){let s=e.value;if(1==i._hx_index){let e=i.operand;if(0==e._hx_index){let r=e.value;t=Ye.Load(Ke.Int(et.Imm(s*r)))}else t=0==s?Ye.Load(Ke.Int(et.Imm(0))):1==s?Ye.Load(Ke.Int(e)):null}else t=null}else if(1==i._hx_index){let s=i.operand;if(0==s._hx_index){let r=s.value;t=0==r?Ye.Load(Ke.Int(et.Imm(0))):1==r?Ye.Load(Ke.Int(e)):null}else t=null}else t=null;break;case 2:let s=a.operand;if(0==s._hx_index){let e=s.value;if(2==i._hx_index){let s=i.operand;if(0==s._hx_index){let r=s.value;t=Ye.Load(Ke.Float(st.Imm(e*r)))}else t=0==e?Ye.Load(Ke.Float(st.Imm(0))):1==e?Ye.Load(Ke.Float(s)):null}else t=null}else if(2==i._hx_index){let e=i.operand;if(0==e._hx_index){let r=e.value;t=0==r?Ye.Load(Ke.Float(st.Imm(0))):1==r?Ye.Load(Ke.Float(s)):null}else t=null}else t=null;break;case 3:let r=a.operand;if(0==r._hx_index){let e=r.y,s=r.x;if(2==i._hx_index){let r=i.operand;if(0==r._hx_index){let n=r.value;t=Ye.Load(Ke.Vec(nt.Imm(s*n,e*n)))}else t=0==s&&0==e?Ye.Load(Ke.Vec(nt.Imm(0,0))):null}else t=null}else if(2==i._hx_index){let e=i.operand;if(0==e._hx_index){let s=e.value;t=0==s?Ye.Load(Ke.Float(st.Imm(0))):1==s?Ye.Load(Ke.Vec(r)):null}else t=null}else t=null;break;default:t=null}break;case 24:let l=e.inputB,h=e.inputA;switch(h._hx_index){case 1:let e=h.operand;if(0==e._hx_index){let s=e.value;if(1==l._hx_index){let e=l.operand;if(0==e._hx_index){let r=e.value;t=Ye.Load(Ke.Int(et.Imm(s/r|0)))}else t=0==s?Ye.Load(Ke.Int(et.Imm(0))):null}else t=null}else if(1==l._hx_index){let s=l.operand;if(0==s._hx_index){t=1==s.value?Ye.Load(Ke.Int(e)):null}else t=null}else t=null;break;case 2:let s=h.operand;if(0==s._hx_index){let e=s.value;if(2==l._hx_index){let s=l.operand;if(0==s._hx_index){let r=s.value;t=Ye.Load(Ke.Float(st.Imm(e/r)))}else t=0==e?Ye.Load(Ke.Float(st.Imm(0))):null}else t=null}else if(2==l._hx_index){let e=l.operand;if(0==e._hx_index){t=1==e.value?Ye.Load(Ke.Float(s)):null}else t=null}else t=null;break;case 3:let r=h.operand;if(0==r._hx_index){let e=r.y,s=r.x;if(2==l._hx_index){let r=l.operand;if(0==r._hx_index){let n=r.value;t=Ye.Load(Ke.Vec(nt.Imm(s/n,e/n)))}else t=0==s&&0==e?Ye.Load(Ke.Vec(nt.Imm(0,0))):null}else t=null}else if(2==l._hx_index){let e=l.operand;if(0==e._hx_index){t=1==e.value?Ye.Load(Ke.Vec(r)):null}else t=null}else t=null;break;default:t=null}break;case 25:let o=e.inputB,_=e.inputA;switch(_._hx_index){case 1:let e=_.operand;if(0==e._hx_index){let s=e.value;if(1==o._hx_index){let e=o.operand;if(0==e._hx_index){let r=e.value;t=Ye.Load(Ke.Int(et.Imm(s%r)))}else t=0==s?Ye.Load(Ke.Int(et.Imm(0))):null}else t=null}else t=null;break;case 2:let s=_.operand;if(0==s._hx_index){let e=s.value;if(2==o._hx_index){let s=o.operand;if(0==s._hx_index){let r=s.value;t=Ye.Load(Ke.Float(st.Imm(e%r)))}else t=0==e?Ye.Load(Ke.Float(st.Imm(0))):null}else t=null}else t=null;break;default:t=null}break;case 38:e.property;let c=e.input;t=qe.isZero(c)?Ye.None:null;break;default:t=null}return t}static tryReplaceUnnecessaryCalculation(e,t,s){let r,n=qe.getType(t);switch(e._hx_index){case 20:let i=e.input;switch(i._hx_index){case 0:let e=i.b,a=i.a;if(0==n&&qe.isZero(t))switch(s){case 2:r=tt.isReg(a)?Ye.Load(Ke.Int(e)):tt.isReg(e)?Ye.Load(Ke.Int(a)):null;break;case 3:r=tt.isRegBuf(a)?Ye.Load(Ke.Int(e)):tt.isRegBuf(e)?Ye.Load(Ke.Int(a)):null;break;default:r=null}else r=null;break;case 1:let l=i.b,h=i.a;if(1==n&&qe.isZero(t))switch(s){case 2:r=rt.isReg(h)?Ye.Load(Ke.Float(l)):rt.isReg(l)?Ye.Load(Ke.Float(h)):null;break;case 3:r=rt.isRegBuf(h)?Ye.Load(Ke.Float(l)):rt.isRegBuf(l)?Ye.Load(Ke.Float(h)):null;break;default:r=null}else r=null;break;case 2:let o=i.b,_=i.a;if(2==n&&qe.isZero(t))switch(s){case 2:r=it.isReg(_)?Ye.Load(Ke.Vec(o)):it.isReg(o)?Ye.Load(Ke.Vec(_)):null;break;case 3:r=null;break;default:r=null}else r=null}break;case 21:let a=e.input;switch(a._hx_index){case 0:let e=a.b,i=a.a;if(0==n&&qe.isZero(t))switch(s){case 2:r=tt.isReg(i)?Ye.Minus(Ke.Int(e)):tt.isReg(e)?Ye.Load(Ke.Int(i)):null;break;case 3:r=tt.isRegBuf(i)?Ye.Minus(Ke.Int(e)):tt.isRegBuf(e)?Ye.Load(Ke.Int(i)):null;break;default:r=null}else r=null;break;case 1:let l=a.b,h=a.a;if(1==n&&qe.isZero(t))switch(s){case 2:r=rt.isReg(h)?Ye.Minus(Ke.Float(l)):rt.isReg(l)?Ye.Load(Ke.Float(h)):null;break;case 3:r=rt.isRegBuf(h)?Ye.Minus(Ke.Float(l)):rt.isRegBuf(l)?Ye.Load(Ke.Float(h)):null;break;default:r=null}else r=null;break;case 2:let o=a.b,_=a.a;r=2==n&&qe.isZero(t)&&2==s?it.isReg(_)?Ye.Minus(Ke.Vec(o)):it.isReg(o)?Ye.Load(Ke.Vec(_)):null:null}break;case 22:let l=e.input;switch(s){case 2:if(qe.isReg(l))switch(t._hx_index){case 1:let e=t.operand;if(0==e._hx_index){let t=e.value;r=Ye.Load(Ke.Int(et.Imm(-t)))}else r=null;break;case 2:let s=t.operand;if(0==s._hx_index){let e=s.value;r=Ye.Load(Ke.Float(st.Imm(-e)))}else r=null;break;case 3:let n=t.operand;if(0==n._hx_index){let e=n.y,t=n.x;r=Ye.Load(Ke.Vec(nt.Imm(-t,-e)))}else r=null;break;default:r=null}else r=null;break;case 3:if(qe.isRegBuf(l))switch(t._hx_index){case 1:let e=t.operand;if(0==e._hx_index){let t=e.value;r=Ye.Load(Ke.Int(et.Imm(-t)))}else r=null;break;case 2:let s=t.operand;if(0==s._hx_index){let e=s.value;r=Ye.Load(Ke.Float(st.Imm(-e)))}else r=null;break;case 3:let n=t.operand;if(0==n._hx_index){let e=n.y,t=n.x;r=Ye.Load(Ke.Vec(nt.Imm(-t,-e)))}else r=null;break;default:r=null}else r=null;break;default:r=null}break;case 23:let h=e.inputB,o=e.inputA,_=qe.getType(o);if(qe.isZero(t))switch(s){case 2:if(qe.tryGetRegType(o)==n||qe.isRegBuf(o)&&qe.tryGetRegType(h)==n){let e;switch(_){case 0:e=Ke.Int(et.Imm(0));break;case 1:e=Ke.Float(st.Imm(0));break;case 2:e=Ke.Vec(nt.Imm(0,0))}r=Ye.Load(e)}else r=null;break;case 3:if(qe.tryGetRegBufType(o)==n||qe.isReg(o)&&qe.tryGetRegBufType(h)==n){let e;switch(_){case 0:e=Ke.Int(et.Imm(0));break;case 1:e=Ke.Float(st.Imm(0));break;case 2:e=Ke.Vec(nt.Imm(0,0))}r=Ye.Load(e)}else r=null;break;default:r=null}else if(qe.isOne(t))switch(s){case 2:r=qe.tryGetRegType(h)==n?qe.isReg(o)?Ye.None:Ye.Load(o):null;break;case 3:r=qe.tryGetRegBufType(h)==n?qe.isReg(o)?Ye.None:Ye.Load(o):null;break;default:r=null}else r=null;break;case 24:let c=e.inputB,u=e.inputA,d=qe.getType(u);if(qe.isZero(t))switch(s){case 2:if(qe.tryGetRegType(u)==n){let e;switch(d){case 0:e=Ke.Int(et.Imm(0));break;case 1:e=Ke.Float(st.Imm(0));break;case 2:e=Ke.Vec(nt.Imm(0,0))}r=Ye.Load(e)}else r=null;break;case 3:if(qe.tryGetRegBufType(u)==n){let e;switch(d){case 0:e=Ke.Int(et.Imm(0));break;case 1:e=Ke.Float(st.Imm(0));break;case 2:e=Ke.Vec(nt.Imm(0,0))}r=Ye.Load(e)}else r=null;break;default:r=null}else if(qe.isOne(t))switch(s){case 2:r=qe.tryGetRegType(c)==n?qe.isReg(u)?Ye.None:Ye.Load(u):null;break;case 3:r=qe.tryGetRegBufType(c)==n?qe.isReg(u)?Ye.None:Ye.Load(u):null;break;default:r=null}else r=null;break;case 25:e.inputB;let p=e.inputA,f=qe.getType(p);if(qe.isZero(t))switch(s){case 2:if(qe.tryGetRegType(p)==n){let e;switch(f){case 0:e=Ke.Int(et.Imm(0));break;case 1:e=Ke.Float(st.Imm(0));break;case 2:e=Ke.Vec(nt.Imm(0,0))}r=Ye.Load(e)}else r=null;break;case 3:if(qe.tryGetRegBufType(p)==n){let e;switch(f){case 0:e=Ke.Int(et.Imm(0));break;case 1:e=Ke.Float(st.Imm(0));break;case 2:e=Ke.Vec(nt.Imm(0,0))}r=Ye.Load(e)}else r=null;break;default:r=null}else r=null;break;case 38:e.property;let x=e.input;if(qe.isZero(t))switch(s){case 2:r=qe.tryGetRegType(x)==n?Ye.None:null;break;case 3:r=qe.tryGetRegBufType(x)==n?Ye.None:null;break;default:r=null}else r=null;break;default:r=null}return r}static tryReplaceVariable(e,t){let s;switch(e._hx_index){case 8:let r=e.input,n=qe.tryReplaceVarWithImm(r,t);s=null!=n?Ye.Load(n):null;break;case 9:let i=e.input,a=qe.tryReplaceVarWithImm(i,t);s=null!=a?Ye.Save(a):null;break;case 11:let l=e.varKey,h=e.input,o=qe.tryReplaceVarWithImm(h,t);s=null!=o?Ye.Store(o,l):null;break;case 13:let _=e.input,c=qe.tryReplaceVarWithImm(_,t);s=null!=c?Ye.Push(c):null;break;case 20:let u=e.input;switch(u._hx_index){case 0:let e=u.b,r=u.a;if(4==r._hx_index){let n=r.key,i=t.variableStackMap.h[n];if(null==i)throw $i.thrown("Variable not declared: "+n);let a=i[i.length-1].tryGetIntImm();s=null!=a?Ye.Add(Je.Int(et.Imm(a),e)):null}else s=null;break;case 1:let n=u.b,i=u.a;if(4==i._hx_index){let e=i.key,r=t.variableStackMap.h[e];if(null==r)throw $i.thrown("Variable not declared: "+e);let a=r[r.length-1].tryGetFloatImm();s=null!=a?Ye.Add(Je.Float(st.Imm(a),n)):null}else s=null;break;default:s=null}break;case 21:let d=e.input;switch(d._hx_index){case 0:let e=d.b,r=d.a;if(4==r._hx_index){let n=r.key,i=t.variableStackMap.h[n];if(null==i)throw $i.thrown("Variable not declared: "+n);let a=i[i.length-1].tryGetIntImm();s=null!=a?Ye.Sub(Je.Int(et.Imm(a),e)):null}else s=null;break;case 1:let n=d.b,i=d.a;if(4==i._hx_index){let e=i.key,r=t.variableStackMap.h[e];if(null==r)throw $i.thrown("Variable not declared: "+e);let a=r[r.length-1].tryGetFloatImm();s=null!=a?Ye.Sub(Je.Float(st.Imm(a),n)):null}else s=null;break;default:s=null}break;case 22:let p=e.input,f=qe.tryReplaceVarWithImm(p,t);s=null!=f?Ye.Minus(f):null;break;case 23:let x=e.inputB,g=e.inputA,b=qe.tryReplaceVarWithImm(g,t);s=null!=b?Ye.Mult(b,x):null;break;case 24:let m=e.inputB,A=e.inputA,w=qe.tryReplaceVarWithImm(A,t);s=null!=w?Ye.Div(w,m):null;break;case 25:let y=e.inputB,k=e.inputA,B=qe.tryReplaceVarWithImm(k,t);s=null!=B?Ye.Mod(B,y):null;break;case 36:let C=e.property,v=e.input,S=qe.tryReplaceVarWithImm(v,t);s=null!=S?Ye.GetDiff(S,C):null;break;case 37:let M=e.property,I=e.input,T=qe.tryReplaceVarWithImm(I,t);s=null!=T?Ye.Set(T,M):null;break;case 38:let F=e.property,E=e.input,D=qe.tryReplaceVarWithImm(E,t);s=null!=D?Ye.Increase(D,F):null;break;default:s=null}return s}}s["firedancer.assembly.InstructionOptimizer"]=He,He.__name__="firedancer.assembly.InstructionOptimizer";var Ke=n["firedancer.assembly.Operand"]={__ename__:"firedancer.assembly.Operand",__constructs__:["Null","Int","Float","Vec"],Null:{_hx_index:0,__enum__:"firedancer.assembly.Operand",toString:r},Int:(t=function(e){return{_hx_index:1,operand:e,__enum__:"firedancer.assembly.Operand",toString:r}},t.__params__=["operand"],t),Float:(t=function(e){return{_hx_index:2,operand:e,__enum__:"firedancer.assembly.Operand",toString:r}},t.__params__=["operand"],t),Vec:(t=function(e){return{_hx_index:3,operand:e,__enum__:"firedancer.assembly.Operand",toString:r}},t.__params__=["operand"],t)};Ke.__empty_constructs__=[Ke.Null];class qe{static toString(e){switch(e._hx_index){case 0:return"n";case 1:let t=e.operand;return tt.toString(t);case 2:let s=e.operand;return rt.toString(s);case 3:let r=e.operand;return it.toString(r)}}static bytecodeLength(e){switch(e._hx_index){case 0:return 0;case 1:let t=e.operand;return tt.bytecodeLength(t);case 2:let s=e.operand;return rt.bytecodeLength(s);case 3:let r=e.operand;return it.bytecodeLength(r)}}static getType(e){switch(e._hx_index){case 0:throw $i.thrown("Cannot determine type of Null.");case 1:e.operand;return 0;case 2:e.operand;return 1;case 3:e.operand;return 2}}static tryGetRegType(e){let t;switch(e._hx_index){case 0:t=null;break;case 1:t=1==e.operand._hx_index?0:null;break;case 2:t=1==e.operand._hx_index?1:null;break;case 3:t=1==e.operand._hx_index?2:null}return t}static tryGetRegBufType(e){let t;switch(e._hx_index){case 0:t=null;break;case 1:t=2==e.operand._hx_index?0:null;break;case 2:t=2==e.operand._hx_index?1:null;break;default:t=null}return t}static isReg(e){switch(e._hx_index){case 0:return!1;case 1:let t=e.operand;return tt.isReg(t);case 2:let s=e.operand;return rt.isReg(s);case 3:let r=e.operand;return it.isReg(r)}}static isRegBuf(e){switch(e._hx_index){case 0:return!1;case 1:let t=e.operand;return tt.isRegBuf(t);case 2:let s=e.operand;return rt.isRegBuf(s);case 3:e.operand;return!1}}static isStack(e){switch(e._hx_index){case 0:return!1;case 1:return e.operand==et.Stack;case 2:return e.operand==st.Stack;case 3:return e.operand==nt.Stack}}static getKind(e){switch(e._hx_index){case 0:return 0;case 1:let t=e.operand;switch(t._hx_index){case 0:t.value;return 1;case 1:return 2;case 2:return 3;case 3:return 4;case 4:t.key;return 5}break;case 2:let s=e.operand;switch(s._hx_index){case 0:s.value;return 1;case 1:return 2;case 2:return 3;case 3:return 4;case 4:s.key;return 5}break;case 3:let r=e.operand;switch(r._hx_index){case 0:r.y,r.x;return 1;case 1:return 2;case 2:return 4}}}static tryGetIntImm(e){let t;if(1==e._hx_index){let s=e.operand;if(0==s._hx_index){t=s.value}else t=null}else t=null;return t}static tryGetFloatImm(e){let t;if(2==e._hx_index){let s=e.operand;if(0==s._hx_index){t=s.value}else t=null}else t=null;return t}static tryGetVecImm(e){let t;if(3==e._hx_index){let s=e.operand;if(0==s._hx_index){let e=s.y;t={x:s.x,y:e}}else t=null}else t=null;return t}static tryReplaceRegWithImm(e,t){let s;switch(e._hx_index){case 0:s=null;break;case 1:if(1==e.operand._hx_index)if(1==t._hx_index){let e=t.operand;if(0==e._hx_index){e.value;s=t}else s=null}else s=null;else s=null;break;case 2:if(1==e.operand._hx_index)if(2==t._hx_index){let e=t.operand;if(0==e._hx_index){e.value;s=t}else s=null}else s=null;else s=null;break;case 3:if(1==e.operand._hx_index)if(3==t._hx_index){let e=t.operand;if(0==e._hx_index){e.y,e.x;s=t}else s=null}else s=null;else s=null}return s}static tryReplaceRegBufWithImm(e,t){let s;switch(e._hx_index){case 1:if(2==e.operand._hx_index)if(1==t._hx_index){let e=t.operand;if(0==e._hx_index){e.value;s=t}else s=null}else s=null;else s=null;break;case 2:if(2==e.operand._hx_index)if(2==t._hx_index){let e=t.operand;if(0==e._hx_index){e.value;s=t}else s=null}else s=null;else s=null;break;default:s=null}return s}static tryReplaceVarWithImm(e,t){let s;switch(e._hx_index){case 0:s=null;break;case 1:let r=e.operand;if(4==r._hx_index){let e=r.key,n=t.variableStackMap.h[e];if(null==n)throw $i.thrown("Variable not declared: "+e);let i=n[n.length-1];if(null!=i.operand){let e=i.operand;if(1==e._hx_index){let t=e.operand;if(0==t._hx_index){t.value;s=i.operand}else s=null}else s=null}else s=null}else s=null;break;case 2:let n=e.operand;if(4==n._hx_index){let e=n.key,r=t.variableStackMap.h[e];if(null==r)throw $i.thrown("Variable not declared: "+e);let i=r[r.length-1];if(null!=i.operand){let e=i.operand;if(2==e._hx_index){let t=e.operand;if(0==t._hx_index){t.value;s=i.operand}else s=null}else s=null}else s=null}else s=null;break;default:s=null}return s}static isZero(e){switch(e._hx_index){case 1:let t=e.operand;return tt.isZero(t);case 2:let s=e.operand;return rt.isZero(s);case 3:let r=e.operand;return it.isZero(r);default:return!1}}static isOne(e){switch(e._hx_index){case 1:let t=e.operand;return tt.isOne(t);case 2:let s=e.operand;return rt.isOne(s);default:return!1}}}s["firedancer.assembly.OperandExtension"]=qe,qe.__name__="firedancer.assembly.OperandExtension";var Je=n["firedancer.assembly.OperandPair"]={__ename__:"firedancer.assembly.OperandPair",__constructs__:["Int","Float","Vec"],Int:(t=function(e,t){return{_hx_index:0,a:e,b:t,__enum__:"firedancer.assembly.OperandPair",toString:r}},t.__params__=["a","b"],t),Float:(t=function(e,t){return{_hx_index:1,a:e,b:t,__enum__:"firedancer.assembly.OperandPair",toString:r}},t.__params__=["a","b"],t),Vec:(t=function(e,t){return{_hx_index:2,a:e,b:t,__enum__:"firedancer.assembly.OperandPair",toString:r}},t.__params__=["a","b"],t)};Je.__empty_constructs__=[];class $e{static toString(e){switch(e._hx_index){case 0:let t=e.b,s=e.a;return tt.toString(s)+", "+tt.toString(t);case 1:let r=e.b,n=e.a;return rt.toString(n)+", "+rt.toString(r);case 2:let i=e.b,a=e.a;return it.toString(a)+", "+it.toString(i)}}static bytecodeLength(e){switch(e._hx_index){case 0:let t=e.b,s=e.a;return tt.bytecodeLength(s)+tt.bytecodeLength(t);case 1:let r=e.b,n=e.a;return rt.bytecodeLength(n)+rt.bytecodeLength(r);case 2:let i=e.b,a=e.a;return it.bytecodeLength(a)+it.bytecodeLength(i)}}static getFirstOperand(e){switch(e._hx_index){case 0:e.b;let t=e.a;return Ke.Int(t);case 1:e.b;let s=e.a;return Ke.Float(s);case 2:e.b;let r=e.a;return Ke.Vec(r)}}static tryGetRegType(e){let t;switch(e._hx_index){case 0:let s=e.b,r=e.a;t=tt.isReg(r)||tt.isReg(s)?0:null;break;case 1:let n=e.b,i=e.a;t=rt.isReg(i)||rt.isReg(n)?1:null;break;case 2:let a=e.b,l=e.a;t=it.isReg(l)||it.isReg(a)?2:null}return t}static tryGetRegBufType(e){let t;switch(e._hx_index){case 0:let s=e.b,r=e.a;t=tt.isRegBuf(r)||tt.isRegBuf(s)?0:null;break;case 1:let n=e.b,i=e.a;t=rt.isRegBuf(i)||rt.isRegBuf(n)?1:null;break;default:t=null}return t}static tryReplaceRegWithImm(e,t){let s;switch(e._hx_index){case 0:let r=e.b,n=e.a;if(1==t._hx_index){let e=t.operand;if(0==e._hx_index){e.value;s=tt.isReg(n)?2==r._hx_index?null:Je.Int(e,r):tt.isReg(r)?2==n._hx_index?null:Je.Int(n,e):null}else s=null}else s=null;break;case 1:let i=e.b,a=e.a;if(2==t._hx_index){let e=t.operand;if(0==e._hx_index){e.value;s=rt.isReg(a)?2==i._hx_index?null:Je.Float(e,i):rt.isReg(i)?2==a._hx_index?null:Je.Float(a,e):null}else s=null}else s=null;break;case 2:e.b,e.a;s=null}return s}static tryReplaceRegBufWithImm(e,t){let s;switch(e._hx_index){case 0:let r=e.b,n=e.a;if(1==t._hx_index){let e=t.operand;if(0==e._hx_index){e.value;s=tt.isRegBuf(n)?Je.Int(e,r):tt.isRegBuf(r)?Je.Int(n,e):null}else s=null}else s=null;break;case 1:let i=e.b,a=e.a;if(2==t._hx_index){let e=t.operand;if(0==e._hx_index){e.value;s=rt.isRegBuf(a)?Je.Float(e,i):rt.isRegBuf(i)?Je.Float(a,e):null}else s=null}else s=null;break;case 2:e.b,e.a;s=null}return s}}s["firedancer.assembly.OperandPairExtension"]=$e,$e.__name__="firedancer.assembly.OperandPairExtension";var et=n["firedancer.assembly.IntOperand"]={__ename__:"firedancer.assembly.IntOperand",__constructs__:["Imm","Reg","RegBuf","Stack","Var"],Imm:(t=function(e){return{_hx_index:0,value:e,__enum__:"firedancer.assembly.IntOperand",toString:r}},t.__params__=["value"],t),Reg:{_hx_index:1,__enum__:"firedancer.assembly.IntOperand",toString:r},RegBuf:{_hx_index:2,__enum__:"firedancer.assembly.IntOperand",toString:r},Stack:{_hx_index:3,__enum__:"firedancer.assembly.IntOperand",toString:r},Var:(t=function(e){return{_hx_index:4,key:e,__enum__:"firedancer.assembly.IntOperand",toString:r}},t.__params__=["key"],t)};et.__empty_constructs__=[et.Reg,et.RegBuf,et.Stack];class tt{static toString(e){switch(e._hx_index){case 0:let t=e.value;return null==t?"null":""+t;case 1:return"ri";case 2:return"rib";case 3:return"s";case 4:let s=e.key;return at.varToString(s,0)}}static bytecodeLength(e){switch(e._hx_index){case 0:e.value;return 4;case 4:e.key;return 4;default:return 0}}static isReg(e){return 1==e._hx_index}static isRegBuf(e){return 2==e._hx_index}static isZero(e){if(0==e._hx_index){return 0==e.value}return!1}static isOne(e){if(0==e._hx_index){return 1==e.value}return!1}}s["firedancer.assembly.IntOperandExtension"]=tt,tt.__name__="firedancer.assembly.IntOperandExtension";var st=n["firedancer.assembly.FloatOperand"]={__ename__:"firedancer.assembly.FloatOperand",__constructs__:["Imm","Reg","RegBuf","Stack","Var"],Imm:(t=function(e){return{_hx_index:0,value:e,__enum__:"firedancer.assembly.FloatOperand",toString:r}},t.__params__=["value"],t),Reg:{_hx_index:1,__enum__:"firedancer.assembly.FloatOperand",toString:r},RegBuf:{_hx_index:2,__enum__:"firedancer.assembly.FloatOperand",toString:r},Stack:{_hx_index:3,__enum__:"firedancer.assembly.FloatOperand",toString:r},Var:(t=function(e){return{_hx_index:4,key:e,__enum__:"firedancer.assembly.FloatOperand",toString:r}},t.__params__=["key"],t)};st.__empty_constructs__=[st.Reg,st.RegBuf,st.Stack];class rt{static toString(e){switch(e._hx_index){case 0:let t=e.value;return at.ftoa(t);case 1:return"rf";case 2:return"rfb";case 3:return"s";case 4:let s=e.key;return at.varToString(s,1)}}static bytecodeLength(e){switch(e._hx_index){case 0:e.value;return 8;case 4:e.key;return 4;default:return 0}}static isReg(e){return 1==e._hx_index}static isRegBuf(e){return 2==e._hx_index}static isZero(e){if(0==e._hx_index){let t=e.value;return Math.abs(t)<177635683940025e-29}return!1}static isOne(e){if(0==e._hx_index){let t=e.value;return Math.abs(t-1)<177635683940025e-29}return!1}}s["firedancer.assembly.FloatOperandExtension"]=rt,rt.__name__="firedancer.assembly.FloatOperandExtension";var nt=n["firedancer.assembly.VecOperand"]={__ename__:"firedancer.assembly.VecOperand",__constructs__:["Imm","Reg","Stack"],Imm:(t=function(e,t){return{_hx_index:0,x:e,y:t,__enum__:"firedancer.assembly.VecOperand",toString:r}},t.__params__=["x","y"],t),Reg:{_hx_index:1,__enum__:"firedancer.assembly.VecOperand",toString:r},Stack:{_hx_index:2,__enum__:"firedancer.assembly.VecOperand",toString:r}};nt.__empty_constructs__=[nt.Reg,nt.Stack];class it{static toString(e){switch(e._hx_index){case 0:let t=e.y,s=e.x;return"("+at.ftoa(s)+", "+at.ftoa(t)+")";case 1:return"rvec";case 2:return"s"}}static bytecodeLength(e){if(0==e._hx_index){e.y,e.x;return 16}return 0}static isReg(e){return 1==e._hx_index}static isZero(e){if(0==e._hx_index){let t=e.y,s=e.x;return Math.abs(s)<177635683940025e-29&&Math.abs(t)<177635683940025e-29}return!1}}s["firedancer.assembly.VecOperandExtension"]=it,it.__name__="firedancer.assembly.VecOperandExtension";class at{static ftoa(e){return(0|e)==e?e+".0":null==e?"null":""+e}static varToString(e,t){if(-1!=e.indexOf('"',null))throw $i.thrown("Invalid variable key. Contains double quote: "+e);let s;switch(t){case 0:s="i";break;case 1:s="f";break;case 2:s="v"}return s+'var["'+e+'"]'}}s["firedancer.assembly.OperandTools"]=at,at.__name__="firedancer.assembly.OperandTools";class lt{static optimize(e){let t=0;for(e=e.slice();;){let s=!1;if(lt.tryOptimizeCalc(e)&&(s=!0),lt.tryOptimizeStack(e)&&(s=!0),lt.tryOptimizeVar(e)&&(s=!0),lt.tryOptimizeWait(e)&&(s=!0),!s)break;let r=e.length,n=0,i=0,a=!1;for(;n<r;){let t=e[n];++n,t!=Ye.None?(e[i]=t,++i):a=!0}if(e.length=i,1024<++t)throw $i.thrown("Detected infinite loop in the optimization process.")}return e}static tryOptimizeCalc(e){if(e.length<=1)return!1;let t,s,r=!1,n=ht.createNull(),i=ht.createNull(),a=ht.createNull(),l=ht.createNull(),h=ht.createNull(),o=!1,_=!1,c=0;for(;;){let u;if(!(c<e.length))break;switch(t=e[c],s=!0,t._hx_index){case 8:let n=t.input;switch(n._hx_index){case 1:switch(n.operand._hx_index){case 1:let n=Ye.None;e[c]=n,c==c&&(t=n,s=!1),r=!0;break;case 2:if(o){let n=Ye.None;e[c]=n,c==c&&(t=n,s=!1),r=!0}}break;case 2:switch(n.operand._hx_index){case 1:let n=Ye.None;e[c]=n,c==c&&(t=n,s=!1),r=!0;break;case 2:if(_){let n=Ye.None;e[c]=n,c==c&&(t=n,s=!1),r=!0}}}break;case 9:let i=t.input;switch(i._hx_index){case 1:switch(i.operand._hx_index){case 1:if(o){let n=Ye.None;e[c]=n,c==c&&(t=n,s=!1),r=!0}break;case 2:let n=Ye.None;e[c]=n,c==c&&(t=n,s=!1),r=!0}break;case 2:switch(i.operand._hx_index){case 1:if(_){let n=Ye.None;e[c]=n,c==c&&(t=n,s=!1),r=!0}break;case 2:let n=Ye.None;e[c]=n,c==c&&(t=n,s=!1),r=!0}}}let d=n.getMaybeImm(),p=!1;if(null!=d){let n=d,i=He.tryReplaceRegWithImm(t,n);if(null!=i){let n=i;e[c]=n,c==c&&(t=n,s=!1),r=!0,p=!0}}if(p)u=!0;else{let o=i.getMaybeImm(),_=!1;if(null!=o){let n=o,i=He.tryReplaceRegWithImm(t,n);if(null!=i){let n=i;e[c]=n,c==c&&(t=n,s=!1),r=!0,_=!0}}if(_)u=!0;else{let o=a.getMaybeImm(),_=!1;if(null!=o){let n=o,i=He.tryReplaceRegWithImm(t,n);if(null!=i){let n=i;e[c]=n,c==c&&(t=n,s=!1),r=!0,_=!0}}if(_)u=!0;else{let a=l.getMaybeImm(),o=!1;if(null!=a){let n=a,i=He.tryReplaceRegBufWithImm(t,n);if(null!=i){let n=i;e[c]=n,c==c&&(t=n,s=!1),r=!0,o=!0}}if(o)u=!0;else{let a=h.getMaybeImm(),o=!1;if(null!=a){let n=a,i=He.tryReplaceRegBufWithImm(t,n);if(null!=i){let n=i;e[c]=n,c==c&&(t=n,s=!1),r=!0,o=!0}}if(o)u=!0;else{let a=l.getMaybeImm(),o=n.getMaybeImm(),_=!1;if(null!=a&&null!=o){let n=a,i=o,l=He.tryReplaceRegBufAndRegWithImm(t,n,i);if(null!=l){let n=l;e[c]=n,c==c&&(t=n,s=!1),r=!0,_=!0}}if(_)u=!0;else{let n=h.getMaybeImm(),a=i.getMaybeImm(),l=!1;if(null!=n&&null!=a){let i=n,h=a,o=He.tryReplaceRegBufAndRegWithImm(t,i,h);if(null!=o){let n=o;e[c]=n,c==c&&(t=n,s=!1),r=!0,l=!0}}u=l}}}}}}if(!u){let o=n.getMaybeImm(),_=!1;if(null!=o){let n=o,i=He.tryReplaceUnnecessaryCalculation(t,n,2);if(null!=i){let n=i;e[c]=n,c==c&&(t=n,s=!1),r=!0,_=!0}}if(!_){let n=i.getMaybeImm(),o=!1;if(null!=n){let i=n,a=He.tryReplaceUnnecessaryCalculation(t,i,2);if(null!=a){let n=a;e[c]=n,c==c&&(t=n,s=!1),r=!0,o=!0}}if(!o){let n=a.getMaybeImm(),i=!1;if(null!=n){let a=n,l=He.tryReplaceUnnecessaryCalculation(t,a,2);if(null!=l){let n=l;e[c]=n,c==c&&(t=n,s=!1),r=!0,i=!0}}if(!i){let n=l.getMaybeImm(),i=!1;if(null!=n){let a=n,l=He.tryReplaceUnnecessaryCalculation(t,a,3);if(null!=l){let n=l;e[c]=n,c==c&&(t=n,s=!1),r=!0,i=!0}}if(!i){let n=h.getMaybeImm(),i=!1;if(null!=n){let a=n,l=He.tryReplaceUnnecessaryCalculation(t,a,3);if(null!=l){let n=l;e[c]=n,c==c&&(t=n,s=!1),r=!0,i=!0}}}}}}}let f=He.tryFoldConstants(t);if(null!=f){let n=f;e[c]=n,c==c&&(t=n,s=!1),r=!0}Ze.readsReg(t,0)&&(n.maybeRead=!0),Ze.readsReg(t,1)&&(i.maybeRead=!0),Ze.readsReg(t,2)&&(a.maybeRead=!0),Ze.readsRegBuf(t,0)&&(l.maybeRead=!0),Ze.readsRegBuf(t,1)&&(h.maybeRead=!0);let x=Ze.tryGetWriteRegType(t);if(null!=x)switch(x){case 0:if(n.isEliminatable(c)){let i=n.loadedIndex,a=Ye.None;e[i]=a,i==c&&(t=a,s=!1),r=!0}switch(t._hx_index){case 8:let e=t.input;n=new ht(e,c,!0),o=qe.isRegBuf(e);break;case 14:t.type;n=new ht(null,c,!1),o=!1;break;default:n=new ht(null,c,!0),o=!1}break;case 1:if(i.isEliminatable(c)){let n=i.loadedIndex,a=Ye.None;e[n]=a,n==c&&(t=a,s=!1),r=!0}switch(t._hx_index){case 8:let e=t.input;i=new ht(e,c,!0),_=qe.isRegBuf(e);break;case 14:t.type;i=new ht(null,c,!1),o=!1;break;default:i=new ht(null,c,!0),_=!1}break;case 2:if(a.isEliminatable(c)){let n=a.loadedIndex,i=Ye.None;e[n]=i,n==c&&(t=i,s=!1),r=!0}switch(t._hx_index){case 8:let e=t.input;a=new ht(e,c,!0);break;case 14:t.type;n=new ht(null,c,!1);break;default:a=new ht(null,c,!0)}}let g=Ze.tryGetWriteRegBufType(t);if(null!=g)switch(g){case 0:if(l.isEliminatable(c)){let n=l.loadedIndex,i=Ye.None;e[n]=i,n==c&&(t=i,s=!1),r=!0}if(9==t._hx_index){let e=t.input;l=new ht(e,c,!0),o=qe.isReg(e)}else l=new ht(null,c,!0),o=!1;break;case 1:if(h.isEliminatable(c)){let n=h.loadedIndex,i=Ye.None;e[n]=i,n==c&&(t=i,s=!1),r=!0}if(9==t._hx_index){let e=t.input;h=new ht(e,c,!0),_=qe.isReg(e)}else h=new ht(null,c,!0),_=!1}s&&++c}let u=e.length;if(n.isEliminatable(u)){let i=n.loadedIndex,a=Ye.None;e[i]=a,i==c&&(t=a,s=!1),r=!0}let d=e.length;if(i.isEliminatable(d)){let n=i.loadedIndex,a=Ye.None;e[n]=a,n==c&&(t=a,s=!1),r=!0}let p=e.length;if(a.isEliminatable(p)){let n=a.loadedIndex,i=Ye.None;e[n]=i,n==c&&(t=i,s=!1),r=!0}let f=e.length;if(l.isEliminatable(f)){let n=l.loadedIndex,i=Ye.None;e[n]=i,n==c&&(t=i,s=!1),r=!0}let x=e.length;if(h.isEliminatable(x)){let n=h.loadedIndex,i=Ye.None;e[n]=i,n==c&&(t=i,s=!1),r=!0}return r}static tryOptimizeStack(e){if(e.length<=1)return!1;let t=!1,s=[],r=0;for(;;){if(!(r<e.length))break;let n=e[r];switch(n._hx_index){case 1:s.pop();break;case 4:n.labelId,s.pop();break;case 5:n.programId;let i=n.output;if(1==i._hx_index){if(3==i.operand._hx_index){s.push(new ot(i,r,null))}}break;case 6:s.pop();break;case 13:let a=n.input;s.push(new ot(a,r,null));break;case 14:n.type;let l=s.pop();if(!l.maybeRead){let s;if(1!=qe.getKind(l.operand)){let e=r-1;s=l.pushedIndex==e}else s=!0;if(s){let s=Ye.Load(l.operand);e[r]=s,r==r&&(n=s),t=!0;let i=l.pushedIndex,a=Ye.None;e[i]=a,r==i&&(n=a),t=!0}}break;case 15:n.bytesToSkip,n.type;let h,o=s.length-1;if(-1!=o){h=s[o]}else{h=null}null!=h&&(h.maybeRead=!0);break;case 16:n.type,s.pop();break;case 38:n.property;let _=n.input;if(qe.isStack(_)){let e,t=s.length-1;if(-1!=t){e=s[t]}else{e=null}null!=e&&(e.maybeRead=!0)}}let i,a=s.length-1;if(-1!=a){i=s[a]}else{i=null}if(null!=i){let s=He.tryReplaceStackWithImm(n,i.operand);if(null!=s){let i=s;e[r]=i,r==r&&(n=i),t=!0}}++r}return t}static tryOptimizeVar(e){if(e.length<=1)return!1;let t,s=!1,r=new ct,n=0;for(;;){if(!(n<e.length))break;switch(t=e[n],t._hx_index){case 2:t.labelId;r.allMayBeReadOrAssigned();break;case 3:t.labelId;r.allMayBeReadOrAssigned();break;case 4:t.labelId;r.allMayBeReadOrAssigned();break;case 10:t.type;let i=t.varKey;r.let(i,n);break;case 12:t.type;let a=t.varKey,l=r.variableStackMap.h[a];if(null==l)throw $i.thrown("Variable not declared: "+a);let h=l[l.length-1];if(!h.maybeRead){let r=h.lastAssignedIndex;if(-1!=r){let i=r,a=Ye.None;e[i]=a,n==i&&(t=a),s=!0}}if(!h.isUsed){let r=h.declaredIndex,i=Ye.None;e[r]=i,n==r&&(t=i),s=!0;let a=Ye.None;e[n]=a,n==n&&(t=a),s=!0}r.free(a);break;default:let o=He.tryReplaceVariable(t,r);if(null!=o){let r=o;e[n]=r,n==n&&(t=r),s=!0}let _=Ze.tryGetReadVarKey(t);if(null!=_){let e=_,t=r.variableStackMap.h[e];if(null==t)throw $i.thrown("Variable not declared: "+e);let s=t[t.length-1];s.maybeRead=!0,s.isUsed=!0}let c=Ze.tryGetWriteVarKey(t);if(null!=c){let i=c,a=r.variableStackMap.h[i];if(null==a)throw $i.thrown("Variable not declared: "+i);let l=a[a.length-1];if(!l.maybeRead){let r=l.lastAssignedIndex;if(-1!=r){let i=r,a=Ye.None;e[i]=a,n==i&&(t=a),s=!0}}if(11==t._hx_index){t.varKey;let e=t.input;r.assign(c,n,e)}else r.assign(c,n)}}++n}return s}static tryOptimizeWait(e){let t=!1,s=1;for(;;){if(!(s<e.length))break;if(1==e[s]._hx_index){let r=e[s-1];if(13==r._hx_index){let n=r.input,i=qe.tryGetIntImm(n);if(null!=i){let r=i;if(r<=32){e[s-1]=Ye.None,t=!0,e[s]=Ye.None,t=!0;let n=0,i=r;for(;n<i;){n++;e.splice(s,0,Ye.Break)}s=s+r}}}}++s}return t}}s["firedancer.assembly.Optimizer"]=lt,lt.__name__="firedancer.assembly.Optimizer";class ht{constructor(e,t,s){null==s&&(s=!0),this.maybeRead=!1,this.operand=null;let r=e;this.operand=r,this.loadedIndex=t,this.eliminatable=s}getMaybeImm(){let e=this.operand;if(null!=e){if(1==qe.getKind(e))return e;return null}return null}isEliminatable(e){if(!this.eliminatable)return!1;if(this.maybeRead)return!1;let t=this.loadedIndex;return-1!=t&&t!=e}static createNull(){return new ht(null,-1,!1)}}s["firedancer.assembly._Optimizer.RegContent"]=ht,ht.__name__="firedancer.assembly._Optimizer.RegContent",Object.assign(ht.prototype,{__class__:ht});class ot{constructor(e,t,s){this.maybeRead=!1,this.operand=e,this.pushedIndex=t,null!=s&&(this.maybeRead=s)}}s["firedancer.assembly.StackElement"]=ot,ot.__name__="firedancer.assembly.StackElement",Object.assign(ot.prototype,{__class__:ot});class _t{constructor(e,t,s){this.maybeRead=!1,this.isUsed=!1,this.declaredIndex=e,this.lastAssignedIndex=null!=t?t:-1;let r=s;this.operand=r}tryGetIntImm(){if(null!=this.operand){let e=this.operand;if(1==e._hx_index){let t=e.operand;if(0==t._hx_index){return t.value}return null}return null}return null}tryGetFloatImm(){if(null!=this.operand){let e=this.operand;if(2==e._hx_index){let t=e.operand;if(0==t._hx_index){return t.value}return null}return null}return null}}s["firedancer.assembly.VariableElement"]=_t,_t.__name__="firedancer.assembly.VariableElement",Object.assign(_t.prototype,{__class__:_t});class ct{constructor(){this.variableStackMap=new va}let(e,t){let s=this.variableStackMap.h[e],r=new _t(t,null,null);if(null==s)this.variableStackMap.h[e]=[r];else{s.push(r)}}assign(e,t,s){let r=this.variableStackMap.h[e];if(null!=r){let e=r[r.length-1];e.lastAssignedIndex=t;let n=s;e.operand=n,e.maybeRead=!1,e.isUsed=!0}}free(e){let t=this.variableStackMap.h[e];if(null!=t){t.pop()}}allMayBeReadOrAssigned(){let e=va.valueIterator(this.variableStackMap.h);for(;e.hasNext();){let t,s=e.next(),r=s.length-1;if(-1!=r){t=s[r]}else{t=null}if(null==t)continue;let n=t;n.maybeRead=!0,n.lastAssignedIndex=-1;let i=null;n.operand=i}}}s["firedancer.assembly.Variables"]=ct,ct.__name__="firedancer.assembly.Variables",Object.assign(ct.prototype,{__class__:ct});class ut{static toString(e){switch(e){case 0:return"int";case 1:return"float";case 2:return"vec"}}}var dt=n["firedancer.assembly.WordEnum"]={__ename__:"firedancer.assembly.WordEnum",__constructs__:["OpcodeWord","IntWord","FloatWord"],OpcodeWord:(t=function(e){return{_hx_index:0,code:e,__enum__:"firedancer.assembly.WordEnum",toString:r}},t.__params__=["code"],t),IntWord:(t=function(e){return{_hx_index:1,value:e,__enum__:"firedancer.assembly.WordEnum",toString:r}},t.__params__=["value"],t),FloatWord:(t=function(e){return{_hx_index:2,value:e,__enum__:"firedancer.assembly.WordEnum",toString:r}},t.__params__=["value"],t)};dt.__empty_constructs__=[];class pt{constructor(e,t){this.type=e,this.component=t}toString(){switch(this.type){case 0:switch(this.component){case 0:return"position";case 1:return"distance";case 2:return"bearing"}break;case 1:switch(this.component){case 0:return"velocity";case 1:return"speed";case 2:return"direction"}break;case 2:switch(this.component){case 0:return"shot_position";case 1:return"shot_distance";case 2:return"shot_bearing"}break;case 3:switch(this.component){case 0:return"shot_velocity";case 1:return"shot_speed";case 2:return"shot_direction"}}}static create(e,t){return new pt(e,t)}}s["firedancer.assembly.types.ActorProperty"]=pt,pt.__name__="firedancer.assembly.types.ActorProperty",Object.assign(pt.prototype,{__class__:pt});class ft{static getValueType(e){switch(e){case 0:return 2;case 1:case 2:return 1}}}class xt{static getReadOpcode(e){let t;switch(e.type){case 0:switch(e.component){case 0:t=0;break;case 1:t=1;break;case 2:t=2}break;case 1:switch(e.component){case 0:t=3;break;case 1:t=4;break;case 2:t=5}break;case 2:switch(e.component){case 0:t=6;break;case 1:t=7;break;case 2:t=8}break;case 3:switch(e.component){case 0:t=9;break;case 1:t=10;break;case 2:t=11}}return 128|t}static getWriteOpcode(e,t,s){let r;switch(e.type){case 0:switch(e.component){case 0:switch(t){case 0:switch(s){case 1:r=0;break;case 2:r=4;break;default:throw $i.thrown(xt.unsupported())}break;case 1:switch(s){case 1:r=1;break;case 2:r=5;break;case 4:r=8;break;default:throw $i.thrown(xt.unsupported())}}break;case 1:switch(t){case 0:switch(s){case 1:r=10;break;case 2:r=12;break;default:throw $i.thrown(xt.unsupported())}break;case 1:switch(s){case 1:r=11;break;case 2:r=13;break;case 4:r=14;break;default:throw $i.thrown(xt.unsupported())}}break;case 2:switch(t){case 0:switch(s){case 1:r=15;break;case 2:r=17;break;default:throw $i.thrown(xt.unsupported())}break;case 1:switch(s){case 1:r=16;break;case 2:r=18;break;case 4:r=19;break;default:throw $i.thrown(xt.unsupported())}}}break;case 1:switch(e.component){case 0:switch(t){case 0:switch(s){case 1:r=2;break;case 2:r=6;break;default:throw $i.thrown(xt.unsupported())}break;case 1:switch(s){case 1:r=3;break;case 2:r=7;break;case 4:r=9;break;default:throw $i.thrown(xt.unsupported())}}break;case 1:switch(t){case 0:switch(s){case 1:r=20;break;case 2:r=22;break;default:throw $i.thrown(xt.unsupported())}break;case 1:switch(s){case 1:r=21;break;case 2:r=23;break;case 4:r=24;break;default:throw $i.thrown(xt.unsupported())}}break;case 2:switch(t){case 0:switch(s){case 1:r=25;break;case 2:r=27;break;default:throw $i.thrown(xt.unsupported())}break;case 1:switch(s){case 1:r=26;break;case 2:r=28;break;case 4:r=29;break;default:throw $i.thrown(xt.unsupported())}}}break;case 2:switch(e.component){case 0:switch(t){case 0:switch(s){case 1:r=30;break;case 2:r=34;break;default:throw $i.thrown(xt.unsupported())}break;case 1:switch(s){case 1:r=31;break;case 2:r=35;break;case 4:r=38;break;default:throw $i.thrown(xt.unsupported())}}break;case 1:switch(t){case 0:switch(s){case 1:r=40;break;case 2:r=42;break;default:throw $i.thrown(xt.unsupported())}break;case 1:switch(s){case 1:r=41;break;case 2:r=43;break;case 4:r=44;break;default:throw $i.thrown(xt.unsupported())}}break;case 2:switch(t){case 0:switch(s){case 1:r=45;break;case 2:r=47;break;default:throw $i.thrown(xt.unsupported())}break;case 1:switch(s){case 1:r=46;break;case 2:r=48;break;case 4:r=49;break;default:throw $i.thrown(xt.unsupported())}}}break;case 3:switch(e.component){case 0:switch(t){case 0:switch(s){case 1:r=32;break;case 2:r=36;break;default:throw $i.thrown(xt.unsupported())}break;case 1:switch(s){case 1:r=33;break;case 2:r=37;break;case 4:r=39;break;default:throw $i.thrown(xt.unsupported())}}break;case 1:switch(t){case 0:switch(s){case 1:r=50;break;case 2:r=52;break;default:throw $i.thrown(xt.unsupported())}break;case 1:switch(s){case 1:r=51;break;case 2:r=53;break;case 4:r=54;break;default:throw $i.thrown(xt.unsupported())}}break;case 2:switch(t){case 0:switch(s){case 1:r=55;break;case 2:r=57;break;default:throw $i.thrown(xt.unsupported())}break;case 1:switch(s){case 1:r=56;break;case 2:r=58;break;case 4:r=59;break;default:throw $i.thrown(xt.unsupported())}}}}return 192|r}static getDiffOpcode(e,t){let s;switch(e.type){case 0:switch(e.component){case 0:switch(t){case 1:s=16;break;case 2:s=18;break;default:throw $i.thrown(xt.unsupported())}break;case 1:switch(t){case 1:s=20;break;case 2:s=24;break;default:throw $i.thrown(xt.unsupported())}break;case 2:switch(t){case 1:s=21;break;case 2:s=25;break;default:throw $i.thrown(xt.unsupported())}}break;case 1:switch(e.component){case 0:switch(t){case 1:s=17;break;case 2:s=19;break;default:throw $i.thrown(xt.unsupported())}break;case 1:switch(t){case 1:s=22;break;case 2:s=26;break;default:throw $i.thrown(xt.unsupported())}break;case 2:switch(t){case 1:s=23;break;case 2:s=27;break;default:throw $i.thrown(xt.unsupported())}}break;case 2:switch(e.component){case 0:switch(t){case 1:s=28;break;case 2:s=30;break;default:throw $i.thrown(xt.unsupported())}break;case 1:switch(t){case 1:s=32;break;case 2:s=36;break;default:throw $i.thrown(xt.unsupported())}break;case 2:switch(t){case 1:s=33;break;case 2:s=37;break;default:throw $i.thrown(xt.unsupported())}}break;case 3:switch(e.component){case 0:switch(t){case 1:s=29;break;case 2:s=31;break;default:throw $i.thrown(xt.unsupported())}break;case 1:switch(t){case 1:s=34;break;case 2:s=38;break;default:throw $i.thrown(xt.unsupported())}break;case 2:switch(t){case 1:s=35;break;case 2:s=39;break;default:throw $i.thrown(xt.unsupported())}}}return 128|s}static unsupported(){return"unsupported operation."}}s["firedancer.assembly.types.ActorPropertyExtension"]=xt,xt.__name__="firedancer.assembly.types.ActorPropertyExtension";class gt{static getOutputType(e){switch(e){case 0:return 1;case 1:case 2:return 2}}}var bt=n["firedancer.assembly.types.FireType"]={__ename__:"firedancer.assembly.types.FireType",__constructs__:["Simple","Complex","SimpleWithCode","ComplexWithCode"],Simple:{_hx_index:0,__enum__:"firedancer.assembly.types.FireType",toString:r},Complex:(t=function(e){return{_hx_index:1,fireArgument:e,__enum__:"firedancer.assembly.types.FireType",toString:r}},t.__params__=["fireArgument"],t),SimpleWithCode:(t=function(e){return{_hx_index:2,fireCode:e,__enum__:"firedancer.assembly.types.FireType",toString:r}},t.__params__=["fireCode"],t),ComplexWithCode:(t=function(e,t){return{_hx_index:3,fireArgument:e,fireCode:t,__enum__:"firedancer.assembly.types.FireType",toString:r}},t.__params__=["fireArgument","fireCode"],t)};bt.__empty_constructs__=[bt.Simple];class mt{static toString(e){switch(e._hx_index){case 0:return"fire";case 1:let t=e.fireArgument;return"fire "+Fs.toString(t);case 2:return"fire code "+e.fireCode;case 3:let s=e.fireCode,r=e.fireArgument;return"fire "+Fs.toString(r)+" code "+s}}static bytecodeLength(e){switch(e._hx_index){case 0:return 0;case 1:e.fireArgument;return 4;case 2:e.fireCode;return 4;case 3:e.fireCode,e.fireArgument;return 8}}}s["firedancer.assembly.types.FireTypeExtension"]=mt,mt.__name__="firedancer.assembly.types.FireTypeExtension";class At{static toString(e){switch(e){case 0:return"position";case 1:return"x";case 2:return"y";case 3:return"angle_from_shot_position"}}static getType(e){switch(e){case 0:return 2;case 1:case 2:case 3:return 1}}}class wt{constructor(e){wt._hx_skip_constructor||this._hx_constructor(e)}_hx_constructor(e){this.property=e}}s["firedancer.script.api_components.ActorPropertyApiComponent"]=wt,wt.__name__="firedancer.script.api_components.ActorPropertyApiComponent",Object.assign(wt.prototype,{__class__:wt});class yt extends wt{constructor(){super(new pt(1,2))}}s["firedancer.script.api_components._Velocity.DirectionImpl"]=yt,yt.__name__="firedancer.script.api_components._Velocity.DirectionImpl",yt.__super__=wt,Object.assign(yt.prototype,{__class__:yt});class kt extends wt{constructor(){wt._hx_skip_constructor=!0,super(),wt._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.cartesian=new Rt,super._hx_constructor(new pt(0,0))}}s["firedancer.script.api_components.Position"]=kt,kt.__name__="firedancer.script.api_components.Position",kt.__super__=wt,Object.assign(kt.prototype,{__class__:kt});class Bt{constructor(){this.angle=new Vt}}s["firedancer.script.api_components.Random"]=Bt,Bt.__name__="firedancer.script.api_components.Random",Object.assign(Bt.prototype,{__class__:Bt});class Ct{constructor(){this.angleToTarget=new Zt(Xt.Runtime(ls.Inst(Ye.GetTarget(3)))),this.direction=new Ut,this.speed=new zt,this.velocity=new Gt,this.bearing=new Lt,this.distance=new Qt,this.position=new Ot}}s["firedancer.script.api_components.Shot"]=Ct,Ct.__name__="firedancer.script.api_components.Shot",Object.assign(Ct.prototype,{__class__:Ct});class vt extends wt{constructor(){wt._hx_skip_constructor=!0,super(),wt._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.cartesian=new Wt,super._hx_constructor(new pt(1,0))}}s["firedancer.script.api_components.Velocity"]=vt,vt.__name__="firedancer.script.api_components.Velocity",vt.__super__=wt,Object.assign(vt.prototype,{__class__:vt});class St{static wait(e){return new Bs(e)}static loop(e){return new xs(e)}static rep(e,t){return new ms(t,e)}static dup(e,t,s){return null==s&&(s=St.fire()),new us(s,e,t)}static fire(e){return new ps(e)}static aim(){return new _s}static parallel(e){return new bs(e)}static end(e){return new ds(e)}static vanish(){return St.end(-1)}static intVar(e){return e}static floatVar(e){return e}static angleVar(e){return e}static sin(e){return e.sin()}static cos(e){return e.cos()}static compileToAssembly(e,t){null==t&&(t=!0);let s=new Ft,r=va.kvIterator(e.h);for(;r.hasNext();){let e=r.next(),t=e.key,n=e.value.toAssembly(s);s.setNamedCode(n,t)}let n=s.createPackage();return t&&(n=n.optimize()),n}}s["firedancer.script.Api"]=St,St.__name__="firedancer.script.Api";class Mt{static radial(e,t){let s=St.intVar("__loopCnt"),r=St.angleVar("__sDirChgRt");null==t&&(t=St.fire());let n=es.let(s,e),i=jt.let(r,new Zt(Xt.Constant(new as(360,.017453292519943295))).divide(es.get(s).toFloatExpression())),a=es.toIntExpression(s);St.shot.direction;return new fs([n,i,St.rep(a,new fs([t,new hs(3,os.AddAngle(jt.toAngleExpression(r)))]))])}static nWay(e,t,s){let r=t.angle;return St.dup(e,{shotDirectionRange:{start:r.unaryMinus().divide(new Zt(Xt.Constant(new as(2,1)))),end:r.divide(new Zt(Xt.Constant(new as(2,1))))}},s)}static line(e,t,s){return St.dup(e,{shotSpeedChange:t.shotSpeedChange},s)}}s["firedancer.script.ApiEx"]=Mt,Mt.__name__="firedancer.script.ApiEx";class It{constructor(){It._hx_skip_constructor||this._hx_constructor()}_hx_constructor(){this.nodeType=Tt.Other}containsWait(){throw $i.thrown(new Kh(null,{fileName:"firedancer/script/AstNode.hx",lineNumber:30,className:"firedancer.script.AstNode",methodName:"containsWait"}))}toAssembly(e){throw $i.thrown(new Kh(null,{fileName:"firedancer/script/AstNode.hx",lineNumber:36,className:"firedancer.script.AstNode",methodName:"toAssembly"}))}}s["firedancer.script.AstNode"]=It,It.__name__="firedancer.script.AstNode",Object.assign(It.prototype,{__class__:It});var Tt=n["firedancer.script.AstNodeType"]={__ename__:"firedancer.script.AstNodeType",__constructs__:["EachFrame","Other"],EachFrame:(t=function(e){return{_hx_index:0,astToBeInjected:e,__enum__:"firedancer.script.AstNodeType",toString:r}},t.__params__=["astToBeInjected"],t),Other:{_hx_index:1,__enum__:"firedancer.script.AstNodeType",toString:r}};Tt.__empty_constructs__=[Tt.Other];class Ft{constructor(){this.injectionStack=[],this.nameIndexMap=new va,this.codeList=[],this.nextLabelIdStack=[0],this.localVariables=new Et(this)}setCode(e){let t=this.codeList,s=t.indexOf(e,0);if(-1!=s)return s;let r=t.length;t.push(e);return r}setNamedCode(e,t){let s=this.setCode(e);return this.nameIndexMap.h[t]=s,s}createPackage(){return new We(this.codeList,this.nameIndexMap)}}s["firedancer.script.CompileContext"]=Ft,Ft.__name__="firedancer.script.CompileContext",Object.assign(Ft.prototype,{__class__:Ft});class Et{constructor(e){this.variableStack=[],this.variableCountStack=[],this.context=e}startScope(){let e=this.variableStack.length;this.variableCountStack.push(e)}endScope(){let e=this.variableCountStack.pop();if(null==e)throw $i.thrown("Called endScope() before startScope().");let t=e,s=[],r=this.variableStack;for(;;){if(!(t<r.length))break;let e=r.pop();s.push(Ye.Free(e.name,e.type))}return s}push(e,t){this.variableStack.push(new Dt(e,t,this.context))}get(e){let t=this.variableStack,s=t.length-1;for(;s>=0;){let r=t[s];if(r.name==e)return r;--s}throw $i.thrown("Unknown local variable: "+e)}}s["firedancer.script.LocalVariableTable"]=Et,Et.__name__="firedancer.script.LocalVariableTable",Object.assign(Et.prototype,{__class__:Et});class Dt{constructor(e,t,s){this.name=e,this.type=t,this.context=s}load(){switch(this.type){case 0:return[Ye.Load(Ke.Int(et.Var(this.name)))];case 1:return[Ye.Load(Ke.Float(st.Var(this.name)))];case 2:throw $i.thrown("Local variable of vector type is not supported.")}}setValue(e){let t;switch(this.type){case 0:t=Ye.Store(Ke.Int(et.Reg),this.name);break;case 1:t=Ye.Store(Ke.Float(st.Reg),this.name);break;case 2:throw $i.thrown("Local variable of vector type is not supported.")}let s=[Kt.load(e,this.context),[t]],r=s.length,n=0,i=0,a=r;for(;i<a;){n+=s[i++].length}let l=n,h=[];h.length=l;let o=h,_=0,c=0,u=r;for(;c<u;){let e=s[c++],t=0,r=e.length;for(;t<r;){let s=t++;o[_]=e[s],++_}}return o}addValue(e){let t;switch(this.type){case 0:t=Ye.Add(Je.Int(et.Var(this.name),et.Reg));break;case 1:t=Ye.Add(Je.Float(st.Var(this.name),st.Reg));break;case 2:throw $i.thrown("Local variable of vector type is not supported.")}let s=[Kt.load(e,this.context),[t]],r=s.length,n=0,i=0,a=r;for(;i<a;){n+=s[i++].length}let l=n,h=[];h.length=l;let o=h,_=0,c=0,u=r;for(;c<u;){let e=s[c++],t=0,r=e.length;for(;t<r;){let s=t++;o[_]=e[s],++_}}return o}increment(){if(0!=this.type)throw $i.thrown("Cannot increment local variable that is not an integer.");return[Ye.Increment(this.name)]}decrement(){if(0!=this.type)throw $i.thrown("Cannot decrement local variable that is not an integer.");return[Ye.Decrement(this.name)]}}s["firedancer.script.LocalVariable"]=Dt,Dt.__name__="firedancer.script.LocalVariable",Object.assign(Dt.prototype,{__class__:Dt});class Rt{constructor(){}}s["firedancer.script.api_components.CartesianPosition"]=Rt,Rt.__name__="firedancer.script.api_components.CartesianPosition",Object.assign(Rt.prototype,{__class__:Rt});class Vt{constructor(){}}s["firedancer.script.api_components.RandomAngle"]=Vt,Vt.__name__="firedancer.script.api_components.RandomAngle",Object.assign(Vt.prototype,{__class__:Vt});class Ot extends wt{constructor(){wt._hx_skip_constructor=!0,super(),wt._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.cartesian=new Pt,super._hx_constructor(new pt(2,0))}}s["firedancer.script.api_components.ShotPosition"]=Ot,Ot.__name__="firedancer.script.api_components.ShotPosition",Ot.__super__=wt,Object.assign(Ot.prototype,{__class__:Ot});class Pt{constructor(){}}s["firedancer.script.api_components.CartesianShotPosition"]=Pt,Pt.__name__="firedancer.script.api_components.CartesianShotPosition",Object.assign(Pt.prototype,{__class__:Pt});class Qt extends wt{constructor(){super(new pt(2,1))}}s["firedancer.script.api_components._ShotPosition.ShotDistanceImpl"]=Qt,Qt.__name__="firedancer.script.api_components._ShotPosition.ShotDistanceImpl",Qt.__super__=wt,Object.assign(Qt.prototype,{__class__:Qt});class Lt extends wt{constructor(){super(new pt(2,2))}}s["firedancer.script.api_components._ShotPosition.ShotBearingImpl"]=Lt,Lt.__name__="firedancer.script.api_components._ShotPosition.ShotBearingImpl",Lt.__super__=wt,Object.assign(Lt.prototype,{__class__:Lt});class Gt extends wt{constructor(){super(new pt(3,0))}}s["firedancer.script.api_components.ShotVelocity"]=Gt,Gt.__name__="firedancer.script.api_components.ShotVelocity",Gt.__super__=wt,Object.assign(Gt.prototype,{__class__:Gt});class zt extends wt{constructor(){super(new pt(3,1))}}s["firedancer.script.api_components._ShotVelocity.ShotSpeedImpl"]=zt,zt.__name__="firedancer.script.api_components._ShotVelocity.ShotSpeedImpl",zt.__super__=wt,Object.assign(zt.prototype,{__class__:zt});class Ut extends wt{constructor(){super(new pt(3,2))}}s["firedancer.script.api_components._ShotVelocity.ShotDirectionImpl"]=Ut,Ut.__name__="firedancer.script.api_components._ShotVelocity.ShotDirectionImpl",Ut.__super__=wt,Object.assign(Ut.prototype,{__class__:Ut});class Wt{constructor(){}}s["firedancer.script.api_components.CartesianVelocity"]=Wt,Wt.__name__="firedancer.script.api_components.CartesianVelocity",Object.assign(Wt.prototype,{__class__:Wt});class Nt{static toExpression(e){return new Zt(Xt.Runtime(ls.Inst(Ye.Get(e.property))))}}class jt{static toAngleExpression(e){return new Zt(Xt.Runtime(ls.Custom((function(t){let s=t.localVariables.get(e),r=s.load();switch(s.type){case 0:r.push(Ye.Cast(0)),r.push(Ye.Mult(Ke.Float(st.RegBuf),Ke.Float(st.Imm(.017453292519943295))));break;case 1:break;case 2:throw $i.thrown("Cannot cast vector to float.")}return r}))))}static let(e,t){return cs.fromAngle(e,t)}static add(e,t){return new gs(e,1,qt.AngleExpr(t))}}class Yt{}s["firedancer.script.expression.ExpressionData"]=Yt,Yt.__name__="firedancer.script.expression.ExpressionData",Yt.__isInterface__=!0;var Xt=n["firedancer.script.expression.FloatLikeExpressionEnum"]={__ename__:"firedancer.script.expression.FloatLikeExpressionEnum",__constructs__:["Constant","Runtime"],Constant:(t=function(e){return{_hx_index:0,value:e,__enum__:"firedancer.script.expression.FloatLikeExpressionEnum",toString:r}},t.__params__=["value"],t),Runtime:(t=function(e){return{_hx_index:1,expression:e,__enum__:"firedancer.script.expression.FloatLikeExpressionEnum",toString:r}},t.__params__=["expression"],t)};Xt.__empty_constructs__=[];class Zt{constructor(e){this.data=e}load(e){let t=this.data;switch(t._hx_index){case 0:let s=t.value;return[Ye.Load(Ke.Float(st.Imm(s.toImmediateValue())))];case 1:let r=t.expression;return class{static load(e,t){switch(e._hx_index){case 0:return[e.loadV];case 1:let s=e.operand,r=e.instruction,n=s.load(t);n.push(r);return n;case 2:let i=e.operandB,a=e.operandA,l=e.instruction,h=[],o=i.load(t),_=h.length,c=0,u=o.length,d=_+u;for(h.length=d;c<u;){let e=c;h[_]=o[e],++_,++c}h.push(Ye.Push(Ke.Float(st.Reg)));let p=a.load(t),f=h.length,x=0,g=p.length,b=f+g;for(h.length=b;x<g;){let e=x;h[f]=p[e],++f,++x}h.push(Ye.Save(Ke.Float(st.Reg))),h.push(Ye.Pop(1)),h.push(l);return h;case 3:return(0,e.load)(t)}}}.load(r,e)}}use(e,t){let s=[this.load(e),[t]],r=s.length,n=0,i=0,a=r;for(;i<a;){n+=s[i++].length}let l=n,h=[];h.length=l;let o=h,_=0,c=0,u=r;for(;c<u;){let e=s[c++],t=0,r=e.length;for(;t<r;){let s=t++;o[_]=e[s],++_}}return o}unaryOperation(e){return new Zt(Xt.Runtime(ls.UnaryOperation(e,this)))}binaryOperation(e,t){return new Zt(Xt.Runtime(ls.BinaryOperation(e,this,t)))}unaryMinus(){return this.unaryOperation(Ye.Minus(Ke.Float(st.Reg)))}cos(){return this.unaryOperation(Ye.Cos)}sin(){return this.unaryOperation(Ye.Sin)}add(e){return this.binaryOperation(Ye.Add(Je.Float(st.RegBuf,st.Reg)),e)}subtract(e){return this.binaryOperation(Ye.Sub(Je.Float(st.RegBuf,st.Reg)),e)}multiply(e){return this.binaryOperation(Ye.Mult(Ke.Float(st.RegBuf),Ke.Float(st.Reg)),e)}divide(e){return this.binaryOperation(Ye.Div(Ke.Float(st.RegBuf),Ke.Float(st.Reg)),e)}}s["firedancer.script.expression.FloatLikeExpressionData"]=Zt,Zt.__name__="firedancer.script.expression.FloatLikeExpressionData",Zt.__interfaces__=[Yt],Object.assign(Zt.prototype,{__class__:Zt});class Ht{static toFloatExpression(e){return new Zt(Xt.Runtime(ls.Custom((function(t){let s=t.localVariables.get(e),r=s.load();switch(s.type){case 0:r.push(Ye.Cast(0));break;case 1:break;case 2:throw $i.thrown("Cannot cast vector to float.")}return r}))))}static let(e,t){return cs.fromFloat(e,t)}}class Kt{static load(e,t){switch(e._hx_index){case 0:return e.expr.load(t);case 1:return e.expr.load(t);case 2:return e.expr.load(t);case 3:return e.expr.load(t)}}}var qt=n["firedancer.script.expression._GenericExpression.Data"]={__ename__:"firedancer.script.expression._GenericExpression.Data",__constructs__:["IntExpr","FloatExpr","AngleExpr","VecExpr"],IntExpr:(t=function(e){return{_hx_index:0,expr:e,__enum__:"firedancer.script.expression._GenericExpression.Data",toString:r}},t.__params__=["expr"],t),FloatExpr:(t=function(e){return{_hx_index:1,expr:e,__enum__:"firedancer.script.expression._GenericExpression.Data",toString:r}},t.__params__=["expr"],t),AngleExpr:(t=function(e){return{_hx_index:2,expr:e,__enum__:"firedancer.script.expression._GenericExpression.Data",toString:r}},t.__params__=["expr"],t),VecExpr:(t=function(e){return{_hx_index:3,expr:e,__enum__:"firedancer.script.expression._GenericExpression.Data",toString:r}},t.__params__=["expr"],t)};qt.__empty_constructs__=[];var Jt=n["firedancer.script.expression.IntLikeExpressionEnum"]={__ename__:"firedancer.script.expression.IntLikeExpressionEnum",__constructs__:["Constant","Runtime"],Constant:(t=function(e){return{_hx_index:0,value:e,__enum__:"firedancer.script.expression.IntLikeExpressionEnum",toString:r}},t.__params__=["value"],t),Runtime:(t=function(e){return{_hx_index:1,expression:e,__enum__:"firedancer.script.expression.IntLikeExpressionEnum",toString:r}},t.__params__=["expression"],t)};Jt.__empty_constructs__=[];class $t{constructor(e){this.data=e}toFloatExpression(){return this.toFloatLikeExpressionData(1)}toAngleExpression(){return this.toFloatLikeExpressionData(.017453292519943295)}load(e){let t=this.data;switch(t._hx_index){case 0:let s=t.value;return[Ye.Load(Ke.Int(et.Imm(s)))];case 1:let r=t.expression;return class{static load(e,t){switch(e._hx_index){case 0:return[e.loadV];case 1:let s=e.operand,r=e.instruction,n=s.load(t);n.push(r);return n;case 2:let i=e.operandB,a=e.operandA,l=e.instruction,h=[],o=i.load(t),_=h.length,c=0,u=o.length,d=_+u;for(h.length=d;c<u;){let e=c;h[_]=o[e],++_,++c}h.push(Ye.Push(Ke.Int(et.Reg)));let p=a.load(t),f=h.length,x=0,g=p.length,b=f+g;for(h.length=b;x<g;){let e=x;h[f]=p[e],++f,++x}h.push(Ye.Save(Ke.Int(et.Reg))),h.push(Ye.Pop(0)),h.push(l);return h;case 3:return(0,e.load)(t)}}}.load(r,e)}}tryGetConstant(){let e=this.data;switch(e._hx_index){case 0:return e.value;case 1:e.expression;return null}}binaryOperation(e,t){return new $t(Jt.Runtime(ls.BinaryOperation(e,this,t)))}subtract(e){return this.binaryOperation(Ye.Sub(Je.Int(et.RegBuf,et.Reg)),e)}multiply(e){return this.binaryOperation(Ye.Mult(Ke.Int(et.RegBuf),Ke.Int(et.Reg)),e)}toFloatLikeExpressionData(e){let t=this,s=Xt.Runtime(ls.Custom((function(s){let r=[t.load(s),[Ye.Cast(0)],1==e?[]:[Ye.Mult(Ke.Float(st.Reg),Ke.Float(st.Imm(e)))]],n=r.length,i=0,a=0,l=n;for(;a<l;){i+=r[a++].length}let h=i,o=[];o.length=h;let _=o,c=0,u=0,d=n;for(;u<d;){let e=r[u++],t=0,s=e.length;for(;t<s;){let s=t++;_[c]=e[s],++c}}return _})));return new Zt(s)}}s["firedancer.script.expression.IntLikeExpressionData"]=$t,$t.__name__="firedancer.script.expression.IntLikeExpressionData",$t.__interfaces__=[Yt],Object.assign($t.prototype,{__class__:$t});class es{static toIntExpression(e){return new $t(Jt.Runtime(ls.Custom((function(t){let s=t.localVariables.get(e),r=s.load();switch(s.type){case 0:break;case 1:throw $i.thrown("Cannot cast float to int.");case 2:throw $i.thrown("Cannot cast vector to int.")}return r}))))}static let(e,t){return cs.fromInt(e,t)}static increment(e){return new gs(e,2,null)}static get(e){return es.toIntExpression(e)}}class ts{constructor(e,t,s,r,n,i){this.a=e,this.b=t,this.c=s,this.d=r,this.e=n,this.f=i}static multiply(e,t){return new ts(e.a.multiply(t.a).add(e.c.multiply(t.b)),e.b.multiply(t.a).add(e.d.multiply(t.b)),e.a.multiply(t.c).add(e.c.multiply(t.d)),e.b.multiply(t.c).add(e.d.multiply(t.d)),e.a.multiply(t.e).add(e.c.multiply(t.f)).add(e.e),e.b.multiply(t.e).add(e.d.multiply(t.f)).add(e.f))}static apply(e,t){let s=t.x,r=t.y;return{x:e.a.multiply(s).add(e.c.multiply(r)).add(e.e),y:e.b.multiply(s).add(e.d.multiply(r)).add(e.f)}}static createRotate(e){return new ts(e.cos(),e.sin(),e.sin().unaryMinus(),e.cos(),new Zt(Xt.Constant(new as(0,1))),new Zt(Xt.Constant(new as(0,1))))}static createScale(e,t){return null==t&&(t=e),new ts(e,new Zt(Xt.Constant(new as(0,1))),new Zt(Xt.Constant(new as(0,1))),t,new Zt(Xt.Constant(new as(0,1))),new Zt(Xt.Constant(new as(0,1))))}}s["firedancer.script.expression.Transformation"]=ts,ts.__name__="firedancer.script.expression.Transformation",Object.assign(ts.prototype,{__class__:ts});class ss{static fromCartesianExpressions(e){return new ns(e.x,e.y)}static fromPolarExpressionss(e){return new is(e.length,e.angle)}}class rs{constructor(e){rs._hx_skip_constructor||this._hx_constructor(e)}_hx_constructor(e){this.divisor=null;let t=e;this.divisor=t}transform(e){throw $i.thrown(new Kh(null,{fileName:"firedancer/script/expression/VecExpressionData.hx",lineNumber:25,className:"firedancer.script.expression.VecExpressionData",methodName:"transform"}))}load(e){throw $i.thrown(new Kh(null,{fileName:"firedancer/script/expression/VecExpressionData.hx",lineNumber:31,className:"firedancer.script.expression.VecExpressionData",methodName:"load"}))}use(e,t){let s=this.load(e);s.push(t);return s}}s["firedancer.script.expression.VecExpressionData"]=rs,rs.__name__="firedancer.script.expression.VecExpressionData",rs.__interfaces__=[Yt],Object.assign(rs.prototype,{__class__:rs});class ns extends rs{constructor(e,t,s,r){rs._hx_skip_constructor=!0,super(),rs._hx_skip_constructor=!1,this._hx_constructor(e,t,s,r)}_hx_constructor(e,t,s,r){this.transformation=null,super._hx_constructor(s),this.x=e,this.y=t;let n=r;this.transformation=n}transform(e){return new ns(this.x,this.y,this.divisor,null!=this.transformation?ts.multiply(this.transformation,e):e)}load(e){let t=this.x,s=this.y;if(null!=this.transformation){let e=ts.apply(this.transformation,{x:t,y:s});t=e.x,s=e.y}let r=this.divisor,n=[s.load(e),[Ye.Push(Ke.Float(st.Reg))],t.load(e),[Ye.Save(Ke.Float(st.Reg)),Ye.Pop(1),Ye.Cast(1)]],i=n.length,a=0,l=0,h=i;for(;l<h;){a+=n[l++].length}let o=a,_=[];_.length=o;let c=_,u=0,d=0,p=i;for(;d<p;){let e=n[d++],t=0,s=e.length;for(;t<s;){let s=t++;c[u]=e[s],++u}}let f=c;f.length;if(null==r)return f;{let t=[f,r.load(e),[Ye.Div(Ke.Vec(nt.Reg),Ke.Float(st.Reg))]],s=t.length,n=0,i=0,a=s;for(;i<a;){n+=t[i++].length}let l=n,h=[];h.length=l;let o=h,_=0,c=0,u=s;for(;c<u;){let e=t[c++],s=0,r=e.length;for(;s<r;){let t=s++;o[_]=e[t],++_}}return o}}}s["firedancer.script.expression.CartesianVecExpressionData"]=ns,ns.__name__="firedancer.script.expression.CartesianVecExpressionData",ns.__super__=rs,Object.assign(ns.prototype,{__class__:ns});class is extends rs{constructor(e,t,s){super(s),this.length=e,this.angle=t}transform(e){return new ns(this.length.multiply(this.angle.cos()),this.length.multiply(this.angle.sin()),this.divisor,e)}load(e){let t=this.length,s=[this.angle.load(e),[Ye.Push(Ke.Float(st.Reg))],t.load(e),[Ye.Save(Ke.Float(st.Reg)),Ye.Pop(1),Ye.Cast(2)]],r=s.length,n=0,i=0,a=r;for(;i<a;){n+=s[i++].length}let l=n,h=[];h.length=l;let o=h,_=0,c=0,u=r;for(;c<u;){let e=s[c++],t=0,r=e.length;for(;t<r;){let s=t++;o[_]=e[s],++_}}let d=o;if(null==this.divisor)return d;{let t=[d,this.divisor.load(e),[Ye.Div(Ke.Vec(nt.Reg),Ke.Float(st.Reg))]],s=t.length,r=0,n=0,i=s;for(;n<i;){r+=t[n++].length}let a=r,l=[];l.length=a;let h=l,o=0,_=0,c=s;for(;_<c;){let e=t[_++],s=0,r=e.length;for(;s<r;){let t=s++;h[o]=e[t],++o}}return h}}}s["firedancer.script.expression.PolarVecExpressionData"]=is,is.__name__="firedancer.script.expression.PolarVecExpressionData",is.__super__=rs,Object.assign(is.prototype,{__class__:is});class as{constructor(e,t){this.value=e,this.factor=t}toImmediateValue(){return this.factor*this.value}}s["firedancer.script.expression.subtypes.FloatLikeConstantData"]=as,as.__name__="firedancer.script.expression.subtypes.FloatLikeConstantData",Object.assign(as.prototype,{__class__:as});var ls=n["firedancer.script.expression.subtypes.RuntimeExpressionEnum"]={__ename__:"firedancer.script.expression.subtypes.RuntimeExpressionEnum",__constructs__:["Inst","UnaryOperation","BinaryOperation","Custom"],Inst:(t=function(e){return{_hx_index:0,loadV:e,__enum__:"firedancer.script.expression.subtypes.RuntimeExpressionEnum",toString:r}},t.__params__=["loadV"],t),UnaryOperation:(t=function(e,t){return{_hx_index:1,instruction:e,operand:t,__enum__:"firedancer.script.expression.subtypes.RuntimeExpressionEnum",toString:r}},t.__params__=["instruction","operand"],t),BinaryOperation:(t=function(e,t,s){return{_hx_index:2,instruction:e,operandA:t,operandB:s,__enum__:"firedancer.script.expression.subtypes.RuntimeExpressionEnum",toString:r}},t.__params__=["instruction","operandA","operandB"],t),Custom:(t=function(e){return{_hx_index:3,load:e,__enum__:"firedancer.script.expression.subtypes.RuntimeExpressionEnum",toString:r}},t.__params__=["load"],t)};ls.__empty_constructs__=[];class hs extends It{constructor(e,t){super(),this.propType=e,this.operation=t}containsWait(){return!1}toAssembly(e){let t=e;switch(this.propType){case 0:let e=this.operation;switch(e._hx_index){case 0:return e.arg.use(t,Ye.Increase(Ke.Vec(nt.Reg),pt.create(0,0)));case 1:return e.arg.use(t,Ye.Increase(Ke.Float(st.Reg),pt.create(0,1)));case 2:return e.arg.use(t,Ye.Increase(Ke.Float(st.Reg),pt.create(0,2)))}break;case 1:let s=this.operation;switch(s._hx_index){case 0:return s.arg.use(t,Ye.Increase(Ke.Vec(nt.Reg),pt.create(1,0)));case 1:return s.arg.use(t,Ye.Increase(Ke.Float(st.Reg),pt.create(1,1)));case 2:return s.arg.use(t,Ye.Increase(Ke.Float(st.Reg),pt.create(1,2)))}break;case 2:let r=this.operation;switch(r._hx_index){case 0:return r.arg.use(t,Ye.Increase(Ke.Vec(nt.Reg),pt.create(2,0)));case 1:return r.arg.use(t,Ye.Increase(Ke.Float(st.Reg),pt.create(2,1)));case 2:return r.arg.use(t,Ye.Increase(Ke.Float(st.Reg),pt.create(2,2)))}break;case 3:let n=this.operation;switch(n._hx_index){case 0:return n.arg.use(t,Ye.Increase(Ke.Vec(nt.Reg),pt.create(3,0)));case 1:return n.arg.use(t,Ye.Increase(Ke.Float(st.Reg),pt.create(3,1)));case 2:return n.arg.use(t,Ye.Increase(Ke.Float(st.Reg),pt.create(3,2)))}}}}s["firedancer.script.nodes.AddActorProperty"]=hs,hs.__name__="firedancer.script.nodes.AddActorProperty",hs.__interfaces__=[T],hs.__super__=It,Object.assign(hs.prototype,{__class__:hs});var os=n["firedancer.script.nodes.ActorPropertyAddOperation"]={__ename__:"firedancer.script.nodes.ActorPropertyAddOperation",__constructs__:["AddVector","AddLength","AddAngle"],AddVector:(t=function(e){return{_hx_index:0,arg:e,__enum__:"firedancer.script.nodes.ActorPropertyAddOperation",toString:r}},t.__params__=["arg"],t),AddLength:(t=function(e){return{_hx_index:1,arg:e,__enum__:"firedancer.script.nodes.ActorPropertyAddOperation",toString:r}},t.__params__=["arg"],t),AddAngle:(t=function(e){return{_hx_index:2,arg:e,__enum__:"firedancer.script.nodes.ActorPropertyAddOperation",toString:r}},t.__params__=["arg"],t)};os.__empty_constructs__=[];class _s extends It{constructor(){It._hx_skip_constructor=!0,super(),It._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.speed=null,super._hx_constructor()}containsWait(){return!1}toAssembly(e){return new As(3,null!=this.speed?ks.SetVector(ss.fromPolarExpressionss({length:this.speed,angle:St.shot.angleToTarget})):ks.SetAngle(St.shot.angleToTarget)).toAssembly(e)}}s["firedancer.script.nodes.Aim"]=_s,_s.__name__="firedancer.script.nodes.Aim",_s.__interfaces__=[T],_s.__super__=It,Object.assign(_s.prototype,{__class__:_s});class cs extends It{constructor(e,t){super(),this.name=e,this.initialValue=t}containsWait(){return!1}toAssembly(e){let t,s,r=this.name,n=this.initialValue;switch(n._hx_index){case 0:n.expr;s=Ye.Let(r,0),t=Ye.Store(Ke.Int(et.Reg),r),e.localVariables.push(r,0);break;case 1:n.expr;s=Ye.Let(r,1),t=Ye.Store(Ke.Float(st.Reg),r),e.localVariables.push(r,1);break;case 2:n.expr;s=Ye.Let(r,1),t=Ye.Store(Ke.Float(st.Reg),r),e.localVariables.push(r,1);break;case 3:n.expr;throw $i.thrown("Local variable of vector type is not supported.")}let i=[[s],Kt.load(this.initialValue,e),[t]],a=i.length,l=0,h=0,o=a;for(;h<o;){l+=i[h++].length}let _=l,c=[];c.length=_;let u=c,d=0,p=0,f=a;for(;p<f;){let e=i[p++],t=0,s=e.length;for(;t<s;){let s=t++;u[d]=e[s],++d}}return u}static fromInt(e,t){return null==t&&(t=new $t(Jt.Constant(0))),new cs(e,qt.IntExpr(t))}static fromFloat(e,t){return null==t&&(t=new Zt(Xt.Constant(new as(0,1)))),new cs(e,qt.FloatExpr(t))}static fromAngle(e,t){return null==t&&(t=new Zt(Xt.Constant(new as(0,.017453292519943295)))),new cs(e,qt.AngleExpr(t))}}s["firedancer.script.nodes.DeclareLocalVariable"]=cs,cs.__name__="firedancer.script.nodes.DeclareLocalVariable",cs.__super__=It,Object.assign(cs.prototype,{__class__:cs});class us extends It{constructor(e,t,s){super(),this.node=e,this.count=t,this.params=s}containsWait(){return!!this.node.containsWait()||null!=this.params.intervalFrames}toAssembly(e){let t=this.params,s=[],r=[],n=[],i=St.intVar("__loopCnt");s.push(es.let(i,this.count.subtract(new $t(Jt.Constant(1)))));if(null!=t.intervalFrames){r.push(St.wait(t.intervalFrames))}if(null!=t.shotDistanceChange){let e=t.shotDistanceChange,a=St.floatVar("__sDstBuf"),l=St.floatVar("__sDstChgRt");s.push(Ht.let(a,class{static toExpression(e){return new Zt(Xt.Runtime(ls.Inst(Ye.Get(e.property))))}}.toExpression(St.shot.distance))),s.push(Ht.let(l,e.divide(es.get(i).toFloatExpression()))),St.shot.distance,r.push(new hs(2,os.AddLength(Ht.toFloatExpression(l)))),St.shot.distance,n.push(new As(2,ks.SetLength(Ht.toFloatExpression(a))))}if(null!=t.shotBearingRange){let e=t.shotBearingRange,a=St.angleVar("__sBrgBuf"),l=St.angleVar("__sBrgChgRt");s.push(jt.let(a,class{static toExpression(e){return new Zt(Xt.Runtime(ls.Inst(Ye.Get(e.property))))}}.toExpression(St.shot.bearing))),St.shot.bearing,s.push(new hs(2,os.AddAngle(e.start))),s.push(jt.let(l,e.end.subtract(e.start).divide(es.get(i).toFloatExpression()))),St.shot.bearing,r.push(new hs(2,os.AddAngle(jt.toAngleExpression(l)))),St.shot.bearing,n.push(new As(2,ks.SetAngle(jt.toAngleExpression(a))))}if(null!=t.shotSpeedChange){let e=t.shotSpeedChange,a=St.floatVar("__sSpdBuf"),l=St.floatVar("__sSpdChgRt");s.push(Ht.let(a,class{static toExpression(e){return new Zt(Xt.Runtime(ls.Inst(Ye.Get(e.property))))}}.toExpression(St.shot.speed))),s.push(Ht.let(l,e.divide(es.get(i).toFloatExpression()))),St.shot.speed,r.push(new hs(3,os.AddLength(Ht.toFloatExpression(l)))),St.shot.speed,n.push(new As(3,ks.SetLength(Ht.toFloatExpression(a))))}if(null!=t.shotDirectionRange){let e=t.shotDirectionRange,a=St.angleVar("__sDirBuf"),l=St.angleVar("__sDirChgRt");s.push(jt.let(a,class{static toExpression(e){return new Zt(Xt.Runtime(ls.Inst(Ye.Get(e.property))))}}.toExpression(St.shot.direction))),St.shot.direction,s.push(new hs(3,os.AddAngle(e.start))),s.push(jt.let(l,e.end.subtract(e.start).divide(es.get(i).toFloatExpression()))),St.shot.direction,r.push(new hs(3,os.AddAngle(jt.toAngleExpression(l)))),St.shot.direction,n.push(new As(3,ks.SetAngle(jt.toAngleExpression(a))))}let a=es.toIntExpression(i),l=[[this.node],r],h=l.length,o=0,_=0,c=h;for(;_<c;){o+=l[_++].length}let u=o,d=[];d.length=u;let p=d,f=0,x=0,g=h;for(;x<g;){let e=l[x++],t=0,s=e.length;for(;t<s;){let s=t++;p[f]=e[s],++f}}let b=St.rep(a,new fs(p));return new fs(s.concat([b,this.node]).concat(n)).toAssembly(e)}}s["firedancer.script.nodes.Duplicate"]=us,us.__name__="firedancer.script.nodes.Duplicate",us.__super__=It,Object.assign(us.prototype,{__class__:us});class ds extends It{constructor(e){super(),this.endCode=e}containsWait(){return!1}toAssembly(e){return[Ye.End(this.endCode)]}}s["firedancer.script.nodes.End"]=ds,ds.__name__="firedancer.script.nodes.End",ds.__interfaces__=[T],ds.__super__=It,Object.assign(ds.prototype,{__class__:ds});class ps extends It{constructor(e){It._hx_skip_constructor=!0,super(),It._hx_skip_constructor=!1,this._hx_constructor(e)}_hx_constructor(e){this.fireCode=0,this.bindPosition=!1,super._hx_constructor(),this.pattern=e}containsWait(){return!1}toAssembly(e){let t;if(null==this.pattern){t=null}else{let s=e.nextLabelIdStack,r=(s.push(0),e.setCode(this.pattern.toAssembly(e)));s.pop();t=Fs.from(r,this.bindPosition)}let s,r=this.fireCode;if(null==r&&(r=0),null==t)s=Ye.Fire(0==r?bt.Simple:bt.SimpleWithCode(r));else{let e=t;s=Ye.Fire(0==r?bt.Complex(e):bt.ComplexWithCode(e,r))}return[s]}}s["firedancer.script.nodes.Fire"]=ps,ps.__name__="firedancer.script.nodes.Fire",ps.__interfaces__=[T],ps.__super__=It,Object.assign(ps.prototype,{__class__:ps});class fs extends It{constructor(e){super(),this.nodes=e}containsWait(){let e=this.nodes,t=!1,s=0,r=e.length;for(;s<r;){if(e[s++].containsWait()){t=!0;break}}return t}toAssembly(e){let t=[],s=this.nodes,r=0;e.localVariables.startScope();let n=0,i=s.length;for(;n<i;){let i=s[n++],a=i.nodeType;if(0==a._hx_index){let t=a.astToBeInjected.toAssembly(e);e.injectionStack.push(t);++r}t.push(i.toAssembly(e))}let a=e.localVariables.endScope(),l=(t.push(a),0),h=r;for(;l<h;){l++,e.injectionStack.pop()}let o=t.length,_=0,c=0,u=o;for(;c<u;){_+=t[c++].length}let d=_,p=[];p.length=d;let f=p,x=0,g=0,b=o;for(;g<b;){let e=t[g++],s=0,r=e.length;for(;s<r;){let t=s++;f[x]=e[t],++x}}return f}}s["firedancer.script.nodes.List"]=fs,fs.__name__="firedancer.script.nodes.List",fs.__interfaces__=[T],fs.__super__=It,Object.assign(fs.prototype,{__class__:fs});class xs extends It{constructor(e){super(),this.node=e}containsWait(){return this.node.containsWait()}toAssembly(e){if(!this.node.containsWait())throw $i.thrown("Infinite loop must contain Wait.");let t=e.nextLabelIdStack,s=t.pop(),r=s++,n=(t.push(s),[]),i=(n.push(Ye.Label(r)),this.node.toAssembly(e)),a=n.length,l=0,h=i.length,o=a+h;for(n.length=o;l<h;){let e=l;n[a]=i[e],++a,++l}n.push(Ye.GotoLabel(r));return n}}s["firedancer.script.nodes.Loop"]=xs,xs.__name__="firedancer.script.nodes.Loop",xs.__interfaces__=[T],xs.__super__=It,Object.assign(xs.prototype,{__class__:xs});class gs extends It{constructor(e,t,s){switch(super(),t){case 0:case 1:if(null==s)throw $i.thrown("Missing value to set/add.")}this.name=e,this.operation=t;let r=s;this.value=r}containsWait(){return!1}toAssembly(e){let t=e.localVariables.get(this.name);switch(this.operation){case 0:return t.setValue(this.value);case 1:return t.addValue(this.value);case 2:return t.increment();case 3:return t.decrement()}}}s["firedancer.script.nodes.OperateLocalVariable"]=gs,gs.__name__="firedancer.script.nodes.OperateLocalVariable",gs.__super__=It,Object.assign(gs.prototype,{__class__:gs});class bs extends It{constructor(e){super(),this.array=e}containsWait(){return!1}toAssembly(e){let t=this.array.shift();if(null==t)return[];let s=t.toAssembly(e),r=this.array,n=r.length,i=[];i.length=n;let a=i,l=0;for(;l<n;){let t=e.setCode(r[l].toAssembly(e));a[l]=Ye.UseThread(t,Ke.Int(et.Stack)),++l}let h=a,o=this.array.length,_=[];_.length=o;let c=_,u=0;for(;u<o;)c[u]=Ye.AwaitThread,++u;let d=[h,s,c],p=d.length,f=0,x=0,g=p;for(;x<g;){f+=d[x++].length}let b=f,m=[];m.length=b;let A=m,w=0,y=0,k=p;for(;y<k;){let e=d[y++],t=0,s=e.length;for(;t<s;){let s=t++;A[w]=e[s],++w}}return A}}s["firedancer.script.nodes.Parallel"]=bs,bs.__name__="firedancer.script.nodes.Parallel",bs.__interfaces__=[T],bs.__super__=It,Object.assign(bs.prototype,{__class__:bs});class ms extends It{constructor(e,t){super(),this.node=e,this.repetitionCount=t}containsWait(){return this.node.containsWait()}toAssembly(e){let t=this.repetitionCount,s=this.node.toAssembly(e);return Ne.loop(e,s,t)}}s["firedancer.script.nodes.Repeat"]=ms,ms.__name__="firedancer.script.nodes.Repeat",ms.__interfaces__=[T],ms.__super__=It,Object.assign(ms.prototype,{__class__:ms});class As extends It{constructor(e,t){super(),this.propType=e,this.operation=t}frames(e){return new ys(this.propType,this.operation,e)}containsWait(){return!1}toAssembly(e){let t=e;switch(this.propType){case 0:let e=this.operation;switch(e._hx_index){case 0:let s=e.mat,r=e.arg;return null!=s&&(r=r.transform(s)),r.use(t,Ye.Set(Ke.Vec(nt.Reg),pt.create(0,0)));case 1:return e.arg.use(t,Ye.Set(Ke.Float(st.Reg),pt.create(0,1)));case 2:return e.arg.use(t,Ye.Set(Ke.Float(st.Reg),pt.create(0,2)))}break;case 1:let s=this.operation;switch(s._hx_index){case 0:let e=s.mat,r=s.arg;return null!=e&&(r=r.transform(e)),r.use(t,Ye.Set(Ke.Vec(nt.Reg),pt.create(1,0)));case 1:return s.arg.use(t,Ye.Set(Ke.Float(st.Reg),pt.create(1,1)));case 2:return s.arg.use(t,Ye.Set(Ke.Float(st.Reg),pt.create(1,2)))}break;case 2:let r=this.operation;switch(r._hx_index){case 0:let e=r.mat,s=r.arg;return null!=e&&(s=s.transform(e)),s.use(t,Ye.Set(Ke.Vec(nt.Reg),pt.create(2,0)));case 1:return r.arg.use(t,Ye.Set(Ke.Float(st.Reg),pt.create(2,1)));case 2:return r.arg.use(t,Ye.Set(Ke.Float(st.Reg),pt.create(2,2)))}break;case 3:let n=this.operation;switch(n._hx_index){case 0:let e=n.mat,s=n.arg;return null!=e&&(s=s.transform(e)),s.use(t,Ye.Set(Ke.Vec(nt.Reg),pt.create(3,0)));case 1:return n.arg.use(t,Ye.Set(Ke.Float(st.Reg),pt.create(3,1)));case 2:return n.arg.use(t,Ye.Set(Ke.Float(st.Reg),pt.create(3,2)))}}}}s["firedancer.script.nodes.SetActorProperty"]=As,As.__name__="firedancer.script.nodes.SetActorProperty",As.__interfaces__=[T],As.__super__=It,Object.assign(As.prototype,{__class__:As});class ws extends As{constructor(e,t,s){super(e,ks.SetVector(t,s))}transform(e){let t=this.operation;if(0==t._hx_index){let s=t.mat,r=t.arg;return new ws(this.propType,r,null!=s?ts.multiply(s,e):e)}throw $i.thrown("Invalid operation in SetActorVector class.")}rotate(e){return this.transform(ts.createRotate(e))}scale(e,t){return this.transform(ts.createScale(e,t))}}s["firedancer.script.nodes.SetActorVector"]=ws,ws.__name__="firedancer.script.nodes.SetActorVector",ws.__interfaces__=[T],ws.__super__=As,Object.assign(ws.prototype,{__class__:ws});class ys extends It{constructor(e,t,s){super(),this.propType=e,this.operation=t,this.frames=s}containsWait(){let e=this.frames.tryGetConstant();return null==e||0<e}toAssembly(e){let t,s,r,n,i,a,l=this.frames,h=this.operation;switch(h._hx_index){case 0:let o=h.mat,_=h.arg;null!=o&&(_=_.transform(o));let c=Ye.Div(Ke.Vec(nt.Reg),Ke.Float(st.Reg)),u=[],d=l.toFloatExpression().load(e),p=u.length,f=0,x=d.length,g=p+x;for(u.length=g;f<x;){let e=f;u[p]=d[e],++p,++f}u.push(c);s=u,r=Ye.Push(Ke.Vec(nt.Reg)),n=Ye.Peek(2,4),a=Ye.Drop(2),i=Ye.Increase(Ke.Vec(nt.Reg),pt.create(this.propType,0));let b=Ye.GetDiff(Ke.Vec(nt.Reg),pt.create(this.propType,0)),m=[_.load(e),[b]],A=m.length,w=0,y=0,k=A;for(;y<k;){w+=m[y++].length}let B=w,C=[];C.length=B;let v=C,S=0,M=0,I=A;for(;M<I;){let e=m[M++],t=0,s=e.length;for(;t<s;){let s=t++;v[S]=e[s],++S}}t=v;break;case 1:let T=h.arg,F=Ye.Div(Ke.Float(st.RegBuf),Ke.Float(st.Reg)),E=[Ye.Save(Ke.Float(st.Reg))],D=l.toFloatExpression().load(e),R=E.length,V=0,O=D.length,P=R+O;for(E.length=P;V<O;){let e=V;E[R]=D[e],++R,++V}E.push(F);s=E,r=Ye.Push(Ke.Float(st.Reg)),n=Ye.Peek(1,4),a=Ye.Drop(1),i=Ye.Increase(Ke.Float(st.Reg),pt.create(this.propType,1));let Q=Ye.GetDiff(Ke.Float(st.Reg),pt.create(this.propType,1));t=T.load(e);t.push(Q);break;case 2:let L=h.arg,G=Ye.Div(Ke.Float(st.RegBuf),Ke.Float(st.Reg)),z=[Ye.Save(Ke.Float(st.Reg))],U=l.toFloatExpression().load(e),W=z.length,N=0,j=U.length,Y=W+j;for(z.length=Y;N<j;){let e=N;z[W]=U[e],++W,++N}z.push(G);s=z,r=Ye.Push(Ke.Float(st.Reg)),n=Ye.Peek(1,4),a=Ye.Drop(1),i=Ye.Increase(Ke.Float(st.Reg),pt.create(this.propType,2));let X=Ye.GetDiff(Ke.Float(st.Reg),pt.create(this.propType,2));t=L.load(e);t.push(X)}let o=t.concat(s).concat([r]),_=[Ye.Break,n,i],c=[o,Ne.constructLoop(e,[Ye.Push(Ke.Int(et.Reg))],_),[a]],u=c.length,d=0,p=0,f=u;for(;p<f;){d+=c[p++].length}let x=d,g=[];g.length=x;let b=g,m=0,A=0,w=u;for(;A<w;){let e=c[A++],t=0,s=e.length;for(;t<s;){let s=t++;b[m]=e[s],++m}}return b}}s["firedancer.script.nodes.SetActorPropertyLinear"]=ys,ys.__name__="firedancer.script.nodes.SetActorPropertyLinear",ys.__super__=It,Object.assign(ys.prototype,{__class__:ys});var ks=n["firedancer.script.nodes._SetActorProperty.ActorPropertySetOperation"]={__ename__:"firedancer.script.nodes._SetActorProperty.ActorPropertySetOperation",__constructs__:["SetVector","SetLength","SetAngle"],SetVector:(t=function(e,t){return{_hx_index:0,arg:e,mat:t,__enum__:"firedancer.script.nodes._SetActorProperty.ActorPropertySetOperation",toString:r}},t.__params__=["arg","mat"],t),SetLength:(t=function(e){return{_hx_index:1,arg:e,__enum__:"firedancer.script.nodes._SetActorProperty.ActorPropertySetOperation",toString:r}},t.__params__=["arg"],t),SetAngle:(t=function(e){return{_hx_index:2,arg:e,__enum__:"firedancer.script.nodes._SetActorProperty.ActorPropertySetOperation",toString:r}},t.__params__=["arg"],t)};ks.__empty_constructs__=[];class Bs extends It{constructor(e){super(),this.frames=e}containsWait(){return!0}toAssembly(e){let t=e.injectionStack.slice();t.reverse();let s=t.length,r=0,n=0,i=s;for(;n<i;){r+=t[n++].length}let a=r,l=[];l.length=a;let h=l,o=0,_=0,c=s;for(;_<c;){let e=t[_++],s=0,r=e.length;for(;s<r;){let t=s++;h[o]=e[t],++o}}let u=h,d=u.concat([Ye.Break]);if(0==u.length){let t=[this.frames.load(e),[Ye.Push(Ke.Int(et.Reg)),Ye.CountDownBreak]],s=t.length,r=0,n=0,i=s;for(;n<i;){r+=t[n++].length}let a=r,l=[];l.length=a;let h=l,o=0,_=0,c=s;for(;_<c;){let e=t[_++],s=0,r=e.length;for(;s<r;){let t=s++;h[o]=e[t],++o}}return h}return Ne.loop(e,d,this.frames)}}s["firedancer.script.nodes.Wait"]=Bs,Bs.__name__="firedancer.script.nodes.Wait",Bs.__interfaces__=[T],Bs.__super__=It,Object.assign(Bs.prototype,{__class__:Bs});class Cs{static dump(e,t,s){null==s&&(s=-1);let r=new ro,n=R.toHex(e,t,!0);if(-1!=s){let e=s;if(0!=e&&e<t){let e=n.split("");e[s*3-1]="|",n=e.join("")}}let i=n.length,a=0;for(;a<i;){r.b+=x.string(x.string(c.substr(n,a,47))+"\n"),a=a+48}return r.b}}var vs=n["haxe.ds.Option"]={__ename__:"haxe.ds.Option",__constructs__:["Some","None"],Some:(t=function(e){return{_hx_index:0,v:e,__enum__:"haxe.ds.Option",toString:r}},t.__params__=["v"],t),None:{_hx_index:1,__enum__:"haxe.ds.Option",toString:r}};vs.__empty_constructs__=[vs.None];class Ss{static getClass(e){if(null==e)return null;if(e instanceof Array)return Array;{let t=e.__class__;if(null!=t)return t;let s=Ss.__nativeClassName(e);return null!=s?Ss.__resolveNativeClass(s):null}}static __string_rec(e,t){if(null==e)return"null";if(t.length>=5)return"<...>";let s=typeof e;switch("function"==s&&(e.__name__||e.__ename__)&&(s="object"),s){case"function":return"<function>";case"object":if(e.__enum__){let s=n[e.__enum__],r=s.__constructs__[e._hx_index],i=s[r];return i.__params__?(t+="\t",r+"("+function(s){let r=[];{let s=0,n=i.__params__;for(;s<n.length;){let i=n[s];s+=1,r.push(Ss.__string_rec(e[i],t))}}return r}().join(",")+")"):r}if(e instanceof Array){let s="[";t+="\t";let r=0,n=e.length;for(;r<n;){let n=r++;s+=(n>0?",":"")+Ss.__string_rec(e[n],t)}return s+="]",s}let s;try{s=e.toString}catch(e){return"???"}if(null!=s&&s!=Object.toString&&"function"==typeof s){let t=e.toString();if("[object Object]"!=t)return t}let r="{\n";t+="\t";let i=null!=e.hasOwnProperty,a=null;for(a in e)i&&!e.hasOwnProperty(a)||"prototype"!=a&&"__class__"!=a&&"__super__"!=a&&"__interfaces__"!=a&&"__properties__"!=a&&(2!=r.length&&(r+=", \n"),r+=t+a+" : "+Ss.__string_rec(e[a],t));return r+="\n"+(t=t.substring(1))+"}",r;case"string":return e;default:return String(e)}}static __interfLoop(e,t){if(null==e)return!1;if(e==t)return!0;let s=e.__interfaces__;if(null!=s&&(null==e.__super__||e.__super__.__interfaces__!=s)){let e=0,r=s.length;for(;e<r;){let r=s[e++];if(r==t||Ss.__interfLoop(r,t))return!0}}return Ss.__interfLoop(e.__super__,t)}static __instanceof(e,t){if(null==t)return!1;switch(t){case Array:return e instanceof Array;case _o:return"boolean"==typeof e;case ho:return null!=e;case oo:return"number"==typeof e;case lo:return"number"==typeof e&&(0|e)===e;case String:return"string"==typeof e;default:if(null==e)return!1;if("function"==typeof t){if(Ss.__downcastCheck(e,t))return!0}else if("object"==typeof t&&Ss.__isNativeObj(t)&&e instanceof t)return!0;return t==co&&null!=e.__name__||(t==uo&&null!=e.__ename__||null!=e.__enum__&&n[e.__enum__]==t)}}static __downcastCheck(e,t){return e instanceof t||!!t.__isInterface__&&Ss.__interfLoop(Ss.getClass(e),t)}static __nativeClassName(e){let t=Ss.__toStr.call(e).slice(8,-1);return"Object"==t||"Function"==t||"Math"==t||"JSON"==t?null:t}static __isNativeObj(e){return null!=Ss.__nativeClassName(e)}static __resolveNativeClass(t){return e[t]}}s["js.Boot"]=Ss,Ss.__name__="js.Boot";var Ms=n["prayer.CompilerFlagType"]={__ename__:"prayer.CompilerFlagType",__constructs__:["Mandatory","Optional"],Mandatory:(t=function(e){return{_hx_index:0,defaultValue:e,__enum__:"prayer.CompilerFlagType",toString:r}},t.__params__=["defaultValue"],t),Optional:(t=function(e){return{_hx_index:1,nullValue:e,__enum__:"prayer.CompilerFlagType",toString:r}},t.__params__=["nullValue"],t)};Ms.__empty_constructs__=[];class Is{constructor(e,t,s,r){this.value=vs.None,this.name=e,this.getDefine=t,this.validate=s,this.type=r}get(){let e=this.value;switch(e._hx_index){case 0:return e.v;case 1:return this.set()}}set(){let e=this.getDefine(),t=this.validate(e),s=this.validate(e);switch(s._hx_index){case 0:let e=s.v;return this.value=t,e;case 1:let r=this.type;switch(r._hx_index){case 0:let e=r.defaultValue;return this.value=vs.Some(e),e;case 1:let t=r.nullValue;return this.value=vs.Some(t),t}}}}s["prayer.CompilerFlag"]=Is,Is.__name__="prayer.CompilerFlag",Object.assign(Is.prototype,{__class__:Is});class Ts{}s["firedancer.vm.CompilerFlags"]=Ts,Ts.__name__="firedancer.vm.CompilerFlags";class Fs{static from(e,t){if(0!=(-2147483648&e))throw $i.thrown("Invalid program ID: "+(null==e?"null":x.string(e)));return(t?-2147483648:0)|e}static toString(e){let t=2147483647&e,s="program "+(null==t?"null":x.string(t));return 0!=(-2147483648&e)&&(s+=" bind"),s}}class Es{static serialize(e){let t=new la;return t.serialize(e),t.toString()}}class Ds{constructor(e,t,s){this.vmVersion=null!=s?s:Ts.version.get(),this.programTable=e;let r=0,n=va.keysIterator(t.h);for(;n.hasNext();){n.next();++r}let i=new se(r),a=va.kvIterator(t.h);for(;a.hasNext();){let e=a.next(),t=e.key,s=e.value,r=i.nextFreeSlotIndex,n=i.keyVector,l=n,h=-1,o=0;for(;o<r;){if(l[o]==t){h=o;break}++o}let _=h;if(-1!=_)i.valueVector[_]=s;else{n[r]=t,i.valueVector[r]=s;let e=r+1;i.nextFreeSlotIndex=e}}this.nameIdMap=i}getProgramByName(e){let t=this.nameIdMap,s=t.keyVector,r=t.nextFreeSlotIndex,n=-1,i=0;for(;i<r;){if(s[i]==e){n=i;break}++i}let a=n,l=t.valueVector[a];return this.programTable[l]}toString(){let e={},t=this.nameIdMap,s=t.keyVector,r=t.valueVector,n=t.nextFreeSlotIndex,i=0;for(;i<n;){let t=i;e[s[i]]=r[t],++i}let a=Es.serialize,l=this.programTable,h=l.length,o=new Array(h),_=0,c=h;for(;_<c;){let e=_++,t=a(l[e]);o[e]=t}let u={nameIdMap:e,programTable:o.slice(0),vmVersion:this.vmVersion};return JSON.stringify(u,null,"  ").toString()}}s["firedancer.vm.ProgramPackage"]=Ds,Ds.__name__="firedancer.vm.ProgramPackage",Object.assign(Ds.prototype,{__class__:Ds});class Rs{constructor(e){this.active=!1;this.code=null,this.codeLength=0,this.programCounter=0,this.memoryData=new da(new ArrayBuffer(e)),this.stackPointer=0,this.shotX=0,this.shotY=0,this.shotVx=0,this.shotVy=0}}s["firedancer.vm.Thread"]=Rs,Rs.__name__="firedancer.vm.Thread",Object.assign(Rs.prototype,{__class__:Rs});class Vs{static useSubThread(e,t,s){let r=-1,n=1,i=e.length;for(;;){let a=e[n];if(!a.active){a.active=!0;let e=t;a.code=e;let i=t.length;a.codeLength=i,a.programCounter=0,a.stackPointer=0,a.shotX=s.shotX,a.shotY=s.shotY,a.shotVx=s.shotVx,a.shotVy=s.shotVy,r=n;break}if(++n,!(n<i))break}return r}}class Os{static run(e,t,s,r,n,i,a,l,h,o,_,u,d){let p,f,g,b,m=o[_],A=i[_],w=a[_];if(null==m)g=0,b=g,f=A,p=w;else{let e=m;if(-3402823e32!=e.x)b=e.x,g=e.y,f=A-b,p=w-g;else{let e=null;o[_]=e,g=0,b=g,f=A,p=w}}let y,k,B,C,v,S,M,I,T=l[_],F=h[_],E=new Ls,D=r,V=0,O=!1,P=0,Q=n.length;for(;P<Q;){let r=n[P++];if(r.active){E.pc=r.programCounter,E.codeLength=r.codeLength,E.code=r.code,C=0,B=0,S=0,v=0,k=0,y=0,I=r.memoryData,M=r.stackPointer;e:for(;;){if(E.codeLength<=E.pc){r.active=!1;let e=null;r.code=e;break}let i=E.code.b[E.pc],a=E.pc+1;E.pc=a;let l=i;switch(l>>>6){case 0:switch(63&l){case 0:break e;case 1:let i=M-4;if(0<I.getInt32(i)){let e=I,t=M-4;e.setInt32(t,e.getInt32(t)-1|0);let s=E.pc-1;E.pc=s;break e}M=M-4;break;case 2:let a=E.code.getInt32(E.pc),l=E.pc+4;E.pc=l;let h=a;E.pc=h;break;case 3:let o=M-4;if(0<I.getInt32(o)){let e=I,t=M-4;e.setInt32(t,e.getInt32(t)-1|0);let s=E.pc+4;E.pc=s}else{M=M-4;let e=E.code.getInt32(E.pc),t=E.pc+4;E.pc=t;let s=e;E.pc=s}break;case 4:let _=E.code.getInt32(E.pc),A=E.pc+4;E.pc=A;let w=_;Vs.useSubThread(n,e[w],r);break;case 5:let T=E.code.getInt32(E.pc),F=E.pc+4;E.pc=F;let P=T,Q=Vs.useSubThread(n,e[P],r),L=M;I.setInt32(L,Q),M=L+4;break;case 6:let G=M-4;if(n[I.getInt32(G)].active){let e=E.pc-1;E.pc=e;break e}M=M-4;break;case 7:let z=E.code.getInt32(E.pc),U=E.pc+4;E.pc=U,V=z,O=!0;break e;case 8:let W=E.code.getInt32(E.pc),N=E.pc+4;E.pc=N,C=W;break;case 9:C=B;break;case 10:let j=E.code.getDouble(E.pc),Y=E.pc+8;E.pc=Y,S=j;break;case 11:S=v;break;case 12:let X=E.code.getDouble(E.pc),Z=E.pc+8;E.pc=Z;let H=E.code.getDouble(E.pc),K=E.pc+8;E.pc=K,k=X,y=H;break;case 13:let q=E.code.getInt32(E.pc),J=E.pc+4;E.pc=J,B=q;break;case 14:B=C;break;case 15:let $=E.code.getDouble(E.pc),ee=E.pc+8;E.pc=ee,v=$;break;case 16:v=S;break;case 17:let te=E.code.getInt32(E.pc),se=E.pc+4;E.pc=se;let re=D-te-4;C=I.getInt32(re);break;case 18:let ne=E.code.getInt32(E.pc),ie=E.pc+4;E.pc=ie;let ae=D-ne-8;S=I.getDouble(ae);break;case 19:let le=E.code.getInt32(E.pc),he=E.pc+4;E.pc=he;let oe=E.code.getInt32(E.pc),_e=E.pc+4;E.pc=_e;let ce=D-le-4;I.setInt32(ce,oe);break;case 20:let ue=E.code.getInt32(E.pc),de=E.pc+4;E.pc=de;let pe=D-ue-4;I.setInt32(pe,C);break;case 21:let fe=E.code.getInt32(E.pc),xe=E.pc+4;E.pc=xe;let ge=E.code.getDouble(E.pc),be=E.pc+8;E.pc=be;let me=D-fe-8;I.setDouble(me,ge);break;case 22:let Ae=E.code.getInt32(E.pc),we=E.pc+4;E.pc=we;let ye=D-Ae-8;I.setDouble(ye,S);break;case 23:let ke=E.code.getInt32(E.pc),Be=E.pc+4;E.pc=Be;let Ce=M;I.setInt32(Ce,ke),M=Ce+4;break;case 24:let ve=M;I.setInt32(ve,C),M=ve+4;break;case 25:let Se=E.code.getDouble(E.pc),Me=E.pc+8;E.pc=Me;let Ie=M;I.setDouble(Ie,Se),M=Ie+8;break;case 26:let Te=M;I.setDouble(Te,S),M=Te+8;break;case 27:let Fe=E.code.getDouble(E.pc),Ee=E.pc+8;E.pc=Ee;let De=E.code.getDouble(E.pc),Re=E.pc+8;E.pc=Re;let Ve=M;I.setDouble(Ve,Fe),M=Ve+8;let Oe=M;I.setDouble(Oe,De),M=Oe+8;break;case 28:let Pe=M;I.setDouble(Pe,k),M=Pe+8;let Qe=M;I.setDouble(Qe,y),M=Qe+8;break;case 29:let Le=M;Le=Le-4,M=Le,C=I.getInt32(Le);break;case 30:let Ge=M;Ge=Ge-8,M=Ge,S=I.getDouble(Ge);break;case 31:let ze=E.code.getInt32(E.pc),Ue=E.pc+4;E.pc=Ue;let We=M-ze-8;S=I.getDouble(We);break;case 32:M=M-8;break;case 33:let Ne=E.code.getInt32(E.pc),je=E.pc+4;E.pc=je;let Ye=I,Xe=M-Ne,Ze=Xe-8-8,He=Xe-8;k=Ye.getDouble(Ze),y=Ye.getDouble(He);break;case 34:let Ke=8;M=M-Ke-Ke;break;case 35:let qe=null,Je=null;s.emit(b+f+r.shotX,g+p+r.shotY,r.shotVx,r.shotVy,0,qe,Je);break;case 36:let $e=E.code.getInt32(E.pc),et=E.pc+4;E.pc=et;let tt,st=$e,rt=e[2147483647&st];if(0!=(-2147483648&st)){tt=u}else{tt=null}s.emit(b+f+r.shotX,g+p+r.shotY,r.shotVx,r.shotVy,0,rt,tt);break;case 37:let nt=E.code.getInt32(E.pc),it=E.pc+4;E.pc=it;let at=nt,lt=null,ht=null;s.emit(b+f+r.shotX,g+p+r.shotY,r.shotVx,r.shotVy,at,lt,ht);break;case 38:let ot=E.code.getInt32(E.pc),_t=E.pc+4;E.pc=_t;let ct=ot,ut=E.code.getInt32(E.pc),dt=E.pc+4;E.pc=dt;let pt,ft=ut,xt=e[2147483647&ct];if(0!=(-2147483648&ct)){pt=u}else{pt=null}s.emit(b+f+r.shotX,g+p+r.shotY,r.shotVx,r.shotVy,ft,xt,pt);break;case 39:t.onGlobalEvent(C);break;case 40:t.onLocalEvent(C,f,p,r,m,d);break;case 41:let gt=E.code.getInt32(E.pc),bt=E.pc+4;if(E.pc=bt,0==gt){let e=new ro;e.b+=x.string("---- DUMP -------------------------------------\n\n"),e.b+=x.string("[scanner]\n"),e.b+="program counter: ",e.b+=x.string(x.string(E.pc)+"\n"),e.b+="bytecode length: ",e.b+=x.string(x.string(E.codeLength)+"\n"),e.b+=x.string("bytecode:\n");let t=Cs.dump(E.code,E.codeLength,E.pc);e.b+=x.string(t),e.b+=x.string("\n[memory]\n"),e.b+="stack pointer: ",e.b+=x.string(x.string(M)+"\n"),e.b+="capacity: ",e.b+=x.string(x.string(D)+"\n"),e.b+=x.string("memory dump:\n");let s=I,r=R.toHex(s,D,!0),n=r.length;if(0!=M){let e=r.split("");e[M*3-1]="|",r=e.join("")}let i=0,a=48;for(;i<n;){e.b+=x.string(x.string(c.substr(r,i,a-1))+"\n"),i=i+a}e.b+=x.string("\n[data register file]\n"),e.b+="int:      ",e.b+=x.string(x.string(C)+"\n"),e.b+="intBuf:   ",e.b+=x.string(x.string(B)+"\n"),e.b+="float:    ",e.b+=x.string(x.string(S)+"\n"),e.b+="floatBuf: ",e.b+=x.string(x.string(v)+"\n"),e.b+="vecX:     ",e.b+=x.string(x.string(k)+"\n"),e.b+="vecY:     ",e.b+=x.string(x.string(y)+"\n"),e.b+=x.string("\n------------------------------ END OF DUMP ----\n"),to.println_String(e.b)}}break;case 1:switch(63&l){case 0:let e=E.code.getInt32(E.pc),t=E.pc+4;E.pc=t,C=C+e|0;break;case 1:C=B+C;break;case 2:let s=E.code.getInt32(E.pc),r=E.pc+4;E.pc=r,C=C-s|0;break;case 3:let n=E.code.getInt32(E.pc),i=E.pc+4;E.pc=i,C=n-C|0;break;case 4:C=B-C;break;case 5:C=-C;break;case 6:let a=E.code.getInt32(E.pc),l=E.pc+4;E.pc=l,C=ea._mul(C,a);break;case 7:C*=B;break;case 8:let h=E.code.getInt32(E.pc),o=E.pc+4;E.pc=o,C=C/h|0;break;case 9:let _=E.code.getInt32(E.pc),c=E.pc+4;E.pc=c,C=_/C|0;break;case 10:C=B/C|0;break;case 11:let u=E.code.getInt32(E.pc),d=E.pc+4;E.pc=d,C%=u;break;case 12:let p=E.code.getInt32(E.pc),f=E.pc+4;E.pc=f,C=p%C;break;case 13:C=B%C;break;case 14:let x=E.code.getDouble(E.pc),g=E.pc+8;E.pc=g,S+=x;break;case 15:S=v+S;break;case 16:let b=E.code.getDouble(E.pc),m=E.pc+8;E.pc=m,S-=b;break;case 17:let A=E.code.getDouble(E.pc),w=E.pc+8;E.pc=w,S=A-S;break;case 18:S=v-S;break;case 19:S=-S;break;case 20:let M=E.code.getDouble(E.pc),T=E.pc+8;E.pc=T,S*=M;break;case 21:S*=v;break;case 22:let F=E.code.getDouble(E.pc),R=E.pc+8;E.pc=R,S/=F;break;case 23:let V=E.code.getDouble(E.pc),O=E.pc+8;E.pc=O,S=V/S;break;case 24:S=v/S;break;case 25:let P=E.code.getDouble(E.pc),Q=E.pc+8;E.pc=Q,S%=P;break;case 26:let L=E.code.getDouble(E.pc),G=E.pc+8;E.pc=G,S=L%S;break;case 27:S=v%S;break;case 28:k=-k,y=-y;break;case 29:let z=E.code.getDouble(E.pc),U=E.pc+8;E.pc=U;k*=z,y*=z;break;case 30:k*=S,y*=S;break;case 31:k/=S,y/=S;break;case 32:S=C;break;case 33:k=v,y=S;break;case 34:let W=v,N=S;k=W*Math.sin(N),y=W*-Math.cos(N);break;case 35:S=Math.random();break;case 36:let j=E.code.getDouble(E.pc),Y=E.pc+8;E.pc=Y,S=j*Math.random();break;case 37:S*=Math.random();break;case 38:let X=E.code.getDouble(E.pc),Z=E.pc+8;E.pc=Z,S=X*(2*Math.random()-1);break;case 39:S*=2*Math.random()-1;break;case 40:let H=E.code.getInt32(E.pc),K=E.pc+4;E.pc=K,C=H*Math.random()|0;break;case 41:C=C*Math.random()|0;break;case 42:let q=E.code.getInt32(E.pc),J=E.pc+4;E.pc=J,C=q*(2*Math.random()-1)|0;break;case 43:C=C*(2*Math.random()-1)|0;break;case 44:S=Math.sin(S);break;case 45:S=Math.cos(S);break;case 46:let $=E.code.getInt32(E.pc),ee=E.pc+4;E.pc=ee;let te=E.code.getInt32(E.pc),se=E.pc+4;E.pc=se;let re=I,ne=D-$-4;re.setInt32(ne,re.getInt32(ne)+te|0);break;case 47:let ie=E.code.getInt32(E.pc),ae=E.pc+4;E.pc=ae;let le=I,he=D-ie-4;le.setInt32(he,le.getInt32(he)+C|0);break;case 48:let oe=E.code.getInt32(E.pc),_e=E.pc+4;E.pc=_e;let ce=I,ue=D-oe-4;ce.setInt32(ue,ce.getInt32(ue)+1|0);break;case 49:let de=E.code.getInt32(E.pc),pe=E.pc+4;E.pc=pe;let fe=I,xe=D-de-4;fe.setInt32(xe,fe.getInt32(xe)+-1|0);break;case 50:let ge=E.code.getInt32(E.pc),be=E.pc+4;E.pc=be;let me=E.code.getDouble(E.pc),Ae=E.pc+8;E.pc=Ae;let we=I,ye=D-ge-8;we.setDouble(ye,we.getDouble(ye)+me);break;case 51:let ke=E.code.getInt32(E.pc),Be=E.pc+4;E.pc=Be;let Ce=I,ve=D-ke-8;Ce.setDouble(ve,Ce.getDouble(ve)+S)}break;case 2:switch(63&l){case 0:k=f,y=p;break;case 1:let e=f,t=p;S=Math.sqrt(e*e+t*t);break;case 2:S=Math.atan2(f,-p);break;case 3:k=T,y=F;break;case 4:let s=T,n=F;S=Math.sqrt(s*s+n*n);break;case 5:S=Math.atan2(T,-F);break;case 6:k=r.shotX,y=r.shotY;break;case 7:let i=r.shotX,a=r.shotY;S=Math.sqrt(i*i+a*a);break;case 8:S=Math.atan2(r.shotX,-r.shotY);break;case 9:k=r.shotVx,y=r.shotVy;break;case 10:let l=r.shotVx,h=r.shotVy;S=Math.sqrt(l*l+h*h);break;case 11:S=Math.atan2(r.shotVx,-r.shotVy);break;case 12:k=d.x,y=d.y;break;case 13:S=d.x;break;case 14:S=d.y;break;case 15:S=Math.atan2(d.x-(b+f+r.shotX),-(d.y-(g+p+r.shotY)));break;case 16:let o=E.code.getDouble(E.pc),_=E.pc+8;E.pc=_;let c=E.code.getDouble(E.pc),u=E.pc+8;E.pc=u,k=o-f,y=c-p;break;case 17:let x=E.code.getDouble(E.pc),m=E.pc+8;E.pc=m;let A=E.code.getDouble(E.pc),w=E.pc+8;E.pc=w,k=x-T,y=A-F;break;case 18:k-=f,y-=p;break;case 19:k-=T,y-=F;break;case 20:let B=E.code.getDouble(E.pc),C=E.pc+8;E.pc=C;let v=f,M=p;S=B-Math.sqrt(v*v+M*M);break;case 21:let I=Math.atan2(f,-p),D=E.code.getDouble(E.pc),R=E.pc+8;E.pc=R;let V=D-I;S=V-6.283185307179586*Math.floor(.15915494309189535*(V+3.141592653589793));break;case 22:let O=E.code.getDouble(E.pc),P=E.pc+8;E.pc=P;let Q=T,L=F;S=O-Math.sqrt(Q*Q+L*L);break;case 23:let G=Math.atan2(T,-F),z=E.code.getDouble(E.pc),U=E.pc+8;E.pc=U;let W=z-G;S=W-6.283185307179586*Math.floor(.15915494309189535*(W+3.141592653589793));break;case 24:let N=f,j=p;S-=Math.sqrt(N*N+j*j);break;case 25:let Y=S-Math.atan2(f,-p);S=Y-6.283185307179586*Math.floor(.15915494309189535*(Y+3.141592653589793));break;case 26:let X=T,Z=F;S-=Math.sqrt(X*X+Z*Z);break;case 27:let H=S-Math.atan2(T,-F);S=H-6.283185307179586*Math.floor(.15915494309189535*(H+3.141592653589793));break;case 28:let K=E.code.getDouble(E.pc),q=E.pc+8;E.pc=q;let J=K-r.shotX,$=E.code.getDouble(E.pc),ee=E.pc+8;E.pc=ee,k=J,y=$-r.shotY;break;case 29:let te=E.code.getDouble(E.pc),se=E.pc+8;E.pc=se;let re=te-r.shotVx,ne=E.code.getDouble(E.pc),ie=E.pc+8;E.pc=ie,k=re,y=ne-r.shotVy;break;case 30:k-=r.shotX,y-=r.shotY;break;case 31:k-=r.shotVx,y-=r.shotVy;break;case 32:let ae=E.code.getDouble(E.pc),le=E.pc+8;E.pc=le;let he=r.shotX,oe=r.shotY;S=ae-Math.sqrt(he*he+oe*oe);break;case 33:let _e=Math.atan2(r.shotX,-r.shotY),ce=E.code.getDouble(E.pc),ue=E.pc+8;E.pc=ue;let de=ce-_e;S=de-6.283185307179586*Math.floor(.15915494309189535*(de+3.141592653589793));break;case 34:let pe=E.code.getDouble(E.pc),fe=E.pc+8;E.pc=fe;let xe=r.shotVx,ge=r.shotVy;S=pe-Math.sqrt(xe*xe+ge*ge);break;case 35:let be=Math.atan2(r.shotVx,-r.shotVy),me=E.code.getDouble(E.pc),Ae=E.pc+8;E.pc=Ae;let we=me-be;S=we-6.283185307179586*Math.floor(.15915494309189535*(we+3.141592653589793));break;case 36:let ye=r.shotX,ke=r.shotY;S-=Math.sqrt(ye*ye+ke*ke);break;case 37:let Be=S-Math.atan2(r.shotX,-r.shotY);S=Be-6.283185307179586*Math.floor(.15915494309189535*(Be+3.141592653589793));break;case 38:let Ce=r.shotVx,ve=r.shotVy;S-=Math.sqrt(Ce*Ce+ve*ve);break;case 39:let Se=S-Math.atan2(r.shotVx,-r.shotVy);S=Se-6.283185307179586*Math.floor(.15915494309189535*(Se+3.141592653589793))}break;case 3:switch(63&l){case 0:let e=E.code.getDouble(E.pc),t=E.pc+8;E.pc=t;let s=E.code.getDouble(E.pc),n=E.pc+8;E.pc=n,f=e,p=s;break;case 1:let i=E.code.getDouble(E.pc),a=E.pc+8;E.pc=a;let l=E.code.getDouble(E.pc),h=E.pc+8;E.pc=h,f+=i,p+=l;break;case 2:let o=E.code.getDouble(E.pc),_=E.pc+8;E.pc=_;let c=E.code.getDouble(E.pc),u=E.pc+8;E.pc=u,T=o,F=c;break;case 3:let d=E.code.getDouble(E.pc),x=E.pc+8;E.pc=x;let g=E.code.getDouble(E.pc),b=E.pc+8;E.pc=b,T+=d,F+=g;break;case 4:f=k,p=y;break;case 5:f+=k,p+=y;break;case 6:T=k,F=y;break;case 7:T+=k,F+=y;break;case 8:let m=I,A=M-8-8,w=M-8;f+=m.getDouble(A),p+=m.getDouble(w);break;case 9:let B=I,C=M-8-8,v=M-8;f+=B.getDouble(C),p+=B.getDouble(v);break;case 10:let D=E.code.getDouble(E.pc),R=E.pc+8;E.pc=R;let V=D,O=Math.atan2(f,-p);f=V*Math.sin(O),p=V*-Math.cos(O);break;case 11:let P=E.code.getDouble(E.pc),Q=E.pc+8;E.pc=Q;let L=f,G=p,z=Math.sqrt(L*L+G*G),U=Math.atan2(L,-G),W=z+P;f=W*Math.sin(U),p=W*-Math.cos(U);break;case 12:let N=S,j=Math.atan2(f,-p);f=N*Math.sin(j),p=N*-Math.cos(j);break;case 13:let Y=f,X=p,Z=Math.sqrt(Y*Y+X*X),H=Math.atan2(Y,-X),K=Z+S;f=K*Math.sin(H),p=K*-Math.cos(H);break;case 14:let q=M-8,J=I.getDouble(q),$=f,ee=p,te=Math.sqrt($*$+ee*ee),se=Math.atan2($,-ee),re=te+J;f=re*Math.sin(se),p=re*-Math.cos(se);break;case 15:let ne=E.code.getDouble(E.pc),ie=E.pc+8;E.pc=ie;let ae=ne,le=f,he=p,oe=Math.sqrt(le*le+he*he);f=oe*Math.sin(ae),p=oe*-Math.cos(ae);break;case 16:let _e=E.code.getDouble(E.pc),ce=E.pc+8;E.pc=ce;let ue=f,de=p,pe=Math.sqrt(ue*ue+de*de),fe=Math.atan2(ue,-de)+_e;f=pe*Math.sin(fe),p=pe*-Math.cos(fe);break;case 17:let xe=S,ge=f,be=p,me=Math.sqrt(ge*ge+be*be);f=me*Math.sin(xe),p=me*-Math.cos(xe);break;case 18:let Ae=f,we=p,ye=Math.sqrt(Ae*Ae+we*we),ke=Math.atan2(Ae,-we)+S;f=ye*Math.sin(ke),p=ye*-Math.cos(ke);break;case 19:let Be=M-8,Ce=I.getDouble(Be),ve=f,Se=p,Me=Math.sqrt(ve*ve+Se*Se),Ie=Math.atan2(ve,-Se)+Ce;f=Me*Math.sin(Ie),p=Me*-Math.cos(Ie);break;case 20:let Te=E.code.getDouble(E.pc),Fe=E.pc+8;E.pc=Fe;let Ee=Te,De=Math.atan2(T,-F);T=Ee*Math.sin(De),F=Ee*-Math.cos(De);break;case 21:let Re=E.code.getDouble(E.pc),Ve=E.pc+8;E.pc=Ve;let Oe=T,Pe=F,Qe=Math.sqrt(Oe*Oe+Pe*Pe),Le=Math.atan2(Oe,-Pe),Ge=Qe+Re;T=Ge*Math.sin(Le),F=Ge*-Math.cos(Le);break;case 22:let ze=S,Ue=Math.atan2(T,-F);T=ze*Math.sin(Ue),F=ze*-Math.cos(Ue);break;case 23:let We=T,Ne=F,je=Math.sqrt(We*We+Ne*Ne),Ye=Math.atan2(We,-Ne),Xe=je+S;T=Xe*Math.sin(Ye),F=Xe*-Math.cos(Ye);break;case 24:let Ze=M-8,He=I.getDouble(Ze),Ke=T,qe=F,Je=Math.sqrt(Ke*Ke+qe*qe),$e=Math.atan2(Ke,-qe),et=Je+He;T=et*Math.sin($e),F=et*-Math.cos($e);break;case 25:let tt=E.code.getDouble(E.pc),st=E.pc+8;E.pc=st;let rt=tt,nt=T,it=F,at=Math.sqrt(nt*nt+it*it);T=at*Math.sin(rt),F=at*-Math.cos(rt);break;case 26:let lt=E.code.getDouble(E.pc),ht=E.pc+8;E.pc=ht;let ot=T,_t=F,ct=Math.sqrt(ot*ot+_t*_t),ut=Math.atan2(ot,-_t)+lt;T=ct*Math.sin(ut),F=ct*-Math.cos(ut);break;case 27:let dt=S,pt=T,ft=F,xt=Math.sqrt(pt*pt+ft*ft);T=xt*Math.sin(dt),F=xt*-Math.cos(dt);break;case 28:let gt=T,bt=F,mt=Math.sqrt(gt*gt+bt*bt),At=Math.atan2(gt,-bt)+S;T=mt*Math.sin(At),F=mt*-Math.cos(At);break;case 29:let wt=M-8,yt=I.getDouble(wt),kt=T,Bt=F,Ct=Math.sqrt(kt*kt+Bt*Bt),vt=Math.atan2(kt,-Bt)+yt;T=Ct*Math.sin(vt),F=Ct*-Math.cos(vt);break;case 30:let St=E.code.getDouble(E.pc),Mt=E.pc+8;E.pc=Mt;let It=E.code.getDouble(E.pc),Tt=E.pc+8;E.pc=Tt,r.shotX=St,r.shotY=It;break;case 31:let Ft=E.code.getDouble(E.pc),Et=E.pc+8;E.pc=Et;let Dt=E.code.getDouble(E.pc),Rt=E.pc+8;E.pc=Rt,r.shotX+=Ft,r.shotY+=Dt;break;case 32:let Vt=E.code.getDouble(E.pc),Ot=E.pc+8;E.pc=Ot;let Pt=E.code.getDouble(E.pc),Qt=E.pc+8;E.pc=Qt,r.shotVx=Vt,r.shotVy=Pt;break;case 33:let Lt=E.code.getDouble(E.pc),Gt=E.pc+8;E.pc=Gt;let zt=E.code.getDouble(E.pc),Ut=E.pc+8;E.pc=Ut,r.shotVx+=Lt,r.shotVy+=zt;break;case 34:r.shotX=k,r.shotY=y;break;case 35:r.shotX+=k,r.shotY+=y;break;case 36:r.shotVx=k,r.shotVy=y;break;case 37:r.shotVx+=k,r.shotVy+=y;break;case 38:let Wt=I,Nt=M-8-8,jt=M-8,Yt=Wt.getDouble(Nt),Xt=Wt.getDouble(jt);r.shotX+=Yt,r.shotY+=Xt;break;case 39:let Zt=I,Ht=M-8-8,Kt=M-8,qt=Zt.getDouble(Ht),Jt=Zt.getDouble(Kt);r.shotVx+=qt,r.shotVy+=Jt;break;case 40:let $t=E.code.getDouble(E.pc),es=E.pc+8;E.pc=es;let ts=$t,ss=Math.atan2(r.shotX,-r.shotY),rs=ts*Math.sin(ss),ns=ts*-Math.cos(ss);r.shotX=rs,r.shotY=ns;break;case 41:let is=E.code.getDouble(E.pc),as=E.pc+8;E.pc=as;let ls=r.shotX,hs=r.shotY,os=Math.sqrt(ls*ls+hs*hs),_s=Math.atan2(ls,-hs),cs=os+is,us=cs*Math.sin(_s),ds=cs*-Math.cos(_s);r.shotX=us,r.shotY=ds;break;case 42:let ps=S,fs=Math.atan2(r.shotX,-r.shotY),xs=ps*Math.sin(fs),gs=ps*-Math.cos(fs);r.shotX=xs,r.shotY=gs;break;case 43:let bs=r.shotX,ms=r.shotY,As=Math.sqrt(bs*bs+ms*ms),ws=Math.atan2(bs,-ms),ys=As+S,ks=ys*Math.sin(ws),Bs=ys*-Math.cos(ws);r.shotX=ks,r.shotY=Bs;break;case 44:let Cs=M-8,vs=I.getDouble(Cs),Ss=r.shotX,Ms=r.shotY,Is=Math.sqrt(Ss*Ss+Ms*Ms),Ts=Math.atan2(Ss,-Ms),Fs=Is+vs,Es=Fs*Math.sin(Ts),Ds=Fs*-Math.cos(Ts);r.shotX=Es,r.shotY=Ds;break;case 45:let Rs=E.code.getDouble(E.pc),Vs=E.pc+8;E.pc=Vs;let Os=Rs,Ps=r.shotX,Qs=r.shotY,Ls=Math.sqrt(Ps*Ps+Qs*Qs),Gs=Ls*Math.sin(Os),zs=Ls*-Math.cos(Os);r.shotX=Gs,r.shotY=zs;break;case 46:let Us=E.code.getDouble(E.pc),Ws=E.pc+8;E.pc=Ws;let Ns=r.shotX,js=r.shotY,Ys=Math.sqrt(Ns*Ns+js*js),Xs=Math.atan2(Ns,-js)+Us,Zs=Ys*Math.sin(Xs),Hs=Ys*-Math.cos(Xs);r.shotX=Zs,r.shotY=Hs;break;case 47:let Ks=S,qs=r.shotX,Js=r.shotY,$s=Math.sqrt(qs*qs+Js*Js),er=$s*Math.sin(Ks),tr=$s*-Math.cos(Ks);r.shotX=er,r.shotY=tr;break;case 48:let sr=r.shotX,rr=r.shotY,nr=Math.sqrt(sr*sr+rr*rr),ir=Math.atan2(sr,-rr)+S,ar=nr*Math.sin(ir),lr=nr*-Math.cos(ir);r.shotX=ar,r.shotY=lr;break;case 49:let hr=M-8,or=I.getDouble(hr),_r=r.shotX,cr=r.shotY,ur=Math.sqrt(_r*_r+cr*cr),dr=Math.atan2(_r,-cr)+or,pr=ur*Math.sin(dr),fr=ur*-Math.cos(dr);r.shotX=pr,r.shotY=fr;break;case 50:let xr=E.code.getDouble(E.pc),gr=E.pc+8;E.pc=gr;let br=xr,mr=Math.atan2(r.shotVx,-r.shotVy),Ar=br*Math.sin(mr),wr=br*-Math.cos(mr);r.shotVx=Ar,r.shotVy=wr;break;case 51:let yr=E.code.getDouble(E.pc),kr=E.pc+8;E.pc=kr;let Br=r.shotVx,Cr=r.shotVy,vr=Math.sqrt(Br*Br+Cr*Cr),Sr=Math.atan2(Br,-Cr),Mr=vr+yr,Ir=Mr*Math.sin(Sr),Tr=Mr*-Math.cos(Sr);r.shotVx=Ir,r.shotVy=Tr;break;case 52:let Fr=S,Er=Math.atan2(r.shotVx,-r.shotVy),Dr=Fr*Math.sin(Er),Rr=Fr*-Math.cos(Er);r.shotVx=Dr,r.shotVy=Rr;break;case 53:let Vr=r.shotVx,Or=r.shotVy,Pr=Math.sqrt(Vr*Vr+Or*Or),Qr=Math.atan2(Vr,-Or),Lr=Pr+S,Gr=Lr*Math.sin(Qr),zr=Lr*-Math.cos(Qr);r.shotVx=Gr,r.shotVy=zr;break;case 54:let Ur=M-8,Wr=I.getDouble(Ur),Nr=r.shotVx,jr=r.shotVy,Yr=Math.sqrt(Nr*Nr+jr*jr),Xr=Math.atan2(Nr,-jr),Zr=Yr+Wr,Hr=Zr*Math.sin(Xr),Kr=Zr*-Math.cos(Xr);r.shotVx=Hr,r.shotVy=Kr;break;case 55:let qr=E.code.getDouble(E.pc),Jr=E.pc+8;E.pc=Jr;let $r=qr,en=r.shotVx,tn=r.shotVy,sn=Math.sqrt(en*en+tn*tn),rn=sn*Math.sin($r),nn=sn*-Math.cos($r);r.shotVx=rn,r.shotVy=nn;break;case 56:let an=E.code.getDouble(E.pc),ln=E.pc+8;E.pc=ln;let hn=r.shotVx,on=r.shotVy,_n=Math.sqrt(hn*hn+on*on),cn=Math.atan2(hn,-on)+an,un=_n*Math.sin(cn),dn=_n*-Math.cos(cn);r.shotVx=un,r.shotVy=dn;break;case 57:let pn=S,fn=r.shotVx,xn=r.shotVy,gn=Math.sqrt(fn*fn+xn*xn),bn=gn*Math.sin(pn),mn=gn*-Math.cos(pn);r.shotVx=bn,r.shotVy=mn;break;case 58:let An=r.shotVx,wn=r.shotVy,yn=Math.sqrt(An*An+wn*wn),kn=Math.atan2(An,-wn)+S,Bn=yn*Math.sin(kn),Cn=yn*-Math.cos(kn);r.shotVx=Bn,r.shotVy=Cn;break;case 59:let vn=M-8,Sn=I.getDouble(vn),Mn=r.shotVx,In=r.shotVy,Tn=Math.sqrt(Mn*Mn+In*In),Fn=Math.atan2(Mn,-In)+Sn,En=Tn*Math.sin(Fn),Dn=Tn*-Math.cos(Fn);r.shotVx=En,r.shotVy=Dn}}}r.programCounter=E.pc,r.stackPointer=M}}if(f+=T,p+=F,i[_]=b+f,a[_]=g+p,l[_]=T,h[_]=F,O){let e=n.length,t=0;for(;t<e;){let e=n[t];e.active=!1;let s=null;e.code=s,++t}}return V}}s["firedancer.vm.Vm"]=Os,Os.__name__="firedancer.vm.Vm";class Ps{constructor(){}}s["firedancer.vm.internal.DataRegisterFile"]=Ps,Ps.__name__="firedancer.vm.internal.DataRegisterFile",Object.assign(Ps.prototype,{__class__:Ps});class Qs{constructor(e){this.capacity=e}}s["firedancer.vm.internal.Memory"]=Qs,Qs.__name__="firedancer.vm.internal.Memory",Object.assign(Qs.prototype,{__class__:Qs});class Ls{constructor(){}}s["firedancer.vm.internal.Scanner"]=Ls,Ls.__name__="firedancer.vm.internal.Scanner",Object.assign(Ls.prototype,{__class__:Ls});var Gs=n["format.gif.Block"]={__ename__:"format.gif.Block",__constructs__:["BFrame","BExtension","BEOF"],BFrame:(t=function(e){return{_hx_index:0,frame:e,__enum__:"format.gif.Block",toString:r}},t.__params__=["frame"],t),BExtension:(t=function(e){return{_hx_index:1,extension:e,__enum__:"format.gif.Block",toString:r}},t.__params__=["extension"],t),BEOF:{_hx_index:2,__enum__:"format.gif.Block",toString:r}};Gs.__empty_constructs__=[Gs.BEOF];var zs=n["format.gif.Extension"]={__ename__:"format.gif.Extension",__constructs__:["EGraphicControl","EComment","EText","EApplicationExtension","EUnknown"],EGraphicControl:(t=function(e){return{_hx_index:0,gce:e,__enum__:"format.gif.Extension",toString:r}},t.__params__=["gce"],t),EComment:(t=function(e){return{_hx_index:1,text:e,__enum__:"format.gif.Extension",toString:r}},t.__params__=["text"],t),EText:(t=function(e){return{_hx_index:2,pte:e,__enum__:"format.gif.Extension",toString:r}},t.__params__=["pte"],t),EApplicationExtension:(t=function(e){return{_hx_index:3,ext:e,__enum__:"format.gif.Extension",toString:r}},t.__params__=["ext"],t),EUnknown:(t=function(e,t){return{_hx_index:4,id:e,data:t,__enum__:"format.gif.Extension",toString:r}},t.__params__=["id","data"],t)};zs.__empty_constructs__=[];var Us=n["format.gif.ApplicationExtension"]={__ename__:"format.gif.ApplicationExtension",__constructs__:["AENetscapeLooping","AEUnknown"],AENetscapeLooping:(t=function(e){return{_hx_index:0,loops:e,__enum__:"format.gif.ApplicationExtension",toString:r}},t.__params__=["loops"],t),AEUnknown:(t=function(e,t,s){return{_hx_index:1,name:e,version:t,data:s,__enum__:"format.gif.ApplicationExtension",toString:r}},t.__params__=["name","version","data"],t)};Us.__empty_constructs__=[];var Ws=n["format.gif.Version"]={__ename__:"format.gif.Version",__constructs__:["GIF87a","GIF89a","Unknown"],GIF87a:{_hx_index:0,__enum__:"format.gif.Version",toString:r},GIF89a:{_hx_index:1,__enum__:"format.gif.Version",toString:r},Unknown:(t=function(e){return{_hx_index:2,version:e,__enum__:"format.gif.Version",toString:r}},t.__params__=["version"],t)};Ws.__empty_constructs__=[Ws.GIF87a,Ws.GIF89a];var Ns=n["format.gif.DisposalMethod"]={__ename__:"format.gif.DisposalMethod",__constructs__:["UNSPECIFIED","NO_ACTION","FILL_BACKGROUND","RENDER_PREVIOUS","UNDEFINED"],UNSPECIFIED:{_hx_index:0,__enum__:"format.gif.DisposalMethod",toString:r},NO_ACTION:{_hx_index:1,__enum__:"format.gif.DisposalMethod",toString:r},FILL_BACKGROUND:{_hx_index:2,__enum__:"format.gif.DisposalMethod",toString:r},RENDER_PREVIOUS:{_hx_index:3,__enum__:"format.gif.DisposalMethod",toString:r},UNDEFINED:(t=function(e){return{_hx_index:4,index:e,__enum__:"format.gif.DisposalMethod",toString:r}},t.__params__=["index"],t)};Ns.__empty_constructs__=[Ns.UNSPECIFIED,Ns.NO_ACTION,Ns.FILL_BACKGROUND,Ns.RENDER_PREVIOUS];class js{constructor(e){this.i=e,e.set_bigEndian(!1)}read(){if(71!=this.i.readByte())throw $i.thrown("Invalid header");if(73!=this.i.readByte())throw $i.thrown("Invalid header");if(70!=this.i.readByte())throw $i.thrown("Invalid header");let e=this.i.readString(3),t=Ws.GIF89a;switch(e){case"87a":t=Ws.GIF87a;break;case"89a":t=Ws.GIF89a;break;default:t=Ws.Unknown(e)}let s=this.i.readUInt16(),r=this.i.readUInt16(),n=this.i.readByte(),i=this.i.readByte(),a=this.i.readByte();a=0!=a?(a+15)/64:1;let l={width:s,height:r,hasGlobalColorTable:128==(128&n),colorResolution:(112&n)>>>4,sorted:8==(8&n),globalColorTableSize:2<<(7&n),backgroundColorIndex:i,pixelAspectRatio:a},h=null;l.hasGlobalColorTable&&(h=this.readColorTable(l.globalColorTableSize));let o=new ka;for(;;){let e=this.readBlock();if(o.add(e),e==Gs.BEOF)break}return{version:t,logicalScreenDescriptor:l,globalColorTable:h,blocks:o}}readBlock(){switch(this.i.readByte()){case 33:return this.readExtension();case 44:return this.readImage();case 59:return Gs.BEOF}return Gs.BEOF}readImage(){let e=this.i.readUInt16(),t=this.i.readUInt16(),s=this.i.readUInt16(),r=this.i.readUInt16(),n=this.i.readByte(),i=128==(128&n),a=64==(64&n),l=32==(32&n),h=2<<(7&n),o=null;return i&&(o=this.readColorTable(h)),Gs.BFrame({x:e,y:t,width:s,height:r,localColorTable:i,interlaced:a,sorted:l,localColorTableSize:h,pixels:this.readPixels(s,r,a),colorTable:o})}readPixels(e,t,s){let r=this.i,n=e*t,i=new da(new ArrayBuffer(n)),a=r.readByte(),l=r.readByte()-1,h=r.readByte(),o=8,_=1<<a,c=_+1,u=a+1,d=1<<u,p=d-1,f=[],x=0,g=_;for(;x<g;){let e=x++;f[e]=[e]}let b,m,A=[],w=_+2,y=0,k=0;for(;y<n;){for(m=k;o<u&&0!=l;)h|=r.readByte()<<o,o+=8,--l,0==l&&(l=r.readByte());if(k=h&p,h>>=u,o-=u,k==_){A=f.slice(),w=_+2,u=a+1,d=1<<u,p=d-1;continue}if(k==c)break;if(k<w)m!=_&&(b=A[m].slice(),b.push(A[k][0]),A[w++]=b);else{if(k!=w)throw $i.thrown("Invalid LZW code. Excepted: "+w+", got: "+k);b=A[m].slice(),b.push(b[0]),A[w++]=b}b=A[k];let e=0;for(;e<b.length;){let t=b[e];++e,i.b[y++]=t}w==d&&u<12&&(++u,d=1<<u,p=d-1)}for(;l>0;)r.readByte(),--l,0==l&&(l=r.readByte());for(;y<n;)i.b[y++]=0;if(s){let s=new da(new ArrayBuffer(n)),r=this.deinterlace(i,s,8,0,0,e,t);r=this.deinterlace(i,s,8,4,r,e,t),r=this.deinterlace(i,s,4,2,r,e,t),this.deinterlace(i,s,2,1,r,e,t),i=s}return i}deinterlace(e,t,s,r,n,i,a){for(;r<a;)t.blit(r*i,e,n,i),n+=i,r+=s;return n}readExtension(){let e=this.i.readByte();switch(e){case 1:if(12!=this.i.readByte())throw $i.thrown("Incorrect size of Plain Text Extension introducer block.");let t=this.i.readUInt16(),s=this.i.readUInt16(),r=this.i.readUInt16(),n=this.i.readUInt16(),i=this.i.readByte(),a=this.i.readByte(),l=this.i.readByte(),h=this.i.readByte(),o=new Ea,_=new da(new ArrayBuffer(255)),c=this.i.readByte();for(;0!=c;)this.i.readBytes(_,0,c),o.writeBytes(_,0,c),c=this.i.readByte();return o.flush(),_=o.getBytes(),o.close(),Gs.BExtension(zs.EText({textGridX:t,textGridY:s,textGridWidth:r,textGridHeight:n,charCellWidth:i,charCellHeight:a,textForegroundColorIndex:l,textBackgroundColorIndex:h,text:_.toString()}));case 249:if(4!=this.i.readByte())throw $i.thrown("Incorrect Graphic Control Extension block size!");let u,d=this.i.readByte();switch((28&d)>>2){case 0:u=Ns.UNSPECIFIED;break;case 1:u=Ns.NO_ACTION;break;case 2:u=Ns.FILL_BACKGROUND;break;case 3:u=Ns.RENDER_PREVIOUS;break;default:u=Ns.UNDEFINED((28&d)>>2)}let p=Gs.BExtension(zs.EGraphicControl({disposalMethod:u,userInput:2==(2&d),hasTransparentColor:1==(1&d),delay:this.i.readUInt16(),transparentIndex:this.i.readByte()}));return this.i.readByte(),p;case 254:let f=new Ea,x=new da(new ArrayBuffer(255)),g=this.i.readByte();for(;0!=g;)this.i.readBytes(x,0,g),f.writeBytes(x,0,g),g=this.i.readByte();return f.flush(),x=f.getBytes(),f.close(),Gs.BExtension(zs.EComment(x.toString()));case 255:return this.readApplicationExtension();default:let b=new Ea,m=new da(new ArrayBuffer(255)),A=this.i.readByte();for(;0!=A;)this.i.readBytes(m,0,A),b.writeBytes(m,0,A),A=this.i.readByte();return b.flush(),m=b.getBytes(),b.close(),Gs.BExtension(zs.EUnknown(e,m))}}readApplicationExtension(){if(11!=this.i.readByte())throw $i.thrown("Incorrect size of Application Extension introducer block.");let e=this.i.readString(8),t=this.i.readString(3),s=new Ea,r=new da(new ArrayBuffer(255)),n=this.i.readByte();for(;0!=n;)this.i.readBytes(r,0,n),s.writeBytes(r,0,n),n=this.i.readByte();s.flush(),r=s.getBytes(),s.close();let i=r;return"NETSCAPE"==e&&"2.0"==t&&1==i.b[0]?Gs.BExtension(zs.EApplicationExtension(Us.AENetscapeLooping(i.b[1]|i.b[2]<<8))):Gs.BExtension(zs.EApplicationExtension(Us.AEUnknown(e,t,i)))}readColorTable(e){e*=3;let t=new da(new ArrayBuffer(e)),s=0;for(;s<e;){let e=this.i.readByte();t.b[s]=e;let r=this.i.readByte();t.b[s+1]=r;let n=this.i.readByte();t.b[s+2]=n,s+=3}return t}}s["format.gif.Reader"]=js,js.__name__="format.gif.Reader",Object.assign(js.prototype,{__class__:js});class Ys{static extractFullBGRA(e,t){let s=null,r=0,n=new da(new ArrayBuffer(e.logicalScreenDescriptor.width*e.logicalScreenDescriptor.height*4)),i=e.blocks.h;for(;null!=i;){let a=i.item;i=i.next;let l=a;switch(l._hx_index){case 0:let i=l.frame,a=i.localColorTable?i.colorTable:e.globalColorTable;if(null==a)throw $i.thrown("Frame does not have a color table!");let h=null!=s&&s.hasTransparentColor?3*s.transparentIndex:-1,o=i.pixels,_=0,c=4*(i.y*e.logicalScreenDescriptor.width+i.x),u=4*(e.logicalScreenDescriptor.width-i.width)+4;switch((r!=t&&null!=s?s.disposalMethod:Ns.NO_ACTION)._hx_index){case 2:let e=0,t=o.length;for(;e<t;){e++;n.b[c]=0,n.b[c+1]=0,n.b[c+2]=0,n.b[c+3]=0,++_==i.width?(_=0,c+=u):c+=4}break;case 3:break;default:let s=0,r=o.length;for(;s<r;){let e=s++,t=3*o.b[e];h!=t&&(n.b[c]=a.b[t+2],n.b[c+1]=a.b[t+1],n.b[c+2]=a.b[t],n.b[c+3]=255),++_==i.width?(_=0,c+=u):c+=4}}if(r==t)return n;++r,s=null;break;case 1:let d=l.extension;if(0==d._hx_index){s=d.gce}}}return n}}s["format.gif.Tools"]=Ys,Ys.__name__="format.gif.Tools";var Xs=n["format.mp3.SamplingRate"]={__ename__:"format.mp3.SamplingRate",__constructs__:["SR_8000","SR_11025","SR_12000","SR_22050","SR_24000","SR_32000","SR_44100","SR_48000","SR_Bad"],SR_8000:{_hx_index:0,__enum__:"format.mp3.SamplingRate",toString:r},SR_11025:{_hx_index:1,__enum__:"format.mp3.SamplingRate",toString:r},SR_12000:{_hx_index:2,__enum__:"format.mp3.SamplingRate",toString:r},SR_22050:{_hx_index:3,__enum__:"format.mp3.SamplingRate",toString:r},SR_24000:{_hx_index:4,__enum__:"format.mp3.SamplingRate",toString:r},SR_32000:{_hx_index:5,__enum__:"format.mp3.SamplingRate",toString:r},SR_44100:{_hx_index:6,__enum__:"format.mp3.SamplingRate",toString:r},SR_48000:{_hx_index:7,__enum__:"format.mp3.SamplingRate",toString:r},SR_Bad:{_hx_index:8,__enum__:"format.mp3.SamplingRate",toString:r}};Xs.__empty_constructs__=[Xs.SR_8000,Xs.SR_11025,Xs.SR_12000,Xs.SR_22050,Xs.SR_24000,Xs.SR_32000,Xs.SR_44100,Xs.SR_48000,Xs.SR_Bad];var Zs=n["format.mp3.Bitrate"]={__ename__:"format.mp3.Bitrate",__constructs__:["BR_8","BR_16","BR_24","BR_32","BR_40","BR_48","BR_56","BR_64","BR_80","BR_96","BR_112","BR_128","BR_144","BR_160","BR_176","BR_192","BR_224","BR_256","BR_288","BR_320","BR_352","BR_384","BR_416","BR_448","BR_Free","BR_Bad"],BR_8:{_hx_index:0,__enum__:"format.mp3.Bitrate",toString:r},BR_16:{_hx_index:1,__enum__:"format.mp3.Bitrate",toString:r},BR_24:{_hx_index:2,__enum__:"format.mp3.Bitrate",toString:r},BR_32:{_hx_index:3,__enum__:"format.mp3.Bitrate",toString:r},BR_40:{_hx_index:4,__enum__:"format.mp3.Bitrate",toString:r},BR_48:{_hx_index:5,__enum__:"format.mp3.Bitrate",toString:r},BR_56:{_hx_index:6,__enum__:"format.mp3.Bitrate",toString:r},BR_64:{_hx_index:7,__enum__:"format.mp3.Bitrate",toString:r},BR_80:{_hx_index:8,__enum__:"format.mp3.Bitrate",toString:r},BR_96:{_hx_index:9,__enum__:"format.mp3.Bitrate",toString:r},BR_112:{_hx_index:10,__enum__:"format.mp3.Bitrate",toString:r},BR_128:{_hx_index:11,__enum__:"format.mp3.Bitrate",toString:r},BR_144:{_hx_index:12,__enum__:"format.mp3.Bitrate",toString:r},BR_160:{_hx_index:13,__enum__:"format.mp3.Bitrate",toString:r},BR_176:{_hx_index:14,__enum__:"format.mp3.Bitrate",toString:r},BR_192:{_hx_index:15,__enum__:"format.mp3.Bitrate",toString:r},BR_224:{_hx_index:16,__enum__:"format.mp3.Bitrate",toString:r},BR_256:{_hx_index:17,__enum__:"format.mp3.Bitrate",toString:r},BR_288:{_hx_index:18,__enum__:"format.mp3.Bitrate",toString:r},BR_320:{_hx_index:19,__enum__:"format.mp3.Bitrate",toString:r},BR_352:{_hx_index:20,__enum__:"format.mp3.Bitrate",toString:r},BR_384:{_hx_index:21,__enum__:"format.mp3.Bitrate",toString:r},BR_416:{_hx_index:22,__enum__:"format.mp3.Bitrate",toString:r},BR_448:{_hx_index:23,__enum__:"format.mp3.Bitrate",toString:r},BR_Free:{_hx_index:24,__enum__:"format.mp3.Bitrate",toString:r},BR_Bad:{_hx_index:25,__enum__:"format.mp3.Bitrate",toString:r}};Zs.__empty_constructs__=[Zs.BR_8,Zs.BR_16,Zs.BR_24,Zs.BR_32,Zs.BR_40,Zs.BR_48,Zs.BR_56,Zs.BR_64,Zs.BR_80,Zs.BR_96,Zs.BR_112,Zs.BR_128,Zs.BR_144,Zs.BR_160,Zs.BR_176,Zs.BR_192,Zs.BR_224,Zs.BR_256,Zs.BR_288,Zs.BR_320,Zs.BR_352,Zs.BR_384,Zs.BR_416,Zs.BR_448,Zs.BR_Free,Zs.BR_Bad];class Hs{static enum2Num(e){switch(e._hx_index){case 0:return 3;case 1:return 2;case 2:return 0;case 3:return Hs.Reserved}}static num2Enum(e){switch(e){case 0:return $s.MPEG_V25;case 2:return $s.MPEG_V2;case 3:return $s.MPEG_V1;default:return $s.MPEG_Reserved}}static srEnum2Num(e){switch(e._hx_index){case 0:return 8e3;case 1:return 11025;case 2:return 12e3;case 3:return 22050;case 4:return 24e3;case 5:return 32e3;case 6:return 44100;case 7:return 48e3;case 8:return-1}}static bitrateEnum2Num(e){switch(e._hx_index){case 0:return 8;case 1:return 16;case 2:return 24;case 3:return 32;case 4:return 40;case 5:return 48;case 6:return 56;case 7:return 64;case 8:return 80;case 9:return 96;case 10:return 112;case 11:return 128;case 12:return 144;case 13:return 160;case 14:return 176;case 15:return 192;case 16:return 224;case 17:return 256;case 18:return 288;case 19:return 320;case 20:return 352;case 21:return 384;case 22:return 416;case 23:return 448;case 24:return 0;case 25:return-1}}}s["format.mp3.MPEG"]=Hs,Hs.__name__="format.mp3.MPEG";class Ks{static num2Enum(e){switch(e){case 1:return er.Layer3;case 2:return er.Layer2;case 3:return er.Layer1;default:return er.LayerReserved}}}s["format.mp3.CLayer"]=Ks,Ks.__name__="format.mp3.CLayer";class qs{static num2Enum(e){switch(e){case 0:return tr.Stereo;case 1:return tr.JointStereo;case 2:return tr.DualChannel;case 3:return tr.Mono;default:throw $i.thrown("assert")}}}s["format.mp3.CChannelMode"]=qs,qs.__name__="format.mp3.CChannelMode";class Js{static num2Enum(e){switch(e){case 0:return sr.NoEmphasis;case 1:return sr.Ms50_15;case 2:return sr.InvalidEmphasis;case 3:return sr.CCIT_J17;default:throw $i.thrown("assert")}}}s["format.mp3.CEmphasis"]=Js,Js.__name__="format.mp3.CEmphasis";var $s=n["format.mp3.MPEGVersion"]={__ename__:"format.mp3.MPEGVersion",__constructs__:["MPEG_V1","MPEG_V2","MPEG_V25","MPEG_Reserved"],MPEG_V1:{_hx_index:0,__enum__:"format.mp3.MPEGVersion",toString:r},MPEG_V2:{_hx_index:1,__enum__:"format.mp3.MPEGVersion",toString:r},MPEG_V25:{_hx_index:2,__enum__:"format.mp3.MPEGVersion",toString:r},MPEG_Reserved:{_hx_index:3,__enum__:"format.mp3.MPEGVersion",toString:r}};$s.__empty_constructs__=[$s.MPEG_V1,$s.MPEG_V2,$s.MPEG_V25,$s.MPEG_Reserved];var er=n["format.mp3.Layer"]={__ename__:"format.mp3.Layer",__constructs__:["LayerReserved","Layer3","Layer2","Layer1"],LayerReserved:{_hx_index:0,__enum__:"format.mp3.Layer",toString:r},Layer3:{_hx_index:1,__enum__:"format.mp3.Layer",toString:r},Layer2:{_hx_index:2,__enum__:"format.mp3.Layer",toString:r},Layer1:{_hx_index:3,__enum__:"format.mp3.Layer",toString:r}};er.__empty_constructs__=[er.LayerReserved,er.Layer3,er.Layer2,er.Layer1];var tr=n["format.mp3.ChannelMode"]={__ename__:"format.mp3.ChannelMode",__constructs__:["Stereo","JointStereo","DualChannel","Mono"],Stereo:{_hx_index:0,__enum__:"format.mp3.ChannelMode",toString:r},JointStereo:{_hx_index:1,__enum__:"format.mp3.ChannelMode",toString:r},DualChannel:{_hx_index:2,__enum__:"format.mp3.ChannelMode",toString:r},Mono:{_hx_index:3,__enum__:"format.mp3.ChannelMode",toString:r}};tr.__empty_constructs__=[tr.Stereo,tr.JointStereo,tr.DualChannel,tr.Mono];var sr=n["format.mp3.Emphasis"]={__ename__:"format.mp3.Emphasis",__constructs__:["NoEmphasis","Ms50_15","CCIT_J17","InvalidEmphasis"],NoEmphasis:{_hx_index:0,__enum__:"format.mp3.Emphasis",toString:r},Ms50_15:{_hx_index:1,__enum__:"format.mp3.Emphasis",toString:r},CCIT_J17:{_hx_index:2,__enum__:"format.mp3.Emphasis",toString:r},InvalidEmphasis:{_hx_index:3,__enum__:"format.mp3.Emphasis",toString:r}};sr.__empty_constructs__=[sr.NoEmphasis,sr.Ms50_15,sr.CCIT_J17,sr.InvalidEmphasis];var rr=n["format.mp3.FrameType"]={__ename__:"format.mp3.FrameType",__constructs__:["FT_MP3","FT_NONE"],FT_MP3:{_hx_index:0,__enum__:"format.mp3.FrameType",toString:r},FT_NONE:{_hx_index:1,__enum__:"format.mp3.FrameType",toString:r}};rr.__empty_constructs__=[rr.FT_MP3,rr.FT_NONE];class nr{constructor(e){this.i=e,e.set_bigEndian(!0),this.bits=new dr(e),this.samples=0,this.sampleSize=0,this.any_read=!1}skipID3v2(){this.id3v2_version=this.i.readUInt16(),this.id3v2_flags=this.i.readByte();let e=127&this.i.readByte();e=e<<7|127&this.i.readByte(),e=e<<7|127&this.i.readByte(),e=e<<7|127&this.i.readByte(),this.id3v2_data=this.i.read(e)}seekFrame(){try{let e;for(;;)if(e=this.i.readByte(),this.any_read||(this.any_read=!0,73==e&&(e=this.i.readByte(),68==e&&(e=this.i.readByte(),51==e&&this.skipID3v2()))),255==e&&(this.bits.nbits=0,e=this.bits.readBits(3),7==e))return rr.FT_MP3}catch(e){if($i.caught(e).unwrap()instanceof Da)return rr.FT_NONE;throw e}}readFrames(){let e,t=[];for(;e=this.seekFrame(),e!=rr.FT_NONE;)switch(e._hx_index){case 0:let e=this.readFrame();null!=e&&t.push(e)}return t}readFrameHeader(){let e=this.bits.readBits(2),t=this.bits.readBits(2),s=!this.bits.readBit();if(e==Hs.Reserved||t==Ks.LReserved)return null;let r=this.bits.readBits(4),n=ir.getBitrate(e,t,r),i=this.bits.readBits(2),a=ir.getSamplingRate(e,i),l=this.bits.readBit(),h=this.bits.readBit();if(n==Zs.BR_Bad||n==Zs.BR_Free||a==Xs.SR_Bad)return null;let o=this.bits.readBits(2),_=this.bits.readBit(),c=this.bits.readBit(),u=this.bits.readBit(),d=this.bits.readBit(),p=this.bits.readBits(2),f=0;return s&&(f=this.i.readUInt16()),{version:Hs.num2Enum(e),layer:Ks.num2Enum(t),hasCrc:s,crc16:f,bitrate:n,samplingRate:a,isPadded:l,privateBit:h,channelMode:qs.num2Enum(o),isIntensityStereo:_,isMSStereo:c,isCopyrighted:u,isOriginal:d,emphasis:Js.num2Enum(p)}}readFrame(){let e=this.readFrameHeader();if(null==e||ir.isInvalidFrameHeader(e))return null;try{let t=this.i.read(ir.getSampleDataSizeHdr(e));return this.samples+=ir.getSampleCountHdr(e),this.sampleSize+=t.length,{header:e,data:t}}catch(e){if($i.caught(e).unwrap()instanceof Da)return null;throw e}}read(){return{frames:this.readFrames(),sampleCount:this.samples,sampleSize:this.sampleSize,id3v2:null==this.id3v2_data?null:{versionBytes:this.id3v2_version,flagByte:this.id3v2_flags,data:this.id3v2_data}}}}s["format.mp3.Reader"]=nr,nr.__name__="format.mp3.Reader",Object.assign(nr.prototype,{__class__:nr});class ir{static getBitrate(e,t,s){return e==Hs.Reserved||t==Ks.LReserved?Zs.BR_Bad:(3==e?Hs.V1_Bitrates:Hs.V2_Bitrates)[t][s]}static getSamplingRate(e,t){return Hs.SamplingRates[e][t]}static isInvalidFrameHeader(e){return e.version==$s.MPEG_Reserved||e.layer==er.LayerReserved||e.bitrate==Zs.BR_Bad||e.bitrate==Zs.BR_Free||e.samplingRate==Xs.SR_Bad}static getSampleDataSize(e,t,s,r,n){return((3==e?144:72)*t*1e3/s|0)+(r?1:0)-(n?2:0)-4}static getSampleDataSizeHdr(e){return ir.getSampleDataSize(Hs.enum2Num(e.version),Hs.bitrateEnum2Num(e.bitrate),Hs.srEnum2Num(e.samplingRate),e.isPadded,e.hasCrc)}static getSampleCount(e){return 3==e?1152:576}static getSampleCountHdr(e){return ir.getSampleCount(Hs.enum2Num(e.version))}}s["format.mp3.Tools"]=ir,ir.__name__="format.mp3.Tools";var ar=n["format.png.Color"]={__ename__:"format.png.Color",__constructs__:["ColGrey","ColTrue","ColIndexed"],ColGrey:(t=function(e){return{_hx_index:0,alpha:e,__enum__:"format.png.Color",toString:r}},t.__params__=["alpha"],t),ColTrue:(t=function(e){return{_hx_index:1,alpha:e,__enum__:"format.png.Color",toString:r}},t.__params__=["alpha"],t),ColIndexed:{_hx_index:2,__enum__:"format.png.Color",toString:r}};ar.__empty_constructs__=[ar.ColIndexed];var lr=n["format.png.Chunk"]={__ename__:"format.png.Chunk",__constructs__:["CEnd","CHeader","CData","CPalette","CUnknown"],CEnd:{_hx_index:0,__enum__:"format.png.Chunk",toString:r},CHeader:(t=function(e){return{_hx_index:1,h:e,__enum__:"format.png.Chunk",toString:r}},t.__params__=["h"],t),CData:(t=function(e){return{_hx_index:2,b:e,__enum__:"format.png.Chunk",toString:r}},t.__params__=["b"],t),CPalette:(t=function(e){return{_hx_index:3,b:e,__enum__:"format.png.Chunk",toString:r}},t.__params__=["b"],t),CUnknown:(t=function(e,t){return{_hx_index:4,id:e,data:t,__enum__:"format.png.Chunk",toString:r}},t.__params__=["id","data"],t)};lr.__empty_constructs__=[lr.CEnd];class hr{constructor(e){this.i=e,e.set_bigEndian(!0),this.checkCRC=!0}read(){if(137!=this.i.readByte())throw $i.thrown("Invalid header");if(80!=this.i.readByte())throw $i.thrown("Invalid header");if(78!=this.i.readByte())throw $i.thrown("Invalid header");if(71!=this.i.readByte())throw $i.thrown("Invalid header");if(13!=this.i.readByte())throw $i.thrown("Invalid header");if(10!=this.i.readByte())throw $i.thrown("Invalid header");if(26!=this.i.readByte())throw $i.thrown("Invalid header");if(10!=this.i.readByte())throw $i.thrown("Invalid header");let e=new ka;for(;;){let t=this.readChunk();if(e.add(t),t==lr.CEnd)break}return e}readHeader(e){e.set_bigEndian(!0);let t,s=e.readInt32(),r=e.readInt32(),n=e.readByte(),i=e.readByte();switch(i){case 0:t=ar.ColGrey(!1);break;case 2:t=ar.ColTrue(!1);break;case 3:t=ar.ColIndexed;break;case 4:t=ar.ColGrey(!0);break;case 6:t=ar.ColTrue(!0);break;default:throw $i.thrown("Unknown color model "+i+":"+n)}let a=e.readByte(),l=e.readByte();if(0!=a||0!=l)throw $i.thrown("Invalid header");let h=e.readByte();if(0!=h&&1!=h)throw $i.thrown("Invalid header");return{width:s,height:r,colbits:n,color:t,interlaced:1==h}}readChunk(){let e=this.i.readInt32(),t=this.i.readString(4),s=this.i.read(e),r=this.i.readInt32();if(this.checkCRC){let e=-1,n=255&(e^c.cca(t,0));n=n>>>1^-306674912&-(1&n),n=n>>>1^-306674912&-(1&n),n=n>>>1^-306674912&-(1&n),n=n>>>1^-306674912&-(1&n),n=n>>>1^-306674912&-(1&n),n=n>>>1^-306674912&-(1&n),n=n>>>1^-306674912&-(1&n),n=n>>>1^-306674912&-(1&n),e=e>>>8^n;let i=255&(e^c.cca(t,1));i=i>>>1^-306674912&-(1&i),i=i>>>1^-306674912&-(1&i),i=i>>>1^-306674912&-(1&i),i=i>>>1^-306674912&-(1&i),i=i>>>1^-306674912&-(1&i),i=i>>>1^-306674912&-(1&i),i=i>>>1^-306674912&-(1&i),i=i>>>1^-306674912&-(1&i),e=e>>>8^i;let a=255&(e^c.cca(t,2));a=a>>>1^-306674912&-(1&a),a=a>>>1^-306674912&-(1&a),a=a>>>1^-306674912&-(1&a),a=a>>>1^-306674912&-(1&a),a=a>>>1^-306674912&-(1&a),a=a>>>1^-306674912&-(1&a),a=a>>>1^-306674912&-(1&a),a=a>>>1^-306674912&-(1&a),e=e>>>8^a;let l=255&(e^c.cca(t,3));l=l>>>1^-306674912&-(1&l),l=l>>>1^-306674912&-(1&l),l=l>>>1^-306674912&-(1&l),l=l>>>1^-306674912&-(1&l),l=l>>>1^-306674912&-(1&l),l=l>>>1^-306674912&-(1&l),l=l>>>1^-306674912&-(1&l),l=l>>>1^-306674912&-(1&l),e=e>>>8^l;let h=s.b.bufferValue,o=0,_=s.length;for(;o<_;){let t=o++,s=255&(e^h.bytes[t]);s=s>>>1^-306674912&-(1&s),s=s>>>1^-306674912&-(1&s),s=s>>>1^-306674912&-(1&s),s=s>>>1^-306674912&-(1&s),s=s>>>1^-306674912&-(1&s),s=s>>>1^-306674912&-(1&s),s=s>>>1^-306674912&-(1&s),s=s>>>1^-306674912&-(1&s),e=e>>>8^s}if((-1^e)!=r)throw $i.thrown("CRC check failure")}switch(t){case"IDAT":return lr.CData(s);case"IEND":return lr.CEnd;case"IHDR":return lr.CHeader(this.readHeader(new Ta(s)));case"PLTE":return lr.CPalette(s);default:return lr.CUnknown(t,s)}}}s["format.png.Reader"]=hr,hr.__name__="format.png.Reader",Object.assign(hr.prototype,{__class__:hr});class or{static getHeader(e){let t=e.h;for(;null!=t;){let e=t.item;t=t.next;let s=e;if(1==s._hx_index){return s.h}}throw $i.thrown("Header not found")}static getPalette(e){let t=e.h;for(;null!=t;){let e=t.item;t=t.next;let s=e;if(3==s._hx_index){return s.b}}return null}static extract32(e,t,s){let r=or.getHeader(e),n=null==t?new da(new ArrayBuffer(r.width*r.height*4)):t,i=null,a=null,l=e.h;for(;null!=l;){let e=l.item;l=l.next;let t=e;if(2==t._hx_index){let e=t.b;null!=a?a.add(e):null==i?i=e:(a=new Ma,a.add(i),a.add(e),i=null)}}if(null!=a&&(i=a.getBytes()),null==i)throw $i.thrown("Data not found");i=pr.run(i);let h=0,o=0,_=0;s&&(_=8*-r.width,o=(r.height-1)*(4*r.width));let c=s?-1:1,u=r.color;switch(u._hx_index){case 0:let t=u.alpha;if(8!=r.colbits)throw $i.thrown("Unsupported color mode");let s=r.width,a=(t?2:1)*s+1;if(i.length<r.height*a)throw $i.thrown("Not enough data");let l=-1;if(!t){let t=e.h;for(;null!=t;){let e=t.item;t=t.next;let s=e;if(4==s._hx_index&&"tRNS"==s.id){let e=s.data;e.length>=2&&(l=e.b[1]);break}}}let d=0,p=r.height;for(;d<p;){let e=d++,r=i.b[h++];switch(r){case 0:if(t){let e=0,t=s;for(;e<t;){e++;let t=i.b[h++];n.b[o++]=t,n.b[o++]=t,n.b[o++]=t,n.b[o++]=i.b[h++]}}else{let e=0,t=s;for(;e<t;){e++;let t=i.b[h++];n.b[o++]=t,n.b[o++]=t,n.b[o++]=t,n.b[o++]=t==l?0:255}}break;case 1:let a=0,_=0;if(t){let e=0,t=s;for(;e<t;){e++;a+=i.b[h++],n.b[o++]=a,n.b[o++]=a,n.b[o++]=a,_+=i.b[h++],n.b[o++]=_}}else{let e=0,t=s;for(;e<t;){e++;a+=i.b[h++],n.b[o++]=a,n.b[o++]=a,n.b[o++]=a,n.b[o++]=a==l?0:255}}break;case 2:let u=0==e?0:4*s*c;if(t){let e=0,t=s;for(;e<t;){e++;let t=i.b[h++]+n.b[o-u];n.b[o++]=t,n.b[o++]=t,n.b[o++]=t,n.b[o++]=i.b[h++]+n.b[o-u]}}else{let e=0,t=s;for(;e<t;){e++;let t=i.b[h++]+n.b[o-u];n.b[o++]=t,n.b[o++]=t,n.b[o++]=t,n.b[o++]=t==l?0:255}}break;case 3:let d=0,p=0,f=0==e?0:4*s*c;if(t){let e=0,t=s;for(;e<t;){e++;d=i.b[h++]+(d+n.b[o-f]>>1)&255,n.b[o++]=d,n.b[o++]=d,n.b[o++]=d,p=i.b[h++]+(p+n.b[o-f]>>1)&255,n.b[o++]=p}}else{let e=0,t=s;for(;e<t;){e++;d=i.b[h++]+(d+n.b[o-f]>>1)&255,n.b[o++]=d,n.b[o++]=d,n.b[o++]=d,n.b[o++]=d==l?0:255}}break;case 4:let x=4*s*c,g=0,b=0;if(t){let t=0,r=s;for(;t<r;){let s=t++,r=0==e?0:n.b[o-x],a=0==s||0==e?0:n.b[o-x-4],l=g+r-a,_=l-g;_<0&&(_=-_);let c=l-r;c<0&&(c=-c);let u=l-a;u<0&&(u=-u);let d=h++;g=(_<=c&&_<=u?g:c<=u?r:a)+i.b[d]&255,n.b[o++]=g,n.b[o++]=g,n.b[o++]=g;let p=0==e?0:n.b[o-x],f=0==s||0==e?0:n.b[o-x-4],m=b+p-f,A=m-b;A<0&&(A=-A);let w=m-p;w<0&&(w=-w);let y=m-f;y<0&&(y=-y);let k=h++;b=(A<=w&&A<=y?b:w<=y?p:f)+i.b[k]&255,n.b[o++]=b}}else{let t=0,r=s;for(;t<r;){let s=t++,r=0==e?0:n.b[o-x],a=0==s||0==e?0:n.b[o-x-4],_=g+r-a,c=_-g;c<0&&(c=-c);let u=_-r;u<0&&(u=-u);let d=_-a;d<0&&(d=-d);let p=h++;g=(c<=u&&c<=d?g:u<=d?r:a)+i.b[p]&255,n.b[o++]=g,n.b[o++]=g,n.b[o++]=g,n.b[o++]=g==l?0:255}}break;default:throw $i.thrown("Invalid filter "+r)}o+=_}break;case 1:let f=u.alpha;if(8!=r.colbits)throw $i.thrown("Unsupported color mode");let x=r.width,g=(f?4:3)*x+1;if(i.length<r.height*g)throw $i.thrown("Not enough data");let b=-1,m=-1,A=-1;if(!f){let t=e.h;for(;null!=t;){let e=t.item;t=t.next;let s=e;if(4==s._hx_index&&"tRNS"==s.id){let e=s.data;e.length>=6&&(b=e.b[1],m=e.b[3],A=e.b[5]);break}}}let w=0,y=0,k=0,B=0,C=0,v=r.height;for(;C<v;){let e=C++,t=i.b[h++];switch(t){case 0:if(f){let e=0,t=x;for(;e<t;){e++;n.b[o++]=i.b[h+2],n.b[o++]=i.b[h+1],n.b[o++]=i.b[h],n.b[o++]=i.b[h+3],h+=4}}else{let e=0,t=x;for(;e<t;){e++;k=i.b[h+2],n.b[o++]=k,y=i.b[h+1],n.b[o++]=y,w=i.b[h],n.b[o++]=w,n.b[o++]=w==b&&y==m&&k==A?0:255,h+=3}}break;case 1:if(B=0,k=B,y=k,w=y,f){let e=0,t=x;for(;e<t;){e++;k+=i.b[h+2],n.b[o++]=k,y+=i.b[h+1],n.b[o++]=y,w+=i.b[h],n.b[o++]=w,B+=i.b[h+3],n.b[o++]=B,h+=4}}else{let e=0,t=x;for(;e<t;){e++;k+=i.b[h+2],n.b[o++]=k,y+=i.b[h+1],n.b[o++]=y,w+=i.b[h],n.b[o++]=w,n.b[o++]=w==b&&y==m&&k==A?0:255,h+=3}}break;case 2:let s=0==e?0:4*x*c;if(f){let e=0,t=x;for(;e<t;){e++;n.b[o]=i.b[h+2]+n.b[o-s],++o,n.b[o]=i.b[h+1]+n.b[o-s],++o,n.b[o]=i.b[h]+n.b[o-s],++o,n.b[o]=i.b[h+3]+n.b[o-s],++o,h+=4}}else{let e=0,t=x;for(;e<t;){e++;k=i.b[h+2]+n.b[o-s],n.b[o]=k,++o,y=i.b[h+1]+n.b[o-s],n.b[o]=y,++o,w=i.b[h]+n.b[o-s],n.b[o]=w,++o,n.b[o++]=w==b&&y==m&&k==A?0:255,h+=3}}break;case 3:B=0,k=B,y=k,w=y;let r=0==e?0:4*x*c;if(f){let e=0,t=x;for(;e<t;){e++;k=i.b[h+2]+(k+n.b[o-r]>>1)&255,n.b[o++]=k,y=i.b[h+1]+(y+n.b[o-r]>>1)&255,n.b[o++]=y,w=i.b[h]+(w+n.b[o-r]>>1)&255,n.b[o++]=w,B=i.b[h+3]+(B+n.b[o-r]>>1)&255,n.b[o++]=B,h+=4}}else{let e=0,t=x;for(;e<t;){e++;k=i.b[h+2]+(k+n.b[o-r]>>1)&255,n.b[o++]=k,y=i.b[h+1]+(y+n.b[o-r]>>1)&255,n.b[o++]=y,w=i.b[h]+(w+n.b[o-r]>>1)&255,n.b[o++]=w,n.b[o++]=w==b&&y==m&&k==A?0:255,h+=3}}break;case 4:let a=4*x*c;if(B=0,k=B,y=k,w=y,f){let t=0,s=x;for(;t<s;){let s=t++,r=0==e?0:n.b[o-a],l=0==s||0==e?0:n.b[o-a-4],_=k+r-l,c=_-k;c<0&&(c=-c);let u=_-r;u<0&&(u=-u);let d=_-l;d<0&&(d=-d),k=(c<=u&&c<=d?k:u<=d?r:l)+i.b[h+2]&255,n.b[o++]=k;let p=0==e?0:n.b[o-a],f=0==s||0==e?0:n.b[o-a-4],x=y+p-f,g=x-y;g<0&&(g=-g);let b=x-p;b<0&&(b=-b);let m=x-f;m<0&&(m=-m),y=(g<=b&&g<=m?y:b<=m?p:f)+i.b[h+1]&255,n.b[o++]=y;let A=0==e?0:n.b[o-a],C=0==s||0==e?0:n.b[o-a-4],v=w+A-C,S=v-w;S<0&&(S=-S);let M=v-A;M<0&&(M=-M);let I=v-C;I<0&&(I=-I),w=(S<=M&&S<=I?w:M<=I?A:C)+i.b[h]&255,n.b[o++]=w;let T=0==e?0:n.b[o-a],F=0==s||0==e?0:n.b[o-a-4],E=B+T-F,D=E-B;D<0&&(D=-D);let R=E-T;R<0&&(R=-R);let V=E-F;V<0&&(V=-V),B=(D<=R&&D<=V?B:R<=V?T:F)+i.b[h+3]&255,n.b[o++]=B,h+=4}}else{let t=0,s=x;for(;t<s;){let s=t++,r=0==e?0:n.b[o-a],l=0==s||0==e?0:n.b[o-a-4],_=k+r-l,c=_-k;c<0&&(c=-c);let u=_-r;u<0&&(u=-u);let d=_-l;d<0&&(d=-d),k=(c<=u&&c<=d?k:u<=d?r:l)+i.b[h+2]&255,n.b[o++]=k;let p=0==e?0:n.b[o-a],f=0==s||0==e?0:n.b[o-a-4],x=y+p-f,g=x-y;g<0&&(g=-g);let B=x-p;B<0&&(B=-B);let C=x-f;C<0&&(C=-C),y=(g<=B&&g<=C?y:B<=C?p:f)+i.b[h+1]&255,n.b[o++]=y;let v=0==e?0:n.b[o-a],S=0==s||0==e?0:n.b[o-a-4],M=w+v-S,I=M-w;I<0&&(I=-I);let T=M-v;T<0&&(T=-T);let F=M-S;F<0&&(F=-F),w=(I<=T&&I<=F?w:T<=F?v:S)+i.b[h]&255,n.b[o++]=w,n.b[o++]=w==b&&y==m&&k==A?0:255,h+=3}}break;default:throw $i.thrown("Invalid filter "+t)}o+=_}break;case 2:let S=or.getPalette(e);if(null==S)throw $i.thrown("PNG Palette is missing");let M=null,I=e.h;for(;null!=I;){let e=I.item;I=I.next;let t=e;if(4==t._hx_index&&"tRNS"==t.id){M=t.data;break}}if(null!=M&&M.length<1<<r.colbits){let e=new da(new ArrayBuffer(1<<r.colbits));e.blit(0,M,0,M.length),e.fill(M.length,e.length-M.length,255),M=e}let T=r.width,F=Math.ceil(T*r.colbits/8)+1;if(i.length<r.height*F)throw $i.thrown("Not enough data");let E=r.width*r.colbits>>3,D=0,R=r.height;for(;D<R;){let e=D++,t=i.b[h++];if(0!=t)switch(t){case 1:let s=0,r=0,n=T;for(;r<n;){r++;s+=i.b[h],i.b[h++]=255&s}break;case 2:let a=0==e?0:E+1,l=0,o=T;for(;l<o;){l++;let e=i.b[h];i.b[h]=e+i.b[h-a],++h}break;case 3:let _=0,c=0==e?0:E+1,u=0,d=T;for(;u<d;){u++;_=i.b[h]+(_+i.b[h-c]>>1)&255,i.b[h++]=_}break;case 4:let p=E+1,f=0,x=0,g=T;for(;x<g;){let t=x++,s=i.b[h],r=1;null==r&&(r=4);let n=0==e?0:i.b[h-p],a=0==t||0==e?0:i.b[h-p-r],l=f+n-a,o=l-f;o<0&&(o=-o);let _=l-n;_<0&&(_=-_);let c=l-a;c<0&&(c=-c),f=(o<=_&&o<=c?f:_<=c?n:a)+s&255,i.b[h++]=f}break;default:throw $i.thrown("Invalid filter "+t)}else h+=E}let V=0;if(8==r.colbits){let e=0,t=r.height;for(;e<t;){e++;++V;let t=0,s=r.width;for(;t<s;){t++;let e=i.b[V++];n.b[o++]=S.b[3*e+2],n.b[o++]=S.b[3*e+1],n.b[o++]=S.b[3*e],n.b[o++]=null!=M?M.b[e]:255}o+=_}}else{if(!(r.colbits<8))throw $i.thrown(r.colbits+" indexed bits per pixel not supported");{let e=r.colbits,t=(1<<e)-1,s=0,a=r.height;for(;s<a;){s++;++V;let a=0,l=0,h=0,c=r.width;for(;h<c;){h++;l<e&&(a=a<<8|i.b[V++],l+=8);let s=a>>>l-e&t;l-=e,n.b[o++]=S.b[3*s+2],n.b[o++]=S.b[3*s+1],n.b[o++]=S.b[3*s],n.b[o++]=null!=M?M.b[s]:255}o+=_}}}}return n}}s["format.png.Tools"]=or,or.__name__="format.png.Tools";var _r=n["format.tga.ImageOrigin"]={__ename__:"format.tga.ImageOrigin",__constructs__:["BottomLeft","BottomRight","TopLeft","TopRight"],BottomLeft:{_hx_index:0,__enum__:"format.tga.ImageOrigin",toString:r},BottomRight:{_hx_index:1,__enum__:"format.tga.ImageOrigin",toString:r},TopLeft:{_hx_index:2,__enum__:"format.tga.ImageOrigin",toString:r},TopRight:{_hx_index:3,__enum__:"format.tga.ImageOrigin",toString:r}};_r.__empty_constructs__=[_r.BottomLeft,_r.BottomRight,_r.TopLeft,_r.TopRight];var cr=n["format.tga.ImageType"]={__ename__:"format.tga.ImageType",__constructs__:["NoImage","UncompressedColorMapped","UncompressedTrueColor","UncompressedBlackAndWhite","RunLengthColorMapped","RunLengthTrueColor","RunLengthBlackAndWhite","Unknown"],NoImage:{_hx_index:0,__enum__:"format.tga.ImageType",toString:r},UncompressedColorMapped:{_hx_index:1,__enum__:"format.tga.ImageType",toString:r},UncompressedTrueColor:{_hx_index:2,__enum__:"format.tga.ImageType",toString:r},UncompressedBlackAndWhite:{_hx_index:3,__enum__:"format.tga.ImageType",toString:r},RunLengthColorMapped:{_hx_index:4,__enum__:"format.tga.ImageType",toString:r},RunLengthTrueColor:{_hx_index:5,__enum__:"format.tga.ImageType",toString:r},RunLengthBlackAndWhite:{_hx_index:6,__enum__:"format.tga.ImageType",toString:r},Unknown:(t=function(e){return{_hx_index:7,type:e,__enum__:"format.tga.ImageType",toString:r}},t.__params__=["type"],t)};cr.__empty_constructs__=[cr.NoImage,cr.UncompressedColorMapped,cr.UncompressedTrueColor,cr.UncompressedBlackAndWhite,cr.RunLengthColorMapped,cr.RunLengthTrueColor,cr.RunLengthBlackAndWhite];class ur{constructor(e){this.i=e,e.set_bigEndian(!1)}read(){let e=this.i.readByte(),t=this.readHeader(),s=0==e?"":this.i.readString(e),r=this.readColorMapData(t);return{header:t,imageId:s,colorMapData:r,imageData:this.readImageData(t,r),developerData:null}}readHeader(){let e,t=this.i.readByte(),s=this.i.readByte();switch(s){case 0:e=cr.NoImage;break;case 1:e=cr.UncompressedColorMapped;break;case 2:e=cr.UncompressedTrueColor;break;case 3:e=cr.UncompressedBlackAndWhite;break;case 9:e=cr.RunLengthColorMapped;break;case 10:e=cr.RunLengthTrueColor;break;case 11:e=cr.RunLengthBlackAndWhite;break;default:e=cr.Unknown(s)}let r,n=this.i.readInt16(),i=this.i.readInt16(),a=this.i.readByte(),l=this.i.readInt16(),h=this.i.readInt16(),o=this.i.readInt16(),_=this.i.readInt16(),c=this.i.readByte(),u=this.i.readByte();switch(48&u){case 16:r=_r.BottomRight;break;case 32:r=_r.TopLeft;break;case 48:r=_r.TopRight;break;default:r=_r.BottomLeft}return{colorMapType:t,imageType:e,colorMapFirstIndex:n,colorMapLength:i,colorMapEntrySize:a,xOrigin:l,yOrigin:h,width:o,height:_,bitsPerPixel:c,alphaChannelBits:15&u,imageOrigin:r}}readColorMapData(e){return 0==e.colorMapType?null:this.readPixels(e.colorMapEntrySize,e.colorMapLength,e.alphaChannelBits,!1)}readImageData(e,t){switch(e.imageType._hx_index){case 0:return null;case 1:return this.readIndexes(e.bitsPerPixel,e.width*e.height,t,e.colorMapFirstIndex,!1);case 2:return this.readPixels(e.bitsPerPixel,e.width*e.height,e.alphaChannelBits,!1);case 3:return this.readMono(e.bitsPerPixel,e.width*e.height,e.alphaChannelBits,!1);case 4:return this.readIndexes(e.bitsPerPixel,e.width*e.height,t,e.colorMapFirstIndex,!0);case 5:return this.readPixels(e.bitsPerPixel,e.width*e.height,e.alphaChannelBits,!0);case 6:return this.readMono(e.bitsPerPixel,e.width*e.height,e.alphaChannelBits,!0);default:throw $i.thrown("Unsupported image data type!")}}readPixels(e,s,r,n){let i,a,l=new Array(s),h=0!=r,o=e/3|0;switch(o>8&&(o=8),e){case 8:a=ao(t=this.i,t.readByte),i=ao(this,this.parsePixel1);break;case 16:a=ao(t=this.i,t.readUInt16),i=ao(this,this.parsePixel2);break;case 24:a=ao(t=this.i,t.readUInt24),i=ao(this,this.parsePixel3);break;case 32:a=ao(t=this.i,t.readInt32),i=ao(this,this.parsePixel4);break;default:throw $i.thrown("Unsupported bits per pixels amount!")}if(n){let e,t=0;for(;t<s;)if(e=this.i.readByte(),0!=(128&e)){e&=127;let s=i(a(),h);for(;e>=0;)l[t++]=s,--e}else for(e&=127;e>=0;)l[t++]=i(a(),h),--e}else{let e=0,t=s;for(;e<t;){l[e++]=i(a(),h)}}return l}readMono(e,s,r,n){let i,a,l=new Array(s),h=0!=r;switch(e){case 8:a=ao(t=this.i,t.readByte),i=ao(this,this.parsePixel1);break;case 16:a=ao(t=this.i,t.readUInt16),i=ao(this,this.parsePixelGreyAlpha);break;default:throw $i.thrown("Unsupported bits per pixels amount!")}if(n){let e,t=0;for(;t<s;)if(e=this.i.readByte(),0!=(128&e)){e&=127;let s=i(a(),h);for(;e>=0;)l[t++]=s,--e}else for(e&=127;e>=0;)l[t++]=i(a(),h),--e}else{let e=0,t=s;for(;e<t;){l[e++]=i(a(),h)}}return l}readIndexes(e,s,r,n,i){let a,l=new Array(s);switch(e){case 8:a=ao(t=this.i,t.readByte);break;case 16:a=ao(t=this.i,t.readUInt16);break;case 24:a=ao(t=this.i,t.readUInt24);break;case 32:a=ao(t=this.i,t.readInt32);break;default:throw $i.thrown("Unsupported bits per pixels amount!")}if(i){let e,t=0;for(;t<s;)if(e=this.i.readByte(),0!=(128&e)){e&=127;let s=r[n+a()];for(;e>=0;)l[t++]=s,--e}else for(e&=127;e>=0;)l[t++]=r[n+a()],--e}else{let e=0,t=s;for(;e<t;){l[e++]=r[n+a()]}}return l}parsePixel1(e,t){return e<<16|e<<8|e}parsePixelGreyAlpha(e,t){return(t?(65280&e)<<16:0)|this.parsePixel1(255&e,!1)}parsePixel2(e,t){return(t&&1==(32768&e)?-16777216:0)|(((31744&e)>>10)/31*255|0)<<16|(((992&e)>>5)/31*255|0)<<8|(31&e)/31*255|0}parsePixel3(e,t){return e}parsePixel4(e,t){return e}}s["format.tga.Reader"]=ur,ur.__name__="format.tga.Reader",Object.assign(ur.prototype,{__class__:ur});class dr{constructor(e){this.i=e,this.nbits=0,this.bits=0}readBits(e){if(this.nbits>=e){let t=this.nbits-e,s=this.bits>>>t&(1<<e)-1;return this.nbits=t,s}let t=this.i.readByte();if(this.nbits>=24){if(e>31)throw $i.thrown("Bits error");let s=8+this.nbits-e,r=this.bits&(1<<this.nbits)-1;return r=r<<8-s|t<<s,this.bits=t,this.nbits=s,r}return this.bits=this.bits<<8|t,this.nbits+=8,this.readBits(e)}readBit(){return 0==this.nbits&&(this.bits=this.i.readByte(),this.nbits=8),this.nbits--,1==(this.bits>>>this.nbits&1)}}s["format.tools.BitsInput"]=dr,dr.__name__="format.tools.BitsInput",Object.assign(dr.prototype,{__class__:dr});class pr{static run(e){return Na.run(e)}}s["format.tools.Inflate"]=pr,pr.__name__="format.tools.Inflate";var fr=n["format.wav.WAVEFormat"]={__ename__:"format.wav.WAVEFormat",__constructs__:["WF_PCM"],WF_PCM:{_hx_index:0,__enum__:"format.wav.WAVEFormat",toString:r}};fr.__empty_constructs__=[fr.WF_PCM];class xr{constructor(e){this.i=e,e.set_bigEndian(!1)}read(){if("RIFF"!=this.i.readString(4))throw $i.thrown("RIFF header expected");this.i.readInt32();if("WAVE"!=this.i.readString(4))throw $i.thrown("WAVE signature not found");let e=this.i.readString(4);e:for(;"fmt "!=e;)switch(e){case"JUNK":let t=this.i.readInt32();this.i.read(t),e=this.i.readString(4);break;case"bext":let s=this.i.readInt32();this.i.read(s),e=this.i.readString(4);break;default:break e}if("fmt "!=e)throw $i.thrown("unsupported wave chunk "+e);let t,s=this.i.readInt32();switch(this.i.readUInt16()){case 1:case 3:t=fr.WF_PCM;break;default:throw $i.thrown("only PCM (uncompressed) WAV files are supported")}let r=this.i.readUInt16(),n=this.i.readInt32(),i=this.i.readInt32(),a=this.i.readUInt16(),l=this.i.readUInt16();s>16&&this.i.read(s-16);let h=this.i.readString(4);for(;"data"!=h;)this.i.read(this.i.readInt32()),h=this.i.readString(4);if("data"!=h)throw $i.thrown("expected data subchunk");let o,_=this.i.readInt32();try{o=this.i.read(_)}catch(e){throw $i.caught(e).unwrap()instanceof Da?$i.thrown("Invalid chunk data length"):e}let c=[];try{for(;;){if("cue "==this.i.readString(4)){this.i.readInt32();let e=this.i.readInt32(),t=0,s=e;for(;t<s;){t++;let e=this.i.readInt32();this.i.readInt32(),this.i.readString(4),this.i.readInt32(),this.i.readInt32();let s=this.i.readInt32();c.push({id:e,sampleOffset:s})}}else this.i.read(this.i.readInt32())}}catch(e){if(!($i.caught(e).unwrap()instanceof Da))throw e}return{header:{format:t,channels:r,samplingRate:n,byteRate:i,blockAlign:a,bitsPerSample:l},data:o,cuePoints:c}}}s["format.wav.Reader"]=xr,xr.__name__="format.wav.Reader",Object.assign(xr.prototype,{__class__:xr});class gr{constructor(e){gr._hx_skip_constructor||this._hx_constructor(e)}_hx_constructor(e){this.alpha=1,this.matA=1,this.matB=0,this.matC=0,this.matD=1,this.absX=0,this.absY=0,this.posChanged=!0,this.x=0,this.posChanged=!0,this.y=0,this.posChanged=!0,this.scaleX=1,this.posChanged=!0,this.scaleY=1,this.posChanged=!0,this.rotation=0,this.blendMode=Ar.Alpha,this.posChanged=null!=e,this.set_visible(!0),this.children=[],null!=e&&e.addChild(this)}getBounds(e,t){return null==t?t=new Rr:(t.xMin=1e20,t.yMin=1e20,t.xMax=-1e20,t.yMax=-1e20),null!=e&&e.syncPos(),e!=this&&this.syncPos(),this.getBoundsRec(e,t,!1),(t.xMax<=t.xMin||t.yMax<=t.yMin)&&(this.addBounds(e,t,-1,-1,2,2),t.xMax=t.xMin=.5*(t.xMax+t.xMin),t.yMax=t.yMin=.5*(t.yMax+t.yMin)),t}getBoundsRec(e,t,s){if(this.posChanged){this.calcAbsPos();let e=0,t=this.children;for(;e<t.length;){let s=t[e];++e,s.posChanged=!0}this.posChanged=!1}let r=this.children.length;if(0==r)return t.xMin=1e20,t.yMin=1e20,t.xMax=-1e20,void(t.yMax=-1e20);if(1==r){let r=this.children[0];return void(r.visible?r.getBoundsRec(e,t,s):(t.xMin=1e20,t.yMin=1e20,t.xMax=-1e20,t.yMax=-1e20))}let n=1/0,i=1/0,a=-1/0,l=-1/0,h=0,o=this.children;for(;h<o.length;){let r=o[h];++h,r.visible&&(r.getBoundsRec(e,t,s),t.xMin<n&&(n=t.xMin),t.yMin<i&&(i=t.yMin),t.xMax>a&&(a=t.xMax),t.yMax>l&&(l=t.yMax))}t.xMin=n,t.yMin=i,t.xMax=a,t.yMax=l}addBounds(e,t,s,r,n,i){if(n<=0||i<=0)return;if(null==e){let e=s*this.matA+r*this.matC+this.absX,a=s*this.matB+r*this.matD+this.absY;e<t.xMin&&(t.xMin=e),e>t.xMax&&(t.xMax=e),a<t.yMin&&(t.yMin=a),a>t.yMax&&(t.yMax=a);let l=(s+n)*this.matA+r*this.matC+this.absX,h=(s+n)*this.matB+r*this.matD+this.absY;l<t.xMin&&(t.xMin=l),l>t.xMax&&(t.xMax=l),h<t.yMin&&(t.yMin=h),h>t.yMax&&(t.yMax=h);let o=s*this.matA+(r+i)*this.matC+this.absX,_=s*this.matB+(r+i)*this.matD+this.absY;o<t.xMin&&(t.xMin=o),o>t.xMax&&(t.xMax=o),_<t.yMin&&(t.yMin=_),_>t.yMax&&(t.yMax=_);let c=(s+n)*this.matA+(r+i)*this.matC+this.absX,u=(s+n)*this.matB+(r+i)*this.matD+this.absY;return c<t.xMin&&(t.xMin=c),c>t.xMax&&(t.xMax=c),u<t.yMin&&(t.yMin=u),void(u>t.yMax&&(t.yMax=u))}if(e==this)return t.xMin>s&&(t.xMin=s),t.yMin>r&&(t.yMin=r),t.xMax<s+n&&(t.xMax=s+n),void(t.yMax<r+i&&(t.yMax=r+i));let a=e.matA*e.matD-e.matB*e.matC;if(0==a)return;let l=1/a,h=e.matD*l,o=-e.matB*l,_=-e.matC*l,c=e.matA*l,u=this.absX-e.absX,d=this.absY-e.absY,p=s*this.matA+r*this.matC+u,f=s*this.matB+r*this.matD+d,x=p*h+f*_,g=p*o+f*c;x<t.xMin&&(t.xMin=x),x>t.xMax&&(t.xMax=x),g<t.yMin&&(t.yMin=g),g>t.yMax&&(t.yMax=g),p=(s+n)*this.matA+r*this.matC+u,f=(s+n)*this.matB+r*this.matD+d;let b=p*h+f*_,m=p*o+f*c;b<t.xMin&&(t.xMin=b),b>t.xMax&&(t.xMax=b),m<t.yMin&&(t.yMin=m),m>t.yMax&&(t.yMax=m),p=s*this.matA+(r+i)*this.matC+u,f=s*this.matB+(r+i)*this.matD+d;let A=p*h+f*_,w=p*o+f*c;A<t.xMin&&(t.xMin=A),A>t.xMax&&(t.xMax=A),w<t.yMin&&(t.yMin=w),w>t.yMax&&(t.yMax=w),p=(s+n)*this.matA+(r+i)*this.matC+u,f=(s+n)*this.matB+(r+i)*this.matD+d;let y=p*h+f*_,k=p*o+f*c;y<t.xMin&&(t.xMin=y),y>t.xMax&&(t.xMax=y),k<t.yMin&&(t.yMin=k),k>t.yMax&&(t.yMax=k)}localToGlobal(e){this.syncPos(),null==e&&(e=new Pr);let t=e.x*this.matA+e.y*this.matC+this.absX,s=e.x*this.matB+e.y*this.matD+this.absY;return e.x=t,e.y=s,e}globalToLocal(e){this.syncPos(),e.x-=this.absX,e.y-=this.absY;let t=1/(this.matA*this.matD-this.matB*this.matC),s=(e.x*this.matD-e.y*this.matC)*t,r=(-e.x*this.matB+e.y*this.matA)*t;return e.x=s,e.y=r,e}getScene(){let e=this;for(;null!=e.parent;)e=e.parent;return e instanceof Tr?e:null}set_visible(e){return this.visible==e||(this.visible=e,null!=this.parentContainer&&this.parentContainer.contentChanged(this)),e}addChild(e){this.addChildAt(e,this.children.length)}addChildAt(e,t){t<0&&(t=0),t>this.children.length&&(t=this.children.length);let s=this;for(;null!=s;){if(s==e)throw $i.thrown("Recursive addChild");s=s.parent}if(null!=e.parent){let t=e.allocated;e.allocated=!1,e.parent.removeChild(e),e.allocated=t}this.children.splice(t,0,e),!this.allocated&&e.allocated&&e.onRemove(),e.parent=this,e.parentContainer=this.parentContainer,e.posChanged=!0,this.allocated&&(e.allocated?e.onHierarchyMoved(!0):e.onAdd()),null!=this.parentContainer&&this.parentContainer.contentChanged(this)}onHierarchyMoved(e){let t=0,s=this.children;for(;t<s.length;){let r=s[t];++t,r.onHierarchyMoved(e)}}onAdd(){this.allocated=!0,null!=this.filter&&this.filter.bind(this);let e=0,t=this.children;for(;e<t.length;){let s=t[e];++e,s.onAdd()}}onRemove(){this.allocated=!1,null!=this.filter&&this.filter.unbind(this);let e=0,t=this.children;for(;e<t.length;){let s=t[e];++e,s.onRemove()}}removeChild(e){c.remove(this.children,e)&&(e.allocated&&e.onRemove(),e.parent=null,null!=e.parentContainer&&e.setParentContainer(null),e.posChanged=!0,null!=this.parentContainer&&this.parentContainer.contentChanged(this))}setParentContainer(e){this.parentContainer=e;let t=0,s=this.children;for(;t<s.length;){let r=s[t];++t,r.setParentContainer(e)}}removeChildren(){for(;this.children.length>0;)this.removeChild(this.children[0])}draw(e){}sync(e){let t=this.posChanged;t&&(this.calcAbsPos(),this.posChanged=!1),this.lastFrame=e.frame;let s=0,r=this.children.length;for(;s<r;){let n=this.children[s];if(null==n)break;n.lastFrame!=e.frame&&(t&&(n.posChanged=!0),n.sync(e)),this.children[s]!=n?(s=0,r=this.children.length):++s}}syncPos(){if(null!=this.parent&&this.parent.syncPos(),this.posChanged){this.calcAbsPos();let e=0,t=this.children;for(;e<t.length;){let s=t[e];++e,s.posChanged=!0}this.posChanged=!1}}calcAbsPos(){if(null==this.parent){let e,t;0==this.rotation?(e=1,t=0,this.matA=this.scaleX,this.matB=0,this.matC=0,this.matD=this.scaleY):(e=Math.cos(this.rotation),t=Math.sin(this.rotation),this.matA=this.scaleX*e,this.matB=this.scaleX*t,this.matC=this.scaleY*-t,this.matD=this.scaleY*e),this.absX=this.x,this.absY=this.y}else{if(0==this.rotation)this.matA=this.scaleX*this.parent.matA,this.matB=this.scaleX*this.parent.matB,this.matC=this.scaleY*this.parent.matC,this.matD=this.scaleY*this.parent.matD;else{let e=Math.cos(this.rotation),t=Math.sin(this.rotation),s=this.scaleX*e,r=this.scaleX*t,n=this.scaleY*-t,i=this.scaleY*e;this.matA=s*this.parent.matA+r*this.parent.matC,this.matB=s*this.parent.matB+r*this.parent.matD,this.matC=n*this.parent.matA+i*this.parent.matC,this.matD=n*this.parent.matB+i*this.parent.matD}this.absX=this.x*this.parent.matA+this.y*this.parent.matC+this.parent.absX,this.absY=this.x*this.parent.matB+this.y*this.parent.matD+this.parent.absY}}emitTile(e,t){null==gr.nullDrawable&&(gr.nullDrawable=new br(null)),gr.nullDrawable.absX=this.absX,gr.nullDrawable.absY=this.absY,gr.nullDrawable.matA=this.matA,gr.nullDrawable.matB=this.matB,gr.nullDrawable.matC=this.matC,gr.nullDrawable.matD=this.matD,e.drawTile(gr.nullDrawable,t)}clipBounds(e,t){let s,r,n,i,a,l,h=e.tmpBounds;if(null!=e.inFilter){let t=e.baseShader.filterMatrixA__,h=e.baseShader.filterMatrixB__;s=this.matA*t.x+this.matB*t.y,r=this.matA*h.x+this.matB*h.y,n=this.matC*t.x+this.matD*t.y,i=this.matC*h.x+this.matD*h.y,a=this.absX*t.x+this.absY*t.y+t.z,l=this.absX*h.x+this.absY*h.y+h.z}else s=this.matA,r=this.matB,n=this.matC,i=this.matD,a=this.absX,l=this.absY;h.xMin=1e20,h.yMin=1e20,h.xMax=-1e20,h.yMax=-1e20;let o=t.xMin,_=t.yMin,c=o*s+_*n+a,u=o*r+_*i+l;c<h.xMin&&(h.xMin=c),c>h.xMax&&(h.xMax=c),u<h.yMin&&(h.yMin=u),u>h.yMax&&(h.yMax=u);let d=t.xMax,p=t.yMin,f=d*s+p*n+a,x=d*r+p*i+l;f<h.xMin&&(h.xMin=f),f>h.xMax&&(h.xMax=f),x<h.yMin&&(h.yMin=x),x>h.yMax&&(h.yMax=x);let g=t.xMin,b=t.yMax,m=g*s+b*n+a,A=g*r+b*i+l;m<h.xMin&&(h.xMin=m),m>h.xMax&&(h.xMax=m),A<h.yMin&&(h.yMin=A),A>h.yMax&&(h.yMax=A);let w=t.xMax,y=t.yMax,k=w*s+y*n+a,B=w*r+y*i+l;k<h.xMin&&(h.xMin=k),k>h.xMax&&(h.xMax=k),B<h.yMin&&(h.yMin=B),B>h.yMax&&(h.yMax=B),h.xMin<e.curX&&(h.xMin=e.curX),h.yMin<e.curY&&(h.yMin=e.curY),h.xMax>e.curX+e.curWidth&&(h.xMax=e.curX+e.curWidth),h.yMax>e.curY+e.curHeight&&(h.yMax=e.curY+e.curHeight);let C=1/(s*i-r*n),v=h.xMin,S=h.yMin,M=h.xMax,I=h.yMax;h.xMin=1e20,h.yMin=1e20,h.xMax=-1e20,h.yMax=-1e20;let T=v,F=S;T-=a,F-=l;let E=(T*i-F*n)*C,D=(-T*r+F*s)*C;E<h.xMin&&(h.xMin=E),E>h.xMax&&(h.xMax=E),D<h.yMin&&(h.yMin=D),D>h.yMax&&(h.yMax=D);let R=M,V=S;R-=a,V-=l;let O=(R*i-V*n)*C,P=(-R*r+V*s)*C;O<h.xMin&&(h.xMin=O),O>h.xMax&&(h.xMax=O),P<h.yMin&&(h.yMin=P),P>h.yMax&&(h.yMax=P);let Q=v,L=I;Q-=a,L-=l;let G=(Q*i-L*n)*C,z=(-Q*r+L*s)*C;G<h.xMin&&(h.xMin=G),G>h.xMax&&(h.xMax=G),z<h.yMin&&(h.yMin=z),z>h.yMax&&(h.yMax=z);let U=M,W=I;U-=a,W-=l;let N=(U*i-W*n)*C,j=(-U*r+W*s)*C;N<h.xMin&&(h.xMin=N),N>h.xMax&&(h.xMax=N),j<h.yMin&&(h.yMin=j),j>h.yMax&&(h.yMax=j);let Y=t.xMin,X=h.xMin;t.xMin=Y<X?X:Y;let Z=t.yMin,H=h.yMin;t.yMin=Z<H?H:Z;let K=t.xMax,q=h.xMax;t.xMax=K>q?q:K;let J=t.yMax,$=h.yMax;t.yMax=J>$?$:J}drawFilters(e){if(!e.pushFilter(this))return;let t=e.tmpBounds,s=new Rr,r=-1;this.filter.sync(e,this),this.filter.autoBounds?r=this.filter.boundsExtend:(this.filter.getBounds(this,t),t.xMin<s.xMin&&(s.xMin=t.xMin),t.xMax>s.xMax&&(s.xMax=t.xMax),t.yMin<s.yMin&&(s.yMin=t.yMin),t.yMax>s.yMax&&(s.yMax=t.yMax)),r>=0&&(this.getBounds(this,t),t.xMin-=r,t.yMin-=r,t.xMax+=r,t.yMax+=r,t.xMin<s.xMin&&(s.xMin=t.xMin),t.xMax>s.xMax&&(s.xMax=t.xMax),t.yMin<s.yMin&&(s.yMin=t.yMin),t.yMax>s.yMax&&(s.yMax=t.yMax)),this.clipBounds(e,s);let n=Math.floor(s.xMin+1e-10),i=Math.floor(s.yMin+1e-10),a=Math.ceil(s.xMax-n-1e-10),l=Math.ceil(s.yMax-i-1e-10);if(a<=0||l<=0||s.xMax<s.xMin)return void e.popFilter();let h=e.textures.allocTarget("filterTemp",a,l,!1);e.pushTarget(h,n,i,a,l),e.engine.clear(0);let o=e.globalAlpha,_=e.baseShader,c=_.filterMatrixA__,u=c.x,d=c.y,p=c.z,f=c.w;null==f&&(f=1),null==p&&(p=0),null==d&&(d=0),null==u&&(u=0);let x=u,g=d,b=p,m=f,A=_.filterMatrixB__,w=A.x,y=A.y,k=A.z,B=A.w;null==B&&(B=1),null==k&&(k=0),null==y&&(y=0),null==w&&(w=0);let C=w,v=y,S=k,M=B,I=(e.inFilter,1/(this.matA*this.matD-this.matB*this.matC)),T=this.matD*I,F=-this.matB*I,E=-this.matC*I,D=this.matA*I,R=-(this.absX*T+this.absY*E),V=-(this.absX*F+this.absY*D),O=_.filterMatrixA__,P=T,Q=E,L=R;null==L&&(L=0),null==Q&&(Q=0),null==P&&(P=0),O.x=P,O.y=Q,O.z=L,O.w=1;let G=_.filterMatrixB__,z=F,U=D,W=V;null==W&&(W=0),null==U&&(U=0),null==z&&(z=0),G.x=z,G.y=U,G.z=W,G.w=1,e.globalAlpha=1,this.draw(e);let N=0,j=this.children;for(;N<j.length;){let t=j[N];++N,t.drawRec(e)}let Y=Dr.fromTexture(h);Y.dx=n,Y.dy=i;let X=Y;Y=this.filter.draw(e,Y),Y!=X&&null!=Y&&(Y.dx+=n,Y.dy+=i);let Z=_.filterMatrixA__;Z.x=x,Z.y=g,Z.z=b,Z.w=m;let H=_.filterMatrixB__;H.x=C,H.y=v,H.z=S,H.w=M,e.popTarget(),e.popFilter(),e.globalAlpha=o,null!=Y&&this.drawFiltered(e,Y)}drawFiltered(e,t){let s=e.globalAlpha;e.currentBlend=null,e.inFilterBlend=this.blendMode,e.globalAlpha*=this.alpha,this.emitTile(e,t),e.globalAlpha=s,e.inFilterBlend=null,e.currentBlend=null}drawRec(e){if(this.visible){if(this.posChanged){this.calcAbsPos();let e=0,t=this.children;for(;e<t.length;){let s=t[e];++e,s.posChanged=!0}this.posChanged=!1}if(null!=this.filter&&this.filter.get_enable())this.drawFilters(e);else{let t=e.globalAlpha;if(e.globalAlpha*=this.alpha,e.front2back){let t=this.children.length,s=0,r=t;for(;s<r;){let r=s++;this.children[t-1-r].drawRec(e)}this.draw(e)}else{this.draw(e);let t=0,s=this.children;for(;t<s.length;){let r=s[t];++t,r.drawRec(e)}}e.globalAlpha=t}}}contentChanged(e){}}s["h2d.Object"]=gr,gr.__name__="h2d.Object",Object.assign(gr.prototype,{__class__:gr});class br extends gr{_hx_constructor(e){super._hx_constructor(e),this.color=new Xr(1,1,1,1)}drawFiltered(e,t){let s=this.shaders;this.shaders=null,super.drawFiltered(e,t),this.shaders=s}emitTile(e,t){null==t&&(t=new Dr(null,0,0,5,5)),e.drawTile(this,t)}}s["h2d.Drawable"]=br,br.__name__="h2d.Drawable",br.__super__=gr,Object.assign(br.prototype,{__class__:br});class mr extends br{constructor(e,t){super(t),this.set_tile(e)}getBoundsRec(e,t,s){super.getBoundsRec(e,t,s),null!=this.tile&&(null==this.width&&null==this.height?this.addBounds(e,t,this.tile.dx,this.tile.dy,this.tile.width,this.tile.height):this.addBounds(e,t,this.tile.dx,this.tile.dy,null!=this.width?this.width:this.tile.width*this.height/this.tile.height,null!=this.height?this.height:this.tile.height*this.width/this.tile.width))}set_tile(e){return this.tile==e||(this.tile=e,null!=this.parentContainer&&this.parentContainer.contentChanged(this)),e}draw(e){if(null==this.width&&null==this.height)return void this.emitTile(e,this.tile);null==this.tile&&this.set_tile(Dr.fromColor(16711935));let t=this.tile.width,s=this.tile.height;this.tile.width=null!=this.width?this.width:t*this.height/s,this.tile.height=null!=this.height?this.height:s*this.width/t,this.emitTile(e,this.tile),this.tile.width=t,this.tile.height=s}}s["h2d.Bitmap"]=mr,mr.__name__="h2d.Bitmap",mr.__super__=br,Object.assign(mr.prototype,{__class__:mr});var Ar=n["h2d.BlendMode"]={__ename__:"h2d.BlendMode",__constructs__:["None","Alpha","Add","AlphaAdd","SoftAdd","Multiply","AlphaMultiply","Erase","Screen","Sub","Max","Min"],None:{_hx_index:0,__enum__:"h2d.BlendMode",toString:r},Alpha:{_hx_index:1,__enum__:"h2d.BlendMode",toString:r},Add:{_hx_index:2,__enum__:"h2d.BlendMode",toString:r},AlphaAdd:{_hx_index:3,__enum__:"h2d.BlendMode",toString:r},SoftAdd:{_hx_index:4,__enum__:"h2d.BlendMode",toString:r},Multiply:{_hx_index:5,__enum__:"h2d.BlendMode",toString:r},AlphaMultiply:{_hx_index:6,__enum__:"h2d.BlendMode",toString:r},Erase:{_hx_index:7,__enum__:"h2d.BlendMode",toString:r},Screen:{_hx_index:8,__enum__:"h2d.BlendMode",toString:r},Sub:{_hx_index:9,__enum__:"h2d.BlendMode",toString:r},Max:{_hx_index:10,__enum__:"h2d.BlendMode",toString:r},Min:{_hx_index:11,__enum__:"h2d.BlendMode",toString:r}};Ar.__empty_constructs__=[Ar.None,Ar.Alpha,Ar.Add,Ar.AlphaAdd,Ar.SoftAdd,Ar.Multiply,Ar.AlphaMultiply,Ar.Erase,Ar.Screen,Ar.Sub,Ar.Max,Ar.Min];class wr{}s["hxd.Interactive"]=wr,wr.__name__="hxd.Interactive",wr.__isInterface__=!0,Object.assign(wr.prototype,{__class__:wr});class yr extends br{constructor(e,t,s,r){gr._hx_skip_constructor=!0,super(),gr._hx_skip_constructor=!1,this._hx_constructor(e,t,s,r)}_hx_constructor(e,t,s,r){this.shapeY=0,this.shapeX=0,this.mouseDownButton=-1,this.propagateEvents=!1,this.cancelEvents=!1,super._hx_constructor(s),this.width=e,this.height=t,this.shape=r,this.set_cursor(Ya.Button)}onAdd(){this.scene=this.getScene(),null!=this.scene&&this.scene.addEventTarget(this),this.updateMask(),super.onAdd()}draw(e){null!=this.backgroundColor&&this.emitTile(e,Dr.fromColor(this.backgroundColor,0|this.width,0|this.height,(this.backgroundColor>>>24)/255))}getBoundsRec(e,t,s){super.getBoundsRec(e,t,s),(null!=this.backgroundColor||s)&&this.addBounds(e,t,0,0,0|this.width,0|this.height)}onHierarchyMoved(e){super.onHierarchyMoved(e),null!=this.scene&&(this.scene.removeEventTarget(this),this.scene.addEventTarget(this)),e&&this.updateMask()}updateMask(){this.parentMask=null;let e=this.parent;for(;null!=e;){let t=e instanceof Br?e:null;if(null!=t){this.parentMask=t;break}e=e.parent}}onRemove(){null!=this.scene&&(this.scene.removeEventTarget(this,!0),this.scene=null),super.onRemove()}checkBounds(e){switch(e.kind._hx_index){case 4:case 6:case 7:case 10:return!1;default:return!0}}getInteractiveScene(){return this.scene}handleEvent(e){if(null!=this.parentMask&&this.checkBounds(e)){let t=this.parentMask,s=new Pr(e.relX,e.relY);this.localToGlobal(s);let r=s.x,n=s.y;for(;null!=t;){s.x=r,s.y=n;let i=t.globalToLocal(s);if(i.x<0||i.y<0||i.x>t.width||i.y>t.height)return void(e.cancel=!0);t=t.parentMask}}if(null==this.shape&&this.isEllipse&&this.checkBounds(e)){let t=.5*this.width,s=.5*this.height,r=(e.relX-t)/t,n=(e.relY-s)/s;if(r*r+n*n>1)return void(e.cancel=!0)}switch(this.propagateEvents&&(e.propagate=!0),this.cancelEvents&&(e.cancel=!0),e.kind._hx_index){case 0:(this.enableRightButton||0==e.button)&&(this.mouseDownButton=e.button,this.onPush(e));break;case 1:(this.enableRightButton||0==e.button)&&(this.onRelease(e),this.mouseDownButton==e.button&&this.onClick(e)),this.mouseDownButton=-1;break;case 2:this.onMove(e);break;case 3:this.onOver(e);break;case 4:this.onOut(e);break;case 5:this.onWheel(e);break;case 6:this.onFocus(e);break;case 7:this.onFocusLost(e);break;case 8:this.onKeyDown(e);break;case 9:this.onKeyUp(e);break;case 10:(this.enableRightButton||0==e.button)&&(this.onRelease(e),this.mouseDownButton==e.button&&this.onReleaseOutside(e)),this.mouseDownButton=-1;break;case 11:this.onTextInput(e);break;case 12:this.onCheck(e)}}calcAbsPos(){super.calcAbsPos(),this.invDet=1/(this.matA*this.matD-this.matB*this.matC)}set_cursor(e){return this.cursor=e,null!=this.scene&&null!=this.scene.events&&this.scene.events.updateCursor(this),e}onOver(e){}onOut(e){}onPush(e){}onRelease(e){}onReleaseOutside(e){}onClick(e){}onMove(e){}onWheel(e){}onFocus(e){}onFocusLost(e){}onKeyUp(e){}onKeyDown(e){}onCheck(e){}onTextInput(e){}}s["h2d.Interactive"]=yr,yr.__name__="h2d.Interactive",yr.__interfaces__=[wr],yr.__super__=br,Object.assign(yr.prototype,{__class__:yr});class kr extends gr{_hx_constructor(e){super._hx_constructor(e),this.layersIndexes=[],this.layerCount=0}addChild(e){this.addChildAt(e,0)}addChildAt(e,t){if(e.parent==this){let t=e.allocated;e.allocated=!1,this.removeChild(e),e.allocated=t}for(;t>=this.layerCount;)this.layersIndexes[this.layerCount++]=this.children.length;super.addChildAt(e,this.layersIndexes[t]);let s=t,r=this.layerCount;for(;s<r;){let e=s++;this.layersIndexes[e]++}}removeChild(e){let t=0,s=this.children.length;for(;t<s;){let s=t++;if(this.children[s]==e){this.children.splice(s,1),e.allocated&&e.onRemove(),e.parent=null,e.posChanged=!0,null!=e.parentContainer&&e.setParentContainer(null);let t=this.layerCount-1;for(;t>=0&&this.layersIndexes[t]>s;)this.layersIndexes[t]--,--t;null!=this.parentContainer&&this.parentContainer.contentChanged(this);break}}}}s["h2d.Layers"]=kr,kr.__name__="h2d.Layers",kr.__super__=gr,Object.assign(kr.prototype,{__class__:kr});class Br extends gr{constructor(e,t,s){gr._hx_skip_constructor=!0,super(),gr._hx_skip_constructor=!1,this._hx_constructor(e,t,s)}_hx_constructor(e,t,s){this.scrollY=0,this.scrollX=0,super._hx_constructor(s),this.width=e,this.height=t}onHierarchyMoved(e){super.onHierarchyMoved(e),e&&this.updateMask()}onAdd(){super.onAdd(),this.updateMask()}updateMask(){this.parentMask=null;let e=this.parent;for(;null!=e;){let t=e instanceof Br?e:null;if(null!=t){this.parentMask=t;break}e=e.parent}}calcAbsPos(){super.calcAbsPos(),this.absX-=this.scrollX,this.absY-=this.scrollY}getBoundsRec(e,t,s){let r=t.xMin,n=t.yMin,i=t.xMax,a=t.yMax;if(t.xMin=1e20,t.yMin=1e20,t.xMax=-1e20,t.yMax=-1e20,this.posChanged){this.calcAbsPos();let e=0,t=this.children;for(;e<t.length;){let s=t[e];++e,s.posChanged=!0}this.posChanged=!1}this.addBounds(e,t,0,0,this.width,this.height);let l=t.xMin,h=t.yMin,o=t.xMax,_=t.yMax;t.xMin=r,t.xMax=i,t.yMin=n,t.yMax=a,super.getBoundsRec(e,t,s),t.xMin<l&&(t.xMin=r>l?l:r),t.yMin<h&&(t.yMin=n>h?h:n),t.xMax>o&&(t.xMax=i<o?o:i),t.yMax>_&&(t.yMax=a<_?_:a)}drawRec(e){let t,s=this.absX+this.scrollX,r=this.absY+this.scrollY,n=this.width*this.matA+this.height*this.matC+s,i=this.width*this.matB+this.height*this.matD+r;if(s>n&&(t=s,s=n,n=t),r>i&&(t=r,r=i,i=t),e.hasRenderZone){let t=e.renderX,a=e.renderY,l=e.renderW,h=e.renderH;e.setRenderZone(s,r,n-s,i-r),super.drawRec(e),e.setRenderZone(t,a,l,h)}else e.setRenderZone(s,r,n-s,i-r),super.drawRec(e),e.hasRenderZone=!1,e.engine.setRenderZone()}}s["h2d.Mask"]=Br,Br.__name__="h2d.Mask",Br.__super__=gr,Object.assign(Br.prototype,{__class__:Br});class Cr{constructor(){Cr._hx_skip_constructor||this._hx_constructor()}_hx_constructor(){this.engine=Wr.CURRENT,this.frame=0,this.time=0,this.elapsedTime=1/al.getDefaultFrameRate(),this.textures=new xn(this)}dispose(){this.textures.dispose()}}s["h3d.impl.RenderContext"]=Cr,Cr.__name__="h3d.impl.RenderContext",Object.assign(Cr.prototype,{__class__:Cr});class vr extends Cr{constructor(e){Cr._hx_skip_constructor=!0,super(),Cr._hx_skip_constructor=!1,this._hx_constructor(e)}_hx_constructor(e){this.tmpBounds=new Rr,this.defaultSmooth=!1,this.globalAlpha=1,super._hx_constructor(),this.scene=e,this.bufPos=0,this.manager=new ni,this.pass=new Rn("",null),this.pass.depth(!0,wn.Always),this.pass.set_culling(mn.None),this.baseShader=new vi,this.baseShader.setPriority(100),this.baseShader.zValue__=0,this.baseShaderList=new Vh(this.baseShader),this.targetsStack=[],this.targetsStackIndex=0,this.filterStack=[]}dispose(){super.dispose(),null!=this.fixedBuffer&&this.fixedBuffer.dispose()}begin(){this.texture=null,this.currentObj=null,this.bufPos=0,this.stride=0,this.curX=0,this.curY=0,this.targetFlipY=this.engine.driver.hasFeature(rn.BottomLeftCoords)?-1:1,this.baseFlipY=null!=this.engine.getCurrentTarget()?this.targetFlipY:1,this.inFilter=null,this.curWidth=this.scene.width,this.curHeight=this.scene.height,this.manager.globals.set("time",this.time);let e=this.baseShader;e.constModified=!0,e.pixelAlign__=!1;let t=this.baseShader.halfPixelInverse__,s=.5/this.engine.width,r=.5/this.engine.height;null==r&&(r=0),null==s&&(s=0),t.x=s,t.y=r,t.z=0,t.w=1;let n=this.baseShader.viewport__,i=.5*-this.scene.width-this.scene.offsetX,a=.5*-this.scene.height-this.scene.offsetY,l=2/this.scene.width*this.scene.ratioX,h=-2*this.baseFlipY/this.scene.height*this.scene.ratioY;null==h&&(h=1),null==l&&(l=0),null==a&&(a=0),null==i&&(i=0),n.x=i,n.y=a,n.z=l,n.w=h;let o=this.baseShader.filterMatrixA__,_=1,c=0,u=0;null==u&&(u=0),null==c&&(c=0),null==_&&(_=0),o.x=_,o.y=c,o.z=u,o.w=1;let d=this.baseShader.filterMatrixB__,p=0,f=1,x=0;null==x&&(x=0),null==f&&(f=0),null==p&&(p=0),d.x=p,d.y=f,d.z=x,d.w=1,this.baseShaderList.next=null,this.initShaders(this.baseShaderList),this.engine.selectMaterial(this.pass),this.textures.begin()}initShaders(e){if(this.currentShaders=e,this.compiledShader=this.manager.compileShaders(e),null==this.buffers)this.buffers=new Ti(this.compiledShader);else{let e=this.buffers,t=this.compiledShader;e.vertex.grow(t.vertex),e.fragment.grow(t.fragment)}this.manager.fillGlobals(this.buffers,this.compiledShader),this.engine.selectShader(this.compiledShader),this.engine.uploadShaderBuffers(this.buffers,0)}end(){if(this.texture=null,this.currentObj=null,this.baseShaderList.next=null,0!=this.targetsStackIndex)throw $i.thrown("Missing popTarget()")}pushFilter(e){return!(0==this.filterStack.length&&null!=this.onEnterFilter&&!this.onEnterFilter(e))&&(this.filterStack.push(e),this.inFilter=e,!0)}popFilter(){let e=this.filterStack.pop();this.filterStack.length>0?this.inFilter=this.filterStack[this.filterStack.length-1]:(this.inFilter=null,null!=this.onLeaveFilter&&this.onLeaveFilter(e))}pushTarget(e,t,s,r,n){null==n&&(n=-1),null==r&&(r=-1),null==s&&(s=0),null==t&&(t=0),this.engine.pushTarget(e),this.initShaders(this.baseShaderList),r<0&&(r=null==e?this.scene.width:e.width),n<0&&(n=null==e?this.scene.height:e.height);let i=this.baseShader.halfPixelInverse__,a=.5/(null==e?this.engine.width:e.width),l=.5/(null==e?this.engine.height:e.height);null==l&&(l=0),null==a&&(a=0),i.x=a,i.y=l,i.z=0,i.w=1;let h=this.baseShader.viewport__,o=.5*-r-t,_=.5*-n-s,c=2/r,u=-2*this.targetFlipY/n;if(null==u&&(u=1),null==c&&(c=0),null==_&&(_=0),null==o&&(o=0),h.x=o,h.y=_,h.z=c,h.w=u,this.targetsStackIndex++,this.targetsStackIndex>this.targetsStack.length)this.targetsStack.push({t:e,x:t,y:s,w:r,h:n,hasRZ:this.hasRenderZone,rzX:this.renderX,rzY:this.renderY,rzW:this.renderW,rzH:this.renderH});else{let i=this.targetsStack[this.targetsStackIndex-1];i.t=e,i.x=t,i.y=s,i.w=r,i.h=n,i.hasRZ=this.hasRenderZone,i.rzX=this.renderX,i.rzY=this.renderY,i.rzW=this.renderW,i.rzH=this.renderH}this.curX=t,this.curY=s,this.curWidth=r,this.curHeight=n,this.currentBlend=null,this.hasRenderZone&&(this.hasRenderZone=!1,this.engine.setRenderZone())}popTarget(e){if(null==e&&(e=!0),this.targetsStackIndex<=0)throw $i.thrown("Too many popTarget()");let t=this.targetsStack[--this.targetsStackIndex];if(this.engine.popTarget(),e){let e,t,s,r,n,i,a,l,h,o=this.targetsStack[this.targetsStackIndex-1];null==o?(e=null,t=0,s=0,r=this.scene.width,n=this.scene.height,i=this.scene.ratioX,a=this.scene.ratioY,l=this.scene.offsetX,h=this.scene.offsetY):(e=o.t,t=o.x,s=o.y,r=o.w,n=o.h,i=1,a=1,l=0,h=0),this.initShaders(this.baseShaderList);let _=this.baseShader.halfPixelInverse__,c=.5/(null==e?this.engine.width:e.width),u=.5/(null==e?this.engine.height:e.height);null==u&&(u=0),null==c&&(c=0),_.x=c,_.y=u,_.z=0,_.w=1;let d=this.baseShader.viewport__,p=.5*-r-t-l,f=.5*-n-s-h,x=2/r*i,g=-2*(null==e?this.baseFlipY:this.targetFlipY)/n*a;null==g&&(g=1),null==x&&(x=0),null==f&&(f=0),null==p&&(p=0),d.x=p,d.y=f,d.z=x,d.w=g,this.curX=t,this.curY=s,this.curWidth=r,this.curHeight=n}t.hasRZ&&this.setRenderZone(t.rzX,t.rzY,t.rzW,t.rzH)}setRenderZone(e,t,s,r){this.hasRenderZone=!0,this.renderX=e,this.renderY=t,this.renderW=s,this.renderH=r;let n=this.engine.width*this.scene.ratioX/this.scene.width,i=this.engine.height*this.scene.ratioY/this.scene.height;if(null!=this.inFilter){let n=this.baseShader.filterMatrixA__,i=this.baseShader.filterMatrixB__,a=e+s,l=t+r,h=e*n.x+t*n.y+n.z,o=e*i.x+t*i.y+i.z;e=h,t=o,s=a*n.x+l*n.y+n.z-h,r=a*i.x+l*i.y+i.z-o}this.engine.setRenderZone((e-this.curX+this.scene.viewportX)*n+1e-10|0,(t-this.curY+this.scene.viewportY)*i+1e-10|0,s*n+1e-10|0,r*i+1e-10|0)}drawScene(){this.scene.drawRec(this)}beforeDraw(){null==this.texture&&(this.texture=Pn.fromColor(16711935)),this.baseShader.texture__=this.texture,this.texture.set_filter((null==this.currentObj.smooth?this.defaultSmooth:this.currentObj.smooth)?Bn.Linear:Bn.Nearest),this.texture.set_wrap(!this.currentObj.tileWrap||null!=this.currentObj.filter&&null==this.inFilter?Cn.Clamp:Cn.Repeat);let e=this.currentObj.blendMode;this.inFilter==this.currentObj&&e==Ar.Erase&&(e=Ar.Add),null!=this.inFilterBlend&&(e=this.inFilterBlend),e!=this.currentBlend&&(this.currentBlend=e,this.pass.setBlendMode(e),e!=Ar.Alpha&&e!=Ar.Add||(this.pass.set_blendAlphaSrc(An.One),null!=this.inFilterBlend&&this.pass.set_blendSrc(An.One))),this.manager.fillParams(this.buffers,this.compiledShader,this.currentShaders),this.engine.selectMaterial(this.pass),this.engine.uploadShaderBuffers(this.buffers,1),this.engine.uploadShaderBuffers(this.buffers,2),this.engine.uploadShaderBuffers(this.buffers,3)}beginDrawObject(e,t){if(!this.beginDraw(e,t,!0))return!1;if(this.inFilter==e){let t=this.baseShader.color__,s=e.color.x,r=e.color.y,n=e.color.z,i=e.color.w;null==i&&(i=1),null==n&&(n=0),null==r&&(r=0),null==s&&(s=0),t.x=s,t.y=r,t.z=n,t.w=i}else if(null!=this.inFilterBlend){let e=this.baseShader.color__,t=this.globalAlpha,s=this.globalAlpha,r=this.globalAlpha,n=this.globalAlpha;null==n&&(n=1),null==r&&(r=0),null==s&&(s=0),null==t&&(t=0),e.x=t,e.y=s,e.z=r,e.w=n}else{let t=this.baseShader.color__,s=e.color.x,r=e.color.y,n=e.color.z,i=e.color.w*this.globalAlpha;null==i&&(i=1),null==n&&(n=0),null==r&&(r=0),null==s&&(s=0),t.x=s,t.y=r,t.z=n,t.w=i}let s=this.baseShader.absoluteMatrixA__,r=e.matA,n=e.matC,i=e.absX;null==i&&(i=0),null==n&&(n=0),null==r&&(r=0),s.x=r,s.y=n,s.z=i,s.w=1;let a=this.baseShader.absoluteMatrixB__,l=e.matB,h=e.matD,o=e.absY;return null==o&&(o=0),null==h&&(h=0),null==l&&(l=0),a.x=l,a.y=h,a.z=o,a.w=1,this.beforeDraw(),!0}drawTile(e,t){let s,r,n,i,a,l;if(null!=this.inFilter){let t=this.baseShader.filterMatrixA__,h=this.baseShader.filterMatrixB__;s=e.matA*t.x+e.matB*t.y,r=e.matA*h.x+e.matB*h.y,n=e.matC*t.x+e.matD*t.y,i=e.matC*h.x+e.matD*h.y,a=e.absX*t.x+e.absY*t.y+t.z,l=e.absX*h.x+e.absY*h.y+h.z}else s=e.matA,r=e.matB,n=e.matC,i=e.matD,a=e.absX,l=e.absY;if(0==r&&0==n){let r=t.dx+.5*t.width,n=t.dy+.5*t.height,h=e.matA,o=h<0?-h:h,_=e.matD,c=_<0?-_:_,u=1.5*(t.width>t.height?t.width:t.height)*(o<c?c:o),d=a+r*s-this.curX,p=l+n*i-this.curY;if(d<-u||p<-u||d-u>this.curWidth||p-u>this.curHeight)return!1}else{let e=1e20,h=1e20,o=-1e20,_=-1e20,c=(t.width,t.height,t.dx*s+t.dy*n),u=t.dx*r+t.dy*i;c<e&&(e=c),c>o&&(o=c),u<h&&(h=u),u>_&&(_=u);let d=t.width,p=(d+t.dx)*s+t.dy*n,f=(d+t.dx)*r+t.dy*i;p<e&&(e=p),p>o&&(o=p),f<h&&(h=f),f>_&&(_=f);let x=t.height,g=t.dx*s+(x+t.dy)*n,b=t.dx*r+(x+t.dy)*i;g<e&&(e=g),g>o&&(o=g),b<h&&(h=b),b>_&&(_=b);let m=t.width,A=t.height,w=(m+t.dx)*s+(A+t.dy)*n,y=(m+t.dx)*r+(A+t.dy)*i;w<e&&(e=w),w>o&&(o=w),y<h&&(h=y),y>_&&(_=y);let k=a-this.curX,B=l-this.curY;if(k+o<0||B+_<0||k+e>this.curWidth||B+h>this.curHeight)return!1}if(!this.beginDraw(e,t.innerTex,!0,!0))return!1;if(this.inFilter==e){let t=this.baseShader.color__,s=e.color.x,r=e.color.y,n=e.color.z,i=e.color.w;null==i&&(i=1),null==n&&(n=0),null==r&&(r=0),null==s&&(s=0),t.x=s,t.y=r,t.z=n,t.w=i}else if(null!=this.inFilterBlend){let e=this.baseShader.color__,t=this.globalAlpha,s=this.globalAlpha,r=this.globalAlpha,n=this.globalAlpha;null==n&&(n=1),null==r&&(r=0),null==s&&(s=0),null==t&&(t=0),e.x=t,e.y=s,e.z=r,e.w=n}else{let t=this.baseShader.color__,s=e.color.x,r=e.color.y,n=e.color.z,i=e.color.w*this.globalAlpha;null==i&&(i=1),null==n&&(n=0),null==r&&(r=0),null==s&&(s=0),t.x=s,t.y=r,t.z=n,t.w=i}let h=this.baseShader.absoluteMatrixA__,o=t.width*e.matA,_=t.height*e.matC,c=e.absX+t.dx*e.matA+t.dy*e.matC;null==c&&(c=0),null==_&&(_=0),null==o&&(o=0),h.x=o,h.y=_,h.z=c,h.w=1;let u=this.baseShader.absoluteMatrixB__,d=t.width*e.matB,p=t.height*e.matD,f=e.absY+t.dx*e.matB+t.dy*e.matD;null==f&&(f=0),null==p&&(p=0),null==d&&(d=0),u.x=d,u.y=p,u.z=f,u.w=1;let x=this.baseShader.uvPos__,g=t.u,b=t.v,m=t.u2-t.u,A=t.v2-t.v;if(null==A&&(A=1),null==m&&(m=0),null==b&&(b=0),null==g&&(g=0),x.x=g,x.y=b,x.z=m,x.w=A,this.beforeDraw(),null==this.fixedBuffer||this.fixedBuffer.isDisposed()){this.fixedBuffer=new Gr(4,8,[Lr.Quads,Lr.RawFormat]);let e=Ka._new(0),t=0;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=t;let s=0;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=s;let r=0;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=r;let n=0;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=n;let i=1;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=i;let a=1;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=a;let l=1;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=l;let h=1;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=h;let o=0;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=o;let _=1;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=_;let c=0;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=c;let u=1;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=u;let d=1;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=d;let p=1;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=p;let f=1;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=f;let x=1;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=x;let g=1;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=g;let b=0;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=b;let m=1;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=m;let A=0;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=A;let w=1;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=w;let y=1;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=y;let k=1;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=k;let B=1;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=B;let C=1;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=C;let v=1;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=v;let S=1;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=S;let M=1;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=M;let I=1;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=I;let T=1;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=T;let F=1;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=F;let E=1;if(e.pos==e.array.length){let t=e.array.length<<1;t<128&&(t=128);let s=new Float32Array(t);s.set(e.array),e.array=s}e.array[e.pos++]=E,this.fixedBuffer.uploadVector(e,0,4)}let w=this.engine;return w.renderBuffer(this.fixedBuffer,w.mem.quadIndexes,2,0,-1),!0}beginDraw(e,t,s,r){if(null==r&&(r=!1),null!=this.onBeginDraw&&!this.onBeginDraw(e))return!1;let n=!1,i=!1,a=e.shaders,l=this.currentShaders.next;for(;null!=a&&null!=l;){let e=a.s,t=l.s;a=a.next,l=l.next;let s=t.instance;e!=t&&(i=!0),e.updateConstants(this.manager.globals),e.instance!=s&&(n=!0)}if(null==a&&null==l&&this.baseShader.isRelative__==s&&this.baseShader.hasUVPos__==r&&this.baseShader.killAlpha__==this.killAlpha||(n=!0),n){let t=this.baseShader;t.constModified=!0,t.hasUVPos__=r;let n=this.baseShader;n.constModified=!0,n.isRelative__=s;let i=this.baseShader;i.constModified=!0,i.killAlpha__=this.killAlpha,this.baseShader.updateConstants(this.manager.globals),this.baseShaderList.next=e.shaders,this.initShaders(this.baseShaderList)}else if(i){if(this.currentShaders!=this.baseShaderList)throw $i.thrown("!");this.currentShaders.next=e.shaders}return this.texture=t,this.stride=8,this.currentObj=e,!0}}s["h2d.RenderContext"]=vr,vr.__name__="h2d.RenderContext",vr.__super__=Cr,Object.assign(vr.prototype,{__class__:vr});var Sr=n["h2d.ScaleModeAlign"]={__ename__:"h2d.ScaleModeAlign",__constructs__:["Left","Right","Center","Top","Bottom"],Left:{_hx_index:0,__enum__:"h2d.ScaleModeAlign",toString:r},Right:{_hx_index:1,__enum__:"h2d.ScaleModeAlign",toString:r},Center:{_hx_index:2,__enum__:"h2d.ScaleModeAlign",toString:r},Top:{_hx_index:3,__enum__:"h2d.ScaleModeAlign",toString:r},Bottom:{_hx_index:4,__enum__:"h2d.ScaleModeAlign",toString:r}};Sr.__empty_constructs__=[Sr.Left,Sr.Right,Sr.Center,Sr.Top,Sr.Bottom];var Mr=n["h2d.ScaleMode"]={__ename__:"h2d.ScaleMode",__constructs__:["Resize","Stretch","LetterBox","Fixed","Zoom","AutoZoom"],Resize:{_hx_index:0,__enum__:"h2d.ScaleMode",toString:r},Stretch:(t=function(e,t){return{_hx_index:1,width:e,height:t,__enum__:"h2d.ScaleMode",toString:r}},t.__params__=["width","height"],t),LetterBox:(t=function(e,t,s,n,i){return{_hx_index:2,width:e,height:t,integerScale:s,horizontalAlign:n,verticalAlign:i,__enum__:"h2d.ScaleMode",toString:r}},t.__params__=["width","height","integerScale","horizontalAlign","verticalAlign"],t),Fixed:(t=function(e,t,s,n,i){return{_hx_index:3,width:e,height:t,zoom:s,horizontalAlign:n,verticalAlign:i,__enum__:"h2d.ScaleMode",toString:r}},t.__params__=["width","height","zoom","horizontalAlign","verticalAlign"],t),Zoom:(t=function(e){return{_hx_index:4,level:e,__enum__:"h2d.ScaleMode",toString:r}},t.__params__=["level"],t),AutoZoom:(t=function(e,t,s){return{_hx_index:5,minWidth:e,minHeight:t,integerScaling:s,__enum__:"h2d.ScaleMode",toString:r}},t.__params__=["minWidth","minHeight","integerScaling"],t)};Mr.__empty_constructs__=[Mr.Resize];class Ir{}s["hxd.InteractiveScene"]=Ir,Ir.__name__="hxd.InteractiveScene",Ir.__isInterface__=!0,Object.assign(Ir.prototype,{__class__:Ir});class Tr extends kr{constructor(){gr._hx_skip_constructor=!0,super(),gr._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.scaleMode=Mr.Resize,super._hx_constructor(null);let e=Wr.CURRENT;this.ctx=new vr(this),this.width=e.width,this.height=e.height,this.offsetX=0,this.offsetY=0,this.ratioX=1,this.ratioY=1,this.viewportX=0,this.viewportY=0,this.interactive=[],this.eventListeners=[],this.shapePoint=new Pr,this.window=il.getInstance(),this.posChanged=!0}setEvents(e){this.events=e}set_scaleMode(e){return this.scaleMode=e,this.checkResize(),e}checkResize(){let e=Wr.CURRENT,t=this,s=this.scaleMode;switch(s._hx_index){case 0:let r=e.width,n=e.height;r==t.width&&n==t.height||(t.width=r,t.height=n,t.posChanged=!0),this.ratioX=1,this.ratioY=1,t.offsetX=0,t.offsetY=0,t.viewportX=0,t.viewportY=0;break;case 1:let i=s.height,a=s.width;a==t.width&&i==t.height||(t.width=a,t.height=i,t.posChanged=!0),this.ratioX=1,this.ratioY=1,t.offsetX=0,t.offsetY=0,t.viewportX=0,t.viewportY=0;break;case 2:let l=s.verticalAlign,h=s.horizontalAlign,o=s.integerScale,_=s.height,c=s.width;c==t.width&&_==t.height||(t.width=c,t.height=_,t.posChanged=!0);let u=e.width/c,d=e.height/_,p=u>d?d:u;o&&(p|=0,0==p&&(p=1)),t.ratioX=t.width*p/e.width,t.ratioY=t.height*p/e.height;let f=h,x=l;switch(null==f&&(f=Sr.Center),f._hx_index){case 0:t.offsetX=(e.width-t.width*p)/(2*p),t.viewportX=0;break;case 1:t.offsetX=-(e.width-t.width*p)/(2*p),t.viewportX=(e.width-t.width*p)/p;break;default:t.offsetX=-(e.width-t.width*p)/2%1*.5,t.viewportX=(e.width-t.width*p)/(2*p)}switch(null==x&&(x=Sr.Center),x._hx_index){case 3:t.offsetY=(e.height-t.height*p)/(2*p),t.viewportY=0;break;case 4:t.offsetY=-(e.height-t.height*p)/(2*p),t.viewportY=(e.height-t.height*p)/p;break;default:t.offsetY=-(e.height-t.height*p)/2%1*.5,t.viewportY=(e.height-t.height*p)/(2*p)}break;case 3:let g=s.verticalAlign,b=s.horizontalAlign,m=s.zoom,A=s.height,w=s.width;w==t.width&&A==t.height||(t.width=w,t.height=A,t.posChanged=!0),t.ratioX=t.width*m/e.width,t.ratioY=t.height*m/e.height;let y=b,k=g;switch(null==y&&(y=Sr.Center),y._hx_index){case 0:t.offsetX=(e.width-t.width*m)/(2*m),t.viewportX=0;break;case 1:t.offsetX=-(e.width-t.width*m)/(2*m),t.viewportX=(e.width-t.width*m)/m;break;default:t.offsetX=-(e.width-t.width*m)/2%1*.5,t.viewportX=(e.width-t.width*m)/(2*m)}switch(null==k&&(k=Sr.Center),k._hx_index){case 3:t.offsetY=(e.height-t.height*m)/(2*m),t.viewportY=0;break;case 4:t.offsetY=-(e.height-t.height*m)/(2*m),t.viewportY=(e.height-t.height*m)/m;break;default:t.offsetY=-(e.height-t.height*m)/2%1*.5,t.viewportY=(e.height-t.height*m)/(2*m)}break;case 4:let B=s.level,C=Math.ceil(e.width/B),v=Math.ceil(e.height/B);C==t.width&&v==t.height||(t.width=C,t.height=v,t.posChanged=!0),t.ratioX=t.width*B/e.width,t.ratioY=t.height*B/e.height,t.offsetX=0,t.offsetY=0,t.viewportX=0,t.viewportY=0;break;case 5:let S=s.integerScaling,M=s.minHeight,I=s.minWidth,T=e.width/I,F=e.height/M,E=T>F?F:T;S&&(E|=0,0==E&&(E=1));let D=Math.ceil(e.width/E),R=Math.ceil(e.height/E);D==t.width&&R==t.height||(t.width=D,t.height=R,t.posChanged=!0),t.ratioX=t.width*E/e.width,t.ratioY=t.height*E/e.height,t.offsetX=0,t.offsetY=0,t.viewportX=0,t.viewportY=0}}dispatchListeners(e){this.screenToViewport(e);let t=0,s=this.eventListeners;for(;t<s.length;){let r=s[t];if(++t,r(e),!e.propagate)break}}isInteractiveVisible(e){let t=e;for(;t!=this;){if(null==t||!t.visible)return!1;t=t.parent}return!0}screenToViewport(e){e.relX=e.relX*this.width/(this.window.get_width()*this.ratioX)-this.viewportX,e.relY=e.relY*this.height/(this.window.get_height()*this.ratioY)-this.viewportY}dispatchEvent(e,t){let s=t;this.screenToViewport(e);let r=e.relX-s.absX,n=e.relY-s.absY,i=(r*s.matD-n*s.matC)*s.invDet,a=(n*s.matA-r*s.matB)*s.invDet;e.relX=i,e.relY=a,s.handleEvent(e)}handleEvent(e,t){this.screenToViewport(e);let s=e.relX,r=e.relY,n=null==t?0:this.interactive.indexOf(t)+1,i=this.shapePoint,a=n,l=this.interactive.length;for(;a<l;){let t=a++,n=this.interactive[t];if(null==n)break;if(0==n.invDet)continue;let l=s-n.absX,h=r-n.absY,o=(l*n.matD-h*n.matC)*n.invDet,_=(h*n.matA-l*n.matB)*n.invDet;if(null!=n.shape){if(i.x=o+n.shapeX,i.y=_+n.shapeY,!n.shape.contains(i))continue}else if(_<0||o<0||o>=n.width||_>=n.height)continue;let c=!0,u=n;for(;null!=u;){if(!u.visible){c=!1;break}u=u.parent}if(c){if(e.relX=o,e.relY=_,n.handleEvent(e),!e.cancel)return n;e.cancel=!1,e.propagate=!1}}return null}addEventTarget(e){let t=e,s=0;for(;null!=t;)t=t.parent,++s;let r=s,n=0,i=this.interactive.length;for(;n<i;){let t=n++,s=e,i=this.interactive[t],a=r,l=i,h=0;for(;null!=l;)l=l.parent,++h;let o=h,_=s,c=i;for(;a>o;)s=_,_=_.parent,--a;for(;o>a;)i=c,c=c.parent,--o;for(;_!=c;)s=_,_=_.parent,i=c,c=c.parent;let u=-1,d=0,p=_.children.length;for(;d<p;){let e=d++;if(_.children[e]==s){u=e;break}}let f=u,x=-1,g=0,b=c.children.length;for(;g<b;){let e=g++;if(c.children[e]==i){x=e;break}}if(f>x)return void this.interactive.splice(t,0,e)}this.interactive.push(e)}removeEventTarget(e,t){null==t&&(t=!1),c.remove(this.interactive,e),t&&null!=this.events&&this.events.onRemove(e)}dispose(){this.allocated&&this.onRemove(),this.ctx.dispose()}setElapsedTime(e){this.ctx.elapsedTime=e}render(e){this.ctx.engine=e,this.ctx.frame++,this.ctx.time+=this.ctx.elapsedTime,this.ctx.globalAlpha=this.alpha,this.sync(this.ctx),0!=this.children.length&&(this.ctx.begin(),this.ctx.drawScene(),this.ctx.end())}sync(e){this.allocated||this.onAdd(),super.sync(e)}onAdd(){this.checkResize(),super.onAdd(),this.window.addResizeEvent(ao(this,this.checkResize))}onRemove(){super.onRemove(),this.window.removeResizeEvent(ao(this,this.checkResize))}}s["h2d.Scene"]=Tr,Tr.__name__="h2d.Scene",Tr.__interfaces__=[Ir,ue],Tr.__super__=kr,Object.assign(Tr.prototype,{__class__:Tr});class Fr{constructor(e){this.x=0,this.y=0,this.r=1,this.g=1,this.b=1,this.a=1,this.rotation=0,this.scaleX=this.scaleY=1,this.visible=!0,this.t=e}update(e){return!0}remove(){null!=this.batch&&this.batch.delete(this)}}s["h2d.BatchElement"]=Fr,Fr.__name__="h2d.BatchElement",Object.assign(Fr.prototype,{__class__:Fr});class Er extends br{constructor(e,t){super(t),this.tile=e}delete(e){null==e.prev?this.first==e&&(this.first=e.next):e.prev.next=e.next,null==e.next?this.last==e&&(this.last=e.prev):e.next.prev=e.prev,e.batch=null}sync(e){if(super.sync(e),this.hasUpdate){let t=this.first;for(;null!=t;)t.update(e.elapsedTime)||t.remove(),t=t.next}this.flush()}getBoundsRec(e,t,s){super.getBoundsRec(e,t,s);let r=this.first;for(;null!=r;){let s=r.t;if(this.hasRotationScale){let n=Math.cos(r.rotation),i=Math.sin(r.rotation),a=s.width,l=s.height,h=s.dx*r.scaleX,o=s.dy*r.scaleY,_=h*n-o*i+r.x,c=o*n+h*i+r.y;this.addBounds(e,t,_,c,1e-10,1e-10);let u=(s.dx+a)*r.scaleX,d=s.dy*r.scaleY;_=u*n-d*i+r.x,c=d*n+u*i+r.y,this.addBounds(e,t,_,c,1e-10,1e-10);let p=s.dx*r.scaleX,f=(s.dy+l)*r.scaleY;_=p*n-f*i+r.x,c=f*n+p*i+r.y,this.addBounds(e,t,_,c,1e-10,1e-10);let x=(s.dx+a)*r.scaleX,g=(s.dy+l)*r.scaleY;_=x*n-g*i+r.x,c=g*n+x*i+r.y,this.addBounds(e,t,_,c,1e-10,1e-10)}else this.addBounds(e,t,r.x+s.dx,r.y+s.dy,s.width,s.height);r=r.next}}flush(){if(null==this.first)return void(this.bufferVertices=0);if(null==this.tmpBuf){let e=Ka._new(0);this.tmpBuf=e}let e=0,t=this.first,s=this.tmpBuf;for(;null!=t;){if(!t.visible){t=t.next;continue}let r=t.t,n=s.pos,i=e+32;for(;n<i;){n++;if(s.pos==s.array.length){let e=s.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(s.array),s.array=t}s.array[s.pos++]=0}if(this.hasRotationScale){let n=Math.cos(t.rotation),i=Math.sin(t.rotation),a=r.width,l=r.height,h=r.dx*t.scaleX,o=r.dy*t.scaleY;s.array[e++]=h*n-o*i+t.x,s.array[e++]=o*n+h*i+t.y,s.array[e++]=r.u,s.array[e++]=r.v,s.array[e++]=t.r,s.array[e++]=t.g,s.array[e++]=t.b,s.array[e++]=t.a;let _=(r.dx+a)*t.scaleX,c=r.dy*t.scaleY;s.array[e++]=_*n-c*i+t.x,s.array[e++]=c*n+_*i+t.y,s.array[e++]=r.u2,s.array[e++]=r.v,s.array[e++]=t.r,s.array[e++]=t.g,s.array[e++]=t.b,s.array[e++]=t.a;let u=r.dx*t.scaleX,d=(r.dy+l)*t.scaleY;s.array[e++]=u*n-d*i+t.x,s.array[e++]=d*n+u*i+t.y,s.array[e++]=r.u,s.array[e++]=r.v2,s.array[e++]=t.r,s.array[e++]=t.g,s.array[e++]=t.b,s.array[e++]=t.a;let p=(r.dx+a)*t.scaleX,f=(r.dy+l)*t.scaleY;s.array[e++]=p*n-f*i+t.x,s.array[e++]=f*n+p*i+t.y,s.array[e++]=r.u2,s.array[e++]=r.v2,s.array[e++]=t.r,s.array[e++]=t.g,s.array[e++]=t.b,s.array[e++]=t.a}else{let n=t.x+r.dx,i=t.y+r.dy;s.array[e++]=n,s.array[e++]=i,s.array[e++]=r.u,s.array[e++]=r.v,s.array[e++]=t.r,s.array[e++]=t.g,s.array[e++]=t.b,s.array[e++]=t.a,s.array[e++]=n+r.width+.1,s.array[e++]=i,s.array[e++]=r.u2,s.array[e++]=r.v,s.array[e++]=t.r,s.array[e++]=t.g,s.array[e++]=t.b,s.array[e++]=t.a,s.array[e++]=n,s.array[e++]=i+r.height+.1,s.array[e++]=r.u,s.array[e++]=r.v2,s.array[e++]=t.r,s.array[e++]=t.g,s.array[e++]=t.b,s.array[e++]=t.a,s.array[e++]=n+r.width+.1,s.array[e++]=i+r.height+.1,s.array[e++]=r.u2,s.array[e++]=r.v2,s.array[e++]=t.r,s.array[e++]=t.g,s.array[e++]=t.b,s.array[e++]=t.a}t=t.next}if(this.bufferVertices=e>>3,null!=this.buffer&&!this.buffer.isDisposed()){if(this.buffer.vertices>=this.bufferVertices)return void this.buffer.uploadVector(this.tmpBuf,0,this.bufferVertices);this.buffer.dispose(),this.buffer=null}this.bufferVertices>0&&(this.buffer=Gr.ofSubFloats(this.tmpBuf,8,this.bufferVertices,[Lr.Dynamic,Lr.Quads,Lr.RawFormat]))}draw(e){this.drawWith(e,this)}drawWith(e,t){if(null==this.first||null==this.buffer||this.buffer.isDisposed()||0==this.bufferVertices)return;if(!e.beginDrawObject(t,this.tile.innerTex))return;let s=e.engine,r=0,n=this.bufferVertices>>1;null==n&&(n=-1),null==r&&(r=0),s.renderBuffer(this.buffer,s.mem.quadIndexes,2,r,n)}onRemove(){super.onRemove(),null!=this.buffer&&(this.buffer.dispose(),this.buffer=null)}}s["h2d.SpriteBatch"]=Er,Er.__name__="h2d.SpriteBatch",Er.__super__=br,Object.assign(Er.prototype,{__class__:Er});class Dr{constructor(e,t,s,r,n,i,a){null==a&&(a=0),null==i&&(i=0),this.innerTex=e,this.x=t,this.y=s,this.width=r,this.height=n,this.dx=i,this.dy=a,null!=e&&this.setTexture(e)}setTexture(e){this.innerTex=e,null!=e&&(this.u=this.x/e.width,this.v=this.y/e.height,this.u2=(this.x+this.width)/e.width,this.v2=(this.y+this.height)/e.height)}sub(e,t,s,r,n,i){return null==i&&(i=0),null==n&&(n=0),new Dr(this.innerTex,this.x+e,this.y+t,s,r,n,i)}center(){return this.sub(0,0,this.width,this.height,-.5*this.width,-.5*this.height)}setSize(e,t){this.width=e,this.height=t;let s=this.innerTex;null!=s&&(this.u2=(this.x+e)/s.width,this.v2=(this.y+t)/s.height)}static fromColor(e,t,s,r){null==r&&(r=1),null==s&&(s=1),null==t&&(t=1);let n=new Dr(Pn.fromColor(e,r),0,0,1,1);return n.width=t,n.height=s,n}static fromTexture(e){return new Dr(e,0,0,e.width,e.height)}}s["h2d.Tile"]=Dr,Dr.__name__="h2d.Tile",Object.assign(Dr.prototype,{__class__:Dr});class Rr{constructor(){this.xMin=1e20,this.yMin=1e20,this.xMax=-1e20,this.yMax=-1e20}}s["h2d.col.Bounds"]=Rr,Rr.__name__="h2d.col.Bounds",Object.assign(Rr.prototype,{__class__:Rr});class Vr{}s["h2d.col.Collider"]=Vr,Vr.__name__="h2d.col.Collider",Vr.__isInterface__=!0,Object.assign(Vr.prototype,{__class__:Vr});class Or{constructor(){this.xMin=2147483647,this.yMin=2147483647,this.xMax=-2147483648,this.yMax=-2147483648}}s["h2d.col.IBounds"]=Or,Or.__name__="h2d.col.IBounds",Object.assign(Or.prototype,{__class__:Or});class Pr{constructor(e,t){null==t&&(t=0),null==e&&(e=0),this.x=e,this.y=t}}s["h2d.col.Point"]=Pr,Pr.__name__="h2d.col.Point",Object.assign(Pr.prototype,{__class__:Pr});class Qr{constructor(){this.enable=!0,this.boundsExtend=0,this.autoBounds=!0}get_enable(){return this.enable}sync(e,t){}bind(e){}unbind(e){}getBounds(e,t){e.getBounds(e,t),t.xMin-=this.boundsExtend,t.yMin-=this.boundsExtend,t.xMax+=this.boundsExtend,t.yMax+=this.boundsExtend}draw(e,t){return t}}s["h2d.filter.Filter"]=Qr,Qr.__name__="h2d.filter.Filter",Object.assign(Qr.prototype,{__class__:Qr});var Lr=n["h3d.BufferFlag"]={__ename__:"h3d.BufferFlag",__constructs__:["Dynamic","Triangles","Quads","Managed","RawFormat","NoAlloc","UniformBuffer"],Dynamic:{_hx_index:0,__enum__:"h3d.BufferFlag",toString:r},Triangles:{_hx_index:1,__enum__:"h3d.BufferFlag",toString:r},Quads:{_hx_index:2,__enum__:"h3d.BufferFlag",toString:r},Managed:{_hx_index:3,__enum__:"h3d.BufferFlag",toString:r},RawFormat:{_hx_index:4,__enum__:"h3d.BufferFlag",toString:r},NoAlloc:{_hx_index:5,__enum__:"h3d.BufferFlag",toString:r},UniformBuffer:{_hx_index:6,__enum__:"h3d.BufferFlag",toString:r}};Lr.__empty_constructs__=[Lr.Dynamic,Lr.Triangles,Lr.Quads,Lr.Managed,Lr.RawFormat,Lr.NoAlloc,Lr.UniformBuffer];class Gr{constructor(e,t,s){this.id=Gr.GUID++,this.vertices=e;if(this.flags=0,null!=s){let e=0;for(;e<s.length;){let t=s[e];++e,this.flags|=1<<t._hx_index}}0==(this.flags&1<<Lr.NoAlloc._hx_index)&&Wr.CURRENT.mem.allocBuffer(this,t)}isDisposed(){return null==this.buffer||null==this.buffer.vbuf}dispose(){null!=this.buffer&&(this.buffer.freeBuffer(this),this.buffer=null,null!=this.next&&this.next.dispose())}uploadVector(e,t,s,r){null==r&&(r=0);let n=this;for(;null!=n&&r>=n.vertices;)r-=n.vertices,n=n.next;for(;s>0;){if(null==n)throw $i.thrown("Too many vertices");let i=s+r>n.vertices?n.vertices-r:s;n.buffer.uploadVertexBuffer(n.position+r,i,e,t),r=0,t+=i*this.buffer.stride,s-=i,n=n.next}}static ofFloats(e,t,s){let r=e.pos/t|0,n=new Gr(r,t,s);return n.uploadVector(e,0,r),n}static ofSubFloats(e,t,s,r){let n=new Gr(s,t,r);return n.uploadVector(e,0,s),n}}s["h3d.Buffer"]=Gr,Gr.__name__="h3d.Buffer",Object.assign(Gr.prototype,{__class__:Gr});class zr{constructor(e,t,s,r,n,i){null==i&&(i=!1),null==n&&(n=4e3),null==r&&(r=.02),null==s&&(s=1.333333),null==t&&(t=1),null==e&&(e=25),this.viewY=0,this.viewX=0,this.fovY=e,this.zoom=t,this.screenRatio=s,this.zNear=r,this.zFar=n,this.rightHanded=i,this.pos=new Xr(2,3,4),this.up=new Xr(0,0,1),this.target=new Xr(0,0,0),this.m=new jr,this.mcam=new jr,this.mproj=new jr,this.frustum=new $r,this.update()}getInverseViewProj(){return null==this.minv&&(this.minv=new jr),this.needInv&&(this.minv.initInverse(this.m),this.needInv=!1),this.minv}unproject(e,t,s){let r=new Xr(e,t,s),n=this.getInverseViewProj(),i=r.x*n._11+r.y*n._21+r.z*n._31+r.w*n._41,a=r.x*n._12+r.y*n._22+r.z*n._32+r.w*n._42,l=r.x*n._13+r.y*n._23+r.z*n._33+r.w*n._43,h=1/(r.x*n._14+r.y*n._24+r.z*n._34+r.w*n._44);return r.x=i*h,r.y=a*h,r.z=l*h,r.w=1,r}update(){if(null!=this.follow){let e=this.pos,t=0,s=0,r=0;null==r&&(r=0),null==s&&(s=0),null==t&&(t=0),e.x=t,e.y=s,e.z=r,e.w=1;let n=this.target,i=0,a=0,l=0;if(null==l&&(l=0),null==a&&(a=0),null==i&&(i=0),n.x=i,n.y=a,n.z=l,n.w=1,this.follow.pos.localToGlobal(this.pos),this.follow.target.localToGlobal(this.target),null!=this.follow.pos.name){let e=this.follow.pos;for(;null!=e;){if(null!=e.currentAnimation){let t=e.currentAnimation.getPropValue(this.follow.pos.name,"FOVY");if(null!=t){this.fovY=t;break}}e=e.parent}}}this.makeCameraMatrix(this.mcam),this.makeFrustumMatrix(this.mproj),this.m.multiply(this.mcam,this.mproj),this.needInv=!0,null!=this.mcamInv&&(this.mcamInv._44=0),null!=this.mprojInv&&(this.mprojInv._44=0),this.frustum.loadMatrix(this.m)}getFrustumCorners(e){return null==e&&(e=1),[this.unproject(-1,1,0),this.unproject(1,1,0),this.unproject(1,-1,0),this.unproject(-1,-1,0),this.unproject(-1,1,e),this.unproject(1,1,e),this.unproject(1,-1,e),this.unproject(-1,-1,e)]}makeCameraMatrix(e){let t=this.target,s=this.pos,r=t.x-s.x,n=t.y-s.y,i=t.z-s.z,a=t.w-s.w;null==a&&(a=1),null==i&&(i=0),null==n&&(n=0),null==r&&(r=0);let l=r,h=n,o=i;this.rightHanded&&(l*=-1,h*=-1,o*=-1);let _=1/Math.sqrt(l*l+h*h+o*o);l*=_,h*=_,o*=_;let c=this.up,u=c.y*o-c.z*h,d=c.z*l-c.x*o,p=c.x*h-c.y*l,f=1;null==f&&(f=1),null==p&&(p=0),null==d&&(d=0),null==u&&(u=0);let x=u,g=d,b=p,m=1/Math.sqrt(x*x+g*g+b*b);x*=m,g*=m,b*=m,0==Math.sqrt(x*x+g*g+b*b)&&(x=h,g=o,b=l);let A=h*b-o*g,w=o*x-l*b,y=l*g-h*x,k=1;null==k&&(k=1),null==y&&(y=0),null==w&&(w=0),null==A&&(A=0);let B=A,C=w,v=y;e._11=x,e._12=B,e._13=l,e._14=0,e._21=g,e._22=C,e._23=h,e._24=0,e._31=b,e._32=v,e._33=o,e._34=0;let S=this.pos;e._41=-(x*S.x+g*S.y+b*S.z);let M=this.pos;e._42=-(B*M.x+C*M.y+v*M.z);let I=this.pos;e._43=-(l*I.x+h*I.y+o*I.z),e._44=1}makeFrustumMatrix(e){e.zero();let t=this.orthoBounds;if(null!=t){let s=1/(t.xMax-t.xMin),r=1/(t.yMax-t.yMin),n=1/(t.zMax-t.zMin);e._11=2*s,e._22=2*r,e._33=n,e._41=-(t.xMin+t.xMax)*s,e._42=-(t.yMin+t.yMax)*r,e._43=-t.zMin*n,e._44=1}else{let t=Math.PI/180,s=Math.atan(Math.tan(.5*this.fovY*t)*this.screenRatio),r=this.zoom/Math.tan(s);e._11=r,e._22=r*this.screenRatio,e._33=this.zFar/(this.zFar-this.zNear),e._34=1,e._43=-this.zNear*this.zFar/(this.zFar-this.zNear)}e._11+=this.viewX*e._14,e._21+=this.viewX*e._24,e._31+=this.viewX*e._34,e._41+=this.viewX*e._44,e._12+=this.viewY*e._14,e._22+=this.viewY*e._24,e._32+=this.viewY*e._34,e._42+=this.viewY*e._44,this.rightHanded&&(e._33*=-1,e._34*=-1)}}s["h3d.Camera"]=zr,zr.__name__="h3d.Camera",Object.assign(zr.prototype,{__class__:zr});class Ur{constructor(e,t,s,r){this.t=e,this.next=t,this.layer=s,this.mipLevel=r}}s["h3d._Engine.TargetTmp"]=Ur,Ur.__name__="h3d._Engine.TargetTmp",Object.assign(Ur.prototype,{__class__:Ur});class Wr{constructor(){this.resCache=new Ca,this.ready=!1,this.textureColorCache=new ya,this.tmpVector=new Xr,this.backgroundColor=-16777216,this.hardware=!Wr.SOFTWARE_DRIVER,this.antiAlias=Wr.ANTIALIASING,this.autoResize=!0,this.set_fullScreen(!al.getValue(rl.IsWindowed)),this.window=il.getInstance(),this.realFps=al.getDefaultFrameRate(),this.lastTime=c.now()/1e3,this.window.addResizeEvent(ao(this,this.onWindowResize)),this.driver=new cn(this.antiAlias),Wr.CURRENT=this}init(){this.driver.init(ao(this,this.onCreate),!this.hardware)}selectShader(e){this.needFlushTarget&&this.doFlushTarget(),this.driver.selectShader(e)&&this.shaderSwitches++}selectMaterial(e){this.driver.selectMaterial(e)}uploadShaderBuffers(e,t){this.driver.uploadShaderBuffers(e,t)}selectBuffer(e){return!e.isDisposed()&&(this.needFlushTarget&&this.doFlushTarget(),this.driver.selectBuffer(e),!0)}renderBuffer(e,t,s,r,n){if(null==n&&(n=-1),null==r&&(r=0),!t.isDisposed())for(;;){let i=e.vertices/s|0,a=e.position/s|0;if(r>0){if(r>=i){if(r-=i,null==(e=e.next))break;continue}a+=r,i-=r,r=0}if(n>=0){if(0==n)return;(n-=i)<0&&(i+=n,n=0)}if(i>0&&this.selectBuffer(e)&&(this.driver.draw(t.ibuf,3*a,i),this.drawTriangles+=i,this.drawCalls++),null==(e=e.next))break}}renderIndexed(e,t,s,r){if(null==r&&(r=-1),null==s&&(s=0),null!=e.next)throw $i.thrown("Buffer is split");if(t.isDisposed())return;let n=t.count/3|0;r<0&&(r=n-s),r>0&&this.selectBuffer(e)&&(this.driver.draw(t.ibuf,3*s,r),this.drawTriangles+=r,this.drawCalls++)}set_debug(e){return this.debug=e,this.driver.setDebug(this.debug),e}onCreate(e){Wr.CURRENT=this,this.autoResize&&(this.width=this.window.get_width(),this.height=this.window.get_height()),e?(pl.get().onContextLost(),this.mem.onContextLost()):(this.mem=new pn(this.driver),this.mem.init(),this.nullTexture=new Pn(0,0,[Sn.NoAlloc])),this.hardware=this.driver.hasFeature(rn.HardwareAccelerated),this.set_debug(this.debug),this.set_fullScreen(this.fullScreen),this.resize(this.width,this.height),e?this.onContextLost():this.onReady(),this.ready=!0}onContextLost(){}onReady(){}onWindowResize(){if(this.autoResize&&!this.driver.isDisposed()){let e=this.window.get_width(),t=this.window.get_height();e==this.width&&t==this.height||this.resize(e,t),this.onResized()}}set_fullScreen(e){return this.fullScreen=e,null!=this.mem&&al.getValue(rl.IsWindowed)&&this.window.set_displayMode(e?ll.Borderless:ll.Windowed),e}onResized(){}resize(e,t){e<32&&(e=32),t<32&&(t=32),this.width=e,this.height=t,this.driver.isDisposed()||this.driver.resize(e,t)}begin(){return!this.driver.isDisposed()&&(this.drawTriangles=0,this.shaderSwitches=0,this.drawCalls=0,this.targetStack=null,this.needFlushTarget=null!=this.currentTargetTex,this.driver.begin(nl.frameCount),null!=this.backgroundColor&&this.clear(this.backgroundColor,1,0),!0)}end(){this.driver.end()}getCurrentTarget(){return null==this.targetStack?null:this.targetStack.t}pushTarget(e,t,s){null==s&&(s=0),null==t&&(t=0);let r=this.targetTmp;null==r?r=new Ur(e,this.targetStack,t,s):(this.targetTmp=r.next,r.t=e,r.next=this.targetStack,r.mipLevel=s,r.layer=t),this.targetStack=r,this.updateNeedFlush()}updateNeedFlush(){let e=this.targetStack;this.needFlushTarget=null==e?null!=this.currentTargetTex:this.currentTargetTex!=e.t||this.currentTargetLayer!=e.layer||this.currentTargetMip!=e.mipLevel||null!=e.textures}popTarget(){let e=this.targetStack;if(null==e)throw $i.thrown("popTarget() with no matching pushTarget()");this.targetStack=e.next,this.updateNeedFlush(),e.t=null,e.textures=null,e.next=this.targetTmp,this.targetTmp=e}doFlushTarget(){let e=this.targetStack;null==e?(this.driver.setRenderTarget(null),this.currentTargetTex=null):(null!=e.textures?this.driver.setRenderTargets(e.textures):this.driver.setRenderTarget(e.t,e.layer,e.mipLevel),this.currentTargetTex=e.t,this.currentTargetLayer=e.layer,this.currentTargetMip=e.mipLevel),this.needFlushTarget=!1}clear(e,t,s){if(null!=e){let t=this.tmpVector;t.x=(e>>16&255)/255,t.y=(e>>8&255)/255,t.z=(255&e)/255,t.w=(e>>>24)/255}this.needFlushTarget&&this.doFlushTarget(),this.driver.clear(null==e?null:this.tmpVector,t,s)}setRenderZone(e,t,s,r){null==r&&(r=-1),null==s&&(s=-1),null==t&&(t=0),null==e&&(e=0),this.needFlushTarget&&this.doFlushTarget(),this.driver.setRenderZone(e,t,s,r)}render(e){if(!this.begin())return!1;e.render(this),this.end();let t=c.now()/1e3-this.lastTime;if(this.lastTime+=t,t>0){let e=1/t;e>2*this.realFps?e=2*this.realFps:e<.5*this.realFps&&(e=.5*this.realFps);let s=t/.5;s>.3&&(s=.3),this.realFps=this.realFps*(1-s)+e*s}return!0}}s["h3d.Engine"]=Wr,Wr.__name__="h3d.Engine",Object.assign(Wr.prototype,{__class__:Wr});class Nr{constructor(e,t){null==t&&(t=!1),this.mem=Wr.CURRENT.mem,this.count=e,this.is32=t,this.mem.allocIndexes(this)}isDisposed(){return null==this.ibuf}upload(e,t,s,r){null==r&&(r=0),this.mem.driver.uploadIndexBuffer(this.ibuf,t,s,e,r)}dispose(){null!=this.ibuf&&this.mem.deleteIndexes(this)}static alloc(e,t,s){null==s&&(s=-1),null==t&&(t=0),s<0&&(s=e.length);let r=new Nr(s);return r.upload(e,0,s),r}}s["h3d.Indexes"]=Nr,Nr.__name__="h3d.Indexes",Object.assign(Nr.prototype,{__class__:Nr});class jr{constructor(){}zero(){this._11=0,this._12=0,this._13=0,this._14=0,this._21=0,this._22=0,this._23=0,this._24=0,this._31=0,this._32=0,this._33=0,this._34=0,this._41=0,this._42=0,this._43=0,this._44=0}identity(){this._11=1,this._12=0,this._13=0,this._14=0,this._21=0,this._22=1,this._23=0,this._24=0,this._31=0,this._32=0,this._33=1,this._34=0,this._41=0,this._42=0,this._43=0,this._44=1}multiply3x4(e,t){let s=e._11,r=e._12,n=e._13,i=e._21,a=e._22,l=e._23,h=e._31,o=e._32,_=e._33,c=e._41,u=e._42,d=e._43,p=t._11,f=t._12,x=t._13,g=t._21,b=t._22,m=t._23,A=t._31,w=t._32,y=t._33,k=t._41,B=t._42,C=t._43;this._11=s*p+r*g+n*A,this._12=s*f+r*b+n*w,this._13=s*x+r*m+n*y,this._14=0,this._21=i*p+a*g+l*A,this._22=i*f+a*b+l*w,this._23=i*x+a*m+l*y,this._24=0,this._31=h*p+o*g+_*A,this._32=h*f+o*b+_*w,this._33=h*x+o*m+_*y,this._34=0,this._41=c*p+u*g+d*A+k,this._42=c*f+u*b+d*w+B,this._43=c*x+u*m+d*y+C,this._44=1}multiply(e,t){let s=e._11,r=e._12,n=e._13,i=e._14,a=e._21,l=e._22,h=e._23,o=e._24,_=e._31,c=e._32,u=e._33,d=e._34,p=e._41,f=e._42,x=e._43,g=e._44,b=t._11,m=t._12,A=t._13,w=t._14,y=t._21,k=t._22,B=t._23,C=t._24,v=t._31,S=t._32,M=t._33,I=t._34,T=t._41,F=t._42,E=t._43,D=t._44;this._11=s*b+r*y+n*v+i*T,this._12=s*m+r*k+n*S+i*F,this._13=s*A+r*B+n*M+i*E,this._14=s*w+r*C+n*I+i*D,this._21=a*b+l*y+h*v+o*T,this._22=a*m+l*k+h*S+o*F,this._23=a*A+l*B+h*M+o*E,this._24=a*w+l*C+h*I+o*D,this._31=_*b+c*y+u*v+d*T,this._32=_*m+c*k+u*S+d*F,this._33=_*A+c*B+u*M+d*E,this._34=_*w+c*C+u*I+d*D,this._41=p*b+f*y+x*v+g*T,this._42=p*m+f*k+x*S+g*F,this._43=p*A+f*B+x*M+g*E,this._44=p*w+f*C+x*I+g*D}inverse3x4(e){let t=e._11,s=e._12,r=e._13,n=e._21,i=e._22,a=e._23,l=e._31,h=e._32,o=e._33,_=e._41,c=e._42,u=e._43;this._11=i*o-a*h,this._12=r*h-s*o,this._13=s*a-r*i,this._14=0,this._21=a*l-n*o,this._22=t*o-r*l,this._23=r*n-t*a,this._24=0,this._31=n*h-i*l,this._32=s*l-t*h,this._33=t*i-s*n,this._34=0,this._41=-n*h*u+n*o*c+l*i*u-l*a*c-_*i*o+_*a*h,this._42=t*h*u-t*o*c-l*s*u+l*r*c+_*s*o-_*r*h,this._43=-t*i*u+t*a*c+n*s*u-n*r*c-_*s*a+_*r*i,this._44=t*i*o-t*a*h-n*s*o+n*r*h+l*s*a-l*r*i,this._44=1;let d=t*this._11+s*this._21+r*this._31;if((d<0?-d:d)<1e-10)return void this.zero();let p=1/d;this._11*=p,this._12*=p,this._13*=p,this._21*=p,this._22*=p,this._23*=p,this._31*=p,this._32*=p,this._33*=p,this._41*=p,this._42*=p,this._43*=p}initInverse(e){let t=e._11,s=e._12,r=e._13,n=e._14,i=e._21,a=e._22,l=e._23,h=e._24,o=e._31,_=e._32,c=e._33,u=e._34,d=e._41,p=e._42,f=e._43,x=e._44;this._11=a*c*x-a*u*f-_*l*x+_*h*f+p*l*u-p*h*c,this._12=-s*c*x+s*u*f+_*r*x-_*n*f-p*r*u+p*n*c,this._13=s*l*x-s*h*f-a*r*x+a*n*f+p*r*h-p*n*l,this._14=-s*l*u+s*h*c+a*r*u-a*n*c-_*r*h+_*n*l,this._21=-i*c*x+i*u*f+o*l*x-o*h*f-d*l*u+d*h*c,this._22=t*c*x-t*u*f-o*r*x+o*n*f+d*r*u-d*n*c,this._23=-t*l*x+t*h*f+i*r*x-i*n*f-d*r*h+d*n*l,this._24=t*l*u-t*h*c-i*r*u+i*n*c+o*r*h-o*n*l,this._31=i*_*x-i*u*p-o*a*x+o*h*p+d*a*u-d*h*_,this._32=-t*_*x+t*u*p+o*s*x-o*n*p-d*s*u+d*n*_,this._33=t*a*x-t*h*p-i*s*x+i*n*p+d*s*h-d*n*a,this._34=-t*a*u+t*h*_+i*s*u-i*n*_-o*s*h+o*n*a,this._41=-i*_*f+i*c*p+o*a*f-o*l*p-d*a*c+d*l*_,this._42=t*_*f-t*c*p-o*s*f+o*r*p+d*s*c-d*r*_,this._43=-t*a*f+t*l*p+i*s*f-i*r*p-d*s*l+d*r*a,this._44=t*a*c-t*l*_-i*s*c+i*r*_+o*s*l-o*r*a;let g=t*this._11+s*this._21+r*this._31+n*this._41;(g<0?-g:g)<1e-10?this.zero():(g=1/g,this._11*=g,this._12*=g,this._13*=g,this._14*=g,this._21*=g,this._22*=g,this._23*=g,this._24*=g,this._31*=g,this._32*=g,this._33*=g,this._34*=g,this._41*=g,this._42*=g,this._43*=g,this._44*=g)}loadValues(e){this._11=e[0],this._12=e[1],this._13=e[2],this._14=e[3],this._21=e[4],this._22=e[5],this._23=e[6],this._24=e[7],this._31=e[8],this._32=e[9],this._33=e[10],this._34=e[11],this._41=e[12],this._42=e[13],this._43=e[14],this._44=e[15]}static L(e){let t=new jr;return t.loadValues(e),t}}s["h3d.Matrix"]=jr,jr.__name__="h3d.Matrix",Object.assign(jr.prototype,{__class__:jr});class Yr{constructor(e,t,s,r){null==r&&(r=1),null==s&&(s=0),null==t&&(t=0),null==e&&(e=0),this.x=e,this.y=t,this.z=s,this.w=r}toMatrix(e){null==e&&(e=new jr);let t=this.x*this.x,s=this.x*this.y,r=this.x*this.z,n=this.x*this.w,i=this.y*this.y,a=this.y*this.z,l=this.y*this.w,h=this.z*this.z,o=this.z*this.w;return e._11=1-2*(i+h),e._12=2*(s+o),e._13=2*(r-l),e._14=0,e._21=2*(s-o),e._22=1-2*(t+h),e._23=2*(a+n),e._24=0,e._31=2*(r+l),e._32=2*(a-n),e._33=1-2*(t+i),e._34=0,e._41=0,e._42=0,e._43=0,e._44=1,e}}s["h3d.Quat"]=Yr,Yr.__name__="h3d.Quat",Object.assign(Yr.prototype,{__class__:Yr});class Xr{constructor(e,t,s,r){null==r&&(r=1),null==s&&(s=0),null==t&&(t=0),null==e&&(e=0),this.x=e,this.y=t,this.z=s,this.w=r}normalize(){let e=this.x*this.x+this.y*this.y+this.z*this.z;e=e<1e-10?0:1/Math.sqrt(e),this.x*=e,this.y*=e,this.z*=e}}s["h3d.Vector"]=Xr,Xr.__name__="h3d.Vector",Object.assign(Xr.prototype,{__class__:Xr});class Zr{}s["h3d.anim.AnimatedObject"]=Zr,Zr.__name__="h3d.anim.AnimatedObject";class Hr{}s["hxd.impl._Serializable.NoSerializeSupport"]=Hr,Hr.__name__="hxd.impl._Serializable.NoSerializeSupport",Hr.__isInterface__=!0;class Kr{constructor(e,t,s){this.name=e,this.frameCount=t,this.sampling=s,this.objects=[],this.lastEvent=-1,this.frame=0,this.speed=1,this.loop=!0,this.pause=!1}getPropValue(e,t){return null}sync(e){throw null==e&&(e=!1),$i.thrown("assert")}isPlaying(){return!this.pause&&(this.speed<0?-this.speed:this.speed)>1e-6}endFrame(){return this.frameCount}update(e){if(!this.isInstance)throw $i.thrown("You must instanciate this animation first");if(!this.isPlaying())return 0;if(null!=this.events&&null!=this.onEvent){let t=0|this.frame,s=this.frame+e*this.speed*this.sampling|0;s>=this.frameCount&&(s=this.frameCount-1);let r=t,n=s+1;for(;r<n;){let t=r++;if(t!=this.lastEvent&&(this.lastEvent=t,null!=this.events[t])){let s=this.frame,r=e;e-=(t-this.frame)/(this.speed*this.sampling),this.frame=t;let n=0,i=this.events[t];for(;n<i.length;){let e=i[n];++n,this.onEvent(e)}if(this.frame==t&&t==this.frameCount-1){this.frame=s,e=r;break}return e}}}if(null!=this.onAnimEnd){let t=this.endFrame(),s=0==this.speed?0:(t-this.frame)/(this.speed*this.sampling);if(s<=e&&s>0)return this.frame=t,e-=s,this.onAnimEnd(),this.frame==t&&this.isPlaying()&&(this.loop?this.frame=0:e=0),e}return this.frame+=e*this.speed*this.sampling,this.frame>=this.frameCount&&(this.loop?this.frame%=this.frameCount:this.frame=this.frameCount),0}}s["h3d.anim.Animation"]=Kr,Kr.__name__="h3d.anim.Animation",Kr.__interfaces__=[Hr],Object.assign(Kr.prototype,{__class__:Kr});class qr{}s["h3d.col.Collider"]=qr,qr.__name__="h3d.col.Collider",qr.__isInterface__=!0,qr.__interfaces__=[Hr],Object.assign(qr.prototype,{__class__:qr});class Jr{constructor(){this.xMin=1e20,this.xMax=-1e20,this.yMin=1e20,this.yMax=-1e20,this.zMin=1e20,this.zMax=-1e20}inFrustum(e,t){if(null!=t)throw $i.thrown("Not implemented");return e.hasBounds(this)}rayIntersection(e,t){let s=(this.xMin-e.px)/e.lx,r=(this.yMin-e.py)/e.ly,n=(this.zMin-e.pz)/e.lz,i=(this.xMax-e.px)/e.lx,a=(this.yMax-e.py)/e.ly,l=(this.zMax-e.pz)/e.lz,h=s>i?i:s,o=r>a?a:r,_=n>l?l:n,c=s<i?i:s,u=r<a?a:r,d=n<l?l:n,p=c>u?u:c,f=h<o?o:h,x=f<_?_:f;return(p>d?d:p)<x?-1:x}intersection(e,t){let s=e.xMin,r=t.xMin,n=s<r?r:s,i=e.yMin,a=t.yMin,l=i<a?a:i,h=e.zMin,o=t.zMin,_=h<o?o:h,c=e.xMax,u=t.xMax,d=c>u?u:c,p=e.yMax,f=t.yMax,x=p>f?f:p,g=e.zMax,b=t.zMax,m=g>b?b:g;this.xMin=n,this.xMax=d,this.yMin=l,this.yMax=x,this.zMin=_,this.zMax=m}scaleCenter(e){let t=.5*(this.xMax-this.xMin)*e,s=.5*(this.yMax-this.yMin)*e,r=.5*(this.zMax-this.zMin)*e,n=.5*(this.xMax+this.xMin),i=.5*(this.yMax+this.yMin),a=.5*(this.zMax+this.zMin);this.xMin=n-t,this.yMin=i-s,this.zMin=a-r,this.xMax=n+t,this.yMax=i+s,this.zMax=a+r}}s["h3d.col.Bounds"]=Jr,Jr.__name__="h3d.col.Bounds",Jr.__interfaces__=[qr],Object.assign(Jr.prototype,{__class__:Jr});class $r{constructor(e){this.checkNearFar=!0,this.pleft=new tn(1,0,0,0),this.pright=new tn(1,0,0,0),this.ptop=new tn(1,0,0,0),this.pbottom=new tn(1,0,0,0),this.pnear=new tn(1,0,0,0),this.pfar=new tn(1,0,0,0),null!=e&&this.loadMatrix(e)}loadMatrix(e){let t=this.pleft,s=e._14+e._11,r=e._24+e._21,n=e._34+e._31,i=-(e._44+e._41);t.nx=s,t.ny=r,t.nz=n,t.d=i;let a=this.pright,l=e._14-e._11,h=e._24-e._21,o=e._34-e._31,_=e._41-e._44;a.nx=l,a.ny=h,a.nz=o,a.d=_;let c=this.ptop,u=e._14-e._12,d=e._24-e._22,p=e._34-e._32,f=e._42-e._44;c.nx=u,c.ny=d,c.nz=p,c.d=f;let x=this.pbottom,g=e._14+e._12,b=e._24+e._22,m=e._34+e._32,A=-(e._44+e._42);x.nx=g,x.ny=b,x.nz=m,x.d=A;let w=this.pnear,y=e._13,k=e._23,B=e._33,C=-e._43;w.nx=y,w.ny=k,w.nz=B,w.d=C;let v=this.pfar,S=e._14-e._13,M=e._24-e._23,I=e._34-e._33,T=e._43-e._44;v.nx=S,v.ny=M,v.nz=I,v.d=T;let F=this.pleft,E=1/Math.sqrt(F.nx*F.nx+F.ny*F.ny+F.nz*F.nz);F.nx*=E,F.ny*=E,F.nz*=E,F.d*=E;let D=this.pright,R=1/Math.sqrt(D.nx*D.nx+D.ny*D.ny+D.nz*D.nz);D.nx*=R,D.ny*=R,D.nz*=R,D.d*=R;let V=this.ptop,O=1/Math.sqrt(V.nx*V.nx+V.ny*V.ny+V.nz*V.nz);V.nx*=O,V.ny*=O,V.nz*=O,V.d*=O;let P=this.pbottom,Q=1/Math.sqrt(P.nx*P.nx+P.ny*P.ny+P.nz*P.nz);P.nx*=Q,P.ny*=Q,P.nz*=Q,P.d*=Q;let L=this.pnear,G=1/Math.sqrt(L.nx*L.nx+L.ny*L.ny+L.nz*L.nz);L.nx*=G,L.ny*=G,L.nz*=G,L.d*=G;let z=this.pfar,U=1/Math.sqrt(z.nx*z.nx+z.ny*z.ny+z.nz*z.nz);z.nx*=U,z.ny*=U,z.nz*=U,z.d*=U}hasSphere(e){let t=e.x,s=e.y,r=e.z;null==r&&(r=0),null==s&&(s=0),null==t&&(t=0);let n=t,i=s,a=r,l=this.pleft;if(l.nx*n+l.ny*i+l.nz*a-l.d<-e.r)return!1;let h=this.pright;if(h.nx*n+h.ny*i+h.nz*a-h.d<-e.r)return!1;let o=this.ptop;if(o.nx*n+o.ny*i+o.nz*a-o.d<-e.r)return!1;let _=this.pbottom;if(_.nx*n+_.ny*i+_.nz*a-_.d<-e.r)return!1;if(this.checkNearFar){let t=this.pnear;if(t.nx*n+t.ny*i+t.nz*a-t.d<-e.r)return!1;let s=this.pfar;if(s.nx*n+s.ny*i+s.nz*a-s.d<-e.r)return!1}return!0}hasBounds(e){let t=this.pleft,s=t.nx,r=t.ny,n=t.nz,i=s*(e.xMax+e.xMin)+r*(e.yMax+e.yMin)+n*(e.zMax+e.zMin);if(s<0&&(s=-s),r<0&&(r=-r),n<0&&(n=-n),i+(s*(e.xMax-e.xMin)+r*(e.yMax-e.yMin)+n*(e.zMax-e.zMin))-2*t.d<0)return!1;let a=this.pright,l=a.nx,h=a.ny,o=a.nz,_=l*(e.xMax+e.xMin)+h*(e.yMax+e.yMin)+o*(e.zMax+e.zMin);if(l<0&&(l=-l),h<0&&(h=-h),o<0&&(o=-o),_+(l*(e.xMax-e.xMin)+h*(e.yMax-e.yMin)+o*(e.zMax-e.zMin))-2*a.d<0)return!1;let c=this.ptop,u=c.nx,d=c.ny,p=c.nz,f=u*(e.xMax+e.xMin)+d*(e.yMax+e.yMin)+p*(e.zMax+e.zMin);if(u<0&&(u=-u),d<0&&(d=-d),p<0&&(p=-p),f+(u*(e.xMax-e.xMin)+d*(e.yMax-e.yMin)+p*(e.zMax-e.zMin))-2*c.d<0)return!1;let x=this.ptop,g=x.nx,b=x.ny,m=x.nz,A=g*(e.xMax+e.xMin)+b*(e.yMax+e.yMin)+m*(e.zMax+e.zMin);if(g<0&&(g=-g),b<0&&(b=-b),m<0&&(m=-m),A+(g*(e.xMax-e.xMin)+b*(e.yMax-e.yMin)+m*(e.zMax-e.zMin))-2*x.d<0)return!1;let w=this.pnear,y=w.nx,k=w.ny,B=w.nz,C=y*(e.xMax+e.xMin)+k*(e.yMax+e.yMin)+B*(e.zMax+e.zMin);if(y<0&&(y=-y),k<0&&(k=-k),B<0&&(B=-B),C+(y*(e.xMax-e.xMin)+k*(e.yMax-e.yMin)+B*(e.zMax-e.zMin))-2*w.d<0)return!1;let v=this.pfar,S=v.nx,M=v.ny,I=v.nz,T=S*(e.xMax+e.xMin)+M*(e.yMax+e.yMin)+I*(e.zMax+e.zMin);return S<0&&(S=-S),M<0&&(M=-M),I<0&&(I=-I),!(T+(S*(e.xMax-e.xMin)+M*(e.yMax-e.yMin)+I*(e.zMax-e.zMin))-2*v.d<0)}}s["h3d.col.Frustum"]=$r,$r.__name__="h3d.col.Frustum",Object.assign($r.prototype,{__class__:$r});class en{constructor(){}normalize(){let e=this.lx*this.lx+this.ly*this.ly+this.lz*this.lz;1!=e&&(e=e<1e-10?0:1/Math.sqrt(e),this.lx*=e,this.ly*=e,this.lz*=e)}}s["h3d.col.Ray"]=en,en.__name__="h3d.col.Ray",Object.assign(en.prototype,{__class__:en});class tn{constructor(e,t,s,r){this.nx=e,this.ny=t,this.nz=s,this.d=r}}s["h3d.col.Plane"]=tn,tn.__name__="h3d.col.Plane",Object.assign(tn.prototype,{__class__:tn});class sn{constructor(e,t,s,r){null==r&&(r=0),null==s&&(s=0),null==t&&(t=0),null==e&&(e=0);let n=e,i=t,a=s,l=r;null==l&&(l=0),null==a&&(a=0),null==i&&(i=0),null==n&&(n=0),this.x=n,this.y=i,this.z=a,this.r=l}rayIntersection(e,t){let s=this.r*this.r,r=e.px+e.lx,n=e.py+e.ly,i=e.pz+e.lz,a=e.lx*e.lx+e.ly*e.ly+e.lz*e.lz,l=2*e.lx*(this.x-r)+2*e.ly*(this.y-n)+2*e.lz*(this.z-i),h=l*l-4*a*(this.x*this.x+this.y*this.y+this.z*this.z+(r*r+n*n+i*i)-2*(this.x*r+this.y*n+this.z*i)-s);return h<0?-1:(h=Math.sqrt(h),1-(-l+h)/(2*a))}inFrustum(e,t){return null!=t?this.inFrustumMatrix(e,t):e.hasSphere(this)}inFrustumMatrix(e,t){let s=this.x,r=this.y,n=this.z,i=this.r,a=this.x,l=this.y,h=this.z;null==h&&(h=0),null==l&&(l=0),null==a&&(a=0);let o=a,_=l,c=h,u=o*t._11+_*t._21+c*t._31+t._41,d=o*t._12+_*t._22+c*t._32+t._42,p=o*t._13+_*t._23+c*t._33+t._43;o=u,_=d,c=p,this.x=o,this.y=_,this.z=c;let f=null;null==f&&(f=new Xr),f.x=Math.sqrt(t._11*t._11+t._12*t._12+t._13*t._13),f.y=Math.sqrt(t._21*t._21+t._22*t._22+t._23*t._23),f.z=Math.sqrt(t._31*t._31+t._32*t._32+t._33*t._33),t._11*(t._22*t._33-t._23*t._32)+t._12*(t._23*t._31-t._21*t._33)+t._13*(t._21*t._32-t._22*t._31)<0&&(f.x*=-1,f.y*=-1,f.z*=-1);let x=f;this.r*=Math.max(Math.max(x.x,x.y),x.z);let g=e.hasSphere(this);return this.x=s,this.y=r,this.z=n,this.r=i,g}}s["h3d.col.Sphere"]=sn,sn.__name__="h3d.col.Sphere",sn.__interfaces__=[qr],Object.assign(sn.prototype,{__class__:sn});var rn=n["h3d.impl.Feature"]={__ename__:"h3d.impl.Feature",__constructs__:["StandardDerivatives","FloatTextures","AllocDepthBuffer","HardwareAccelerated","MultipleRenderTargets","Queries","SRGBTextures","ShaderModel3","BottomLeftCoords","Wireframe","InstancedRendering"],StandardDerivatives:{_hx_index:0,__enum__:"h3d.impl.Feature",toString:r},FloatTextures:{_hx_index:1,__enum__:"h3d.impl.Feature",toString:r},AllocDepthBuffer:{_hx_index:2,__enum__:"h3d.impl.Feature",toString:r},HardwareAccelerated:{_hx_index:3,__enum__:"h3d.impl.Feature",toString:r},MultipleRenderTargets:{_hx_index:4,__enum__:"h3d.impl.Feature",toString:r},Queries:{_hx_index:5,__enum__:"h3d.impl.Feature",toString:r},SRGBTextures:{_hx_index:6,__enum__:"h3d.impl.Feature",toString:r},ShaderModel3:{_hx_index:7,__enum__:"h3d.impl.Feature",toString:r},BottomLeftCoords:{_hx_index:8,__enum__:"h3d.impl.Feature",toString:r},Wireframe:{_hx_index:9,__enum__:"h3d.impl.Feature",toString:r},InstancedRendering:{_hx_index:10,__enum__:"h3d.impl.Feature",toString:r}};rn.__empty_constructs__=[rn.StandardDerivatives,rn.FloatTextures,rn.AllocDepthBuffer,rn.HardwareAccelerated,rn.MultipleRenderTargets,rn.Queries,rn.SRGBTextures,rn.ShaderModel3,rn.BottomLeftCoords,rn.Wireframe,rn.InstancedRendering];var nn=n["h3d.impl.RenderFlag"]={__ename__:"h3d.impl.RenderFlag",__constructs__:["CameraHandness"],CameraHandness:{_hx_index:0,__enum__:"h3d.impl.RenderFlag",toString:r}};nn.__empty_constructs__=[nn.CameraHandness];class an{constructor(e){this.id=an.UID++,this.names=e}static get(e){let t=e.join("|"),s=an.CACHE.h[t];return null==s&&(s=new an(e.slice()),an.CACHE.h[t]=s),s}}s["h3d.impl.InputNames"]=an,an.__name__="h3d.impl.InputNames",Object.assign(an.prototype,{__class__:an});class ln{hasFeature(e){return!1}setRenderFlag(e,t){}isSupportedFormat(e){return!1}isDisposed(){return!0}begin(e){}generateMipMaps(e){throw $i.thrown("Mipmaps auto generation is not supported on this platform")}clear(e,t,s){}capturePixels(e,t,s,r){throw $i.thrown("Can't capture pixels on this platform")}init(e,t){null==t&&(t=!1)}resize(e,t){}selectShader(e){return!1}selectMaterial(e){}uploadShaderBuffers(e,t){}selectBuffer(e){}draw(e,t,s){}setRenderZone(e,t,s,r){}setRenderTarget(e,t,s){null==s&&(s=0),null==t&&(t=0)}setRenderTargets(e){}allocDepthBuffer(e){return null}disposeDepthBuffer(e){}getDefaultDepthBuffer(){return null}end(){}setDebug(e){}allocTexture(e){return null}allocIndexes(e,t){return null}allocVertexes(e){return null}disposeTexture(e){}disposeIndexes(e){}disposeVertexes(e){}uploadIndexBuffer(e,t,s,r,n){}uploadVertexBuffer(e,t,s,r,n){}uploadTextureBitmap(e,t,s,r){}uploadTexturePixels(e,t,s,r){}copyTexture(e,t){return!1}}s["h3d.impl.Driver"]=ln,ln.__name__="h3d.impl.Driver",Object.assign(ln.prototype,{__class__:ln});class hn{constructor(e,t,s){this.s=e,this.vertex=t,this.shader=s}}s["h3d.impl._GlDriver.CompiledShader"]=hn,hn.__name__="h3d.impl._GlDriver.CompiledShader",Object.assign(hn.prototype,{__class__:hn});class on{constructor(){}}s["h3d.impl._GlDriver.CompiledAttribute"]=on,on.__name__="h3d.impl._GlDriver.CompiledAttribute",Object.assign(on.prototype,{__class__:on});class _n{constructor(){}}s["h3d.impl._GlDriver.CompiledProgram"]=_n,_n.__name__="h3d.impl._GlDriver.CompiledProgram",Object.assign(_n.prototype,{__class__:_n});class cn extends ln{constructor(e){null==e&&(e=0),super(),this.features=new wa,this.maxCompressedTexturesSupport=0,this.rightHanded=!1,this.firstShader=!0,this.boundTextures=[],this.curTargets=[];let t=[];t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),this.currentDivisor=t,this.curColorMask=-1,this.lastActiveIndex=0,this.curStEnabled=!1,this.curStMaskBits=-1,this.curStOpBits=-1,this.curMatBits=-1,this.maxIdxCurAttribs=0,this.curAttribs=[],this.canvas=il.getInstance().canvas;let s={alpha:!1,stencil:!0,antialias:e>0};if(cn.ALLOW_WEBGL2&&(this.gl=this.canvas.getContext("webgl2",s)),null==this.gl&&(this.gl=Uh.getContextWebGL(this.canvas,s)),null==this.gl)throw $i.thrown("Could not acquire GL context");"undefined"!=typeof WebGLDebugUtils&&(this.gl=WebGLDebugUtils.makeDebugContext(this.gl),this.glDebug=!0),this.commonFB=this.gl.createFramebuffer(),this.programs=new ya,this.defStencil=new Vn;let r=this.gl.getParameter(7938),n=new l("ES ([0-9]+\\.[0-9]+)","");n.match(r)&&(this.glES=parseFloat(n.matched(1)));let i=new l("[0-9]+\\.[0-9]+",""),a=this.gl.getParameter(35724);if(i.match(a)&&(this.glES=parseFloat(i.matched(0)),this.shaderVersion=Math.round(100*parseFloat(i.matched(0)))),this.drawMode=4,this.makeFeatures(),this.hasFeature(rn.InstancedRendering)&&this.glES<3){let e=this.gl.getExtension("ANGLE_instanced_arrays");this.gl.vertexAttribDivisor=ao(e,e.vertexAttribDivisorANGLE),this.gl.drawElementsInstanced=ao(e,e.drawElementsInstancedANGLE)}Lh.UNROLL_LOOPS=!this.hasFeature(rn.ShaderModel3)}setRenderFlag(e,t){this.rightHanded=t>0}setDebug(e){this.debug=e}begin(e){this.frame=e,this.resetStream(),this.gl.useProgram(null),this.curShader=null,this.curBuffer=null}getDriverName(e){let t=this.gl.getParameter(7937);return e?t+=" GLv"+x.string(this.gl.getParameter(7938)):t=t.split("/").shift(),t=t.split("WebGL ").join(""),"OpenGL "+t}compileShader(e,t){let s=t.vertex?35633:35632,r=this.gl.createShader(s);null==t.code&&(t.code=e.run(t.data),t.data.funs=null),this.gl.shaderSource(r,t.code),this.gl.compileShader(r);this.gl.getShaderInfoLog(r);if(1!=this.gl.getShaderParameter(r,35713)){let e=this.gl.getShaderInfoLog(r),s=x.parseInt(c.substr(e,9,null)),n=null==s?null:t.code.split("\n")[s-1];n=null==n?"":"("+b.trim(n)+")";let i=t.code.split("\n"),a=0,l=i.length;for(;a<l;){let e=a++;i[e]=e+1+"\t"+i[e]}throw $i.thrown("An error occurred compiling the shaders: "+e+n+"\n\n"+i.join("\n"))}return new hn(r,t.vertex,t)}initShader(e,t,s){let r=t.vertex?"vertex":"fragment";t.globals=this.gl.getUniformLocation(e.p,r+"Globals"),t.params=this.gl.getUniformLocation(e.p,r+"Params"),t.textures=[];let n=0,i=null,a=0,l="",h=s.textures;for(;null!=h;){let s,o=h.type;if(17==o._hx_index){o.size;s=!0}else s=!1;if(s&&(o=ql.TSampler2D),o!=i){switch(i=o,o._hx_index){case 10:a=3553,l="Textures";break;case 11:a=35866,l="TexturesArray";break;case 12:a=34067,l="TexturesCube";break;default:throw $i.thrown("Unsupported texture type "+x.string(o))}n=0}t.textures.push({u:this.gl.getUniformLocation(e.p,r+l+"["+n+"]"),t:i,mode:a}),++n,h=h.next}if(s.bufferCount>0){let r=[],n=0,i=s.bufferCount;for(;n<i;){let t=n++;r.push(this.gl.getUniformBlockIndex(e.p,"uniform_buffer"+t))}t.buffers=r;let a=0,l=s.bufferCount;for(;a<l;){let s=a++;this.gl.uniformBlockBinding(e.p,t.buffers[s],s)}}}selectShader(e){let t=this.programs.h[e.id];if(null==t){t=new _n;let r=new kh;r.glES=this.glES,r.version=this.shaderVersion,t.vertex=this.compileShader(r,e.vertex),t.fragment=this.compileShader(r,e.fragment),t.p=this.gl.createProgram(),this.gl.attachShader(t.p,t.vertex.s),this.gl.attachShader(t.p,t.fragment.s);let n=null;try{this.gl.linkProgram(t.p),1!=this.gl.getProgramParameter(t.p,35714)&&(n=this.gl.getProgramInfoLog(t.p))}catch(s){let e=$i.caught(s).unwrap();throw $i.thrown("Shader linkage error: "+x.string(e)+" ("+this.getDriverName(!1)+")")}if(this.gl.deleteShader(t.vertex.s),this.gl.deleteShader(t.fragment.s),null!=n)throw this.gl.deleteProgram(t.p),$i.thrown("Program linkage failure: "+n+"\nVertex=\n"+e.vertex.code+"\n\nFragment=\n"+e.fragment.code);this.firstShader=!1,this.initShader(t,t.vertex,e.vertex),this.initShader(t,t.fragment,e.fragment);let i=[];t.attribs=[],t.hasAttribIndex=[],t.stride=0;let a=0,l=e.vertex.data.vars;for(;a<l.length;){let e=l[a];if(++a,1==e.kind._hx_index){let s,n=5126,a=e.type;switch(a._hx_index){case 3:s=1;break;case 5:a.t;s=a.size;break;case 9:let t=a.size;n=5120,s=t;break;default:throw $i.thrown("assert "+x.string(e.type))}let l=this.gl.getAttribLocation(t.p,r.varNames.h.hasOwnProperty(e.id)?r.varNames.h[e.id]:e.name);if(l<0){t.stride+=s;continue}let h=new on;if(h.type=n,h.size=s,h.index=l,h.offset=t.stride,h.divisor=0,null!=e.qualifiers){let t=0,s=e.qualifiers;for(;t<s.length;){let e=s[t];if(++t,9==e._hx_index){let t=e.v;h.divisor=t}}}t.attribs.push(h),t.hasAttribIndex[h.index]=!0,i.push(e.name),t.stride+=s}}t.inputs=an.get(i),this.programs.h[e.id]=t}if(this.curShader==t)return!1;this.gl.useProgram(t.p);let s=0,r=t.attribs;for(;s<r.length;){let e=r[s];++s,this.curAttribs[e.index]||(this.gl.enableVertexAttribArray(e.index),this.curAttribs[e.index]=!0,this.maxIdxCurAttribs<e.index&&(this.maxIdxCurAttribs=e.index))}let n=0,i=0,a=this.maxIdxCurAttribs+1;for(;i<a;){let e=i++;this.curAttribs[e]&&!t.hasAttribIndex[e]?(this.gl.disableVertexAttribArray(e),this.curAttribs[e]=!1):this.curAttribs[e]&&(n=e)}this.maxIdxCurAttribs=n,this.curShader=t,this.curBuffer=null;let l=0,h=this.boundTextures.length;for(;l<h;){let e=l++;this.boundTextures[e]=null}return!0}uploadShaderBuffers(e,t){this.uploadBuffer(this.curShader.vertex,e.vertex,t),this.uploadBuffer(this.curShader.fragment,e.fragment,t)}uploadBuffer(e,t,s){switch(s){case 0:if(null!=e.globals){let s=t.globals.subarray(0,4*e.shader.globalsSize);this.gl.uniform4fv(e.globals,s)}break;case 1:if(null!=e.params){let s=t.params.subarray(0,4*e.shader.paramsSize);this.gl.uniform4fv(e.params,s)}break;case 2:e.textures.length;let s=0,r=e.textures.length;for(;s<r;){let r=s++,n=t.tex[r],i=e.textures[r];if(null==n||null==n.t&&null==n.realloc)switch(i.t._hx_index){case 10:let e=Mn.loadingTextureColor;n=Pn.fromColor(e,(e>>>24)/255);break;case 12:n=Pn.defaultCubeTexture();break;default:throw $i.thrown("Missing texture")}if(null!=n&&null==n.t&&null!=n.realloc&&(n.alloc(),n.realloc()),n.set_lastFrame(this.frame),null==i.u)continue;let a=e.vertex?r:this.curShader.vertex.textures.length+r;if(this.boundTextures[a]!=n.t){this.boundTextures[a]=n.t;let e=this.getBindType(n);if(e!=i.mode)throw $i.thrown("Texture format mismatch: "+x.string(n)+" should be "+x.string(i.t));this.gl.activeTexture(33984+a),this.gl.uniform1i(i.u,a),this.gl.bindTexture(e,n.t.t),this.lastActiveIndex=a}let l=n.mipMap._hx_index,h=n.filter._hx_index,o=n.wrap._hx_index,_=l|h<<3|o<<6;if(_!=n.t.bits){n.t.bits=_;let e=cn.TFILTERS[l][h],t=i.mode;this.gl.texParameteri(t,10240,e[0]),this.gl.texParameteri(t,10241,e[1]);let s=cn.TWRAP[o];this.gl.texParameteri(t,10242,s),this.gl.texParameteri(t,10243,s)}}break;case 3:if(null!=e.buffers){let s=0,r=e.buffers.length;for(;s<r;){let e=s++;this.gl.bindBufferBase(35345,e,t.buffers[e].buffer.vbuf.b)}}}}selectMaterial(e){let t=e.bits;if(null==this.curTarget==this.rightHanded)switch(e.culling._hx_index){case 1:t=-4&t|2;break;case 2:t=-4&t|1}if(this.selectMaterialBits(t),this.curColorMask!=e.colorMask){let t=e.colorMask;this.gl.colorMask(0!=(1&t),0!=(2&t),0!=(4&t),0!=(8&t)),this.curColorMask=t}let s=this.defStencil;null==e.stencil?this.curStEnabled&&(this.gl.disable(2960),this.curStEnabled=!1):(s=e.stencil,this.curStEnabled||(this.gl.enable(2960),this.curStEnabled=!0)),this.selectStencilBits(s.opBits,s.maskBits)}selectMaterialBits(e){let t=e^this.curMatBits;if(this.curMatBits<0&&(t=-1),0==t)return;let s=0!=(268435456&e);if(this.drawMode=s?3:4,0!=(3&t)){let t=3&e;0==t?this.gl.disable(2884):((this.curMatBits<0||0==(3&this.curMatBits))&&this.gl.enable(2884),this.gl.cullFace(cn.FACES[t]))}if(0!=(4194240&t)){let t=e>>6&15,s=e>>10&15,r=e>>14&15,n=e>>18&15;t==r&&s==n?0==t&&1==s?this.gl.disable(3042):((this.curMatBits<0||0==(this.curMatBits>>6&15)&&1==(this.curMatBits>>10&15))&&this.gl.enable(3042),this.gl.blendFunc(cn.BLEND[t],cn.BLEND[s])):((this.curMatBits<0||0==(this.curMatBits>>6&15)&&1==(this.curMatBits>>10&15))&&this.gl.enable(3042),this.gl.blendFuncSeparate(cn.BLEND[t],cn.BLEND[s],cn.BLEND[r],cn.BLEND[n]))}if(0!=(264241152&t)){let t=e>>22&7,s=e>>25&7;t==s?this.gl.blendEquation(cn.OP[t]):this.gl.blendEquationSeparate(cn.OP[t],cn.OP[s])}if(0!=(4&t)&&this.gl.depthMask(0!=(e>>2&1)),0!=(56&t)){let t=e>>3&7;0==t?this.gl.disable(2929):((this.curMatBits<0||0==(this.curMatBits>>3&7))&&this.gl.enable(2929),this.gl.depthFunc(cn.COMPARE[t]))}this.curMatBits=e}selectStencilBits(e,t){let s=e^this.curStOpBits,r=t^this.curStMaskBits;if(0!=(s|r)){if(0!=(4088&s)&&this.gl.stencilOpSeparate(cn.FACES[2],cn.STENCIL_OP[e>>6&7],cn.STENCIL_OP[e>>9&7],cn.STENCIL_OP[e>>3&7]),0!=(16744448&s)&&this.gl.stencilOpSeparate(cn.FACES[1],cn.STENCIL_OP[e>>18&7],cn.STENCIL_OP[e>>21&7],cn.STENCIL_OP[e>>15&7]),0!=(7&s|16711935&r)&&this.gl.stencilFuncSeparate(cn.FACES[2],cn.COMPARE[7&e],t>>16&255,255&t),0!=(28672&s|16711935&r)&&this.gl.stencilFuncSeparate(cn.FACES[1],cn.COMPARE[e>>12&7],t>>16&255,255&t),0!=(65280&r)){let e=t>>8&255;this.gl.stencilMaskSeparate(cn.FACES[2],e),this.gl.stencilMaskSeparate(cn.FACES[1],e)}this.curStOpBits=e,this.curStMaskBits=t}}clear(e,t,s){let r=0;null!=e&&(this.gl.colorMask(!0,!0,!0,!0),this.curColorMask=15,this.gl.clearColor(e.x,e.y,e.z,e.w),r|=16384),null!=t&&(this.gl.depthMask(!0),this.curMatBits>=0&&(this.curMatBits|=4),this.gl.clearDepth(t),r|=256),null!=s&&(this.selectStencilBits(this.defStencil.opBits,this.defStencil.maskBits),this.gl.clearStencil(s),r|=1024),0!=r&&this.gl.clear(r),null!=this.curTarget&&(this.curTarget.flags|=1<<Sn.WasCleared._hx_index)}resize(e,t){if(""==this.canvas.style.width){let s=e/window.devicePixelRatio|0;this.canvas.style.width=s+"px";let r=t/window.devicePixelRatio|0;this.canvas.style.height=r+"px"}this.canvas.width=e,this.canvas.height=t,this.bufferWidth=e,this.bufferHeight=t,this.gl.viewport(0,0,e,t),null!=this.defaultDepth&&(this.disposeDepthBuffer(this.defaultDepth),this.defaultDepth.width=this.bufferWidth,this.defaultDepth.height=this.bufferHeight,this.defaultDepth.b=this.allocDepthBuffer(this.defaultDepth))}getChannels(e){switch(e.internalFmt){case 6407:return 6407;case 6408:return 6408;case 32856:return 32993;case 32857:return 6408;case 6403:case 33321:case 33325:case 33326:return 6403;case 33319:case 33323:case 33327:case 33328:return 33319;case 33777:case 33778:case 33779:return 6408;case 34837:case 34843:case 35898:return 6407;case 35904:case 35905:return 6407;case 34836:case 34842:case 35906:case 35907:return 6408;default:throw $i.thrown("Invalid format "+e.internalFmt)}}isSupportedFormat(e){switch(e._hx_index){case 2:return!0;case 3:case 4:return this.hasFeature(rn.FloatTextures);case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 16:case 17:return this.glES>=3;case 14:case 15:return this.hasFeature(rn.SRGBTextures);case 18:return e.v<=this.maxCompressedTexturesSupport;default:return!1}}getBindType(e){let t=0!=(e.flags&1<<Sn.Cube._hx_index),s=0!=(e.flags&1<<Sn.IsArray._hx_index);return t?34067:s?35866:3553}allocTexture(e){cn.outOfMemoryCheck&&this.gl.getError();let t=this.gl.createTexture(),s=this,r=this.getBindType(e),n={t,width:e.width,height:e.height,internalFmt:6408,pixelFmt:5121,bits:-1,bind:r},i=e.format;switch(i._hx_index){case 1:n.internalFmt=32856;break;case 2:break;case 3:if(!this.hasFeature(rn.FloatTextures))throw $i.thrown("Unsupported texture format "+x.string(e.format));n.pixelFmt=5131,n.internalFmt=34842;break;case 4:if(!this.hasFeature(rn.FloatTextures))throw $i.thrown("Unsupported texture format "+x.string(e.format));n.internalFmt=34836,n.pixelFmt=5126;break;case 5:n.internalFmt=33321;break;case 6:n.internalFmt=33325,n.pixelFmt=5131;break;case 7:n.internalFmt=33326,n.pixelFmt=5126;break;case 8:n.internalFmt=33323;break;case 9:n.internalFmt=33327,n.pixelFmt=5131;break;case 10:n.internalFmt=33328,n.pixelFmt=5126;break;case 11:n.internalFmt=6407;break;case 12:n.internalFmt=34843,n.pixelFmt=5131;break;case 13:n.internalFmt=34837,n.pixelFmt=5126;break;case 14:n.internalFmt=35905;break;case 15:n.internalFmt=35907;break;case 16:n.internalFmt=32857,n.pixelFmt=33640;break;case 17:n.internalFmt=35898,n.pixelFmt=35899;break;case 18:let t=i.v;if(!(t<=this.maxCompressedTexturesSupport))throw $i.thrown("Unsupported texture format "+x.string(e.format));if(0!=(3&e.width)||0!=(3&e.height))throw $i.thrown("Compressed texture "+x.string(e)+" has size "+e.width+"x"+e.height+" - must be a multiple of 4");switch(t){case 1:n.internalFmt=33777;break;case 2:n.internalFmt=33778;break;case 3:n.internalFmt=33779;break;default:throw $i.thrown("Unsupported texture format "+x.string(e.format))}break;default:throw $i.thrown("Unsupported texture format "+x.string(e.format))}e.set_lastFrame(this.frame),e.flags&=-1-(1<<Sn.WasCleared._hx_index),this.gl.bindTexture(r,n.t);let a=!1;if(0!=(e.flags&1<<Sn.Cube._hx_index)){let t=0;for(;t<6;){let r,i=t++;if(this.gl.texImage2D(cn.CUBE_FACES[i],0,n.internalFmt,n.width,n.height,0,this.getChannels(n),n.pixelFmt,null),cn.outOfMemoryCheck){let t=s.gl.getError();if(1285==t)a=!0,r=!0;else{if(0!=t)throw $i.thrown("Failed to alloc texture "+x.string(e.format)+"(error "+t+")");r=!1}}else r=!1;if(r)break}}else if(0!=(e.flags&1<<Sn.IsArray._hx_index)){if(this.gl.texImage3D(35866,0,n.internalFmt,n.width,n.height,e.get_layerCount(),0,this.getChannels(n),n.pixelFmt,null),cn.outOfMemoryCheck){let t=s.gl.getError();if(1285==t)a=!0;else if(0!=t)throw $i.thrown("Failed to alloc texture "+x.string(e.format)+"(error "+t+")")}}else{let t,i=e.format;if(18==i._hx_index){i.v;t=!0}else t=!1;if(t||this.gl.texImage2D(r,0,n.internalFmt,n.width,n.height,0,this.getChannels(n),n.pixelFmt,null),cn.outOfMemoryCheck){let t=s.gl.getError();if(1285==t)a=!0;else if(0!=t)throw $i.thrown("Failed to alloc texture "+x.string(e.format)+"(error "+t+")")}}return this.restoreBind(),a?(this.gl.deleteTexture(n.t),null):n}restoreBind(){let e=this.boundTextures[this.lastActiveIndex];null==e?this.gl.bindTexture(3553,null):this.gl.bindTexture(e.bind,e.t)}allocDepthBuffer(e){let t,s=this.gl.createRenderbuffer();switch(null==e.format&&(e.format=this.glES>=3?In.Depth24Stencil8:In.Depth16),e.format._hx_index){case 0:t=33189;break;case 1:if(!(this.glES>=3))throw $i.thrown("Unsupported depth format "+x.string(e.format));t=33190;break;case 2:t=34041;break;default:throw $i.thrown("Unsupported depth format "+x.string(e.format))}return this.gl.bindRenderbuffer(36161,s),this.gl.renderbufferStorage(36161,t,e.width,e.height),this.gl.bindRenderbuffer(36161,null),{r:s}}disposeDepthBuffer(e){null!=e.b&&null!=e.b.r&&(this.gl.deleteRenderbuffer(e.b.r),e.b=null)}getDefaultDepthBuffer(){return null!=this.defaultDepth||(this.defaultDepth=new Tn(0,0),this.defaultDepth.width=this.bufferWidth,this.defaultDepth.height=this.bufferHeight,this.defaultDepth.b=this.allocDepthBuffer(this.defaultDepth)),this.defaultDepth}allocVertexes(e){cn.outOfMemoryCheck&&this.gl.getError();let t=this.gl.createBuffer();if(this.gl.bindBuffer(34962,t),e.size*e.stride==0)throw $i.thrown("assert");this.gl.bufferData(34962,e.size*e.stride*4,0!=(e.flags&1<<Lr.Dynamic._hx_index)?35048:35044);let s=cn.outOfMemoryCheck&&1285==this.gl.getError();return this.gl.bindBuffer(34962,null),s?(this.gl.deleteBuffer(t),null):{b:t,stride:e.stride}}allocIndexes(e,t){cn.outOfMemoryCheck&&this.gl.getError();let s=this.gl.createBuffer(),r=t?4:2;this.gl.bindBuffer(34963,s),this.gl.bufferData(34963,e*r,35044);let n=cn.outOfMemoryCheck&&1285==this.gl.getError();return this.gl.bindBuffer(34963,null),this.curIndexBuffer=null,n?(this.gl.deleteBuffer(s),null):{b:s,is32:t}}disposeTexture(e){let t=e.t;if(null==t)return;e.t=null;let s=0,r=this.boundTextures.length;for(;s<r;){let e=s++;this.boundTextures[e]==t&&(this.boundTextures[e]=null)}this.gl.deleteTexture(t.t)}disposeIndexes(e){this.gl.deleteBuffer(e.b)}disposeVertexes(e){this.gl.deleteBuffer(e.b)}generateMipMaps(e){let t=this.getBindType(e);this.gl.bindTexture(t,e.t.t),this.gl.generateMipmap(t),this.restoreBind()}uploadTextureBitmap(e,t,s,r){if(e.format!=On.RGBA||0!=(e.flags&1<<Sn.Cube._hx_index)){let n=t.getPixels();this.uploadTexturePixels(e,n,s,r),n.dispose()}else{let r=t.ctx;this.gl.bindTexture(3553,e.t.t),this.gl.texImage2D(3553,s,e.t.internalFmt,this.getChannels(e.t),e.t.pixelFmt,r.getImageData(0,0,t.ctx.canvas.width,t.ctx.canvas.height)),this.restoreBind()}}resetStream(){}uploadTexturePixels(e,t,s,r){let n=0!=(e.flags&1<<Sn.Cube._hx_index),i=this.getBindType(e);if(0!=(e.flags&1<<Sn.IsArray._hx_index))throw $i.thrown("TODO:texImage3D");let a=n?cn.CUBE_FACES[r]:3553;this.gl.bindTexture(i,e.t.t),t.convert(e.format),t.setFlip(!1);let l,h=t.stride*t.height;switch(e.format._hx_index){case 4:case 7:case 10:case 13:l=new Float32Array(t.bytes.b.buffer,t.offset,h>>2);break;case 3:case 6:case 9:case 12:l=new Uint16Array(t.bytes.b.buffer,t.offset,h>>1);break;case 16:case 17:l=new Uint32Array(t.bytes.b.buffer,t.offset,h>>2);break;default:l=new Uint8Array(t.bytes.b.buffer,t.offset,h)}let o,_=e.format;if(18==_._hx_index){_.v;o=!0}else o=!1;o?this.gl.compressedTexImage2D(a,s,e.t.internalFmt,t.width,t.height,0,l):this.gl.texImage2D(a,s,e.t.internalFmt,t.width,t.height,0,this.getChannels(e.t),e.t.pixelFmt,l),e.flags|=1<<Sn.WasCleared._hx_index,this.restoreBind()}uploadVertexBuffer(e,t,s,r,n){let i=e.stride;this.gl.bindBuffer(34962,e.b);let a=r.array,l=new Float32Array(a.buffer,4*n,s*i);this.gl.bufferSubData(34962,t*i*4,l),this.gl.bindBuffer(34962,null)}uploadIndexBuffer(e,t,s,r,n){let i=e.is32?2:1;this.gl.bindBuffer(34963,e.b);let a=new Uint16Array(r),l=new Uint16Array(a.buffer,n<<i,s);this.gl.bufferSubData(34963,t<<i,l),this.gl.bindBuffer(34963,null),this.curIndexBuffer=null}selectBuffer(e){if(e==this.curBuffer)return;if(null!=this.curBuffer&&e.buffer==this.curBuffer.buffer&&0!=(e.buffer.flags&1<<Lr.RawFormat._hx_index)==(0!=(this.curBuffer.flags&1<<Lr.RawFormat._hx_index)))return void(this.curBuffer=e);if(null==this.curShader)throw $i.thrown("No shader selected");this.curBuffer=e;let t=e.buffer.vbuf;if(t.stride<this.curShader.stride)throw $i.thrown("Buffer stride ("+t.stride+") and shader stride ("+this.curShader.stride+") mismatch");if(this.gl.bindBuffer(34962,t.b),0!=(e.flags&1<<Lr.RawFormat._hx_index)){let e=0,s=this.curShader.attribs;for(;e<s.length;){let r=s[e];++e;let n=r.offset;this.gl.vertexAttribPointer(r.index,r.size,r.type,!1,4*t.stride,4*n),this.currentDivisor[r.index]!=r.divisor&&(this.currentDivisor[r.index]=r.divisor,this.gl.vertexAttribDivisor(r.index,r.divisor))}}else{let e=8,s=0,r=this.curShader.attribs.length;for(;s<r;){let r,n=s++,i=this.curShader.attribs[n],a=this.curShader.inputs.names[n];switch(a){case"normal":if(t.stride<6)throw $i.thrown("Buffer is missing NORMAL data, set it to RAW format ?");r=3;break;case"position":r=0;break;case"uv":if(t.stride<8)throw $i.thrown("Buffer is missing UV data, set it to RAW format ?");r=6;break;default:let s=a;if(r=e,e+=i.size,e>t.stride)throw $i.thrown("Buffer is missing '"+s+"' data, set it to RAW format ?")}this.gl.vertexAttribPointer(i.index,i.size,i.type,!1,4*t.stride,4*r),this.currentDivisor[i.index]!=i.divisor&&(this.currentDivisor[i.index]=i.divisor,this.gl.vertexAttribDivisor(i.index,i.divisor))}}}draw(e,t,s){e!=this.curIndexBuffer&&(this.curIndexBuffer=e,this.gl.bindBuffer(34963,e.b)),e.is32?this.gl.drawElements(this.drawMode,3*s,5125,4*t):this.gl.drawElements(this.drawMode,3*s,5123,2*t)}end(){}isDisposed(){return this.gl.isContextLost()}setRenderZone(e,t,s,r){0==e&&0==t&&s<0&&r<0?this.gl.disable(3089):(this.gl.enable(3089),null==this.curTarget&&(t=this.bufferHeight-(t+r)),this.gl.scissor(e,t,s,r))}setDrawBuffers(e){this.glES>=3?this.gl.drawBuffers(cn.CBUFFERS[e]):null!=this.mrtExt&&this.mrtExt.drawBuffersWEBGL(cn.CBUFFERS[e])}unbindTargets(){if(null!=this.curTarget&&this.numTargets>1){for(;this.numTargets>1;)this.gl.framebufferTexture2D(36160,36064+--this.numTargets,3553,null,0),this.curTargets[this.numTargets]=null;this.setDrawBuffers(1)}}capturePixels(e,t,s,r){let n,i,a;null!=r?(r.xMax>e.width&&(r.xMax=e.width),r.yMax>e.height&&(r.yMax=e.height),r.xMin<0&&(r.xMin=0),r.yMin<0&&(r.yMin=0),n=$a.alloc(r.xMax-r.xMin>>s,r.yMax-r.yMin>>s,e.format),i=r.xMin,a=r.yMin):(n=$a.alloc(e.width>>s,e.height>>s,e.format),i=0,a=0);let l=this.curTarget,h=this.numTargets,o=this.curTargetLayer,_=this.curTargetMip;if(h>1){this.numTargets=1;let t=1,s=h;for(;t<s;){let s=t++;this.curTargets[s]==e&&this.gl.framebufferTexture2D(36160,36064+s,3553,null,0)}}if(this.setRenderTarget(e,t,s),this.captureSubRenderBuffer(n,i,a),this.setRenderTarget(l,o,_),h>1){let t=1,s=h;for(;t<s;){let s=t++;this.curTargets[s]==e&&this.gl.framebufferTexture2D(36160,36064+s,3553,e.t.t,0)}this.setDrawBuffers(h),this.numTargets=h}return n}setRenderTarget(e,t,s){if(null==s&&(s=0),null==t&&(t=0),this.unbindTargets(),this.curTarget=e,null==e)return this.gl.bindFramebuffer(36160,null),void this.gl.viewport(0,0,this.bufferWidth,this.bufferHeight);if(null!=e.depthBuffer&&(e.depthBuffer.width!=e.width||e.depthBuffer.height!=e.height))throw $i.thrown("Invalid depth buffer size : does not match render target size");if(s>0&&1==this.glES)throw $i.thrown("Cannot render to mipLevel in WebGL1, use upload() instead");if(null==e.t&&e.alloc(),0!=(e.flags&1<<Sn.MipMapped._hx_index)&&0==(e.flags&1<<Sn.WasCleared._hx_index)){let t=this.getBindType(e);this.gl.bindTexture(t,e.t.t),this.gl.generateMipmap(t),this.restoreBind()}e.flags|=1<<Sn.WasCleared._hx_index,e.set_lastFrame(this.frame),this.curTargetLayer=t,this.curTargetMip=s,this.gl.bindFramebuffer(36160,this.commonFB),0!=(e.flags&1<<Sn.IsArray._hx_index)?this.gl.framebufferTextureLayer(36160,36064,e.t.t,s,t):this.gl.framebufferTexture2D(36160,36064,0!=(e.flags&1<<Sn.Cube._hx_index)?cn.CUBE_FACES[t]:3553,e.t.t,s),null!=e.depthBuffer?(this.gl.framebufferRenderbuffer(36160,36096,36161,e.depthBuffer.b.r),this.gl.framebufferRenderbuffer(36160,36128,36161,e.depthBuffer.hasStencil()?e.depthBuffer.b.r:null)):(this.gl.framebufferRenderbuffer(36160,36096,36161,null),this.gl.framebufferRenderbuffer(36160,36128,36161,null)),this.gl.viewport(0,0,e.width>>s,e.height>>s);let r=0,n=this.boundTextures.length;for(;r<n;){let e=r++;this.boundTextures[e]=null}if(this.glDebug){let e=this.gl.checkFramebufferStatus(36160);if(36053!=e)throw $i.thrown("Invalid frame buffer: "+e)}}setRenderTargets(e){if(this.unbindTargets(),this.setRenderTarget(e[0]),e.length<2)return;this.numTargets=e.length;let t=1,s=e.length;for(;t<s;){let s=t++,r=e[s];null==r.t&&r.alloc(),this.gl.framebufferTexture2D(36160,36064+s,3553,r.t.t,0),this.curTargets[s]=r,r.set_lastFrame(this.frame),r.flags|=1<<Sn.WasCleared._hx_index}this.setDrawBuffers(e.length)}init(e,t){null==t&&(t=!1);let s=!1;if("complete"==window.document.readyState){let t=e,s=!1;ha.delay((function(){t(s)}),1)}else window.addEventListener("load",(function(t){s||(s=!0,e(!1))}))}hasFeature(e){return this.features.get(e)}makeFeatures(){let e=0,t=rn.__empty_constructs__.slice();for(;e<t.length;){let s=t[e];++e,this.features.set(s,this.checkFeature(s))}null!=this.gl.getExtension("WEBGL_compressed_texture_s3tc")&&(this.maxCompressedTexturesSupport=3)}checkFeature(e){switch(e._hx_index){case 0:return this.glES>=3||null!=this.gl.getExtension("OES_standard_derivatives");case 1:return this.glES>=3?null!=this.gl.getExtension("EXT_color_buffer_float")&&null!=this.gl.getExtension("OES_texture_float_linear"):null!=this.gl.getExtension("OES_texture_float")&&null!=this.gl.getExtension("OES_texture_float_linear")&&null!=this.gl.getExtension("OES_texture_half_float")&&null!=this.gl.getExtension("OES_texture_half_float_linear");case 4:return this.glES>=3||(null!=this.mrtExt||null!=(this.mrtExt=this.gl.getExtension("WEBGL_draw_buffers")));case 6:return this.glES>=3||null!=this.gl.getExtension("EXT_sRGB");case 7:return this.glES>=3;case 2:case 3:case 8:case 9:return!0;case 10:return this.glES>=3||null!=this.gl.getExtension("ANGLE_instanced_arrays");default:return!1}}captureSubRenderBuffer(e,t,s){if(null==this.curTarget)throw $i.thrown("Can't capture main render buffer in GL");cn.outOfMemoryCheck&&this.gl.getError();let r=e.bytes.b;switch(this.curTarget.format._hx_index){case 4:case 7:case 10:case 13:r=new Float32Array(r.buffer);break;case 3:case 6:case 9:case 12:r=new Uint16Array(r.buffer);break;case 16:case 17:r=new Uint32Array(r.buffer)}this.gl.readPixels(t,s,e.width,e.height,this.getChannels(this.curTarget.t),this.curTarget.t.pixelFmt,r);let n=this.gl.getError();if(0!=n)throw $i.thrown("Failed to capture pixels (error "+n+")");e.set_innerFormat(this.curTarget.format)}}s["h3d.impl.GlDriver"]=cn,cn.__name__="h3d.impl.GlDriver",cn.__super__=ln,Object.assign(cn.prototype,{__class__:cn});class un{constructor(e,t,s){this.pos=e,this.count=t,this.next=s}}s["h3d.impl._ManagedBuffer.FreeCell"]=un,un.__name__="h3d.impl._ManagedBuffer.FreeCell",Object.assign(un.prototype,{__class__:un});class dn{constructor(e,t,s){if(this.flags=0,null!=s){let e=0;for(;e<s.length;){let t=s[e];++e,this.flags|=1<<t._hx_index}}this.size=t,this.stride=e,this.freeList=new un(0,t,null),this.mem=Wr.CURRENT.mem,this.mem.allocManaged(this)}uploadVertexBuffer(e,t,s,r){null==r&&(r=0),this.mem.driver.uploadVertexBuffer(this.vbuf,e,t,s,r)}allocPosition(e,t){let s=this.freeList;for(;null!=s;){if(s.count>=e){let r=(t-s.pos%t)%t;if(0==r)break;if(s.count>=e+r){s.next=new un(s.pos+r,s.count-r,s.next),s.count=r,s=s.next;break}}s=s.next}if(null==s)return-1;let r=s.pos;return s.pos+=e,s.count-=e,r}allocBuffer(e){let t=0!=(e.flags&1<<Lr.Quads._hx_index)?4:0!=(e.flags&1<<Lr.Triangles._hx_index)?3:1,s=this.allocPosition(e.vertices,t);return!(s<0)&&(e.position=s,e.buffer=this,!0)}freeBuffer(e){let t=null,s=this.freeList,r=e.vertices,n=e.position+r;for(;null!=s;){if(s.pos==n){s.pos-=r,s.count+=r,null!=t&&t.pos+t.count==s.pos&&(t.count+=s.count,t.next=s.next),r=0;break}if(s.pos>n){if(null!=t&&t.pos+t.count==e.position)t.count+=r;else{let n=new un(e.position,r,s);null==t?this.freeList=n:t.next=n}r=0;break}t=s,s=s.next}if(0!=r)throw $i.thrown("assert");this.freeList.count==this.size&&0==(this.flags&1<<Lr.Managed._hx_index)&&this.dispose()}dispose(){this.mem.freeManaged(this)}}s["h3d.impl.ManagedBuffer"]=dn,dn.__name__="h3d.impl.ManagedBuffer",Object.assign(dn.prototype,{__class__:dn});class pn{constructor(e){this.bufferCount=0,this.texMemory=0,this.usedMemory=0,this.driver=e}init(){this.indexes=[],this.textures=[],this.buffers=[],this.depths=[],this.initIndexes()}initIndexes(){let e=new Array(0),t=0;for(;t<65533;){let s=t++;e.push(s)}this.triIndexes=Nr.alloc(e);let s=new Array(0),r=0;for(;r<16383;){let e=r++<<2;s.push(e),s.push(e+1),s.push(e+2),s.push(e+2),s.push(e+1),s.push(e+3)}s.push(65533),this.quadIndexes=Nr.alloc(s)}garbage(){}cleanManagedBuffers(){let e=1,t=this.buffers.length;for(;e<t;){let t=e++,s=this.buffers[t],r=null;for(;null!=s;)s.freeList.count==s.size?(s.dispose(),null==r?this.buffers[t]=s.next:r.next=s.next):r=s,s=s.next}}allocManaged(e){if(null!=e.vbuf)return;let t=e.size*e.stride*4;if(0!=t){for(;this.usedMemory+t>4294967296||this.bufferCount>=65536||null==(e.vbuf=this.driver.allocVertexes(e));){if(this.driver.isDisposed())return;let e=this.usedMemory-this.freeMemorySize();if(this.garbage(),this.cleanManagedBuffers(),this.usedMemory-this.freeMemorySize()==e){if(this.bufferCount>=65536)throw $i.thrown("Too many buffers");throw $i.thrown("Memory full ("+Math.ceil(e/1024)+" KB,"+this.bufferCount+" buffers)")}}this.usedMemory+=t,this.bufferCount++}}freeManaged(e){if(null!=e.vbuf&&(this.driver.disposeVertexes(e.vbuf),e.vbuf=null,this.usedMemory-=e.size*e.stride*4,this.bufferCount--,0==(e.flags&1<<Lr.Managed._hx_index))){let t=this.buffers[0],s=null;for(;null!=t;){if(t==e){null==s?this.buffers[0]=e.next:s.next=e.next;break}s=t,t=t.next}}}allocBuffer(e,t){let s=0!=(e.flags&1<<Lr.Quads._hx_index)?65532:0!=(e.flags&1<<Lr.Triangles._hx_index)?65533:65534;if(e.vertices>s){if(65534==s)throw $i.thrown("Cannot split buffer with "+e.vertices+" vertices if it's not Quads/Triangles");let r=e.vertices-s;e.vertices=s,this.allocBuffer(e,t);let n=e;for(;null!=n.next;)n=n.next;let i=[],a=0,l=pn.ALL_FLAGS;for(;a<l.length;){let t=l[a];++a,0!=(e.flags&1<<t._hx_index)&&i.push(t)}return void(n.next=new Gr(r,t,i))}if(0==(e.flags&1<<Lr.Managed._hx_index)){let s=null;0!=(e.flags&1<<Lr.Dynamic._hx_index)&&(null==s&&(s=[]),s.push(Lr.Dynamic)),0!=(e.flags&1<<Lr.UniformBuffer._hx_index)&&(null==s&&(s=[]),s.push(Lr.UniformBuffer));let r=new dn(t,e.vertices,s);if(r.next=this.buffers[0],this.buffers[0]=r,!r.allocBuffer(e))throw $i.thrown("assert");return}let r=this.buffers[t],n=null;for(;null!=r;){if(r.allocBuffer(e))return;n=r,r=r.next}let i=0!=(e.flags&1<<Lr.Triangles._hx_index)?3:0!=(e.flags&1<<Lr.Quads._hx_index)?4:0;if(null==r&&i>0){let s=e.vertices,n=s;for(;n>2048;)for(r=this.buffers[t],n>>=1,n-=n%i,e.vertices=n;null!=r;){if(r.allocBuffer(e)){let r=[],i=0,a=pn.ALL_FLAGS;for(;i<a.length;){let t=a[i];++i,0!=(e.flags&1<<t._hx_index)&&r.push(t)}return void(e.next=new Gr(s-n,t,r))}r=r.next}e.vertices=s}if(r=new dn(t,65533,[Lr.Managed]),null==n?this.buffers[t]=r:n.next=r,!r.allocBuffer(e))throw $i.thrown("assert")}deleteIndexes(e){c.remove(this.indexes,e),this.driver.disposeIndexes(e.ibuf),e.ibuf=null,this.usedMemory-=e.count*(e.is32?4:2)}allocIndexes(e){e.ibuf=this.driver.allocIndexes(e.count,e.is32),this.indexes.push(e),this.usedMemory+=e.count*(e.is32?4:2)}bpp(e){return 4}cleanTextures(e){null==e&&(e=!0),this.textures.sort(ao(this,this.sortByLRU));let t=0,s=this.textures;for(;t<s.length;){let r=s[t];if(++t,null!=r.realloc&&(null!=r.t||null!=r.realloc)&&(e||r.get_lastFrame()<nl.frameCount-3600))return r.dispose(),!0}return!1}sortByLRU(e,t){return e.get_lastFrame()-t.get_lastFrame()}deleteTexture(e){c.remove(this.textures,e)&&(this.driver.disposeTexture(e),this.texMemory-=e.width*e.height*this.bpp(e))}allocTexture(e){this.cleanTextures(!1);if(e.t=this.driver.allocTexture(e),null!=e.t)this.textures.push(e),this.texMemory+=e.width*e.height*this.bpp(e);else{if(this.driver.isDisposed())return;if(!this.cleanTextures(!0))throw $i.thrown("Maximum texture memory reached");this.allocTexture(e)}}allocDepth(e){this.cleanTextures(!1);if(e.b=this.driver.allocDepthBuffer(e),null!=e.b)this.depths.push(e),this.texMemory+=e.width*e.height*4;else{if(this.driver.isDisposed())return;if(!this.cleanTextures(!0))throw $i.thrown("Maximum texture memory reached");this.allocDepth(e)}}deleteDepth(e){c.remove(this.depths,e)&&(this.driver.disposeDepthBuffer(e),this.texMemory-=e.width*e.height*4)}onContextLost(){this.dispose(),this.initIndexes()}dispose(){null!=this.triIndexes&&this.triIndexes.dispose(),null!=this.quadIndexes&&this.quadIndexes.dispose(),this.triIndexes=null,this.quadIndexes=null;let e=0,t=this.textures.slice();for(;e<t.length;){let s=t[e];++e,s.dispose()}let s=0,r=this.depths.slice();for(;s<r.length;){let e=r[s];++s,e.dispose()}let n=0,i=this.buffers.slice();for(;n<i.length;){let e=i[n];++n;let t=e;for(;null!=t;)t.dispose(),t=t.next}let a=0,l=this.indexes.slice();for(;a<l.length;){let e=l[a];++a,e.dispose()}this.buffers=[],this.indexes=[],this.textures=[],this.bufferCount=0,this.usedMemory=0,this.texMemory=0}freeMemorySize(){let e=0,t=0,s=this.buffers;for(;t<s.length;){let r=s[t];++t;let n=r;for(;null!=n;){let t=n.freeList;for(;null!=t;)e+=t.count*n.stride*4,t=t.next;n=n.next}}return e}}s["h3d.impl.MemoryManager"]=pn,pn.__name__="h3d.impl.MemoryManager",Object.assign(pn.prototype,{__class__:pn});class fn{}s["h3d.impl.RendererFX"]=fn,fn.__name__="h3d.impl.RendererFX",fn.__isInterface__=!0,Object.assign(fn.prototype,{__class__:fn});class xn{constructor(e){this.position=0,this.ctx=e,this.cache=[];Wr.CURRENT;this.defaultFormat=Pn.nativeFormat,this.defaultDepthBuffer=Tn.getDefault()}begin(){for(;this.cache.length>this.position;){let e=this.cache.pop();null!=e&&e.dispose()}this.position=0}lookupTarget(e,t,s,r,n){let i=this.cache[this.position],a=this.position+1,l=this.cache.length;for(;a<l;){let e=a++,l=this.cache[e];if(null!=l&&(null!=l.t||null!=l.realloc)&&l.width==t&&l.height==s&&l.format==r&&n==(0!=(l.flags&1<<Sn.Cube._hx_index)))return this.cache[this.position]=l,this.cache[e]=i,l}null!=i&&i.name==e&&(i.dispose(),i=null);let h=[Sn.Target];n&&h.push(Sn.Cube);let o=new Pn(t,s,h,r);return null!=i?this.cache.splice(this.position,0,o):this.cache[this.position]=o,o}allocTarget(e,t,s,r,n,i){null==i&&(i=!1),null==r&&(r=!0);let a=this.cache[this.position];return null==n&&(n=this.defaultFormat),(null==a||null==a.t&&null==a.realloc||a.width!=t||a.height!=s||a.format!=n||i!=(0!=(a.flags&1<<Sn.Cube._hx_index)))&&(a=this.lookupTarget(e,t,s,n,i)),a.depthBuffer=r?this.defaultDepthBuffer:null,a.setName(e),this.position++,a}dispose(){let e=0,t=this.cache;for(;e<t.length;){let s=t[e];++e,s.dispose()}this.cache=[]}}s["h3d.impl.TextureCache"]=xn,xn.__name__="h3d.impl.TextureCache",Object.assign(xn.prototype,{__class__:xn});class gn{set_props(e){return this.props=e,this.refreshProps(),e}getDefaultProps(e){return{}}refreshProps(){}}s["hxd.impl.AnyProps"]=gn,gn.__name__="hxd.impl.AnyProps",Object.assign(gn.prototype,{__class__:gn});class bn extends gn{constructor(e){super(),bn._hx_skip_constructor||this._hx_constructor(e)}_hx_constructor(e){null!=e&&this.addPass(new Rn("default",null)).addShader(e)}addPass(e){let t=null,s=this.passes;for(;null!=s;)t=s,s=s.nextPass;return null==t?this.passes=e:t.nextPass=e,e.nextPass=null,e}removePass(e){let t=null,s=this.passes;for(;null!=s;){if(s==e)return null==t?this.passes=e.nextPass:t.nextPass=e.nextPass,e.nextPass=null,!0;t=s,s=s.nextPass}return!1}getPass(e){let t=this.passes;for(;null!=t;){if(t.name==e)return t;t=t.nextPass}return null}}s["h3d.mat.BaseMaterial"]=bn,bn.__name__="h3d.mat.BaseMaterial",bn.__interfaces__=[Hr],bn.__super__=gn,Object.assign(bn.prototype,{__class__:bn});var mn=n["h3d.mat.Face"]={__ename__:"h3d.mat.Face",__constructs__:["None","Back","Front","Both"],None:{_hx_index:0,__enum__:"h3d.mat.Face",toString:r},Back:{_hx_index:1,__enum__:"h3d.mat.Face",toString:r},Front:{_hx_index:2,__enum__:"h3d.mat.Face",toString:r},Both:{_hx_index:3,__enum__:"h3d.mat.Face",toString:r}};mn.__empty_constructs__=[mn.None,mn.Back,mn.Front,mn.Both];var An=n["h3d.mat.Blend"]={__ename__:"h3d.mat.Blend",__constructs__:["One","Zero","SrcAlpha","SrcColor","DstAlpha","DstColor","OneMinusSrcAlpha","OneMinusSrcColor","OneMinusDstAlpha","OneMinusDstColor","ConstantColor","ConstantAlpha","OneMinusConstantColor","OneMinusConstantAlpha","SrcAlphaSaturate"],One:{_hx_index:0,__enum__:"h3d.mat.Blend",toString:r},Zero:{_hx_index:1,__enum__:"h3d.mat.Blend",toString:r},SrcAlpha:{_hx_index:2,__enum__:"h3d.mat.Blend",toString:r},SrcColor:{_hx_index:3,__enum__:"h3d.mat.Blend",toString:r},DstAlpha:{_hx_index:4,__enum__:"h3d.mat.Blend",toString:r},DstColor:{_hx_index:5,__enum__:"h3d.mat.Blend",toString:r},OneMinusSrcAlpha:{_hx_index:6,__enum__:"h3d.mat.Blend",toString:r},OneMinusSrcColor:{_hx_index:7,__enum__:"h3d.mat.Blend",toString:r},OneMinusDstAlpha:{_hx_index:8,__enum__:"h3d.mat.Blend",toString:r},OneMinusDstColor:{_hx_index:9,__enum__:"h3d.mat.Blend",toString:r},ConstantColor:{_hx_index:10,__enum__:"h3d.mat.Blend",toString:r},ConstantAlpha:{_hx_index:11,__enum__:"h3d.mat.Blend",toString:r},OneMinusConstantColor:{_hx_index:12,__enum__:"h3d.mat.Blend",toString:r},OneMinusConstantAlpha:{_hx_index:13,__enum__:"h3d.mat.Blend",toString:r},SrcAlphaSaturate:{_hx_index:14,__enum__:"h3d.mat.Blend",toString:r}};An.__empty_constructs__=[An.One,An.Zero,An.SrcAlpha,An.SrcColor,An.DstAlpha,An.DstColor,An.OneMinusSrcAlpha,An.OneMinusSrcColor,An.OneMinusDstAlpha,An.OneMinusDstColor,An.ConstantColor,An.ConstantAlpha,An.OneMinusConstantColor,An.OneMinusConstantAlpha,An.SrcAlphaSaturate];var wn=n["h3d.mat.Compare"]={__ename__:"h3d.mat.Compare",__constructs__:["Always","Never","Equal","NotEqual","Greater","GreaterEqual","Less","LessEqual"],Always:{_hx_index:0,__enum__:"h3d.mat.Compare",toString:r},Never:{_hx_index:1,__enum__:"h3d.mat.Compare",toString:r},Equal:{_hx_index:2,__enum__:"h3d.mat.Compare",toString:r},NotEqual:{_hx_index:3,__enum__:"h3d.mat.Compare",toString:r},Greater:{_hx_index:4,__enum__:"h3d.mat.Compare",toString:r},GreaterEqual:{_hx_index:5,__enum__:"h3d.mat.Compare",toString:r},Less:{_hx_index:6,__enum__:"h3d.mat.Compare",toString:r},LessEqual:{_hx_index:7,__enum__:"h3d.mat.Compare",toString:r}};wn.__empty_constructs__=[wn.Always,wn.Never,wn.Equal,wn.NotEqual,wn.Greater,wn.GreaterEqual,wn.Less,wn.LessEqual];var yn=n["h3d.mat.StencilOp"]={__ename__:"h3d.mat.StencilOp",__constructs__:["Keep","Zero","Replace","Increment","IncrementWrap","Decrement","DecrementWrap","Invert"],Keep:{_hx_index:0,__enum__:"h3d.mat.StencilOp",toString:r},Zero:{_hx_index:1,__enum__:"h3d.mat.StencilOp",toString:r},Replace:{_hx_index:2,__enum__:"h3d.mat.StencilOp",toString:r},Increment:{_hx_index:3,__enum__:"h3d.mat.StencilOp",toString:r},IncrementWrap:{_hx_index:4,__enum__:"h3d.mat.StencilOp",toString:r},Decrement:{_hx_index:5,__enum__:"h3d.mat.StencilOp",toString:r},DecrementWrap:{_hx_index:6,__enum__:"h3d.mat.StencilOp",toString:r},Invert:{_hx_index:7,__enum__:"h3d.mat.StencilOp",toString:r}};yn.__empty_constructs__=[yn.Keep,yn.Zero,yn.Replace,yn.Increment,yn.IncrementWrap,yn.Decrement,yn.DecrementWrap,yn.Invert];var kn=n["h3d.mat.MipMap"]={__ename__:"h3d.mat.MipMap",__constructs__:["None","Nearest","Linear"],None:{_hx_index:0,__enum__:"h3d.mat.MipMap",toString:r},Nearest:{_hx_index:1,__enum__:"h3d.mat.MipMap",toString:r},Linear:{_hx_index:2,__enum__:"h3d.mat.MipMap",toString:r}};kn.__empty_constructs__=[kn.None,kn.Nearest,kn.Linear];var Bn=n["h3d.mat.Filter"]={__ename__:"h3d.mat.Filter",__constructs__:["Nearest","Linear"],Nearest:{_hx_index:0,__enum__:"h3d.mat.Filter",toString:r},Linear:{_hx_index:1,__enum__:"h3d.mat.Filter",toString:r}};Bn.__empty_constructs__=[Bn.Nearest,Bn.Linear];var Cn=n["h3d.mat.Wrap"]={__ename__:"h3d.mat.Wrap",__constructs__:["Clamp","Repeat"],Clamp:{_hx_index:0,__enum__:"h3d.mat.Wrap",toString:r},Repeat:{_hx_index:1,__enum__:"h3d.mat.Wrap",toString:r}};Cn.__empty_constructs__=[Cn.Clamp,Cn.Repeat];var vn=n["h3d.mat.Operation"]={__ename__:"h3d.mat.Operation",__constructs__:["Add","Sub","ReverseSub","Min","Max"],Add:{_hx_index:0,__enum__:"h3d.mat.Operation",toString:r},Sub:{_hx_index:1,__enum__:"h3d.mat.Operation",toString:r},ReverseSub:{_hx_index:2,__enum__:"h3d.mat.Operation",toString:r},Min:{_hx_index:3,__enum__:"h3d.mat.Operation",toString:r},Max:{_hx_index:4,__enum__:"h3d.mat.Operation",toString:r}};vn.__empty_constructs__=[vn.Add,vn.Sub,vn.ReverseSub,vn.Min,vn.Max];var Sn=n["h3d.mat.TextureFlags"]={__ename__:"h3d.mat.TextureFlags",__constructs__:["Target","Cube","MipMapped","ManualMipMapGen","IsNPOT","NoAlloc","Dynamic","AlphaPremultiplied","WasCleared","Loading","Serialize","IsArray"],Target:{_hx_index:0,__enum__:"h3d.mat.TextureFlags",toString:r},Cube:{_hx_index:1,__enum__:"h3d.mat.TextureFlags",toString:r},MipMapped:{_hx_index:2,__enum__:"h3d.mat.TextureFlags",toString:r},ManualMipMapGen:{_hx_index:3,__enum__:"h3d.mat.TextureFlags",toString:r},IsNPOT:{_hx_index:4,__enum__:"h3d.mat.TextureFlags",toString:r},NoAlloc:{_hx_index:5,__enum__:"h3d.mat.TextureFlags",toString:r},Dynamic:{_hx_index:6,__enum__:"h3d.mat.TextureFlags",toString:r},AlphaPremultiplied:{_hx_index:7,__enum__:"h3d.mat.TextureFlags",toString:r},WasCleared:{_hx_index:8,__enum__:"h3d.mat.TextureFlags",toString:r},Loading:{_hx_index:9,__enum__:"h3d.mat.TextureFlags",toString:r},Serialize:{_hx_index:10,__enum__:"h3d.mat.TextureFlags",toString:r},IsArray:{_hx_index:11,__enum__:"h3d.mat.TextureFlags",toString:r}};Sn.__empty_constructs__=[Sn.Target,Sn.Cube,Sn.MipMapped,Sn.ManualMipMapGen,Sn.IsNPOT,Sn.NoAlloc,Sn.Dynamic,Sn.AlphaPremultiplied,Sn.WasCleared,Sn.Loading,Sn.Serialize,Sn.IsArray];class Mn{static get_shadowShader(){let e=Mn.shadowShader;return null==e&&(e=new Gi,Mn.set_shadowShader(e),Mn.shadowShader.setPriority(-1)),e}static set_shadowShader(e){return Mn.shadowShader=e}}s["h3d.mat.Defaults"]=Mn,Mn.__name__="h3d.mat.Defaults";var In=n["h3d.mat.DepthFormat"]={__ename__:"h3d.mat.DepthFormat",__constructs__:["Depth16","Depth24","Depth24Stencil8"],Depth16:{_hx_index:0,__enum__:"h3d.mat.DepthFormat",toString:r},Depth24:{_hx_index:1,__enum__:"h3d.mat.DepthFormat",toString:r},Depth24Stencil8:{_hx_index:2,__enum__:"h3d.mat.DepthFormat",toString:r}};In.__empty_constructs__=[In.Depth16,In.Depth24,In.Depth24Stencil8];class Tn{constructor(e,t,s){this.width=e,this.height=t,this.format=s,e>0&&this.alloc()}hasStencil(){switch(this.format._hx_index){case 0:case 1:return!1;case 2:return!0}}alloc(){Wr.CURRENT.mem.allocDepth(this)}dispose(){null!=this.b&&(Wr.CURRENT.mem.deleteDepth(this),this.b=null)}isDisposed(){return null==this.b}static getDefault(){return Wr.CURRENT.driver.getDefaultDepthBuffer()}}s["h3d.mat.DepthBuffer"]=Tn,Tn.__name__="h3d.mat.DepthBuffer",Object.assign(Tn.prototype,{__class__:Tn});class Fn extends bn{constructor(e){bn._hx_skip_constructor=!0,super(),bn._hx_skip_constructor=!1,this._hx_constructor(e)}_hx_constructor(e){this.mshader=new Si,this.set_blendMode(Ar.None),super._hx_constructor(this.mshader),this.set_texture(e)}set_castShadows(e){return this.castShadows==e?e:(null!=this.passes&&(e?this.addPass(new Rn("shadow",null,this.passes)).set_isStatic(this.staticShadows):this.removePass(this.getPass("shadow"))),this.castShadows=e)}set_receiveShadows(e){if(e==this.receiveShadows)return e;if(null!=this.passes){let t=Mn.get_shadowShader();e?this.passes.addShader(t):this.passes.removeShader(t)}return this.receiveShadows=e}set_blendMode(e){if(null!=this.passes)switch(this.passes.setBlendMode(e),e._hx_index){case 0:this.passes.set_depthWrite(!0),this.passes.setPassName("default");break;case 1:this.passes.set_depthWrite(!0),this.passes.setPassName("alpha");break;case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:this.passes.set_depthWrite(!1),this.passes.setPassName("additive")}return this.blendMode=e}set_texture(e){return null==e?null!=this.textureShader&&(this.passes.removeShader(this.textureShader),this.textureShader=null):(null==this.textureShader&&(this.textureShader=new ji,this.passes.addShader(this.textureShader)),this.textureShader.texture__=e),e}getDefaultProps(e){let t;if(null==e)t={kind:"Opaque",shadows:!0,culling:!0,light:!0};else switch(e){case"particles3D":case"trail3D":t={kind:"Alpha",shadows:!1,culling:!1,light:!0};break;case"ui":t={kind:"Alpha",shadows:!1,culling:!1,light:!1};break;default:t={kind:"Opaque",shadows:!0,culling:!0,light:!0}}return t}refreshProps(){if(null==this.props||null==this.passes)return;let e=this.props;switch(e.kind){case"Add":this.set_blendMode(Ar.Add);break;case"Alpha":this.set_blendMode(Ar.Alpha);break;case"AlphaKill":case"Hidden":case"Opaque":this.set_blendMode(Ar.None);break;case"SoftAdd":this.set_blendMode(Ar.SoftAdd)}let t=this.textureShader;null!=t&&(t.constModified=!0,t.killAlpha__="AlphaKill"==e.kind,t.killAlphaThreshold__=.5),this.passes.set_culling("Hidden"==e.kind?mn.Both:e.culling?mn.Back:mn.None),this.passes.set_enableLights(e.light);let s=e.shadows;this.set_castShadows(s),this.set_receiveShadows(s),this.castShadows&&this.receiveShadows&&this.getPass("shadow").set_culling(this.passes.culling)}}s["h3d.mat.Material"]=Fn,Fn.__name__="h3d.mat.Material",Fn.__super__=bn,Object.assign(Fn.prototype,{__class__:Fn});class En{constructor(){}}s["h3d.mat.MaterialDatabase"]=En,En.__name__="h3d.mat.MaterialDatabase",Object.assign(En.prototype,{__class__:En});class Dn{constructor(e){null==this.database&&(this.database=new En),this.name=e}createRenderer(){return new Bi}createLightSystem(){return new wi}createMaterial(){return new Fn}}s["h3d.mat.MaterialSetup"]=Dn,Dn.__name__="h3d.mat.MaterialSetup",Object.assign(Dn.prototype,{__class__:Dn});class Rn{constructor(e,t,s){this.layer=0,this.bits=0,this.parentPass=s,this.shaders=t,this.setPassName(e),this.set_culling(mn.Back);let r=An.One,n=An.Zero;this.set_blendSrc(r),this.set_blendAlphaSrc(r),this.set_blendDst(n),this.set_blendAlphaDst(n),this.depth(!0,wn.Less),this.set_blendOp(this.set_blendAlphaOp(vn.Add)),this.colorMask=15}setPassName(e){this.name=e,this.passId=yh.allocID(e)}setBlendMode(e){switch(e._hx_index){case 0:let e=An.One,t=An.Zero;this.set_blendSrc(e),this.set_blendAlphaSrc(e),this.set_blendDst(t),this.set_blendAlphaDst(t),this.set_blendOp(vn.Add),this.set_blendAlphaOp(vn.Add);break;case 1:let s=An.SrcAlpha,r=An.OneMinusSrcAlpha;this.set_blendSrc(s),this.set_blendAlphaSrc(s),this.set_blendDst(r),this.set_blendAlphaDst(r),this.set_blendOp(vn.Add),this.set_blendAlphaOp(vn.Add);break;case 2:let n=An.SrcAlpha,i=An.One;this.set_blendSrc(n),this.set_blendAlphaSrc(n),this.set_blendDst(i),this.set_blendAlphaDst(i),this.set_blendOp(vn.Add),this.set_blendAlphaOp(vn.Add);break;case 3:let a=An.One,l=An.OneMinusSrcAlpha;this.set_blendSrc(a),this.set_blendAlphaSrc(a),this.set_blendDst(l),this.set_blendAlphaDst(l),this.set_blendOp(vn.Add),this.set_blendAlphaOp(vn.Add);break;case 4:let h=An.OneMinusDstColor,o=An.One;this.set_blendSrc(h),this.set_blendAlphaSrc(h),this.set_blendDst(o),this.set_blendAlphaDst(o),this.set_blendOp(vn.Add),this.set_blendAlphaOp(vn.Add);break;case 5:let _=An.DstColor,c=An.Zero;this.set_blendSrc(_),this.set_blendAlphaSrc(_),this.set_blendDst(c),this.set_blendAlphaDst(c),this.set_blendOp(vn.Add),this.set_blendAlphaOp(vn.Add);break;case 6:let u=An.DstColor,d=An.OneMinusSrcAlpha;this.set_blendSrc(u),this.set_blendAlphaSrc(u),this.set_blendDst(d),this.set_blendAlphaDst(d),this.set_blendOp(vn.Add),this.set_blendAlphaOp(vn.Add);break;case 7:let p=An.Zero,f=An.OneMinusSrcColor;this.set_blendSrc(p),this.set_blendAlphaSrc(p),this.set_blendDst(f),this.set_blendAlphaDst(f),this.set_blendOp(vn.Add),this.set_blendAlphaOp(vn.Add);break;case 8:let x=An.One,g=An.OneMinusSrcColor;this.set_blendSrc(x),this.set_blendAlphaSrc(x),this.set_blendDst(g),this.set_blendAlphaDst(g),this.set_blendOp(vn.Add),this.set_blendAlphaOp(vn.Add);break;case 9:let b=An.SrcAlpha,m=An.One;this.set_blendSrc(b),this.set_blendAlphaSrc(b),this.set_blendDst(m),this.set_blendAlphaDst(m),this.set_blendOp(vn.ReverseSub),this.set_blendAlphaOp(vn.ReverseSub);break;case 10:this.set_blendSrc(An.Zero),this.set_blendAlphaSrc(An.Zero),this.set_blendDst(An.Zero),this.set_blendAlphaDst(An.Zero),this.set_blendAlphaSrc(An.Zero),this.set_blendAlphaDst(An.Zero),this.set_blendAlphaOp(vn.Max),this.set_blendOp(vn.Max);break;case 11:this.set_blendSrc(An.Zero),this.set_blendAlphaSrc(An.Zero),this.set_blendDst(An.Zero),this.set_blendAlphaDst(An.Zero),this.set_blendAlphaSrc(An.Zero),this.set_blendAlphaDst(An.Zero),this.set_blendAlphaOp(vn.Min),this.set_blendOp(vn.Min)}}depth(e,t){this.set_depthWrite(e),this.set_depthTest(t)}addShader(e){return null==e?null:(this.shaders=Vh.addSort(e,this.shaders),e)}removeShader(e){let t=this.shaders,s=null;for(;null!=t;){if(t.s==e)return null==s?this.shaders=t.next:s.next=t.next,!0;s=t,t=t.next}return!1}getShadersRec(){if(null==this.parentPass||this.parentShaders==this.parentPass.shaders)return this.shaders;let e=this.shaders,t=null;for(;null!=e&&e!=this.parentShaders;)t=e,e=e.next;return this.parentShaders=this.parentPass.shaders,null==t?this.shaders=this.parentShaders:t.next=this.parentShaders,this.shaders}set_enableLights(e){return this.flags=-2&this.flags|(e?1:0),this.enableLights=e}set_isStatic(e){return this.flags=-5&this.flags|(e?1:0)<<2,this.isStatic=e}set_culling(e){return this.bits=-4&this.bits|e._hx_index,this.culling=e}set_depthWrite(e){return this.bits=-5&this.bits|(e?1:0)<<2,this.depthWrite=e}set_depthTest(e){return this.bits=-57&this.bits|e._hx_index<<3,this.depthTest=e}set_blendSrc(e){return this.bits=-961&this.bits|e._hx_index<<6,this.blendSrc=e}set_blendDst(e){return this.bits=-15361&this.bits|e._hx_index<<10,this.blendDst=e}set_blendAlphaSrc(e){return this.bits=-245761&this.bits|e._hx_index<<14,this.blendAlphaSrc=e}set_blendAlphaDst(e){return this.bits=-3932161&this.bits|e._hx_index<<18,this.blendAlphaDst=e}set_blendOp(e){return this.bits=-29360129&this.bits|e._hx_index<<22,this.blendOp=e}set_blendAlphaOp(e){return this.bits=-234881025&this.bits|e._hx_index<<25,this.blendAlphaOp=e}}s["h3d.mat.Pass"]=Rn,Rn.__name__="h3d.mat.Pass",Rn.__interfaces__=[Hr],Object.assign(Rn.prototype,{__class__:Rn});class Vn{constructor(){this.opBits=0,this.maskBits=0,this.setOp(yn.Keep,yn.Keep,yn.Keep),this.setFunc(wn.Always)}setFront(e,t,s){this.set_frontSTfail(e),this.set_frontDPfail(t),this.set_frontPass(s)}setBack(e,t,s){this.set_backSTfail(e),this.set_backDPfail(t),this.set_backPass(s)}setOp(e,t,s){this.setFront(e,t,s),this.setBack(e,t,s)}setFunc(e,t,s,r){null==r&&(r=255),null==s&&(s=255),null==t&&(t=0),this.set_frontTest(this.set_backTest(e)),this.set_reference(t),this.set_readMask(s),this.set_writeMask(r)}set_readMask(e){return this.maskBits=-256&this.maskBits|255&e,this.readMask=e}set_writeMask(e){return this.maskBits=-65281&this.maskBits|(255&e)<<8,this.writeMask=e}set_reference(e){return this.maskBits=-16711681&this.maskBits|(255&e)<<16,this.reference=e}set_frontTest(e){return this.opBits=-8&this.opBits|e._hx_index,this.frontTest=e}set_frontPass(e){return this.opBits=-57&this.opBits|e._hx_index<<3,this.frontPass=e}set_frontSTfail(e){return this.opBits=-449&this.opBits|e._hx_index<<6,this.frontSTfail=e}set_frontDPfail(e){return this.opBits=-3585&this.opBits|e._hx_index<<9,this.frontDPfail=e}set_backTest(e){return this.opBits=-28673&this.opBits|e._hx_index<<12,this.backTest=e}set_backPass(e){return this.opBits=-229377&this.opBits|e._hx_index<<15,this.backPass=e}set_backSTfail(e){return this.opBits=-1835009&this.opBits|e._hx_index<<18,this.backSTfail=e}set_backDPfail(e){return this.opBits=-14680065&this.opBits|e._hx_index<<21,this.backDPfail=e}}s["h3d.mat.Stencil"]=Vn,Vn.__name__="h3d.mat.Stencil",Vn.__interfaces__=[Hr],Object.assign(Vn.prototype,{__class__:Vn});var On=n["hxd.PixelFormat"]={__ename__:"hxd.PixelFormat",__constructs__:["ARGB","BGRA","RGBA","RGBA16F","RGBA32F","R8","R16F","R32F","RG8","RG16F","RG32F","RGB8","RGB16F","RGB32F","SRGB","SRGB_ALPHA","RGB10A2","RG11B10UF","S3TC"],ARGB:{_hx_index:0,__enum__:"hxd.PixelFormat",toString:r},BGRA:{_hx_index:1,__enum__:"hxd.PixelFormat",toString:r},RGBA:{_hx_index:2,__enum__:"hxd.PixelFormat",toString:r},RGBA16F:{_hx_index:3,__enum__:"hxd.PixelFormat",toString:r},RGBA32F:{_hx_index:4,__enum__:"hxd.PixelFormat",toString:r},R8:{_hx_index:5,__enum__:"hxd.PixelFormat",toString:r},R16F:{_hx_index:6,__enum__:"hxd.PixelFormat",toString:r},R32F:{_hx_index:7,__enum__:"hxd.PixelFormat",toString:r},RG8:{_hx_index:8,__enum__:"hxd.PixelFormat",toString:r},RG16F:{_hx_index:9,__enum__:"hxd.PixelFormat",toString:r},RG32F:{_hx_index:10,__enum__:"hxd.PixelFormat",toString:r},RGB8:{_hx_index:11,__enum__:"hxd.PixelFormat",toString:r},RGB16F:{_hx_index:12,__enum__:"hxd.PixelFormat",toString:r},RGB32F:{_hx_index:13,__enum__:"hxd.PixelFormat",toString:r},SRGB:{_hx_index:14,__enum__:"hxd.PixelFormat",toString:r},SRGB_ALPHA:{_hx_index:15,__enum__:"hxd.PixelFormat",toString:r},RGB10A2:{_hx_index:16,__enum__:"hxd.PixelFormat",toString:r},RG11B10UF:{_hx_index:17,__enum__:"hxd.PixelFormat",toString:r},S3TC:(t=function(e){return{_hx_index:18,v:e,__enum__:"hxd.PixelFormat",toString:r}},t.__params__=["v"],t)};On.__empty_constructs__=[On.ARGB,On.BGRA,On.RGBA,On.RGBA16F,On.RGBA32F,On.R8,On.R16F,On.R32F,On.RG8,On.RG16F,On.RG32F,On.RGB8,On.RGB16F,On.RGB32F,On.SRGB,On.SRGB_ALPHA,On.RGB10A2,On.RG11B10UF];class Pn{constructor(e,t,s,r){Pn._hx_skip_constructor||this._hx_constructor(e,t,s,r)}_hx_constructor(e,t,s,r){let n=Wr.CURRENT;this.mem=n.mem,null==r&&(r=Pn.nativeFormat),this.id=++Pn.UID,this.format=r;if(this.flags=0,null!=s){let e=0;for(;e<s.length;){let t=s[e];++e,this.flags|=1<<t._hx_index}}let i=1,a=1;for(;i<e;)i<<=1;for(;a<t;)a<<=1;i==e&&a==t||(this.flags|=1<<Sn.IsNPOT._hx_index),0!=(this.flags&1<<Sn.Target._hx_index)&&(this.realloc=function(){}),this.width=e,this.height=t,this.set_mipMap(0!=(this.flags&1<<Sn.MipMapped._hx_index)?kn.Nearest:kn.None),this.set_filter(Bn.Linear),this.set_wrap(Cn.Clamp),this.bits&=32767,0==(this.flags&1<<Sn.NoAlloc._hx_index)&&this.alloc()}set_lastFrame(e){return this._lastFrame!=Pn.PREVENT_AUTO_DISPOSE&&(this._lastFrame=e),this._lastFrame}get_lastFrame(){return this._lastFrame}get_layerCount(){return 0!=(this.flags&1<<Sn.Cube._hx_index)?6:1}alloc(){null==this.t&&this.mem.allocTexture(this)}preventAutoDispose(){this.set_lastFrame(Pn.PREVENT_AUTO_DISPOSE)}toString(){let e=this.name;return null==this.name&&(e="Texture_"+this.id),e+"("+this.width+"x"+this.height+")"}setName(e){this.name=e}set_mipMap(e){return this.bits=-4&this.bits|e._hx_index,this.mipMap=e}set_filter(e){return this.bits=-25&this.bits|e._hx_index<<3,this.filter=e}set_wrap(e){return this.bits=-193&this.bits|e._hx_index<<6,this.wrap=e}resize(e,t){this.dispose();let s=1,r=1;for(;s<e;)s<<=1;for(;r<t;)r<<=1;s!=e||r!=t?this.flags|=1<<Sn.IsNPOT._hx_index:this.flags&=-1-(1<<Sn.IsNPOT._hx_index),this.width=e,this.height=t,0==(this.flags&1<<Sn.NoAlloc._hx_index)&&this.alloc()}clear(e,t,s){if(null==s&&(s=-1),null==t&&(t=1),this.alloc(),1!=this.width||1!=this.height){let r=Wr.CURRENT;if(e|=(255*(t<0?0:t>1?1:t)|0)<<24,s<0){let t=0,s=this.get_layerCount();for(;t<s;){let s=t++;r.pushTarget(this,s),r.clear(e),r.popTarget()}}else r.pushTarget(this,s),r.clear(e),r.popTarget()}else{let r=$a.alloc(this.width,this.height,Pn.nativeFormat),n=0,i=255&e,a=e>>8&255,l=e>>16&255,h=255*t|0;switch(h<0?h=0:h>255&&(h=255),Pn.nativeFormat._hx_index){case 1:let e=l;l=i,i=e;break;case 2:break;default:throw $i.thrown("TODO")}let o=0,_=this.width*this.height;for(;o<_;){o++;r.bytes.b[n++]=l,r.bytes.b[n++]=a,r.bytes.b[n++]=i,r.bytes.b[n++]=h}if(s<0){let e=0,t=this.get_layerCount();for(;e<t;){let t=e++;this.uploadPixels(r,0,t)}}else this.uploadPixels(r,0,s);r.dispose()}}checkMipMapGen(e,t){0!=e||0==(this.flags&1<<Sn.MipMapped._hx_index)||0!=(this.flags&1<<Sn.ManualMipMapGen._hx_index)||0!=(this.flags&1<<Sn.Cube._hx_index)&&5!=t||this.mem.driver.generateMipMaps(this)}uploadBitmap(e,t,s){null==s&&(s=0),null==t&&(t=0),this.alloc();let r=e.ctx.canvas.width,n=e.ctx.canvas.height;if(r!=this.width>>t||n!=this.height>>t)throw $i.thrown("Invalid upload size : "+r+"x"+n+" should be "+(this.width>>t)+"x"+(this.height>>t));this.mem.driver.uploadTextureBitmap(this,e,t,s),this.flags|=1<<Sn.WasCleared._hx_index,this.checkMipMapGen(t,s)}uploadPixels(e,t,s){null==s&&(s=0),null==t&&(t=0),this.alloc();let r=e.width,n=e.height;if(r!=this.width>>t||n!=this.height>>t)throw $i.thrown("Invalid upload size : "+r+"x"+n+" should be "+(this.width>>t)+"x"+(this.height>>t));this.mem.driver.uploadTexturePixels(this,e,t,s),this.flags|=1<<Sn.WasCleared._hx_index,this.checkMipMapGen(t,s)}dispose(){null!=this.t&&this.mem.deleteTexture(this)}capturePixels(e,t,s){null==t&&(t=0),null==e&&(e=0);let r=this.get_lastFrame();this.preventAutoDispose();let n=this.mem.driver.capturePixels(this,e,t,s);return this.set_lastFrame(r),n}static fromColor(e,t){null==t&&(t=1);let s=Wr.CURRENT,r=255*t|0;r<0?r=0:r>255&&(r=255);let n=16777215&e|r<<24,i=s.textureColorCache.h[n];if(null!=i)return i;let a=new Pn(1,1,null);return a.clear(e,t),a.realloc=function(){a.clear(e,t)},s.textureColorCache.h[n]=a,a}static defaultCubeTexture(){let e=Wr.CURRENT,t=e.resCache.h[Pn.__id__];return null!=t||(t=new Pn(1,1,[Sn.Cube]),t.clear(2105376),t.realloc=function(){t.clear(2105376)},e.resCache.set(Pn,t)),t}}s["h3d.mat.Texture"]=Pn,Pn.__name__="h3d.mat.Texture",Object.assign(Pn.prototype,{__class__:Pn});class Qn extends Pn{constructor(e,t,s,r,n){Pn._hx_skip_constructor=!0,super(),Pn._hx_skip_constructor=!1,this._hx_constructor(e,t,s,r,n)}_hx_constructor(e,t,s,r,n){this.layers=s,null==r&&(r=[]),r.push(Sn.IsArray),super._hx_constructor(e,t,r,n)}get_layerCount(){return this.layers}toString(){return super.toString()+"["+this.layers+"]"}}s["h3d.mat.TextureArray"]=Qn,Qn.__name__="h3d.mat.TextureArray",Qn.__super__=Pn,Object.assign(Qn.prototype,{__class__:Qn});class Ln{constructor(e){Ln._hx_skip_constructor||this._hx_constructor(e)}_hx_constructor(e){this.name=e}setContext(e){this.ctx=e}dispose(){}draw(e,t){}}s["h3d.pass.Base"]=Ln,Ln.__name__="h3d.pass.Base",Object.assign(Ln.prototype,{__class__:Ln});class Gn{constructor(e,t){Gn._hx_skip_constructor||this._hx_constructor(e,t)}_hx_constructor(e,t){this.shader=e,this.shaders=new Vh(e),this.manager=new ni(t),this.pass=new Rn("screenfx",new Vh(e)),this.pass.set_culling(mn.None),this.pass.depth(!1,wn.Always)}get_engine(){return null==this._engine&&(this._engine=Wr.CURRENT),this._engine}render(){null==this.primitive&&(this.primitive=oi.get()),this.shader.flipY__=this.get_engine().driver.hasFeature(rn.BottomLeftCoords)&&null!=this.get_engine().getCurrentTarget()?-1:1;let e=this.manager.compileShaders(this.shaders);if(this.get_engine().selectMaterial(this.pass),this.get_engine().selectShader(e),null==this.buffers)this.buffers=new Ti(e);else{let t=this.buffers;t.vertex.grow(e.vertex),t.fragment.grow(e.fragment)}this.manager.fillGlobals(this.buffers,e),this.manager.fillParams(this.buffers,e,this.shaders),this.get_engine().uploadShaderBuffers(this.buffers,0),this.get_engine().uploadShaderBuffers(this.buffers,1),this.get_engine().uploadShaderBuffers(this.buffers,2),this.primitive.render(this.get_engine())}dispose(){}}s["h3d.pass.ScreenFx"]=Gn,Gn.__name__="h3d.pass.ScreenFx",Object.assign(Gn.prototype,{__class__:Gn});class zn extends Gn{constructor(e,t,s,r){Gn._hx_skip_constructor=!0,super(),Gn._hx_skip_constructor=!1,this._hx_constructor(e,t,s,r)}_hx_constructor(e,t,s,r){null==r&&(r=1),null==s&&(s=0),null==t&&(t=1),null==e&&(e=1),this.cubeDir=[jr.L([0,0,-1,0,0,-1,0,0,1,0,0,0]),jr.L([0,0,1,0,0,-1,0,0,-1,0,0,0]),jr.L([1,0,0,0,0,0,1,0,0,1,0,0]),jr.L([1,0,0,0,0,0,-1,0,0,-1,0,0]),jr.L([1,0,0,0,0,-1,0,0,0,1,0,0]),jr.L([-1,0,0,0,0,-1,0,0,0,0,-1,0])],super._hx_constructor(new Mi),this.set_radius(e),this.set_quality(r),this.set_gain(t),this.set_linear(s)}set_radius(e){return this.radius==e?e:(this.values=null,this.radius=e)}set_quality(e){return this.quality==e?e:(this.values=null,this.quality=e)}set_gain(e){return this.gain==e?e:(this.values=null,this.gain=e)}set_linear(e){return this.linear==e?e:(this.values=null,this.linear=e)}gauss(e,t){if(t<=0)return 0==e?1:0;let s=t*t;return Math.pow(2.718281828459,-e*e/(2*s))/Math.sqrt(2*Math.PI*s)}calcValues(){this.values=[],this.offsets=[];let e,t=0,s=this.quality,r=.7*(s<0?0:s>1?1:s)+.3;if(this.radius>0){let t=this.radius-1;e=Math.ceil((t<1?1:t)*r/2)}else e=0;let n=Math.sqrt(this.radius),i=0,a=e+1;for(;i<a;){let e=i++,s=2*e,a=0==e?0:2*e-1,l=this.gauss(s,n),h=this.gauss(a,n),o=l+h;this.values[e]=o,this.offsets[e]=0==e?0:(l*s+h*a)/(o*e*Math.sqrt(r)),t+=o,e>0&&(t+=o)}let l=this.values[0]*(.01/r);for(;this.values.length>2;){let e=this.values[this.values.length-1];if(e>l)break;t-=2*e,this.values.pop()}t/=this.gain;let h=0,o=this.values.length;for(;h<o;){let e=h++;this.values[e]/=t}if(this.linear>0){let e=this.gain/(2*this.values.length-1),t=0,s=this.values.length;for(;t<s;){let s=t++,n=this.values[s];this.values[s]=n+this.linear*(e-n);let i=this.offsets[s];this.offsets[s]=i+this.linear*((0==s?0:(2*s-.5)/(s*r))-i)}}}apply(e,t,s){if(this.radius<=0&&null==this.shader.fixedColor__)return void(null!=s&&Zn.run(t,s));null==s&&(s=t),null==this.values&&this.calcValues();let r=0!=(t.flags&1<<Sn.Cube._hx_index),n=r?6:1,i=e.textures.allocTarget(t.name+"BlurTmp",t.width,t.height,!1,t.format,r),a=this.shader;if(a.constModified=!0,a.Quality__=this.values.length,this.shader.values__=this.values,this.shader.offsets__=this.offsets,r){this.shader.cubeTexture__=t;let e=this.shader;e.constModified=!0,e.isCube__=!0}else{this.shader.texture__=t;let e=this.shader;e.constModified=!0,e.isCube__=!1}let l=this.shader.pixel__,h=1/t.width,o=0;null==o&&(o=0),null==h&&(h=0),l.x=h,l.y=o,l.z=0,l.w=1;let _=0,c=n;for(;_<c;){let e=_++;this.get_engine().pushTarget(i,e),r&&(this.shader.cubeDir__=this.cubeDir[e]),this.render(),this.get_engine().popTarget()}r?this.shader.cubeTexture__=i:this.shader.texture__=i;let u=this.shader.pixel__,d=0,p=1/t.height;null==p&&(p=0),null==d&&(d=0),u.x=d,u.y=p,u.z=0,u.w=1;let f=s.depthBuffer;s.depthBuffer=null;let x=0,g=n;for(;x<g;){let e=x++;this.get_engine().pushTarget(s,e),r&&(this.shader.cubeDir__=this.cubeDir[e]),this.render(),this.get_engine().popTarget()}s.depthBuffer=f}}s["h3d.pass.Blur"]=zn,zn.__name__="h3d.pass.Blur",zn.__super__=Gn,Object.assign(zn.prototype,{__class__:zn});class Un{constructor(){Un._hx_skip_constructor||this._hx_constructor()}_hx_constructor(){this.priority=0,this.initialize()}initialize(){if(this.constModified=!0,null!=this.shader)return;let e=Ss.getClass(this);if(this.shader=e._SHADER,null==this.shader){let t=e;for(;null!=t&&null==t.SRC;)t=t.__super__;if(null==t)throw $i.thrown(e.__name__+" has no shader source");this.shader=t._SHADER,null==this.shader&&(this.shader=new Lh(t.SRC),t._SHADER=this.shader)}}setPriority(e){this.priority=e}getParamValue(e){throw $i.thrown("assert")}getParamFloatValue(e){throw $i.thrown("assert")}updateConstants(e){throw $i.thrown("assert")}updateConstantsFinal(e){let t=this.shader.consts;for(;null!=t;){if(0==t.globalId){t=t.next;continue}let s=e.map.h[t.globalId],r=t.v.type;switch(r._hx_index){case 1:let n=s;if(n>>>t.bits!=0)throw $i.thrown("Constant "+t.v.name+" is outside range ("+n+" > "+((1<<t.bits)-1)+")");this.constBits|=n<<t.pos;break;case 2:s&&(this.constBits|=1<<t.pos);break;case 17:let i=r.size;if(null==s){t=t.next;continue}let a=s,l=a.channel;if(null==a.texture)l=ph.Unknown;else if(null==l||l==ph.Unknown)switch(i){case 1:if(a.texture.format!=Pn.nativeFormat)throw $i.thrown("Constant "+t.v.name+" does not define channel select value");l=ph.PackedFloat;break;case 3:if(a.texture.format!=Pn.nativeFormat)throw $i.thrown("Constant "+t.v.name+" does not define channel select value");l=ph.PackedNormal;break;default:throw $i.thrown("Constant "+t.v.name+" does not define channel select value")}this.constBits|=(e.allocChannelID(a.texture)<<3|l._hx_index)<<t.pos;break;default:throw $i.thrown("assert")}t=t.next}let s=this.shader,r=this.constBits,n=s.instanceCache.h[r];this.instance=null==n?s.makeInstance(r):n}toString(){return Ss.getClass(this).__name__}}s["hxsl.Shader"]=Un,Un.__name__="hxsl.Shader",Object.assign(Un.prototype,{__class__:Un});class Wn extends Un{constructor(){Un._hx_skip_constructor?super():(Un._hx_skip_constructor=!0,super(),Un._hx_skip_constructor=!1,this._hx_constructor())}_hx_constructor(){this.flipY__=0,super._hx_constructor()}updateConstants(e){this.constBits=0,this.updateConstantsFinal(e)}getParamValue(e){return 0==e?this.flipY__:null}getParamFloatValue(e){return 0==e?this.flipY__:0}}s["h3d.shader.ScreenShader"]=Wn,Wn.__name__="h3d.shader.ScreenShader",Wn.__super__=Un,Object.assign(Wn.prototype,{__class__:Wn});class Nn extends Wn{constructor(){Un._hx_skip_constructor=!0,super(),Un._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.color__=new Xr,super._hx_constructor()}updateConstants(e){this.constBits=0,this.updateConstantsFinal(e)}getParamValue(e){switch(e){case 0:return this.flipY__;case 1:return this.color__}return null}getParamFloatValue(e){return 0==e?this.flipY__:0}}s["h3d.pass._Border.BorderShader"]=Nn,Nn.__name__="h3d.pass._Border.BorderShader",Nn.__super__=Wn,Object.assign(Nn.prototype,{__class__:Nn});class jn extends Gn{constructor(e,t,s){null==s&&(s=1),super(new Nn);let r=Ka._new(0);if(r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=0/e*2-1,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=1-0/t*2,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=e/e*2-1,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=1-0/t*2,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=0/e*2-1,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=1-s/t*2,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=e/e*2-1,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=1-s/t*2,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=0/e*2-1,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=1-0/t*2,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=s/e*2-1,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=1-0/t*2,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=0/e*2-1,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=1-t/t*2,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=s/e*2-1,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=1-t/t*2,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=0/e*2-1,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=1-(t-s)/t*2,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=e/e*2-1,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=1-(t-s)/t*2,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=0/e*2-1,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=1-t/t*2,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=e/e*2-1,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=1-t/t*2,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=(e-s)/e*2-1,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=1-0/t*2,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=e/e*2-1,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=1-0/t*2,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=(e-s)/e*2-1,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=1-t/t*2,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}if(r.array[r.pos++]=e/e*2-1,r.pos==r.array.length){let e=r.array.length<<1;e<128&&(e=128);let t=new Float32Array(e);t.set(r.array),r.array=t}r.array[r.pos++]=1-t/t*2,this.primitive=new _i({vbuf:r,stride:2,quads:!0},!0);let n=this.shader.color__,i=1,a=1,l=1,h=1;null==h&&(h=1),null==l&&(l=0),null==a&&(a=0),null==i&&(i=0),n.x=i,n.y=a,n.z=l,n.w=h}dispose(){super.dispose(),this.primitive.dispose()}}s["h3d.pass.Border"]=jn,jn.__name__="h3d.pass.Border",jn.__super__=Gn,Object.assign(jn.prototype,{__class__:jn});class Yn extends Wn{constructor(){Un._hx_skip_constructor=!0,super(),Un._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.layer__=0,super._hx_constructor()}updateConstants(e){this.constBits=0,this.updateConstantsFinal(e)}getParamValue(e){switch(e){case 0:return this.flipY__;case 1:return this.texture__;case 2:return this.layer__}return null}getParamFloatValue(e){return 0==e?this.flipY__:0}}s["h3d.pass._Copy.ArrayCopyShader"]=Yn,Yn.__name__="h3d.pass._Copy.ArrayCopyShader",Yn.__super__=Wn,Object.assign(Yn.prototype,{__class__:Yn});class Xn extends Wn{constructor(){super()}updateConstants(e){this.constBits=0,this.updateConstantsFinal(e)}getParamValue(e){switch(e){case 0:return this.flipY__;case 1:return this.texture__}return null}getParamFloatValue(e){return 0==e?this.flipY__:0}}s["h3d.pass._Copy.CopyShader"]=Xn,Xn.__name__="h3d.pass._Copy.CopyShader",Xn.__super__=Wn,Object.assign(Xn.prototype,{__class__:Xn});class Zn extends Gn{constructor(){super(new Xn)}apply(e,t,s,r,n){if(null!=t&&this.get_engine().pushTarget(t,null!=n?n:0),this.shader.texture__=e,null!=r){let e=this.pass;this.pass=r,null!=s&&this.pass.setBlendMode(s);let t=this.shaders;for(;null!=t.next;)t=t.next;t.next=this.pass.shaders,this.render(),this.pass=e,t.next=null}else this.pass.setBlendMode(null==s?Ar.None:s),this.render();this.shader.texture__=null,null!=t&&this.get_engine().popTarget()}static run(e,t,s,r,n){let i=Wr.CURRENT;if(null!=t&&null!=e&&(null==s||s==Ar.None)&&null==r&&i.driver.copyTexture(e,t))return;let a=i.resCache.h[Zn.__id__];null==a&&(a=new Zn,i.resCache.set(Zn,a)),a.apply(e,t,s,r,n)}}s["h3d.pass.Copy"]=Zn,Zn.__name__="h3d.pass.Copy",Zn.__super__=Gn,Object.assign(Zn.prototype,{__class__:Zn});class Hn extends Wn{constructor(){Un._hx_skip_constructor=!0,super(),Un._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.mat__=new jr,super._hx_constructor()}updateConstants(e){this.constBits=0,this.updateConstantsFinal(e)}getParamValue(e){switch(e){case 0:return this.flipY__;case 1:return this.texture__;case 2:return this.mat__}return null}getParamFloatValue(e){return 0==e?this.flipY__:0}}s["h3d.pass._CubeCopy.CubeCopyShader"]=Hn,Hn.__name__="h3d.pass._CubeCopy.CubeCopyShader",Hn.__super__=Wn,Object.assign(Hn.prototype,{__class__:Hn});class Kn extends Ln{constructor(e){Ln._hx_skip_constructor?super():(Ln._hx_skip_constructor=!0,super(),Ln._hx_skip_constructor=!1,this._hx_constructor(e))}_hx_constructor(e){this.defaultSort=ao(t=new li,t.sort),super._hx_constructor(e),this.manager=new ni(this.getOutputs()),this.initGlobals()}getOutputs(){return[Sh.Value("output.color")]}processShaders(e,t){let s=this.ctx.extraShaders;for(;null!=s;)t=this.ctx.allocShaderList(s.s,t),s=s.next;return t}setupShaders(e){let t=!1,s=e.current;for(;null!=s;){let e=s;s=s.next;let r=e,n=r.pass.getShadersRec();n=this.processShaders(r,n),r.pass.enableLights&&null!=this.ctx.lightSystem&&(t||(this.ctx.lightSystem.initGlobals(this.manager.globals),t=!0),n=this.ctx.lightSystem.computeLight(r.obj,n)),r.shader=this.manager.compileShaders(n,r.pass.batchMode),r.shaders=n;let i=r.shader.fragment.textures;if(null==i)r.texture=0;else{let e,t=this.manager,s=!0;if(null==s&&(s=!1),null!=i.perObjectGlobal){let s=t.globals.map.h[i.perObjectGlobal.gid];if(null==s)throw $i.thrown("Missing global value "+i.perObjectGlobal.path+" for shader "+t.shaderInfo(n,i.perObjectGlobal.path));let r,a=i.type;if(17==a._hx_index){a.size;r=!0}else r=!1;e=r?s.texture:s}else{let t=n,r=i.instance;for(;--r>0;)t=t.next;let a=t.s.getParamValue(i.index);if(null==a&&!s)throw $i.thrown("Missing param value "+x.string(t.s)+"."+i.name);e=a}r.texture=null==e?0:e.id}}}drawObject(e){this.ctx.drawPass=e,this.ctx.engine.selectMaterial(e.pass),e.obj.draw(this.ctx)}draw(e,t){if(null==e.current)return;let s=0,r=this.ctx.sharedGlobals;for(;s<r.length;){let e=r[s];++s,this.manager.globals.map.h[e.gid]=e.value}this.setGlobals(),this.setupShaders(e),null==t?this.defaultSort(e):t(e),this.ctx.currentManager=this.manager;let n=this.ctx.shaderBuffers,i=null,a=e.current;for(;null!=a;){let e=a;a=a.next;let t=e,s=t.obj.absPos;if(this.manager.globals.map.h[this.globalModelView_id]=s,t.shader.globals.h.hasOwnProperty(this.globalModelViewInverse_id)){let e=t.obj.getInvPos();this.manager.globals.map.h[this.globalModelViewInverse_id]=e}if(i!=t.shader){if(i=t.shader,this.ctx.engine.selectShader(t.shader),null==n)n=this.ctx.shaderBuffers=new Ti(t.shader);else{let e=t.shader;n.vertex.grow(e.vertex),n.fragment.grow(e.fragment)}this.manager.fillGlobals(n,t.shader),this.ctx.engine.uploadShaderBuffers(n,0)}t.pass.dynamicParameters||(this.manager.fillParams(n,t.shader,t.shaders),this.ctx.engine.uploadShaderBuffers(n,1),this.ctx.engine.uploadShaderBuffers(n,2),this.ctx.engine.uploadShaderBuffers(n,3)),this.drawObject(t)}let l=this.ctx;l.cachedPos=0,l.drawPass=null}initGlobals(){let e=yh.allocID("camera.view");this.cameraView_id=e;let t=yh.allocID("camera.zNear");this.cameraNear_id=t;let s=yh.allocID("camera.zFar");this.cameraFar_id=s;let r=yh.allocID("camera.proj");this.cameraProj_id=r;let n=yh.allocID("camera.position");this.cameraPos_id=n;let i=yh.allocID("camera.projDiag");this.cameraProjDiag_id=i;let a=yh.allocID("camera.projFlip");this.cameraProjFlip_id=a;let l=yh.allocID("camera.viewProj");this.cameraViewProj_id=l;let h=yh.allocID("camera.inverseViewProj");this.cameraInverseViewProj_id=h;let o=yh.allocID("global.time");this.globalTime_id=o;let _=yh.allocID("global.pixelSize");this.pixelSize_id=_;let c=yh.allocID("global.modelView");this.globalModelView_id=c;let u=yh.allocID("global.modelViewInverse");this.globalModelViewInverse_id=u}setGlobals(){let e=this.ctx.camera.mcam;this.manager.globals.map.h[this.cameraView_id]=e;let t=this.ctx.camera.zNear;this.manager.globals.map.h[this.cameraNear_id]=t;let s=this.ctx.camera.zFar;this.manager.globals.map.h[this.cameraFar_id]=s;let r=this.ctx.camera.mproj;this.manager.globals.map.h[this.cameraProj_id]=r;let n=this.ctx.camera.pos;this.manager.globals.map.h[this.cameraPos_id]=n;let i=new Xr(this.ctx.camera.mproj._11,this.ctx.camera.mproj._22,this.ctx.camera.mproj._33,this.ctx.camera.mproj._44);this.manager.globals.map.h[this.cameraProjDiag_id]=i;let a=this.ctx.engine.driver.hasFeature(rn.BottomLeftCoords)&&null!=this.ctx.engine.getCurrentTarget()?-1:1;this.manager.globals.map.h[this.cameraProjFlip_id]=a;let l=this.ctx.camera.m;this.manager.globals.map.h[this.cameraViewProj_id]=l;let h=this.ctx.camera.getInverseViewProj();this.manager.globals.map.h[this.cameraInverseViewProj_id]=h;let o=this.ctx.time;this.manager.globals.map.h[this.globalTime_id]=o;let _=new Xr(2/this.ctx.engine.width,2/this.ctx.engine.height);this.manager.globals.map.h[this.pixelSize_id]=_}}s["h3d.pass.Default"]=Kn,Kn.__name__="h3d.pass.Default",Kn.__super__=Ln,Object.assign(Kn.prototype,{__class__:Kn});class qn extends Kn{constructor(e){Ln._hx_skip_constructor?super():(Ln._hx_skip_constructor=!0,super(),Ln._hx_skip_constructor=!1,this._hx_constructor(e))}_hx_constructor(e){this.pcfScale=1,this.pcfQuality=1,this.bias=.01,this.power=30,this.samplingKind=ai.None,this.size=1024,this.mode=ii.None,this.enabled=!0,null==this.format&&(this.format=On.R16F),Wr.CURRENT.driver.isSupportedFormat(this.format)||(this.format=Pn.nativeFormat),super._hx_constructor("shadow"),this.light=e,this.blur=new zn(5),this.blur.set_quality(.5);let t=this.blur.shader;t.constModified=!0,t.isDepth__=this.format==Pn.nativeFormat}set_size(e){return e!=this.size&&null!=this.staticTexture&&(this.staticTexture.dispose(),this.staticTexture=null),this.size=e}dispose(){super.dispose(),this.blur.dispose(),null!=this.staticTexture&&this.staticTexture.dispose()}getShadowProj(){return this.lightCamera.m}isUsingWorldDist(){return!1}getOutputs(){return this.isUsingWorldDist()?[Sh.Swiz(Sh.Value("output.worldDist",1),[lh.X,lh.X,lh.X,lh.X])]:this.format==Pn.nativeFormat?[Sh.PackFloat(Sh.Value("output.depth"))]:[Sh.Swiz(Sh.Value("output.depth",1),[lh.X,lh.X,lh.X,lh.X])]}createDefaultShadowMap(){let e=Pn.fromColor(16777215);return e.name="defaultShadowMap",e}syncShader(e){}filterPasses(e){if(this.ctx.computingStatic)switch(this.mode._hx_index){case 0:return!1;case 1:let t=null,s=null,r=e.discarded,n=e.lastDisc,i=e.current;for(;null!=i;)1==i.pass.isStatic?null==t?(s=i,t=s):(s.next=i,s=i):null==r?(n=i,r=n):(n.next=i,n=i),i=i.next;return null!=s&&(s.next=null),null!=n&&(n.next=null),e.current=t,e.discarded=r,e.lastDisc=n,!0;case 2:return!1;case 3:let a=null,l=null,h=e.discarded,o=e.lastDisc,_=e.current;for(;null!=_;)1==_.pass.isStatic?null==a?(l=_,a=l):(l.next=_,l=_):null==h?(o=_,h=o):(o.next=_,o=_),_=_.next;return null!=l&&(l.next=null),null!=o&&(o.next=null),e.current=a,e.discarded=h,e.lastDisc=o,!0}else switch(this.mode._hx_index){case 0:return!1;case 1:let e;if(null!=this.staticTexture){let t=this.staticTexture;e=null==t.t&&null==t.realloc}else e=!0;return e&&(this.staticTexture=this.createDefaultShadowMap()),this.syncShader(this.staticTexture),!1;case 2:return!0;case 3:let t;if(null!=this.staticTexture){let e=this.staticTexture;t=null==e.t&&null==e.realloc}else t=!0;return t&&(this.staticTexture=this.createDefaultShadowMap()),!0}}}s["h3d.pass.Shadows"]=qn,qn.__name__="h3d.pass.Shadows",qn.__super__=Kn,Object.assign(qn.prototype,{__class__:qn});class Jn extends qn{constructor(e){Ln._hx_skip_constructor?super():(Ln._hx_skip_constructor=!0,super(),Ln._hx_skip_constructor=!1,this._hx_constructor(e))}_hx_constructor(e){this.mergePass=new Gn(new Pi),super._hx_constructor(e),this.lightCamera=new zr,this.lightCamera.orthoBounds=new Jr,this.shader=this.dshader=new Ri,this.border=new jn(this.size,this.size),this.customDepth=Wr.CURRENT.driver.hasFeature(rn.AllocDepthBuffer),this.customDepth||(this.depth=Tn.getDefault())}set_mode(e){let t=this.dshader;return t.constModified=!0,t.enable__=e!=ii.None,this.mode=e}set_size(e){return null!=this.border&&this.size!=e&&(this.border.dispose(),this.border=new jn(e,e)),super.set_size(e)}dispose(){super.dispose(),this.customDepth&&null!=this.depth&&this.depth.dispose(),this.border.dispose()}calcShadowBounds(e){let t=e.orthoBounds,s=new jr;if(this.ctx.scene.iterVisibleMeshes((function(r){if(null==r.primitive||!r.material.castShadows)return;let n=r.primitive.getBounds();if(n.xMin>n.xMax)return;s.multiply3x4(r.getAbsPos(),e.mcam);let i=n.xMin,a=n.yMin,l=n.zMin;null==l&&(l=0),null==a&&(a=0),null==i&&(i=0);let h=i,o=a,_=l,c=h*s._11+o*s._21+_*s._31+s._41,u=h*s._12+o*s._22+_*s._32+s._42,d=h*s._13+o*s._23+_*s._33+s._43;h=c,o=u,_=d,h<t.xMin&&(t.xMin=h),h>t.xMax&&(t.xMax=h),o<t.yMin&&(t.yMin=o),o>t.yMax&&(t.yMax=o),_<t.zMin&&(t.zMin=_),_>t.zMax&&(t.zMax=_);let p=n.xMin,f=n.yMin,x=n.zMax;null==x&&(x=0),null==f&&(f=0),null==p&&(p=0);let g=p,b=f,m=x,A=g*s._11+b*s._21+m*s._31+s._41,w=g*s._12+b*s._22+m*s._32+s._42,y=g*s._13+b*s._23+m*s._33+s._43;g=A,b=w,m=y,g<t.xMin&&(t.xMin=g),g>t.xMax&&(t.xMax=g),b<t.yMin&&(t.yMin=b),b>t.yMax&&(t.yMax=b),m<t.zMin&&(t.zMin=m),m>t.zMax&&(t.zMax=m);let k=n.xMin,B=n.yMax,C=n.zMin;null==C&&(C=0),null==B&&(B=0),null==k&&(k=0);let v=k,S=B,M=C,I=v*s._11+S*s._21+M*s._31+s._41,T=v*s._12+S*s._22+M*s._32+s._42,F=v*s._13+S*s._23+M*s._33+s._43;v=I,S=T,M=F,v<t.xMin&&(t.xMin=v),v>t.xMax&&(t.xMax=v),S<t.yMin&&(t.yMin=S),S>t.yMax&&(t.yMax=S),M<t.zMin&&(t.zMin=M),M>t.zMax&&(t.zMax=M);let E=n.xMin,D=n.yMax,R=n.zMax;null==R&&(R=0),null==D&&(D=0),null==E&&(E=0);let V=E,O=D,P=R,Q=V*s._11+O*s._21+P*s._31+s._41,L=V*s._12+O*s._22+P*s._32+s._42,G=V*s._13+O*s._23+P*s._33+s._43;V=Q,O=L,P=G,V<t.xMin&&(t.xMin=V),V>t.xMax&&(t.xMax=V),O<t.yMin&&(t.yMin=O),O>t.yMax&&(t.yMax=O),P<t.zMin&&(t.zMin=P),P>t.zMax&&(t.zMax=P);let z=n.xMax,U=n.yMin,W=n.zMin;null==W&&(W=0),null==U&&(U=0),null==z&&(z=0);let N=z,j=U,Y=W,X=N*s._11+j*s._21+Y*s._31+s._41,Z=N*s._12+j*s._22+Y*s._32+s._42,H=N*s._13+j*s._23+Y*s._33+s._43;N=X,j=Z,Y=H,N<t.xMin&&(t.xMin=N),N>t.xMax&&(t.xMax=N),j<t.yMin&&(t.yMin=j),j>t.yMax&&(t.yMax=j),Y<t.zMin&&(t.zMin=Y),Y>t.zMax&&(t.zMax=Y);let K=n.xMax,q=n.yMin,J=n.zMax;null==J&&(J=0),null==q&&(q=0),null==K&&(K=0);let $=K,ee=q,te=J,se=$*s._11+ee*s._21+te*s._31+s._41,re=$*s._12+ee*s._22+te*s._32+s._42,ne=$*s._13+ee*s._23+te*s._33+s._43;$=se,ee=re,te=ne,$<t.xMin&&(t.xMin=$),$>t.xMax&&(t.xMax=$),ee<t.yMin&&(t.yMin=ee),ee>t.yMax&&(t.yMax=ee),te<t.zMin&&(t.zMin=te),te>t.zMax&&(t.zMax=te);let ie=n.xMax,ae=n.yMax,le=n.zMin;null==le&&(le=0),null==ae&&(ae=0),null==ie&&(ie=0);let he=ie,oe=ae,_e=le,ce=he*s._11+oe*s._21+_e*s._31+s._41,ue=he*s._12+oe*s._22+_e*s._32+s._42,de=he*s._13+oe*s._23+_e*s._33+s._43;he=ce,oe=ue,_e=de,he<t.xMin&&(t.xMin=he),he>t.xMax&&(t.xMax=he),oe<t.yMin&&(t.yMin=oe),oe>t.yMax&&(t.yMax=oe),_e<t.zMin&&(t.zMin=_e),_e>t.zMax&&(t.zMax=_e);let pe=n.xMax,fe=n.yMax,xe=n.zMax;null==xe&&(xe=0),null==fe&&(fe=0),null==pe&&(pe=0);let ge=pe,be=fe,me=xe,Ae=ge*s._11+be*s._21+me*s._31+s._41,we=ge*s._12+be*s._22+me*s._32+s._42,ye=ge*s._13+be*s._23+me*s._33+s._43;ge=Ae,be=we,me=ye,ge<t.xMin&&(t.xMin=ge),ge>t.xMax&&(t.xMax=ge),be<t.yMin&&(t.yMin=be),be>t.yMax&&(t.yMax=be),me<t.zMin&&(t.zMin=me),me>t.zMax&&(t.zMax=me)})),this.mode==ii.Dynamic){let s=new Jr,r=0,n=this.ctx.camera.getFrustumCorners();for(;r<n.length;){let t=n[r];++r;let i=e.mcam,a=t.x*i._11+t.y*i._21+t.z*i._31+t.w*i._41,l=t.x*i._12+t.y*i._22+t.z*i._32+t.w*i._42,h=t.x*i._13+t.y*i._23+t.z*i._33+t.w*i._43,o=t.x*i._14+t.y*i._24+t.z*i._34+t.w*i._44;t.x=a,t.y=l,t.z=h,t.w=o;let _=t.x,c=t.y,u=t.z;_<s.xMin&&(s.xMin=_),_>s.xMax&&(s.xMax=_),c<s.yMin&&(s.yMin=c),c>s.yMax&&(s.yMax=c),u<s.zMin&&(s.zMin=u),u>s.zMax&&(s.zMax=u)}s.zMin=t.zMin,t.intersection(t,s)}t.scaleCenter(1.01)}setGlobals(){if(super.setGlobals(),this.mode!=ii.Mixed||this.ctx.computingStatic){let e=this.lightCamera.orthoBounds;e.xMin=1e20,e.xMax=-1e20,e.yMin=1e20,e.yMax=-1e20,e.zMin=1e20,e.zMax=-1e20,this.calcShadowBounds(this.lightCamera),this.lightCamera.update()}let e=this.getShadowProj();this.manager.globals.map.h[this.cameraViewProj_id]=e}syncShader(e){let t=this.dshader;t.constModified=!0,t.shadowMap__=e;let s=this.dshader;s.constModified=!0,s.shadowMapChannel__=this.format==Pn.nativeFormat?ph.PackedFloat:ph.R,this.dshader.shadowBias__=this.bias,this.dshader.shadowPower__=this.power,this.dshader.shadowProj__=this.getShadowProj();let r=this.dshader;r.constModified=!0,r.USE_ESM__=this.samplingKind==ai.ESM,this.dshader.shadowPower__=this.power;let n=this.dshader;n.constModified=!0,n.USE_PCF__=this.samplingKind==ai.PCF;let i=this.dshader.shadowRes__,a=e.width,l=e.height;null==l&&(l=0),null==a&&(a=0),i.x=a,i.y=l,i.z=0,i.w=1,this.dshader.pcfScale__=this.pcfScale;let h=this.dshader;h.constModified=!0,h.pcfQuality__=this.pcfQuality}draw(e,t){if(!this.enabled)return;let s=this;if(!this.filterPasses(e))return;let r=function(e){return e.inFrustum(s.lightCamera.frustum)},n=null,i=!0,a=null,l=null,h=e.discarded,o=e.lastDisc,_=e.current;for(;null!=_;){let e,t=_.obj.cullingCollider;null==t?e=!0:(t!=n&&(n=t,i=r(t)),e=i),e?null==a?(l=_,a=l):(l.next=_,l=_):null==h?(o=_,h=o):(o.next=_,o=_),_=_.next}null!=l&&(l.next=null),null!=o&&(o.next=null),e.current=a,e.discarded=h,e.lastDisc=o;let c=this.ctx.textures.allocTarget("dirShadowMap",this.size,this.size,!1,this.format);if(this.customDepth&&(null==this.depth||this.depth.width!=this.size||this.depth.height!=this.size||this.depth.isDisposed())&&(null!=this.depth&&this.depth.dispose(),this.depth=new Tn(this.size,this.size)),c.depthBuffer=this.depth,this.mode!=ii.Mixed||this.ctx.computingStatic){let e=this.ctx.camera.target,t=null==this.light?this.ctx.lightSystem.shadowLight:this.light,s=null==t?null:t.getShadowDirection();if(null==s){let e=this.lightCamera.target,t=0,s=0,r=-1;null==r&&(r=0),null==s&&(s=0),null==t&&(t=0),e.x=t,e.y=s,e.z=r,e.w=1}else{let e=this.lightCamera.target,t=s.x,r=s.y,n=s.z;null==n&&(n=0),null==r&&(r=0),null==t&&(t=0),e.x=t,e.y=r,e.z=n,e.w=1,this.lightCamera.target.normalize()}this.lightCamera.target.x+=e.x,this.lightCamera.target.y+=e.y,this.lightCamera.target.z+=e.z;let r=this.lightCamera.pos;r.x=e.x,r.y=e.y,r.z=e.z,r.w=e.w,this.lightCamera.update()}if(this.ctx.engine.pushTarget(c),this.ctx.engine.clear(16777215,1),super.draw(e,t),null!=this.border&&this.border.render(),this.ctx.engine.popTarget(),this.mode==ii.Mixed&&!this.ctx.computingStatic){let e=this.ctx.textures.allocTarget("mergedDirShadowMap",this.size,this.size,!1,this.format);this.mergePass.shader.texA__=c,this.mergePass.shader.texB__=this.staticTexture,this.ctx.engine.pushTarget(e),this.mergePass.render(),this.ctx.engine.popTarget(),c=e}this.blur.radius>0&&(this.mode!=ii.Mixed||!this.ctx.computingStatic)&&this.blur.apply(this.ctx,c),this.syncShader(c)}}s["h3d.pass.DirShadowMap"]=Jn,Jn.__name__="h3d.pass.DirShadowMap",Jn.__super__=qn,Object.assign(Jn.prototype,{__class__:Jn});class $n extends Jn{constructor(e,t){Ln._hx_skip_constructor=!0,super(),Ln._hx_skip_constructor=!1,this._hx_constructor(e,t)}_hx_constructor(e,t){null==e&&(e=1024),null!=t&&(this.format=t),super._hx_constructor(null),this.set_size(e),this.color=new Xr,this.set_mode(ii.Dynamic),this.shadowMapId=yh.allocID("shadow.map"),this.shadowProjId=yh.allocID("shadow.proj"),this.shadowColorId=yh.allocID("shadow.color"),this.shadowPowerId=yh.allocID("shadow.power"),this.shadowBiasId=yh.allocID("shadow.bias")}draw(e,t){super.draw(e,t),this.ctx.setGlobalID(this.shadowMapId,{texture:this.dshader.shadowMap__,channel:this.format==Pn.nativeFormat?ph.PackedFloat:ph.R}),this.ctx.setGlobalID(this.shadowProjId,this.getShadowProj()),this.ctx.setGlobalID(this.shadowColorId,this.color),this.ctx.setGlobalID(this.shadowPowerId,this.power),this.ctx.setGlobalID(this.shadowBiasId,this.bias)}}s["h3d.pass.DefaultShadowMap"]=$n,$n.__name__="h3d.pass.DefaultShadowMap",$n.__super__=Jn,Object.assign($n.prototype,{__class__:$n});class ei extends Un{constructor(){Un._hx_skip_constructor=!0,super(),Un._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.viewport__=new Xr,this.colorID__=new Xr,super._hx_constructor()}updateConstants(e){this.constBits=0,this.updateConstantsFinal(e)}getParamValue(e){switch(e){case 0:return this.colorID__;case 1:return this.viewport__}return null}getParamFloatValue(e){return 0}}s["h3d.pass._HardwarePick.FixedColor"]=ei,ei.__name__="h3d.pass._HardwarePick.FixedColor",ei.__super__=Un,Object.assign(ei.prototype,{__class__:ei});class ti extends Kn{constructor(){Ln._hx_skip_constructor=!0,super(),Ln._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.pickedIndex=-1,this.fixedColor=new ei,super._hx_constructor("hwpick"),this.material=new Rn("");let e=this.material,t=An.One,s=An.Zero;e.set_blendSrc(t),e.set_blendAlphaSrc(t),e.set_blendDst(s),e.set_blendAlphaDst(s),this.texOut=new Pn(3,3,[Sn.Target]),this.texOut.depthBuffer=new Tn(3,3)}dispose(){super.dispose(),this.texOut.dispose(),this.texOut.depthBuffer.dispose()}getOutputs(){return[Sh.Value("output.colorID")]}drawObject(e){super.drawObject(e);let t=this.fixedColor.colorID__,s=-16777216|++this.colorID;t.x=(s>>16&255)/255,t.y=(s>>8&255)/255,t.z=(255&s)/255,t.w=(s>>>24)/255}draw(e,t){let s=e.current;for(;null!=s;){let e=s;s=s.next;let t=e,r=268435392;t.pass.bits&=~r,t.pass.bits|=this.material.bits&r}this.colorID=0;let r=this.fixedColor.colorID__,n=-16777216|++this.colorID;r.x=(n>>16&255)/255,r.y=(n>>8&255)/255,r.z=(255&n)/255,r.w=(n>>>24)/255;let i=this.fixedColor.viewport__,a=-(2*this.pickX/this.ctx.engine.width-1),l=2*this.pickY/this.ctx.engine.height-1,h=this.ctx.engine.width/this.texOut.width,o=this.ctx.engine.height/this.texOut.height;null==o&&(o=1),null==h&&(h=0),null==l&&(l=0),null==a&&(a=0),i.x=a,i.y=l,i.z=h,i.w=o,this.ctx.engine.pushTarget(this.texOut),this.ctx.engine.clear(-16777216,1),this.ctx.extraShaders=this.ctx.allocShaderList(this.fixedColor),super.draw(e,t),this.ctx.extraShaders=null,this.ctx.engine.popTarget();let _=e.current;for(;null!=_;){let e=_;_=_.next;let t=e;t.pass.set_blendSrc(t.pass.blendSrc),t.pass.set_blendDst(t.pass.blendDst),t.pass.set_blendOp(t.pass.blendOp),t.pass.set_blendAlphaSrc(t.pass.blendAlphaSrc),t.pass.set_blendAlphaDst(t.pass.blendAlphaDst),t.pass.set_blendAlphaOp(t.pass.blendAlphaOp),t.pass.colorMask=t.pass.colorMask}this.ctx.engine.clear(null,null,0);let c=this.texOut.capturePixels();this.pickedIndex=(16777215&c.getPixel(c.width>>1,c.height>>1))-1}}s["h3d.pass.HardwarePick"]=ti,ti.__name__="h3d.pass.HardwarePick",ti.__super__=Kn,Object.assign(ti.prototype,{__class__:ti});class si{constructor(e){this.current=e,this.discarded=this.lastDisc=null}}s["h3d.pass.PassList"]=si,si.__name__="h3d.pass.PassList",Object.assign(si.prototype,{__class__:si});class ri{constructor(){this.texture=0}}s["h3d.pass.PassObject"]=ri,ri.__name__="h3d.pass.PassObject",Object.assign(ri.prototype,{__class__:ri});class ni{constructor(e){this.shaderCache=dh.get(),this.globals=new yh,this.currentOutput=new Vh(null),this.setOutput(e)}setOutput(e){null==e&&(e=[Sh.Value("output.color")]),this.currentOutput.s=this.shaderCache.getLinkShader(e)}fillRec(e,t,s,r){switch(t._hx_index){case 1:case 3:return s[r]=e,1;case 5:t.t;let n=t.size,i=e;switch(s[r++]=i.x,s[r++]=i.y,n){case 3:s[r++]=i.z;break;case 4:s[r++]=i.z,s[r++]=i.w}return n;case 6:let a=e;return s[r++]=a._11,s[r++]=a._21,s[r++]=a._31,s[r++]=0,s[r++]=a._12,s[r++]=a._22,s[r++]=a._32,s[r++]=0,s[r++]=a._13,s[r++]=a._23,s[r++]=a._33,s[r++]=0,12;case 7:let l=e;return s[r++]=l._11,s[r++]=l._21,s[r++]=l._31,s[r++]=l._41,s[r++]=l._12,s[r++]=l._22,s[r++]=l._32,s[r++]=l._42,s[r++]=l._13,s[r++]=l._23,s[r++]=l._33,s[r++]=l._43,s[r++]=l._14,s[r++]=l._24,s[r++]=l._34,s[r++]=l._44,16;case 8:let h=e;return s[r++]=h._11,s[r++]=h._21,s[r++]=h._31,s[r++]=h._41,s[r++]=h._12,s[r++]=h._22,s[r++]=h._32,s[r++]=h._42,s[r++]=h._13,s[r++]=h._23,s[r++]=h._33,s[r++]=h._43,12;case 13:let o=t.vl,_=0,c=0;for(;c<o.length;){let t=o[c];++c,_+=this.fillRec(f.field(e,t.name),t.type,s,r+_)}return _;case 15:let u=t.size,d=t.t;switch(d._hx_index){case 3:if(0==u._hx_index){let t=u.v,n=e,i=0,a=n.length<t?n.length:t;for(;i<a;){let e=i++;s[r++]=n[e]}return t}throw $i.thrown("assert "+x.string(t));case 5:if(4==d.size){if(1==d.t._hx_index){if(0==u._hx_index){let t=u.v,n=e,i=0,a=t;for(;i<a;){let e=n[i++];if(null==e)break;s[r++]=e.x,s[r++]=e.y,s[r++]=e.z,s[r++]=e.w}return 4*t}throw $i.thrown("assert "+x.string(t))}if(0==u._hx_index){let t=u.v,n=d,i=e,a=0,l=0,h=t;for(;l<h;){let e=i[l++];if(null==e)break;a=this.fillRec(e,n,s,r),r+=a}return t*a}throw $i.thrown("assert "+x.string(t))}if(0==u._hx_index){let t=u.v,n=d,i=e,a=0,l=0,h=t;for(;l<h;){let e=i[l++];if(null==e)break;a=this.fillRec(e,n,s,r),r+=a}return t*a}throw $i.thrown("assert "+x.string(t));case 8:if(0==u._hx_index){let t=u.v,n=e,i=0,a=t;for(;i<a;){let e=n[i++];if(null==e)break;s[r++]=e._11,s[r++]=e._21,s[r++]=e._31,s[r++]=e._41,s[r++]=e._12,s[r++]=e._22,s[r++]=e._32,s[r++]=e._42,s[r++]=e._13,s[r++]=e._23,s[r++]=e._33,s[r++]=e._43}return 12*t}throw $i.thrown("assert "+x.string(t));default:if(0==u._hx_index){let t=u.v,n=d,i=e,a=0,l=0,h=t;for(;l<h;){let e=i[l++];if(null==e)break;a=this.fillRec(e,n,s,r),r+=a}return t*a}throw $i.thrown("assert "+x.string(t))}break;default:throw $i.thrown("assert "+x.string(t))}}shaderInfo(e,t){let s=t.split(".").pop();for(;null!=e;){let t=0,r=e.s.instance.shader.vars;for(;t<r.length;){let n=r[t];if(++t,n.name==s)return e.s.toString()}e=e.next}return"(not found)"}fillGlobals(e,t){let s=this,r=t.vertex,n=r.globals,i=e.vertex.globals;for(;null!=n;){let e=s.globals.map.h[n.gid];if(null==e){if("__consts__"==n.path){s.fillRec(r.consts,n.type,i,n.pos),n=n.next;continue}throw $i.thrown("Missing global value "+n.path)}s.fillRec(e,n.type,i,n.pos),n=n.next}let a=t.fragment,l=a.globals,h=e.fragment.globals;for(;null!=l;){let e=s.globals.map.h[l.gid];if(null==e){if("__consts__"==l.path){s.fillRec(a.consts,l.type,h,l.pos),l=l.next;continue}throw $i.thrown("Missing global value "+l.path)}s.fillRec(e,l.type,h,l.pos),l=l.next}}fillParams(e,t,s){let r=-1,n=null,i=this,a=e.vertex,l=t.vertex,h=l.params,o=a.params;for(;null!=h;){let e;if(null==h.perObjectGlobal){if(h.type==ql.TFloat){let e,t=h.instance;if(r==t)e=n;else{let i=s;for(r=t;--t>0;)i=i.next;n=i.s,e=n}o[h.pos]=e.getParamFloatValue(h.index),h=h.next;continue}let t,i=h.instance;if(r==i)t=n;else{let e=s;for(r=i;--i>0;)e=e.next;n=e.s,t=n}if(e=t.getParamValue(h.index),null==e)throw $i.thrown("Missing param value "+x.string(n)+"."+h.name)}else if(null!=h.perObjectGlobal){let t=i.globals.map.h[h.perObjectGlobal.gid];if(null==t)throw $i.thrown("Missing global value "+h.perObjectGlobal.path+" for shader "+i.shaderInfo(s,h.perObjectGlobal.path));let r,n=h.type;if(17==n._hx_index){n.size;r=!0}else r=!1;e=r?t.texture:t}else{let t=s,r=h.instance;for(;--r>0;)t=t.next;let n=t.s.getParamValue(h.index);if(null==n)throw $i.thrown("Missing param value "+x.string(t.s)+"."+h.name);e=n}i.fillRec(e,h.type,o,h.pos),h=h.next}let _=0,c=l.textures;for(;null!=c;){let e,t=a.tex,r=_++,n=!ni.STRICT;if(null==n&&(n=!1),null!=c.perObjectGlobal){let t=i.globals.map.h[c.perObjectGlobal.gid];if(null==t)throw $i.thrown("Missing global value "+c.perObjectGlobal.path+" for shader "+i.shaderInfo(s,c.perObjectGlobal.path));let r,n=c.type;if(17==n._hx_index){n.size;r=!0}else r=!1;e=r?t.texture:t}else{let t=s,r=c.instance;for(;--r>0;)t=t.next;let i=t.s.getParamValue(c.index);if(null==i&&!n)throw $i.thrown("Missing param value "+x.string(t.s)+"."+c.name);e=i}t[r]=e,c=c.next}let u=l.buffers,d=0;for(;null!=u;){let e,t=!ni.STRICT;if(null==t&&(t=!1),null!=u.perObjectGlobal){let t=i.globals.map.h[u.perObjectGlobal.gid];if(null==t)throw $i.thrown("Missing global value "+u.perObjectGlobal.path+" for shader "+i.shaderInfo(s,u.perObjectGlobal.path));let r,n=u.type;if(17==n._hx_index){n.size;r=!0}else r=!1;e=r?t.texture:t}else{let r=s,n=u.instance;for(;--n>0;)r=r.next;let i=r.s.getParamValue(u.index);if(null==i&&!t)throw $i.thrown("Missing param value "+x.string(r.s)+"."+u.name);e=i}a.buffers[d++]=e,u=u.next}let p=e.fragment,f=t.fragment,g=f.params,b=p.params;for(;null!=g;){let e;if(null==g.perObjectGlobal){if(g.type==ql.TFloat){let e,t=g.instance;if(r==t)e=n;else{let i=s;for(r=t;--t>0;)i=i.next;n=i.s,e=n}b[g.pos]=e.getParamFloatValue(g.index),g=g.next;continue}let t,i=g.instance;if(r==i)t=n;else{let e=s;for(r=i;--i>0;)e=e.next;n=e.s,t=n}if(e=t.getParamValue(g.index),null==e)throw $i.thrown("Missing param value "+x.string(n)+"."+g.name)}else if(null!=g.perObjectGlobal){let t=i.globals.map.h[g.perObjectGlobal.gid];if(null==t)throw $i.thrown("Missing global value "+g.perObjectGlobal.path+" for shader "+i.shaderInfo(s,g.perObjectGlobal.path));let r,n=g.type;if(17==n._hx_index){n.size;r=!0}else r=!1;e=r?t.texture:t}else{let t=s,r=g.instance;for(;--r>0;)t=t.next;let n=t.s.getParamValue(g.index);if(null==n)throw $i.thrown("Missing param value "+x.string(t.s)+"."+g.name);e=n}i.fillRec(e,g.type,b,g.pos),g=g.next}let m=0,A=f.textures;for(;null!=A;){let e,t=p.tex,r=m++,n=!ni.STRICT;if(null==n&&(n=!1),null!=A.perObjectGlobal){let t=i.globals.map.h[A.perObjectGlobal.gid];if(null==t)throw $i.thrown("Missing global value "+A.perObjectGlobal.path+" for shader "+i.shaderInfo(s,A.perObjectGlobal.path));let r,n=A.type;if(17==n._hx_index){n.size;r=!0}else r=!1;e=r?t.texture:t}else{let t=s,r=A.instance;for(;--r>0;)t=t.next;let i=t.s.getParamValue(A.index);if(null==i&&!n)throw $i.thrown("Missing param value "+x.string(t.s)+"."+A.name);e=i}t[r]=e,A=A.next}let w=f.buffers,y=0;for(;null!=w;){let e,t=!ni.STRICT;if(null==t&&(t=!1),null!=w.perObjectGlobal){let t=i.globals.map.h[w.perObjectGlobal.gid];if(null==t)throw $i.thrown("Missing global value "+w.perObjectGlobal.path+" for shader "+i.shaderInfo(s,w.perObjectGlobal.path));let r,n=w.type;if(17==n._hx_index){n.size;r=!0}else r=!1;e=r?t.texture:t}else{let r=s,n=w.instance;for(;--n>0;)r=r.next;let i=r.s.getParamValue(w.index);if(null==i&&!t)throw $i.thrown("Missing param value "+x.string(r.s)+"."+w.name);e=i}p.buffers[y++]=e,w=w.next}}compileShaders(e,t){null==t&&(t=!1),this.globals.maxChannels=0;let s=e;for(;null!=s;){let e=s.s;s=s.next,e.updateConstants(this.globals)}this.currentOutput.next=e;let r=this.shaderCache.link(this.currentOutput,t);return this.currentOutput.next=null,r}}s["h3d.pass.ShaderManager"]=ni,ni.__name__="h3d.pass.ShaderManager",Object.assign(ni.prototype,{__class__:ni});var ii=n["h3d.pass.RenderMode"]={__ename__:"h3d.pass.RenderMode",__constructs__:["None","Static","Dynamic","Mixed"],None:{_hx_index:0,__enum__:"h3d.pass.RenderMode",toString:r},Static:{_hx_index:1,__enum__:"h3d.pass.RenderMode",toString:r},Dynamic:{_hx_index:2,__enum__:"h3d.pass.RenderMode",toString:r},Mixed:{_hx_index:3,__enum__:"h3d.pass.RenderMode",toString:r}};ii.__empty_constructs__=[ii.None,ii.Static,ii.Dynamic,ii.Mixed];var ai=n["h3d.pass.ShadowSamplingKind"]={__ename__:"h3d.pass.ShadowSamplingKind",__constructs__:["None","PCF","ESM"],None:{_hx_index:0,__enum__:"h3d.pass.ShadowSamplingKind",toString:r},PCF:{_hx_index:1,__enum__:"h3d.pass.ShadowSamplingKind",toString:r},ESM:{_hx_index:2,__enum__:"h3d.pass.ShadowSamplingKind",toString:r}};ai.__empty_constructs__=[ai.None,ai.PCF,ai.ESM];class li{constructor(){this.textureCount=1,this.shaderCount=1,this.shaderIdMap=[],this.textureIdMap=[]}sort(e){let t=this.shaderCount,s=this.textureCount,r=this,n=e.current;for(;null!=n;){let e=n;n=n.next;let r=e;(this.shaderIdMap[r.shader.id]<t||null==this.shaderIdMap[r.shader.id])&&(this.shaderIdMap[r.shader.id]=this.shaderCount++),(this.textureIdMap[r.texture]<s||null==this.textureIdMap[r.shader.id])&&(this.textureIdMap[r.texture]=this.textureCount++)}let i,a=e.current;if(null==a)i=null;else{let e,t,s,n,l,h=1,o=0,_=0;for(;;){for(t=a,a=null,l=null,e=0;null!=t;){++e,s=t,o=0;let i=0,c=h;for(;i<c;){i++;if(++o,s=s.next,null==s)break}for(_=h;o>0||_>0&&null!=s;){if(0==o)n=s,s=s.next,--_;else{let e;if(0!=_&&null!=s){let n=r.shaderIdMap[t.shader.id]-r.shaderIdMap[s.shader.id];e=(0!=n?n:r.textureIdMap[t.texture]-r.textureIdMap[s.texture])<=0}else e=!0;e?(n=t,t=t.next,--o):(n=s,s=s.next,--_)}null!=l?l.next=n:a=n,l=n}t=s}if(l.next=null,e<=1)break;h*=2}i=a}e.current=i}}s["h3d.pass.SortByMaterial"]=li,li.__name__="h3d.pass.SortByMaterial",Object.assign(li.prototype,{__class__:li});class hi{constructor(){this.refCount=0}getBounds(){throw $i.thrown("not implemented for "+x.string(this))}incref(){this.refCount++}decref(){this.refCount--,this.refCount<=0&&(this.refCount=0,this.dispose())}alloc(e){throw $i.thrown("not implemented")}render(e){(null==this.buffer||this.buffer.isDisposed())&&this.alloc(e),null==this.indexes?0!=(this.buffer.flags&1<<Lr.Quads._hx_index)?e.renderBuffer(this.buffer,e.mem.quadIndexes,2,0,-1):e.renderBuffer(this.buffer,e.mem.triIndexes,3,0,-1):e.renderIndexed(this.buffer,this.indexes)}dispose(){null!=this.buffer&&(this.buffer.dispose(),this.buffer=null),null!=this.indexes&&(this.indexes.dispose(),this.indexes=null)}toString(){return Ss.getClass(this).__name__.split(".").pop()}}s["h3d.prim.Primitive"]=hi,hi.__name__="h3d.prim.Primitive",hi.__interfaces__=[Hr],Object.assign(hi.prototype,{__class__:hi});class oi extends hi{constructor(){super()}alloc(e){let t=Ka._new(0);if(t.pos==t.array.length){let e=t.array.length<<1;e<128&&(e=128);let s=new Float32Array(e);s.set(t.array),t.array=s}if(t.array[t.pos++]=-1,t.pos==t.array.length){let e=t.array.length<<1;e<128&&(e=128);let s=new Float32Array(e);s.set(t.array),t.array=s}if(t.array[t.pos++]=-1,t.pos==t.array.length){let e=t.array.length<<1;e<128&&(e=128);let s=new Float32Array(e);s.set(t.array),t.array=s}if(t.array[t.pos++]=0,t.pos==t.array.length){let e=t.array.length<<1;e<128&&(e=128);let s=new Float32Array(e);s.set(t.array),t.array=s}if(t.array[t.pos++]=1,t.pos==t.array.length){let e=t.array.length<<1;e<128&&(e=128);let s=new Float32Array(e);s.set(t.array),t.array=s}if(t.array[t.pos++]=-1,t.pos==t.array.length){let e=t.array.length<<1;e<128&&(e=128);let s=new Float32Array(e);s.set(t.array),t.array=s}if(t.array[t.pos++]=1,t.pos==t.array.length){let e=t.array.length<<1;e<128&&(e=128);let s=new Float32Array(e);s.set(t.array),t.array=s}if(t.array[t.pos++]=0,t.pos==t.array.length){let e=t.array.length<<1;e<128&&(e=128);let s=new Float32Array(e);s.set(t.array),t.array=s}if(t.array[t.pos++]=0,t.pos==t.array.length){let e=t.array.length<<1;e<128&&(e=128);let s=new Float32Array(e);s.set(t.array),t.array=s}if(t.array[t.pos++]=1,t.pos==t.array.length){let e=t.array.length<<1;e<128&&(e=128);let s=new Float32Array(e);s.set(t.array),t.array=s}if(t.array[t.pos++]=-1,t.pos==t.array.length){let e=t.array.length<<1;e<128&&(e=128);let s=new Float32Array(e);s.set(t.array),t.array=s}if(t.array[t.pos++]=1,t.pos==t.array.length){let e=t.array.length<<1;e<128&&(e=128);let s=new Float32Array(e);s.set(t.array),t.array=s}if(t.array[t.pos++]=1,t.pos==t.array.length){let e=t.array.length<<1;e<128&&(e=128);let s=new Float32Array(e);s.set(t.array),t.array=s}if(t.array[t.pos++]=1,t.pos==t.array.length){let e=t.array.length<<1;e<128&&(e=128);let s=new Float32Array(e);s.set(t.array),t.array=s}if(t.array[t.pos++]=1,t.pos==t.array.length){let e=t.array.length<<1;e<128&&(e=128);let s=new Float32Array(e);s.set(t.array),t.array=s}if(t.array[t.pos++]=1,t.pos==t.array.length){let e=t.array.length<<1;e<128&&(e=128);let s=new Float32Array(e);s.set(t.array),t.array=s}t.array[t.pos++]=0,this.buffer=Gr.ofFloats(t,4,[Lr.Quads,Lr.RawFormat])}render(e){(null==this.buffer||this.buffer.isDisposed())&&this.alloc(e),e.renderBuffer(this.buffer,e.mem.quadIndexes,2,0,-1)}static get(){let e=Wr.CURRENT,t=e.resCache.h[oi.__id__];return null==t&&(t=new oi,e.resCache.set(oi,t)),t}}s["h3d.prim.Plane2D"]=oi,oi.__name__="h3d.prim.Plane2D",oi.__super__=hi,Object.assign(oi.prototype,{__class__:oi});class _i extends hi{constructor(e,t){null==t&&(t=!1),super(),this.onContextLost=function(){return e},this.bounds=e.bounds,this.alloc(null),t||(this.onContextLost=null)}alloc(e){if(null==this.onContextLost)throw $i.thrown("Cannot realloc "+x.string(this));let t=this.onContextLost(),s=[];null==t.ibuf&&s.push(t.quads?Lr.Quads:Lr.Triangles),t.stride<8&&s.push(Lr.RawFormat),this.buffer=Gr.ofFloats(t.vbuf,t.stride,s),this.vcount=this.buffer.vertices,this.tcount=null!=t.ibuf?t.ibuf.length/3|0:t.quads?this.vcount>>1:this.vcount/3|0,null!=t.ibuf?this.indexes=Nr.alloc(t.ibuf):null!=this.indexes&&(this.indexes.dispose(),this.indexes=null)}getBounds(){if(null==this.bounds)throw $i.thrown("Bounds not defined for "+x.string(this));return this.bounds}}s["h3d.prim.RawPrimitive"]=_i,_i.__name__="h3d.prim.RawPrimitive",_i.__super__=hi,Object.assign(_i.prototype,{__class__:_i});class ci{constructor(e){ci._hx_skip_constructor||this._hx_constructor(e)}_hx_constructor(e){this.flags=0,this.absPos=new jr,this.absPos.identity(),this.x=0;this.flags|=1,this.y=0;this.flags|=1,this.z=0;this.flags|=1,this.scaleX=1;this.flags|=1,this.scaleY=1;this.flags|=1,this.scaleZ=1;this.flags|=1,this.qRot=new Yr;null!=this.follow?this.flags|=1:this.flags&=-2;this.flags|=2,this.children=[],null!=e&&e.addChild(this)}set_cullingCollider(e){this.cullingCollider=e;return this.flags&=-4097,e}localToGlobal(e){this.syncPos(),null==e&&(e=new Xr);let t=this.absPos,s=e.x*t._11+e.y*t._21+e.z*t._31+e.w*t._41,r=e.x*t._12+e.y*t._22+e.z*t._32+e.w*t._42,n=e.x*t._13+e.y*t._23+e.z*t._33+e.w*t._43;return e.x=s,e.y=r,e.z=n,e}getInvPos(){return this.syncPos(),null==this.invPos&&(this.invPos=new jr,this.invPos._44=0),0==this.invPos._44&&this.invPos.inverse3x4(this.absPos),this.invPos}addChild(e){this.addChildAt(e,this.children.length)}addChildAt(e,t){t<0&&(t=0),t>this.children.length&&(t=this.children.length);let s=this;for(;null!=s;){if(s==e)throw $i.thrown("Recursive addChild");s=s.parent}if(null!=e.parent){let t=0!=(32&e.flags),s=32;e.flags&=~s,e.parent.removeChild(e);let r=32;t?e.flags|=r:e.flags&=~r}this.children.splice(t,0,e),0==(32&this.flags)&&0!=(32&e.flags)&&e.onRemove(),e.parent=this;e.flags|=1,0!=(32&this.flags)&&(0==(32&e.flags)?e.onAdd():e.onParentChanged())}iterVisibleMeshes(e){if(0==(2&this.flags)||0!=(4&this.flags)&&0!=(128&this.flags))return;if(0==(4&this.flags)){let t=this instanceof ui?this:null;null!=t&&e(t)}let t=0,s=this.children;for(;t<s.length;){let r=s[t];++t,r.iterVisibleMeshes(e)}}onParentChanged(){let e=0,t=this.children;for(;e<t.length;){let s=t[e];++e,s.onParentChanged()}}onAdd(){this.flags|=32;let e=0,t=this.children;for(;e<t.length;){let s=t[e];++e,s.onAdd()}}onRemove(){this.flags&=-33;let e=0,t=this.children;for(;e<t.length;){let s=t[e];++e,s.onRemove()}}removeChild(e){if(c.remove(this.children,e)){0!=(32&e.flags)&&e.onRemove(),e.parent=null;let t=1;!0?e.flags|=t:e.flags&=~t}}getScene(){let e=this;for(;null!=e.parent;)e=e.parent;return e instanceof Ai?e:null}getAbsPos(){return this.syncPos(),this.absPos}draw(e){}calcAbsPos(){if(this.qRot.toMatrix(this.absPos),this.absPos._11*=this.scaleX,this.absPos._12*=this.scaleX,this.absPos._13*=this.scaleX,this.absPos._21*=this.scaleY,this.absPos._22*=this.scaleY,this.absPos._23*=this.scaleY,this.absPos._31*=this.scaleZ,this.absPos._32*=this.scaleZ,this.absPos._33*=this.scaleZ,this.absPos._41=this.x,this.absPos._42=this.y,this.absPos._43=this.z,null!=this.follow)if(this.follow.syncPos(),0!=(8&this.flags)){let e=this.absPos,t=this.absPos,s=this.parent.absPos,r=t._11,n=t._12,i=t._13,a=t._21,l=t._22,h=t._23,o=t._31,_=t._32,c=t._33,u=t._41,d=t._42,p=t._43,f=s._11,x=s._12,g=s._13,b=s._21,m=s._22,A=s._23,w=s._31,y=s._32,k=s._33,B=s._41,C=s._42,v=s._43;e._11=r*f+n*b+i*w,e._12=r*x+n*m+i*y,e._13=r*g+n*A+i*k,e._14=0,e._21=a*f+l*b+h*w,e._22=a*x+l*m+h*y,e._23=a*g+l*A+h*k,e._24=0,e._31=o*f+_*b+c*w,e._32=o*x+_*m+c*y,e._33=o*g+_*A+c*k,e._34=0,e._41=u*f+d*b+p*w+B,e._42=u*x+d*m+p*y+C,e._43=u*g+d*A+p*k+v,e._44=1,this.absPos._41=this.x+this.follow.absPos._41,this.absPos._42=this.y+this.follow.absPos._42,this.absPos._43=this.z+this.follow.absPos._43}else this.absPos.multiply3x4(this.absPos,this.follow.absPos);else if(null!=this.parent&&0==(2048&this.flags)){let e=this.absPos,t=this.absPos,s=this.parent.absPos,r=t._11,n=t._12,i=t._13,a=t._21,l=t._22,h=t._23,o=t._31,_=t._32,c=t._33,u=t._41,d=t._42,p=t._43,f=s._11,x=s._12,g=s._13,b=s._21,m=s._22,A=s._23,w=s._31,y=s._32,k=s._33,B=s._41,C=s._42,v=s._43;e._11=r*f+n*b+i*w,e._12=r*x+n*m+i*y,e._13=r*g+n*A+i*k,e._14=0,e._21=a*f+l*b+h*w,e._22=a*x+l*m+h*y,e._23=a*g+l*A+h*k,e._24=0,e._31=o*f+_*b+c*w,e._32=o*x+_*m+c*y,e._33=o*g+_*A+c*k,e._34=0,e._41=u*f+d*b+p*w+B,e._42=u*x+d*m+p*y+C,e._43=u*g+d*A+p*k+v,e._44=1}if(null!=this.defaultTransform){let e=this.absPos,t=this.defaultTransform,s=this.absPos,r=t._11,n=t._12,i=t._13,a=t._21,l=t._22,h=t._23,o=t._31,_=t._32,c=t._33,u=t._41,d=t._42,p=t._43,f=s._11,x=s._12,g=s._13,b=s._21,m=s._22,A=s._23,w=s._31,y=s._32,k=s._33,B=s._41,C=s._42,v=s._43;e._11=r*f+n*b+i*w,e._12=r*x+n*m+i*y,e._13=r*g+n*A+i*k,e._14=0,e._21=a*f+l*b+h*w,e._22=a*x+l*m+h*y,e._23=a*g+l*A+h*k,e._24=0,e._31=o*f+_*b+c*w,e._32=o*x+_*m+c*y,e._33=o*g+_*A+c*k,e._34=0,e._41=u*f+d*b+p*w+B,e._42=u*x+d*m+p*y+C,e._43=u*g+d*A+p*k+v,e._44=1}null!=this.invPos&&(this.invPos._44=0)}sync(e){}syncRec(e){if(null!=this.currentAnimation){let t=this.parent,s=e.elapsedTime;for(;s>0&&null!=this.currentAnimation;)s=this.currentAnimation.update(s);if(null!=this.currentAnimation&&(e.visibleFlag&&0!=(2&this.flags)&&0==(4&this.flags)||0!=(64&this.flags))&&this.currentAnimation.sync(),null==this.parent&&null!=t)return}let t=e.visibleFlag;if((0==(2&this.flags)||0!=(4&this.flags)&&0!=(128&this.flags))&&(e.visibleFlag=!1),null==e.cullingCollider||null!=this.cullingCollider&&0==(4096&this.flags))0!=(4096&this.flags)&&this.set_cullingCollider(null);else{this.set_cullingCollider(e.cullingCollider);let t=4096;this.flags|=t}let s=e.cullingCollider;0!=(128&this.flags)&&(e.cullingCollider=this.cullingCollider);let r=0!=(1&this.flags);r&&this.calcAbsPos(),this.sync(e);null!=this.follow?this.flags|=1:this.flags&=-2,this.lastFrame=e.frame;let n=0,i=this.children.length;for(;n<i;){let t=this.children[n];if(null==t)break;if(t.lastFrame!=e.frame){if(r){let e=1;!0?t.flags|=e:t.flags&=~e}t.syncRec(e)}this.children[n]!=t?(n=0,i=this.children.length):++n}e.visibleFlag=t,e.cullingCollider=s}syncPos(){if(null!=this.parent&&this.parent.syncPos(),0!=(1&this.flags)){let e=1;null!=this.follow?this.flags|=e:this.flags&=~e,this.calcAbsPos();let t=0,s=this.children;for(;t<s.length;){let e=s[t];++t;let r=1;!0?e.flags|=r:e.flags&=~r}}}emit(e){}emitRec(e){if(0==(2&this.flags)||0!=(4&this.flags)&&0!=(128&this.flags)&&!e.computingStatic)return;if(0!=(1&this.flags)){null!=this.currentAnimation&&this.currentAnimation.sync();let e=1;null!=this.follow?this.flags|=e:this.flags&=~e,this.calcAbsPos();let t=0,s=this.children;for(;t<s.length;){let e=s[t];++t;let r=1;!0?e.flags|=r:e.flags&=~r}}(0==(4&this.flags)||e.computingStatic)&&this.emit(e);let t=0,s=this.children;for(;t<s.length;){let r=s[t];++t,r.emitRec(e)}}}s["h3d.scene.Object"]=ci,ci.__name__="h3d.scene.Object",ci.__interfaces__=[Hr],Object.assign(ci.prototype,{__class__:ci});class ui extends ci{constructor(e,t,s){super(s),this.set_primitive(e),null==t&&(t=Dn.current.createMaterial()).set_props(t.getDefaultProps()),this.material=t}draw(e){this.primitive.render(e.engine)}emit(e){let t=this.material.passes;for(;null!=t;)e.emitPass(t,this).index=0,t=t.nextPass}onAdd(){super.onAdd(),null!=this.primitive&&this.primitive.incref()}onRemove(){null!=this.primitive&&this.primitive.decref(),super.onRemove()}set_primitive(e){return e!=this.primitive&&0!=(32&this.flags)&&(null!=this.primitive&&this.primitive.decref(),null!=e&&e.incref()),this.primitive=e}}s["h3d.scene.Mesh"]=ui,ui.__name__="h3d.scene.Mesh",ui.__super__=ci,Object.assign(ui.prototype,{__class__:ui});class di extends ci{constructor(e,t){ci._hx_skip_constructor=!0,super(),ci._hx_skip_constructor=!1,this._hx_constructor(e,t)}_hx_constructor(e,t){this.hitPoint=new Xr,this.mouseDownButton=-1,this.propagateEvents=!1,this.cancelEvents=!1,super._hx_constructor(t),this.shape=e,this.set_cursor(Ya.Button)}onAdd(){this.scene=this.getScene(),null!=this.scene&&this.scene.addEventTarget(this),super.onAdd()}onRemove(){null!=this.scene&&(this.scene.removeEventTarget(this),this.scene=null),super.onRemove()}getInteractiveScene(){return this.scene}handleEvent(e){switch(this.propagateEvents&&(e.propagate=!0),this.cancelEvents&&(e.cancel=!0),e.kind._hx_index){case 0:(this.enableRightButton||0==e.button)&&(this.mouseDownButton=e.button,this.onPush(e));break;case 1:(this.enableRightButton||0==e.button)&&(this.onRelease(e),this.mouseDownButton==e.button&&this.onClick(e)),this.mouseDownButton=-1;break;case 2:this.onMove(e);break;case 3:this.onOver(e);break;case 4:this.onOut(e);break;case 5:this.onWheel(e);break;case 6:this.onFocus(e);break;case 7:this.onFocusLost(e);break;case 8:this.onKeyDown(e);break;case 9:this.onKeyUp(e);break;case 10:(this.enableRightButton||0==e.button)&&(this.onRelease(e),this.mouseDownButton==e.button&&this.onReleaseOutside(e)),this.mouseDownButton=-1;break;case 11:this.onTextInput(e);break;case 12:this.onCheck(e)}}set_cursor(e){return this.cursor=e,null!=this.scene&&null!=this.scene.events&&this.scene.events.updateCursor(this),e}onOver(e){}onOut(e){}onPush(e){}onRelease(e){}onReleaseOutside(e){}onClick(e){}onMove(e){}onWheel(e){}onFocus(e){}onFocusLost(e){}onKeyUp(e){}onKeyDown(e){}onCheck(e){}onTextInput(e){}}s["h3d.scene.Interactive"]=di,di.__name__="h3d.scene.Interactive",di.__interfaces__=[wr],di.__super__=ci,Object.assign(di.prototype,{__class__:di});class pi extends ci{constructor(e,t){ci._hx_skip_constructor=!0,super(),ci._hx_skip_constructor=!1,this._hx_constructor(e,t)}_hx_constructor(e,t){this.priority=0,this.cullingDistance=-1,super._hx_constructor(t),this.shader=e}emit(e){e.emitLight(this)}getShadowDirection(){return null}}s["h3d.scene.Light"]=pi,pi.__name__="h3d.scene.Light",pi.__super__=ci,Object.assign(pi.prototype,{__class__:pi});class fi{constructor(){fi._hx_skip_constructor||this._hx_constructor()}_hx_constructor(){this.ambientLight=new Xr(1,1,1)}initGlobals(e){}cullLights(){let e=this.ctx.lights,t=null,s=new sn;for(;null!=e;)s.x=e.absPos._41,s.y=e.absPos._42,s.z=e.absPos._43,s.r=e.cullingDistance,e.cullingDistance>0&&!this.ctx.computingStatic&&!this.ctx.camera.frustum.hasSphere(s)?(null==t?this.ctx.lights=e.next:t.next=e.next,e=e.next):(this.lightCount++,e.objectDistance=0,t=e,e=e.next)}initLights(e){if(this.lightCount=0,this.ctx=e,this.cullLights(),null==this.shadowLight||0==(32&this.shadowLight.flags)){let t=e.lights;for(;null!=t;){if(null!=t.getShadowDirection()){this.shadowLight=t;break}t=t.next}}}computeLight(e,t){return t}}s["h3d.scene.LightSystem"]=fi,fi.__name__="h3d.scene.LightSystem",Object.assign(fi.prototype,{__class__:fi});class xi{constructor(e,t){this.gid=e,this.value=t}}s["h3d.scene._RenderContext.SharedGlobal"]=xi,xi.__name__="h3d.scene._RenderContext.SharedGlobal",Object.assign(xi.prototype,{__class__:xi});class gi extends Cr{constructor(){super(),this.cachedShaderList=[],this.cachedPassObjects=[]}start(){this.sharedGlobals=[],this.lights=null,this.drawPass=null,this.passes=null,this.lights=null,this.cachedPos=0,this.visibleFlag=!0,this.time+=this.elapsedTime,this.frame++}setGlobalID(e,t){let s=0,r=this.sharedGlobals;for(;s<r.length;){let n=r[s];if(++s,n.gid==e)return void(n.value=t)}this.sharedGlobals.push(new xi(e,t))}emitPass(e,t){let s=this.allocPool;return null==s?(s=new ri,s.nextAlloc=this.allocFirst,this.allocFirst=s):this.allocPool=s.nextAlloc,s.pass=e,s.obj=t,s.next=this.passes,this.passes=s,s}allocShaderList(e,t){let s=this.cachedShaderList[this.cachedPos++];return null==s&&(s=new Vh(null),this.cachedShaderList[this.cachedPos-1]=s),s.s=e,s.next=t,s}emitLight(e){e.next=this.lights,this.lights=e}done(){this.drawPass=null;let e=this.allocFirst;for(;null!=e&&e!=this.allocPool;)e.obj=null,e.pass=null,e.shader=null,e.shaders=null,e.next=null,e.index=0,e.texture=0,e=e.nextAlloc;null!=this.allocPool&&(this.allocFirst=this.allocFirst.nextAlloc),this.allocPool=this.allocFirst;let t=0,s=this.cachedShaderList;for(;t<s.length;){let e=s[t];++t,e.s=null,e.next=null}this.passes=null,this.lights=null}}s["h3d.scene.RenderContext"]=gi,gi.__name__="h3d.scene.RenderContext",gi.__super__=Cr,Object.assign(gi.prototype,{__class__:gi});class bi{constructor(){this.passes=new si}}s["h3d.scene.PassObjects"]=bi,bi.__name__="h3d.scene.PassObjects",Object.assign(bi.prototype,{__class__:bi});class mi extends gn{constructor(){super(),mi._hx_skip_constructor||this._hx_constructor()}_hx_constructor(){this.effects=[],this.hasSetTarget=!1,this.emptyPasses=new si,this.allPasses=[],this.passObjects=new va,this.set_props(this.getDefaultProps());let e=ao(this,this.depthSort);this.frontToBack=function(t){e(true,t)};let t=ao(this,this.depthSort);this.backToFront=function(e){t(false,e)}}dispose(){let e=0,t=this.allPasses;for(;e<t.length;){let s=t[e];++e,s.dispose()}let s=0,r=this.effects;for(;s<r.length;){let e=r[s];++s,e.dispose()}this.passObjects=new va}depthSort(e,t){let s=this.ctx.camera.m,r=t.current;for(;null!=r;){let e=r;r=r.next;let t=e,n=t.obj.absPos._41*s._13+t.obj.absPos._42*s._23+t.obj.absPos._43*s._33+s._43,i=t.obj.absPos._41*s._14+t.obj.absPos._42*s._24+t.obj.absPos._43*s._34+s._44;t.depth=n/i}if(e){let e,s=t.current;if(null==s)e=null;else{let t,r,n,i,a,l=1,h=0,o=0;for(;;){for(r=s,s=null,a=null,t=0;null!=r;){++t,n=r,h=0;let e=0,_=l;for(;e<_;){e++;if(++h,n=n.next,null==n)break}for(o=l;h>0||o>0&&null!=n;)0==h?(i=n,n=n.next,--o):0==o||null==n||(r.pass.layer==n.pass.layer?r.depth>n.depth?1:-1:r.pass.layer-n.pass.layer)<=0?(i=r,r=r.next,--h):(i=n,n=n.next,--o),null!=a?a.next=i:s=i,a=i;r=n}if(a.next=null,t<=1)break;l*=2}e=s}t.current=e}else{let e,s=t.current;if(null==s)e=null;else{let t,r,n,i,a,l=1,h=0,o=0;for(;;){for(r=s,s=null,a=null,t=0;null!=r;){++t,n=r,h=0;let e=0,_=l;for(;e<_;){e++;if(++h,n=n.next,null==n)break}for(o=l;h>0||o>0&&null!=n;)0==h?(i=n,n=n.next,--o):0==o||null==n||(r.pass.layer==n.pass.layer?r.depth>n.depth?-1:1:r.pass.layer-n.pass.layer)<=0?(i=r,r=r.next,--h):(i=n,n=n.next,--o),null!=a?a.next=i:s=i,a=i;r=n}if(a.next=null,t<=1)break;l*=2}e=s}t.current=e}}resetTarget(){this.hasSetTarget&&(this.ctx.engine.popTarget(),this.hasSetTarget=!1)}has(e){return null!=this.passObjects.h[e]}get(e){let t=this.passObjects.h[e];return null==t?this.emptyPasses:(t.rendered=!0,t.passes)}render(){throw $i.thrown("Not implemented")}computeStatic(){throw $i.thrown("Not implemented")}start(){}process(e){this.hasSetTarget=!1;let t=0,s=this.allPasses;for(;t<s.length;){let e=s[t];++t,e.setContext(this.ctx)}let r=0;for(;r<e.length;){let t=e[r];++r,this.passObjects.h[t.name]=t}this.ctx.textures.begin(),this.ctx.computingStatic?this.computeStatic():this.render(),this.resetTarget();let n=0;for(;n<e.length;){let t=e[n];++n,this.passObjects.h[t.name]=null}}}s["h3d.scene.Renderer"]=mi,mi.__name__="h3d.scene.Renderer",mi.__super__=gn,Object.assign(mi.prototype,{__class__:mi});class Ai extends ci{constructor(e,t){null==t&&(t=!0),null==e&&(e=!0),super(null),this.window=il.getInstance(),this.eventListeners=[],this.hitInteractives=[],this.interactives=[],this.camera=new zr;let s=Wr.CURRENT;null!=s&&(this.camera.screenRatio=s.width/s.height),this.ctx=new gi,e&&this.set_renderer(Dn.current.createRenderer()),t&&(this.lightSystem=Dn.current.createLightSystem())}setEvents(e){this.events=e}dispatchListeners(e){let t=0,s=this.eventListeners;for(;t<s.length;){let r=s[t];if(++t,r(e),!e.propagate)break}}set_renderer(e){return this.renderer=e,null!=e&&(e.ctx=this.ctx),e}sortHitPointByCameraDistance(e,t){return e.hitPoint.w>t.hitPoint.w?-1:1}dispatchEvent(e,t){t.handleEvent(e)}isInteractiveVisible(e){let t=e;for(;t!=this;){if(null==t||0==(2&t.flags))return!1;t=t.parent}return!0}handleEvent(e,t){if(0==this.interactives.length)return null;if(0==this.hitInteractives.length){let t=2*(e.relX/this.window.get_width()-.5),s=2*-(e.relY/this.window.get_height()-.5),r=this.camera.unproject(t,s,0),n=this.camera.unproject(t,s,1),i=r.x,a=r.y,l=r.z;null==l&&(l=0),null==a&&(a=0),null==i&&(i=0);let h=i,o=a,_=l,c=n.x,u=n.y,d=n.z;null==d&&(d=0),null==u&&(u=0),null==c&&(c=0);let p=c,f=u,x=d,g=new en;g.px=h,g.py=o,g.pz=_,g.lx=p-h,g.ly=f-o,g.lz=x-_,g.normalize();let b=g,m=b.px,A=b.py,w=b.pz,y=b.lx,k=b.ly,B=b.lz,C=-2147483648,v=0,S=this.interactives;for(;v<S.length;){let e=S[v];if(++v,e.priority<C)continue;let t=e;for(;null!=t&&0!=(2&t.flags);)t=t.parent;if(null!=t)continue;let s=e.getInvPos(),r=b.px,n=b.py,i=b.pz;null==i&&(i=0),null==n&&(n=0),null==r&&(r=0);let a=r,l=n,h=i,o=1,_=a*s._11+l*s._21+h*s._31+o*s._41,c=a*s._12+l*s._22+h*s._32+o*s._42,u=a*s._13+l*s._23+h*s._33+o*s._43;a=_,l=c,h=u,b.px=a,b.py=l,b.pz=h;let d=b.lx,p=b.ly,f=b.lz;null==f&&(f=0),null==p&&(p=0),null==d&&(d=0);let x=d,g=p,M=f,I=x*s._11+g*s._21+M*s._31,T=x*s._12+g*s._22+M*s._32,F=x*s._13+g*s._23+M*s._33;if(x=I,g=T,M=F,b.lx=x,b.ly=g,b.lz=M,b.normalize(),b.lx!=b.lx){b.px=m,b.py=A,b.pz=w,b.lx=y,b.ly=k,b.lz=B;continue}let E=e.shape.rayIntersection(b,e.bestMatch);if(E<0){b.px=m,b.py=A,b.pz=w,b.lx=y,b.ly=k,b.lz=B;continue}let D=b.px+E*b.lx,R=b.py+E*b.ly,V=b.pz+E*b.lz;null==V&&(V=0),null==R&&(R=0),null==D&&(D=0);let O=D,P=R,Q=V;if(b.px=m,b.py=A,b.pz=w,b.lx=y,b.ly=k,b.lz=B,e.hitPoint.x=O,e.hitPoint.y=P,e.hitPoint.z=Q,e.priority>C){for(;this.hitInteractives.length>0;)this.hitInteractives.pop();C=e.priority}this.hitInteractives.push(e)}if(0==this.hitInteractives.length)return null;if(this.hitInteractives.length>1){let e=0,t=this.hitInteractives;for(;e<t.length;){let s=t[e];++e;let r=s.invPos,n=0;if(null!=s.preciseShape){let e=b.px,t=b.py,i=b.pz;null==i&&(i=0),null==t&&(t=0),null==e&&(e=0);let a=e,l=t,h=i,o=1,_=a*r._11+l*r._21+h*r._31+o*r._41,c=a*r._12+l*r._22+h*r._32+o*r._42,u=a*r._13+l*r._23+h*r._33+o*r._43;a=_,l=c,h=u,b.px=a,b.py=l,b.pz=h;let d=b.lx,p=b.ly,f=b.lz;null==f&&(f=0),null==p&&(p=0),null==d&&(d=0);let x=d,g=p,C=f,v=x*r._11+g*r._21+C*r._31,S=x*r._12+g*r._22+C*r._32,M=x*r._13+g*r._23+C*r._33;x=v,g=S,C=M,b.lx=x,b.ly=g,b.lz=C,b.normalize();let I=s.preciseShape.rayIntersection(b,s.bestMatch);if(I>0){let e=b.px+I*b.lx,t=b.py+I*b.ly,r=b.pz+I*b.lz;null==r&&(r=0),null==t&&(t=0),null==e&&(e=0);let n=e,i=t,a=r;s.hitPoint.x=n,s.hitPoint.y=i,s.hitPoint.z=a}else n=1;b.px=m,b.py=A,b.pz=w,b.lx=y,b.ly=k,b.lz=B}let i=s.hitPoint,a=i.x,l=i.y,h=i.z,o=i.w;null==o&&(o=1),null==h&&(h=0),null==l&&(l=0),null==a&&(a=0);let _=a,c=l,u=h,d=o;d=1;let p=s.absPos,f=_*p._11+c*p._21+u*p._31+d*p._41,x=_*p._12+c*p._22+u*p._32+d*p._42,g=_*p._13+c*p._23+u*p._33+d*p._43;_=f,c=x,u=g;let C=this.camera.m,v=_*C._11+c*C._21+u*C._31+d*C._41,S=_*C._12+c*C._22+u*C._32+d*C._42,M=_*C._13+c*C._23+u*C._33+d*C._43,I=1/(_*C._14+c*C._24+u*C._34+d*C._44);_=v*I,c=S*I,u=M*I,d=1,s.hitPoint.w=u+n}this.hitInteractives.sort(ao(this,this.sortHitPointByCameraDistance))}this.hitInteractives.unshift(null)}for(;this.hitInteractives.length>0;){let t=this.hitInteractives.pop();if(null==t)return null;if(e.relX=t.hitPoint.x,e.relY=t.hitPoint.y,e.relZ=t.hitPoint.z,t.handleEvent(e),!e.cancel){if(!e.propagate)for(;this.hitInteractives.length>0;)this.hitInteractives.pop();return t}e.cancel=!1,e.propagate=!1}return null}dispose(){0!=(32&this.flags)&&this.onRemove(),null!=this.hardwarePass&&(this.hardwarePass.dispose(),this.hardwarePass=null),this.ctx.dispose(),null!=this.renderer&&(this.renderer.dispose(),this.set_renderer(new mi))}addEventTarget(e){if(this.interactives.indexOf(e)>=0)throw $i.thrown("assert");this.interactives.push(e)}removeEventTarget(e){c.remove(this.interactives,e)&&(null!=this.events&&this.events.onRemove(e),c.remove(this.hitInteractives,e))}setElapsedTime(e){this.ctx.elapsedTime=e}render(e){0==(32&this.flags)&&this.onAdd();let t=e.getCurrentTarget();this.camera.screenRatio=null==t?e.width/e.height:t.width/t.height,this.camera.update(),this.camera.rightHanded&&e.driver.setRenderFlag(nn.CameraHandness,1),this.ctx.camera=this.camera,this.ctx.engine=e,this.ctx.scene=this,this.ctx.start(),this.renderer.start(),this.syncRec(this.ctx),this.emitRec(this.ctx);let s,r=this.ctx.passes;if(null==r)s=null;else{let e,t,n,i,a,l=1,h=0,o=0;for(;;){for(t=r,r=null,a=null,e=0;null!=t;){++e,n=t,h=0;let s=0,_=l;for(;s<_;){s++;if(++h,n=n.next,null==n)break}for(o=l;h>0||o>0&&null!=n;)0==h?(i=n,n=n.next,--o):0==o||null==n||t.pass.passId-n.pass.passId<=0?(i=t,t=t.next,--h):(i=n,n=n.next,--o),null!=a?a.next=i:r=i,a=i;t=n}if(a.next=null,e<=1)break;l*=2}s=r}this.ctx.passes=s;let n=this.ctx.passes,i=[],a=-1;for(;null!=n;){let e=n.pass.passId,t=n,s=null;for(;null!=t&&t.pass.passId==e;)s=t,t=t.next;s.next=null;let r=this.ctx.cachedPassObjects[++a];null==r&&(r=new bi,this.ctx.cachedPassObjects[a]=r),r.name=n.pass.name;let l=r.passes;l.current=n,l.discarded=l.lastDisc=null,i.push(r),n=t}null!=this.lightSystem&&(this.ctx.lightSystem=this.lightSystem,this.lightSystem.initLights(this.ctx)),this.renderer.process(i),this.camera.rightHanded&&e.driver.setRenderFlag(nn.CameraHandness,0),this.ctx.done(),this.ctx.scene=null,this.ctx.camera=null,this.ctx.engine=null;let l=0,h=a;for(;l<h;){let e=l++,t=this.ctx.cachedPassObjects[e];t.name=null;let s=t.passes;s.current=null,s.discarded=s.lastDisc=null}}}s["h3d.scene.Scene"]=Ai,Ai.__name__="h3d.scene.Scene",Ai.__interfaces__=[Ir,ue],Ai.__super__=ci,Object.assign(Ai.prototype,{__class__:Ai});class wi extends fi{constructor(){fi._hx_skip_constructor=!0,super(),fi._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.perPixelLighting=!0,this.maxLightsPerObject=6,super._hx_constructor();let e=this.ambientLight,t=.5,s=.5,r=.5;null==r&&(r=0),null==s&&(s=0),null==t&&(t=0),e.x=t,e.y=s,e.z=r,e.w=1,this.ambientShader=new Ci,this.set_additiveLighting(!0)}set_additiveLighting(e){let t=this.ambientShader,s=t instanceof Ci?t:null;return s.constModified=!0,s.additive__=e}initLights(e){if(super.initLights(e),this.lightCount<=this.maxLightsPerObject){let t,s=e.lights,r=ao(this,this.sortLight);if(null==s)t=null;else{let e,n,i,a,l,h=1,o=0,_=0;for(;;){for(n=s,s=null,l=null,e=0;null!=n;){++e,i=n,o=0;let t=0,c=h;for(;t<c;){t++;if(++o,i=i.next,null==i)break}for(_=h;o>0||_>0&&null!=i;)0==o?(a=i,i=i.next,--_):0==_||null==i||r(n,i)<=0?(a=n,n=n.next,--o):(a=i,i=i.next,--_),null!=l?l.next=a:s=a,l=a;n=i}if(l.next=null,e<=1)break;h*=2}t=s}e.lights=t}}initGlobals(e){e.set("global.ambientLight",this.ambientLight),e.set("global.perPixelLighting",this.perPixelLighting)}sortLight(e,t){let s=e.priority-t.priority;return 0!=s?-s:e.objectDistance<t.objectDistance?-1:1}computeLight(e,t){let s=this;if(this.lightCount>this.maxLightsPerObject){let t=this.ctx.lights;for(;null!=t;){if(0!=(16&e.flags)){let e=t.absPos._41-this.ctx.camera.target.x,s=t.absPos._42-this.ctx.camera.target.y,r=t.absPos._43-this.ctx.camera.target.z;null==r&&(r=0),t.objectDistance=e*e+s*s+r*r}else{let s=t.absPos._41-e.absPos._41,r=t.absPos._42-e.absPos._42,n=t.absPos._43-e.absPos._43;null==n&&(n=0),t.objectDistance=s*s+r*r+n*n}t=t.next}let s,r=this.ctx.lights,n=ao(this,this.sortLight);if(null==r)s=null;else{let e,t,i,a,l,h=1,o=0,_=0;for(;;){for(t=r,r=null,l=null,e=0;null!=t;){++e,i=t,o=0;let s=0,c=h;for(;s<c;){s++;if(++o,i=i.next,null==i)break}for(_=h;o>0||_>0&&null!=i;)0==o?(a=i,i=i.next,--_):0==_||null==i||n(t,i)<=0?(a=t,t=t.next,--o):(a=i,i=i.next,--_),null!=l?l.next=a:r=a,l=a;t=i}if(l.next=null,e<=1)break;h*=2}s=r}this.ctx.lights=s}t=s.ctx.allocShaderList(this.ambientShader,t);let r=this.ctx.lights,n=0;for(;null!=r&&n++!=this.maxLightsPerObject;)t=s.ctx.allocShaderList(r.shader,t),r=r.next;return t}}s["h3d.scene.fwd.LightSystem"]=wi,wi.__name__="h3d.scene.fwd.LightSystem",wi.__super__=fi,Object.assign(wi.prototype,{__class__:wi});class yi extends Kn{constructor(){Ln._hx_skip_constructor=!0,super(),Ln._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.enableSky=!1,super._hx_constructor("depth"),this.depthMapId=yh.allocID("depthMap")}getOutputs(){return[Sh.PackFloat(Sh.Value("output.depth"))]}draw(e,t){let s=this.ctx.textures.allocTarget("depthMap",this.ctx.engine.width,this.ctx.engine.height,!0);this.ctx.engine.pushTarget(s),this.ctx.engine.clear(this.enableSky?0:16711680,1),super.draw(e,t),this.ctx.engine.popTarget(),this.ctx.setGlobalID(this.depthMapId,{texture:s})}}s["h3d.scene.fwd.DepthPass"]=yi,yi.__name__="h3d.scene.fwd.DepthPass",yi.__super__=Kn,Object.assign(yi.prototype,{__class__:yi});class ki extends Kn{constructor(){super("normal"),this.normalMapId=yh.allocID("normalMap")}getOutputs(){return[Sh.PackNormal(Sh.Value("output.normal"))]}draw(e,t){let s=this.ctx.textures.allocTarget("normalMap",this.ctx.engine.width,this.ctx.engine.height);this.ctx.engine.pushTarget(s),this.ctx.engine.clear(8421504,1),super.draw(e,t),this.ctx.engine.popTarget(),this.ctx.setGlobalID(this.normalMapId,s)}}s["h3d.scene.fwd.NormalPass"]=ki,ki.__name__="h3d.scene.fwd.NormalPass",ki.__super__=Kn,Object.assign(ki.prototype,{__class__:ki});class Bi extends mi{constructor(){mi._hx_skip_constructor=!0,super(),mi._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.shadow=new $n(1024),this.normal=new ki,this.depth=new yi,super._hx_constructor(),this.defaultPass=new Kn("default"),this.allPasses=[this.defaultPass,this.depth,this.normal,this.shadow]}renderPass(e,t,s){e.draw(t,s)}render(){this.has("shadow")&&this.renderPass(this.shadow,this.get("shadow")),this.has("depth")&&this.renderPass(this.depth,this.get("depth")),this.has("normal")&&this.renderPass(this.normal,this.get("normal")),this.renderPass(this.defaultPass,this.get("default")),this.renderPass(this.defaultPass,this.get("alpha"),this.backToFront),this.renderPass(this.defaultPass,this.get("additive"))}}s["h3d.scene.fwd.Renderer"]=Bi,Bi.__name__="h3d.scene.fwd.Renderer",Bi.__super__=mi,Object.assign(Bi.prototype,{__class__:Bi});class Ci extends Un{constructor(){super()}updateConstants(e){this.constBits=0,this.additive__&&(this.constBits|=2),this.updateConstantsFinal(e)}getParamValue(e){return 0==e?this.additive__:null}getParamFloatValue(e){return 0}}s["h3d.shader.AmbientLight"]=Ci,Ci.__name__="h3d.shader.AmbientLight",Ci.__super__=Un,Object.assign(Ci.prototype,{__class__:Ci});class vi extends Un{constructor(){Un._hx_skip_constructor=!0,super(),Un._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.viewport__=new Xr,this.halfPixelInverse__=new Xr,this.uvPos__=new Xr,this.filterMatrixB__=new Xr,this.filterMatrixA__=new Xr,this.absoluteMatrixB__=new Xr,this.absoluteMatrixA__=new Xr,this.color__=new Xr,this.zValue__=0,super._hx_constructor()}updateConstants(e){this.constBits=0,this.isRelative__&&(this.constBits|=1),this.hasUVPos__&&(this.constBits|=2),this.killAlpha__&&(this.constBits|=4),this.pixelAlign__&&(this.constBits|=8),this.updateConstantsFinal(e)}getParamValue(e){switch(e){case 0:return this.zValue__;case 1:return this.texture__;case 2:return this.isRelative__;case 3:return this.color__;case 4:return this.absoluteMatrixA__;case 5:return this.absoluteMatrixB__;case 6:return this.filterMatrixA__;case 7:return this.filterMatrixB__;case 8:return this.hasUVPos__;case 9:return this.uvPos__;case 10:return this.killAlpha__;case 11:return this.pixelAlign__;case 12:return this.halfPixelInverse__;case 13:return this.viewport__}return null}getParamFloatValue(e){return 0==e?this.zValue__:0}}s["h3d.shader.Base2d"]=vi,vi.__name__="h3d.shader.Base2d",vi.__super__=Un,Object.assign(vi.prototype,{__class__:vi});class Si extends Un{constructor(){Un._hx_skip_constructor=!0,super(),Un._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.specularColor__=new Xr,this.specularAmount__=0,this.specularPower__=0,this.color__=new Xr,super._hx_constructor();let e=this.color__,t=1,s=1,r=1;null==r&&(r=0),null==s&&(s=0),null==t&&(t=0),e.x=t,e.y=s,e.z=r,e.w=1;let n=this.specularColor__,i=1,a=1,l=1;null==l&&(l=0),null==a&&(a=0),null==i&&(i=0),n.x=i,n.y=a,n.z=l,n.w=1,this.specularPower__=50,this.specularAmount__=1}updateConstants(e){this.constBits=0,this.updateConstantsFinal(e)}getParamValue(e){switch(e){case 0:return this.color__;case 1:return this.specularPower__;case 2:return this.specularAmount__;case 3:return this.specularColor__}return null}getParamFloatValue(e){switch(e){case 1:return this.specularPower__;case 2:return this.specularAmount__}return 0}}s["h3d.shader.BaseMesh"]=Si,Si.__name__="h3d.shader.BaseMesh",Si.__super__=Un,Object.assign(Si.prototype,{__class__:Si});class Mi extends Wn{constructor(){Un._hx_skip_constructor=!0,super(),Un._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.cubeDir__=new jr,this.fixedColor__=new Xr,this.pixel__=new Xr,this.offsets__=[],this.values__=[],this.Quality__=0,this.cameraInverseViewProj__=new jr,super._hx_constructor()}updateConstants(e){this.constBits=0;let t=this.Quality__;if(t>>>8!=0)throw $i.thrown("Quality is out of range "+t+">255");this.constBits|=t,this.isDepth__&&(this.constBits|=256),this.hasFixedColor__&&(this.constBits|=512),this.smoothFixedColor__&&(this.constBits|=1024),this.isDepthDependant__&&(this.constBits|=2048),this.hasNormal__&&(this.constBits|=4096),this.isCube__&&(this.constBits|=8192),this.updateConstantsFinal(e)}getParamValue(e){switch(e){case 0:return this.flipY__;case 1:return this.cameraInverseViewProj__;case 2:return this.texture__;case 3:return this.depthTexture__;case 4:return this.Quality__;case 5:return this.isDepth__;case 6:return this.values__;case 7:return this.offsets__;case 8:return this.pixel__;case 9:return this.hasFixedColor__;case 10:return this.smoothFixedColor__;case 11:return this.fixedColor__;case 12:return this.isDepthDependant__;case 13:return this.hasNormal__;case 14:return this.normalTexture__;case 15:return this.isCube__;case 16:return this.cubeTexture__;case 17:return this.cubeDir__}return null}getParamFloatValue(e){return 0==e?this.flipY__:0}}s["h3d.shader.Blur"]=Mi,Mi.__name__="h3d.shader.Blur",Mi.__super__=Wn,Object.assign(Mi.prototype,{__class__:Mi});class Ii{constructor(e){this.globals=new Float32Array(e.globalsSize<<2),this.params=new Float32Array(e.paramsSize<<2);let t,s=new Array(e.texturesCount);if(this.tex=s,e.bufferCount>0){t=new Array(e.bufferCount)}else t=null;this.buffers=t}grow(e){let t=e.globalsSize<<2,s=e.paramsSize<<2,r=e.texturesCount,n=e.bufferCount;if(this.globals.length<t&&(this.globals=new Float32Array(t)),this.params.length<s&&(this.params=new Float32Array(s)),this.tex.length<r){let e=new Array(r);this.tex=e}if(n>0&&(null==this.buffers||this.buffers.length<n)){let e=new Array(n);this.buffers=e}}}s["h3d.shader.ShaderBuffers"]=Ii,Ii.__name__="h3d.shader.ShaderBuffers",Object.assign(Ii.prototype,{__class__:Ii});class Ti{constructor(e){this.vertex=new Ii(e.vertex),this.fragment=new Ii(e.fragment)}}s["h3d.shader.Buffers"]=Ti,Ti.__name__="h3d.shader.Buffers",Object.assign(Ti.prototype,{__class__:Ti});class Fi extends Un{constructor(e){Un._hx_skip_constructor=!0,super(),Un._hx_skip_constructor=!1,this._hx_constructor(e)}_hx_constructor(e){null==e&&(e=0),this.color__=new Xr,super._hx_constructor();let t=this.color__;t.x=(e>>16&255)/255,t.y=(e>>8&255)/255,t.z=(255&e)/255,t.w=(e>>>24)/255}updateConstants(e){this.constBits=0,this.updateConstantsFinal(e)}getParamValue(e){return 0==e?this.color__:null}getParamFloatValue(e){return 0}}s["h3d.shader.ColorAdd"]=Fi,Fi.__name__="h3d.shader.ColorAdd",Fi.__super__=Un,Object.assign(Fi.prototype,{__class__:Fi});class Ei extends Un{constructor(e){Un._hx_skip_constructor=!0,super(),Un._hx_skip_constructor=!1,this._hx_constructor(e)}_hx_constructor(e){null==e&&(e=0),this.colorKey__=new Xr,super._hx_constructor();let t=this.colorKey__;t.x=(e>>16&255)/255,t.y=(e>>8&255)/255,t.z=(255&e)/255,t.w=(e>>>24)/255}updateConstants(e){this.constBits=0,this.updateConstantsFinal(e)}getParamValue(e){return 0==e?this.colorKey__:null}getParamFloatValue(e){return 0}}s["h3d.shader.ColorKey"]=Ei,Ei.__name__="h3d.shader.ColorKey",Ei.__super__=Un,Object.assign(Ei.prototype,{__class__:Ei});class Di extends Un{constructor(e){Un._hx_skip_constructor=!0,super(),Un._hx_skip_constructor=!1,this._hx_constructor(e)}_hx_constructor(e){this.matrix__=new jr,super._hx_constructor(),null!=e?this.matrix__.loadValues(e):this.matrix__.identity()}updateConstants(e){this.constBits=0,this.updateConstantsFinal(e)}getParamValue(e){return 0==e?this.matrix__:null}getParamFloatValue(e){return 0}}s["h3d.shader.ColorMatrix"]=Di,Di.__name__="h3d.shader.ColorMatrix",Di.__super__=Un,Object.assign(Di.prototype,{__class__:Di});class Ri extends Un{constructor(){Un._hx_skip_constructor=!0,super(),Un._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.poissonDiskVeryHigh__=[],this.poissonDiskHigh__=[],this.poissonDiskLow__=[],this.shadowBias__=0,this.shadowProj__=new jr,this.shadowMapChannel__=ph.Unknown,this.shadowRes__=new Xr,this.pcfScale__=0,this.pcfQuality__=0,this.shadowPower__=0,super._hx_constructor(),this.poissonDiskLow__=[new Xr(-.942,-.399),new Xr(.945,-.768),new Xr(-.094,-.929),new Xr(.344,.293)],this.poissonDiskHigh__=[new Xr(-.326,-.406),new Xr(-.84,-.074),new Xr(-.696,.457),new Xr(-.203,.621),new Xr(.962,-.195),new Xr(.473,-.48),new Xr(.519,.767),new Xr(.185,-.893),new Xr(.507,.064),new Xr(.896,.412),new Xr(-.322,-.933),new Xr(-.792,-.598)],this.poissonDiskVeryHigh__=[new Xr(-.613392,.617481),new Xr(.170019,-.040254),new Xr(-.299417,.791925),new Xr(.64568,.49321),new Xr(-.651784,.717887),new Xr(.421003,.02707),new Xr(-.817194,-.271096),new Xr(-.705374,-.668203),new Xr(.97705,-.108615),new Xr(.063326,.142369),new Xr(.203528,.214331),new Xr(-.667531,.32609),new Xr(-.098422,-.295755),new Xr(-.885922,.215369),new Xr(.566637,.605213),new Xr(.039766,-.3961),new Xr(.751946,.453352),new Xr(.078707,-.715323),new Xr(-.075838,-.529344),new Xr(.724479,-.580798),new Xr(.222999,-.215125),new Xr(-.467574,-.405438),new Xr(-.248268,-.814753),new Xr(.354411,-.88757),new Xr(.175817,.382366),new Xr(.487472,-.063082),new Xr(-.084078,.898312),new Xr(.488876,-.783441),new Xr(.470016,.217933),new Xr(-.69689,-.549791),new Xr(-.149693,.605762),new Xr(.034211,.97998),new Xr(.503098,-.308878),new Xr(-.016205,-.872921),new Xr(.385784,-.393902),new Xr(-.146886,-.859249),new Xr(.643361,.164098),new Xr(.634388,-.049471),new Xr(-.688894,.007843),new Xr(.464034,-.188818),new Xr(-.44084,.137486),new Xr(.364483,.511704),new Xr(.034028,.325968),new Xr(.099094,-.308023),new Xr(.69396,-.366253),new Xr(.678884,-.204688),new Xr(.001801,.780328),new Xr(.145177,-.898984),new Xr(.062655,-.611866),new Xr(.315226,-.604297),new Xr(-.780145,.486251),new Xr(-.371868,.882138),new Xr(.200476,.49443),new Xr(-.494552,-.711051),new Xr(.612476,.705252),new Xr(-.578845,-.768792),new Xr(-.772454,-.090976),new Xr(.50444,.372295),new Xr(.155736,.065157),new Xr(.391522,.849605),new Xr(-.620106,-.328104),new Xr(.789239,-.419965),new Xr(-.545396,.538133),new Xr(-.178564,-.596057)]}updateConstants(e){this.constBits=0,this.enable__&&(this.constBits|=1),this.USE_ESM__&&(this.constBits|=2),this.USE_PCF__&&(this.constBits|=4);let t=this.pcfQuality__;if(t>>>8!=0)throw $i.thrown("pcfQuality is out of range "+t+">255");if(this.constBits|=t<<3,null==this.shadowMap__)this.shadowMapChannel__=ph.Unknown;else if(this.shadowMapChannel__==ph.Unknown){if(this.shadowMap__.format!=Pn.nativeFormat)throw $i.thrown("shadowMapChannel is not set");this.shadowMapChannel__=ph.PackedFloat}this.constBits|=(e.allocChannelID(this.shadowMap__)<<3|this.shadowMapChannel__._hx_index)<<11,this.updateConstantsFinal(e)}getParamValue(e){switch(e){case 0:return this.enable__;case 1:return this.USE_ESM__;case 2:return this.shadowPower__;case 3:return this.USE_PCF__;case 4:return this.pcfQuality__;case 5:return this.pcfScale__;case 6:return this.shadowRes__;case 7:return this.shadowMap__;case 8:return this.shadowProj__;case 9:return this.shadowBias__;case 10:return this.poissonDiskLow__;case 11:return this.poissonDiskHigh__;case 12:return this.poissonDiskVeryHigh__}return null}getParamFloatValue(e){switch(e){case 2:return this.shadowPower__;case 5:return this.pcfScale__;case 9:return this.shadowBias__}return 0}}s["h3d.shader.DirShadow"]=Ri,Ri.__name__="h3d.shader.DirShadow",Ri.__super__=Un,Object.assign(Ri.prototype,{__class__:Ri});class Vi extends Wn{constructor(){Un._hx_skip_constructor=!0,super(),Un._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.color__=new Xr,this.mode__=0,super._hx_constructor()}updateConstants(e){this.constBits=0;let t=this.mode__;if(t>>>8!=0)throw $i.thrown("mode is out of range "+t+">255");this.constBits|=t,this.updateConstantsFinal(e)}getParamValue(e){switch(e){case 0:return this.flipY__;case 1:return this.mode__;case 2:return this.color__}return null}getParamFloatValue(e){return 0==e?this.flipY__:0}}s["h3d.shader.GenTexture"]=Vi,Vi.__name__="h3d.shader.GenTexture",Vi.__super__=Wn,Object.assign(Vi.prototype,{__class__:Vi});class Oi extends Un{constructor(e,t){Un._hx_skip_constructor=!0,super(),Un._hx_skip_constructor=!1,this._hx_constructor(e,t)}_hx_constructor(e,t){null==t&&(t=1),null==e&&(e=1.5),this.width__=0,this.lengthScale__=0,super._hx_constructor(),this.width__=e,this.lengthScale__=t}updateConstants(e){this.constBits=0,this.updateConstantsFinal(e)}getParamValue(e){switch(e){case 0:return this.lengthScale__;case 1:return this.width__}return null}getParamFloatValue(e){switch(e){case 0:return this.lengthScale__;case 1:return this.width__}return 0}}s["h3d.shader.LineShader"]=Oi,Oi.__name__="h3d.shader.LineShader",Oi.__super__=Un,Object.assign(Oi.prototype,{__class__:Oi});class Pi extends Wn{constructor(){super()}updateConstants(e){this.constBits=0,this.isMax__&&(this.constBits|=1),this.updateConstantsFinal(e)}getParamValue(e){switch(e){case 0:return this.flipY__;case 1:return this.texA__;case 2:return this.texB__;case 3:return this.isMax__}return null}getParamFloatValue(e){return 0==e?this.flipY__:0}}s["h3d.shader.MinMaxShader"]=Pi,Pi.__name__="h3d.shader.MinMaxShader",Pi.__super__=Wn,Object.assign(Pi.prototype,{__class__:Pi});class Qi extends Wn{constructor(){Un._hx_skip_constructor=!0,super(),Un._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.mat__=new jr,super._hx_constructor()}updateConstants(e){this.constBits=0,this.isMax__&&(this.constBits|=1),this.updateConstantsFinal(e)}getParamValue(e){switch(e){case 0:return this.flipY__;case 1:return this.texA__;case 2:return this.texB__;case 3:return this.isMax__;case 4:return this.mat__}return null}getParamFloatValue(e){return 0==e?this.flipY__:0}}s["h3d.shader.CubeMinMaxShader"]=Qi,Qi.__name__="h3d.shader.CubeMinMaxShader",Qi.__super__=Wn,Object.assign(Qi.prototype,{__class__:Qi});class Li extends Un{constructor(e){super(),this.texture__=e}updateConstants(e){this.constBits=0,this.updateConstantsFinal(e)}getParamValue(e){return 0==e?this.texture__:null}getParamFloatValue(e){return 0}}s["h3d.shader.NormalMap"]=Li,Li.__name__="h3d.shader.NormalMap",Li.__super__=Un,Object.assign(Li.prototype,{__class__:Li});class Gi extends Un{constructor(){super()}updateConstants(e){this.constBits=0,this.updateConstantsFinal(e)}getParamValue(e){return null}getParamFloatValue(e){return 0}}s["h3d.shader.Shadow"]=Gi,Gi.__name__="h3d.shader.Shadow",Gi.__super__=Un,Object.assign(Gi.prototype,{__class__:Gi});class zi extends Un{constructor(){Un._hx_skip_constructor=!0,super(),Un._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.bonesMatrixes__=[],this.MaxBones__=0,super._hx_constructor(),this.constModified=!0,this.MaxBones__=34}updateConstants(e){this.constBits=0;let t=this.MaxBones__;if(t>>>8!=0)throw $i.thrown("MaxBones is out of range "+t+">255");this.constBits|=t,this.updateConstantsFinal(e)}getParamValue(e){switch(e){case 0:return this.MaxBones__;case 1:return this.bonesMatrixes__}return null}getParamFloatValue(e){return 0}}s["h3d.shader.SkinBase"]=zi,zi.__name__="h3d.shader.SkinBase",zi.__super__=Un,Object.assign(zi.prototype,{__class__:zi});class Ui extends zi{constructor(){super()}updateConstants(e){this.constBits=0;let t=this.MaxBones__;if(t>>>8!=0)throw $i.thrown("MaxBones is out of range "+t+">255");this.constBits|=t,this.updateConstantsFinal(e)}getParamValue(e){switch(e){case 0:return this.MaxBones__;case 1:return this.bonesMatrixes__}return null}getParamFloatValue(e){return 0}}s["h3d.shader.Skin"]=Ui,Ui.__name__="h3d.shader.Skin",Ui.__super__=zi,Object.assign(Ui.prototype,{__class__:Ui});class Wi extends zi{constructor(){super()}updateConstants(e){this.constBits=0;let t=this.MaxBones__;if(t>>>8!=0)throw $i.thrown("MaxBones is out of range "+t+">255");this.constBits|=t,this.updateConstantsFinal(e)}getParamValue(e){switch(e){case 0:return this.MaxBones__;case 1:return this.bonesMatrixes__}return null}getParamFloatValue(e){return 0}}s["h3d.shader.SkinTangent"]=Wi,Wi.__name__="h3d.shader.SkinTangent",Wi.__super__=zi,Object.assign(Wi.prototype,{__class__:Wi});class Ni extends Un{constructor(e){super(),this.texture__=e}updateConstants(e){this.constBits=0,this.updateConstantsFinal(e)}getParamValue(e){return 0==e?this.texture__:null}getParamFloatValue(e){return 0}}s["h3d.shader.SpecularTexture"]=Ni,Ni.__name__="h3d.shader.SpecularTexture",Ni.__super__=Un,Object.assign(Ni.prototype,{__class__:Ni});class ji extends Un{constructor(e){Un._hx_skip_constructor=!0,super(),Un._hx_skip_constructor=!1,this._hx_constructor(e)}_hx_constructor(e){this.killAlphaThreshold__=0,super._hx_constructor(),this.texture__=e,this.killAlphaThreshold__=Mn.defaultKillAlphaThreshold}updateConstants(e){this.constBits=0,this.additive__&&(this.constBits|=1),this.killAlpha__&&(this.constBits|=2),this.specularAlpha__&&(this.constBits|=4),this.updateConstantsFinal(e)}getParamValue(e){switch(e){case 0:return this.additive__;case 1:return this.killAlpha__;case 2:return this.specularAlpha__;case 3:return this.killAlphaThreshold__;case 4:return this.texture__}return null}getParamFloatValue(e){return 3==e?this.killAlphaThreshold__:0}}s["h3d.shader.Texture"]=ji,ji.__name__="h3d.shader.Texture",ji.__super__=Un,Object.assign(ji.prototype,{__class__:ji});class Yi extends Un{constructor(e,t,s,r){Un._hx_skip_constructor=!0,super(),Un._hx_skip_constructor=!1,this._hx_constructor(e,t,s,r)}_hx_constructor(e,t,s,r){null==r&&(r=1),null==s&&(s=1),null==t&&(t=0),null==e&&(e=0),this.uvScale__=new Xr,this.uvDelta__=new Xr,super._hx_constructor();let n=this.uvDelta__,i=e,a=t;null==a&&(a=0),null==i&&(i=0),n.x=i,n.y=a,n.z=0,n.w=1;let l=this.uvScale__,h=s,o=r;null==o&&(o=0),null==h&&(h=0),l.x=h,l.y=o,l.z=0,l.w=1}updateConstants(e){this.constBits=0,this.updateConstantsFinal(e)}getParamValue(e){switch(e){case 0:return this.uvDelta__;case 1:return this.uvScale__}return null}getParamFloatValue(e){return 0}}s["h3d.shader.UVDelta"]=Yi,Yi.__name__="h3d.shader.UVDelta",Yi.__super__=Un,Object.assign(Yi.prototype,{__class__:Yi});class Xi extends Un{constructor(){super()}updateConstants(e){this.constBits=0,this.additive__&&(this.constBits|=1),this.updateConstantsFinal(e)}getParamValue(e){return 0==e?this.additive__:null}getParamFloatValue(e){return 0}}s["h3d.shader.VertexColorAlpha"]=Xi,Xi.__name__="h3d.shader.VertexColorAlpha",Xi.__super__=Un,Object.assign(Xi.prototype,{__class__:Xi});class Zi extends Un{constructor(e,t){Un._hx_skip_constructor=!0,super(),Un._hx_skip_constructor=!1,this._hx_constructor(e,t)}_hx_constructor(e,t){this.isCentered__=!0,this.tangent__=new Xr,this.normal__=new Xr,this.scale__=new Xr,super._hx_constructor();let s=this.normal__,r=0,n=0,i=1;null==i&&(i=0),null==n&&(n=0),null==r&&(r=0),s.x=r,s.y=n,s.z=i,s.w=1;let a=this.tangent__,l=1,h=0,o=0;null==o&&(o=0),null==h&&(h=0),null==l&&(l=0),a.x=l,a.y=h,a.z=o,a.w=1;let _=this.scale__,c=1/e,u=1/t;null==u&&(u=0),null==c&&(c=0),_.x=c,_.y=u,_.z=0,_.w=1}updateConstants(e){this.constBits=0,this.isCentered__&&(this.constBits|=64),this.updateConstantsFinal(e)}getParamValue(e){switch(e){case 0:return this.scale__;case 1:return this.normal__;case 2:return this.tangent__;case 3:return this.isCentered__}return null}getParamFloatValue(e){return 0}}s["h3d.shader.VolumeDecal"]=Zi,Zi.__name__="h3d.shader.VolumeDecal",Zi.__super__=Un,Object.assign(Zi.prototype,{__class__:Zi});var Hi=n["haxe.StackItem"]={__ename__:"haxe.StackItem",__constructs__:["CFunction","Module","FilePos","Method","LocalFunction"],CFunction:{_hx_index:0,__enum__:"haxe.StackItem",toString:r},Module:(t=function(e){return{_hx_index:1,m:e,__enum__:"haxe.StackItem",toString:r}},t.__params__=["m"],t),FilePos:(t=function(e,t,s,n){return{_hx_index:2,s:e,file:t,line:s,column:n,__enum__:"haxe.StackItem",toString:r}},t.__params__=["s","file","line","column"],t),Method:(t=function(e,t){return{_hx_index:3,classname:e,method:t,__enum__:"haxe.StackItem",toString:r}},t.__params__=["classname","method"],t),LocalFunction:(t=function(e){return{_hx_index:4,v:e,__enum__:"haxe.StackItem",toString:r}},t.__params__=["v"],t)};Hi.__empty_constructs__=[Hi.CFunction];class Ki{static callStack(){return ia.toHaxe(ia.callStack())}}class qi{}s["haxe.IMap"]=qi,qi.__name__="haxe.IMap",qi.__isInterface__=!0;class Ji{static processEvents(){for(;;){let e=Ji.pending.shift();if(null==e)break;e()}let e=na.tick();return na.hasEvents()||0!=Ji.threadCount?e:-1}static run(){let e=Ji.processEvents();if("undefined"!=typeof window){let t=window,s=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame;null!=s?s(Ji.run):e>=0&&setTimeout(Ji.run,1e3*e)}else e>=0&&setTimeout(Ji.run,1e3*e)}}s["haxe.EntryPoint"]=Ji,Ji.__name__="haxe.EntryPoint";class $i extends Error{constructor(e,t,s){super(e),this.message=e,this.__previousException=t,this.__nativeException=null!=s?s:this}unwrap(){return this.__nativeException}get_native(){return this.__nativeException}static caught(e){return e instanceof $i?e:e instanceof Error?new $i(e.message,null,e):new ca(e,null,e)}static thrown(e){if(e instanceof $i)return e.get_native();if(e instanceof Error)return e;return new ca(e)}}s["haxe.Exception"]=$i,$i.__name__="haxe.Exception",$i.__super__=Error,Object.assign($i.prototype,{__class__:$i});class ea{}class ta{}s["haxe._Int64.___Int64"]=ta,ta.__name__="haxe._Int64.___Int64";class sa{static formatOutput(e,t){let s=x.string(e);if(null==t)return s;let r=t.fileName+":"+t.lineNumber;if(null!=t.customParams){let e=0,r=t.customParams;for(;e<r.length;){let t=r[e];++e,s+=", "+x.string(t)}}return r+": "+s}static trace(e,t){let s=sa.formatOutput(e,t);"undefined"!=typeof console&&null!=console.log&&console.log(s)}}s["haxe.Log"]=sa,sa.__name__="haxe.Log";class ra{constructor(e,t){this.isBlocking=!0,this.f=e,this.priority=t,this.nextRun=-1/0}stop(){null!=this.f&&(this.f=null,this.nextRun=-1/0,null==this.prev?na.pending=this.next:this.prev.next=this.next,null!=this.next&&(this.next.prev=this.prev))}}s["haxe.MainEvent"]=ra,ra.__name__="haxe.MainEvent",Object.assign(ra.prototype,{__class__:ra});class na{static hasEvents(){let e=na.pending;for(;null!=e;){if(e.isBlocking)return!0;e=e.next}return!1}static add(e,t){if(null==t&&(t=0),null==e)throw $i.thrown("Event function is null");let s=new ra(e,t),r=na.pending;return null!=r&&(r.prev=s),s.next=r,na.pending=s,s}static sortEvents(){let e=na.pending;if(null==e)return;let t,s,r,n,i,a=1,l=0,h=0;for(;;){for(s=e,e=null,i=null,t=0;null!=s;){++t,r=s,l=0;let o=0,_=a;for(;o<_;){o++;if(++l,r=r.next,null==r)break}for(h=a;l>0||h>0&&null!=r;)0==l?(n=r,r=r.next,--h):0==h||null==r||s.priority>r.priority||s.priority==r.priority&&s.nextRun<=r.nextRun?(n=s,s=s.next,--l):(n=r,r=r.next,--h),null!=i?i.next=n:e=n,n.prev=i,i=n;s=r}if(i.next=null,t<=1)break;a*=2}e.prev=null,na.pending=e}static tick(){na.sortEvents();let e=na.pending,t=c.now()/1e3,s=1e9;for(;null!=e;){let r=e.next,n=e.nextRun-t;n<=0?(s=0,null!=e.f&&e.f()):s>n&&(s=n),e=r}return s}}s["haxe.MainLoop"]=na,na.__name__="haxe.MainLoop";class ia{static callStack(){let e=new Error(""),t=ia.tryHaxeStack(e);if(void 0===t){try{throw e}catch(e){}t=e.stack}return ia.normalize(t,2)}static toHaxe(e,t){if(null==t&&(t=0),null==e)return[];if("string"==typeof e){let s=e.split("\n");"Error"==s[0]&&s.shift();let r=[],n=0,i=s.length;for(;n<i;){let e=n++;if(t>e)continue;let i=s[e],a=i.match(/^    at ([A-Za-z0-9_. ]+) \(([^)]+):([0-9]+):([0-9]+)\)$/);if(null!=a){let e=a[1].split(".");"$hxClasses"==e[0]&&e.shift();let t=e.pop(),s=a[2],n=x.parseInt(a[3]),i=x.parseInt(a[4]);r.push(Hi.FilePos("Anonymous function"==t?Hi.LocalFunction():"Global code"==t?null:Hi.Method(e.join("."),t),s,n,i))}else r.push(Hi.Module(b.trim(i)))}return r}return t>0&&Array.isArray(e)?e.slice(t):e}static tryHaxeStack(e){if(null==e)return[];let t=Error.prepareStackTrace;Error.prepareStackTrace=ia.prepareHxStackTrace;let s=e.stack;return Error.prepareStackTrace=t,s}static prepareHxStackTrace(e,t){let s=[],r=0;for(;r<t.length;){let e=t[r];++r,null!=ia.wrapCallSite&&(e=ia.wrapCallSite(e));let n=null,i=e.getFunctionName();if(null!=i){let e=i.lastIndexOf(".");if(e>=0){let t=i.substring(0,e),s=i.substring(e+1);n=Hi.Method(t,s)}else n=Hi.Method(null,i)}let a=e.getFileName(),l=null==a?-1:a.indexOf("file:");null!=ia.wrapCallSite&&l>0&&(a=a.substring(l+6)),s.push(Hi.FilePos(n,a,e.getLineNumber(),e.getColumnNumber()))}return s}static normalize(e,t){if(null==t&&(t=0),Array.isArray(e)&&t>0)return e.slice(t);if("string"==typeof e){switch(e.substring(0,6)){case"Error\n":case"Error:":++t}return ia.skipLines(e,t)}return e}static skipLines(e,t,s){return null==s&&(s=0),t>0?(s=e.indexOf("\n",s))<0?"":ia.skipLines(e,--t,s+1):e.substring(s)}}s["haxe.NativeStackTrace"]=ia,ia.__name__="haxe.NativeStackTrace";class aa{static getBytes(e){let t=0,s=aa.content;for(;t<s.length;){let r=s[t];if(++t,r.name==e)return null!=r.str?da.ofString(r.str):fa.decode(r.data)}return null}}s["haxe.Resource"]=aa,aa.__name__="haxe.Resource";class la{constructor(){this.buf=new g,this.cache=[],this.useCache=la.USE_CACHE,this.useEnumIndex=la.USE_ENUM_INDEX,this.shash=new va,this.scount=0}toString(){return this.buf.b}serializeString(e){let t=this.shash.h[e];if(null!=t)return this.buf.b+="R",void(this.buf.b+=null==t?"null":""+t);this.shash.h[e]=this.scount++,this.buf.b+="y",e=encodeURIComponent(e),this.buf.b+=x.string(e.length),this.buf.b+=":",this.buf.b+=null==e?"null":""+e}serializeRef(e){let t=typeof e,s=0,r=this.cache.length;for(;s<r;){let r=s++,n=this.cache[r];if(typeof n==t&&n==e)return this.buf.b+="r",this.buf.b+=null==r?"null":""+r,!0}return this.cache.push(e),!1}serializeFields(e){let t=0,s=f.fields(e);for(;t<s.length;){let r=s[t];++t,this.serializeString(r),this.serialize(f.field(e,r))}this.buf.b+="g"}serialize(e){let t=y.typeof(e);switch(t._hx_index){case 0:this.buf.b+="n";break;case 1:let s=e;if(0==s)return void(this.buf.b+="z");this.buf.b+="i",this.buf.b+=null==s?"null":""+s;break;case 2:let r=e;isNaN(r)?this.buf.b+="k":isFinite(r)?(this.buf.b+="d",this.buf.b+=null==r?"null":""+r):this.buf.b+=r<0?"m":"p";break;case 3:this.buf.b+=e?"t":"f";break;case 4:if(Ss.__instanceof(e,co)){let t=e.__name__;this.buf.b+="A",this.serializeString(t)}else if(Ss.__instanceof(e,uo))this.buf.b+="B",this.serializeString(e.__ename__);else{if(this.useCache&&this.serializeRef(e))return;this.buf.b+="o",this.serializeFields(e)}break;case 5:throw $i.thrown("Cannot serialize function");case 6:let i=t.c;if(i==String)return void this.serializeString(e);if(this.useCache&&this.serializeRef(e))return;switch(i){case Array:let t=0;this.buf.b+="a";let s=0,r=e.length;for(;s<r;){let r=s++;null==e[r]?++t:(t>0&&(1==t?this.buf.b+="n":(this.buf.b+="u",this.buf.b+=null==t?"null":""+t),t=0),this.serialize(e[r]))}t>0&&(1==t?this.buf.b+="n":(this.buf.b+="u",this.buf.b+=null==t?"null":""+t)),this.buf.b+="h";break;case Date:let n=e;this.buf.b+="v",this.buf.b+=x.string(n.getTime());break;case ya:this.buf.b+="q";let a=e,l=a.keys();for(;l.hasNext();){let e=l.next();this.buf.b+=":",this.buf.b+=null==e?"null":""+e,this.serialize(a.h[e])}this.buf.b+="h";break;case ka:this.buf.b+="l";let h=e.h;for(;null!=h;){let e=h.item;h=h.next;let t=e;this.serialize(t)}this.buf.b+="h";break;case Ca:this.buf.b+="M";let o=e,_=o.keys();for(;_.hasNext();){let e=_.next(),t=f.field(e,"__id__");f.deleteField(e,"__id__"),this.serialize(e),e.__id__=t,this.serialize(o.h[e.__id__])}this.buf.b+="h";break;case va:this.buf.b+="b";let u=e,d=va.keysIterator(u.h);for(;d.hasNext();){let e=d.next();this.serializeString(e),this.serialize(u.h[e])}this.buf.b+="h";break;case da:let p=e;this.buf.b+="s",this.buf.b+=x.string(Math.ceil(8*p.length/6)),this.buf.b+=":";let g=0,b=p.length-2,m=la.BASE64_CODES;if(null==m){m=new Array(la.BASE64.length);let e=0,t=la.BASE64.length;for(;e<t;){let t=e++;m[t]=c.cca(la.BASE64,t)}la.BASE64_CODES=m}for(;g<b;){let e=p.b[g++],t=p.b[g++],s=p.b[g++];this.buf.b+=String.fromCodePoint(m[e>>2]),this.buf.b+=String.fromCodePoint(m[63&(e<<4|t>>4)]),this.buf.b+=String.fromCodePoint(m[63&(t<<2|s>>6)]),this.buf.b+=String.fromCodePoint(m[63&s])}if(g==b){let e=p.b[g++],t=p.b[g++];this.buf.b+=String.fromCodePoint(m[e>>2]),this.buf.b+=String.fromCodePoint(m[63&(e<<4|t>>4)]),this.buf.b+=String.fromCodePoint(m[t<<2&63])}else if(g==b+1){let e=p.b[g++];this.buf.b+=String.fromCodePoint(m[e>>2]),this.buf.b+=String.fromCodePoint(m[e<<4&63])}break;default:this.useCache&&this.cache.pop(),null!=e.hxSerialize?(this.buf.b+="C",this.serializeString(i.__name__),this.useCache&&this.cache.push(e),e.hxSerialize(this),this.buf.b+="g"):(this.buf.b+="c",this.serializeString(i.__name__),this.useCache&&this.cache.push(e),this.serializeFields(e))}break;case 7:let a=t.e;if(this.useCache){if(this.serializeRef(e))return;this.cache.pop()}if(this.buf.b+=x.string(this.useEnumIndex?"j":"w"),this.serializeString(a.__ename__),this.useEnumIndex)this.buf.b+=":",this.buf.b+=x.string(e._hx_index);else{let t=e;this.serializeString(n[t.__enum__].__constructs__[t._hx_index])}this.buf.b+=":";let l=y.enumParameters(e);this.buf.b+=x.string(l.length);let h=0;for(;h<l.length;){let e=l[h];++h,this.serialize(e)}this.useCache&&this.cache.push(e);break;default:throw $i.thrown("Cannot serialize "+x.string(e))}}}s["haxe.Serializer"]=la,la.__name__="haxe.Serializer",Object.assign(la.prototype,{__class__:la});class ha{constructor(e){let t=this;this.id=setInterval((function(){t.run()}),e)}stop(){null!=this.id&&(clearInterval(this.id),this.id=null)}run(){}static delay(e,t){let s=new ha(t);return s.run=function(){s.stop(),e()},s}}s["haxe.Timer"]=ha,ha.__name__="haxe.Timer",Object.assign(ha.prototype,{__class__:ha});class oa{constructor(){}resolveClass(e){return s[e]}resolveEnum(e){return n[e]}}s["haxe._Unserializer.DefaultResolver"]=oa,oa.__name__="haxe._Unserializer.DefaultResolver",Object.assign(oa.prototype,{__class__:oa});class _a{constructor(e){this.buf=e,this.length=e.length,this.pos=0,this.scache=[],this.cache=[];let t=_a.DEFAULT_RESOLVER;null==t&&(t=new oa,_a.DEFAULT_RESOLVER=t),this.resolver=t}readDigits(){let e=0,t=!1,s=this.pos;for(;;){let r=this.buf.charCodeAt(this.pos);if(r!=r)break;if(45!=r){if(r<48||r>57)break;e=10*e+(r-48),this.pos++}else{if(this.pos!=s)break;t=!0,this.pos++}}return t&&(e*=-1),e}readFloat(){let e=this.pos;for(;;){let e=this.buf.charCodeAt(this.pos);if(e!=e)break;if(!(e>=43&&e<58||101==e||69==e))break;this.pos++}return parseFloat(c.substr(this.buf,e,this.pos-e))}unserializeObject(e){for(;;){if(this.pos>=this.length)throw $i.thrown("Invalid object");if(103==this.buf.charCodeAt(this.pos))break;let t=this.unserialize();if("string"!=typeof t)throw $i.thrown("Invalid object key");let s=this.unserialize();e[t]=s}this.pos++}unserializeEnum(e,t){if(58!=this.buf.charCodeAt(this.pos++))throw $i.thrown("Invalid enum format");let s=this.readDigits();if(0==s)return y.createEnum(e,t);let r=[];for(;s-- >0;)r.push(this.unserialize());return y.createEnum(e,t,r)}unserialize(){switch(this.buf.charCodeAt(this.pos++)){case 65:let e=this.unserialize(),t=this.resolver.resolveClass(e);if(null==t)throw $i.thrown("Class not found "+e);return t;case 66:let s=this.unserialize(),r=this.resolver.resolveEnum(s);if(null==r)throw $i.thrown("Enum not found "+s);return r;case 67:let n=this.unserialize(),i=this.resolver.resolveClass(n);if(null==i)throw $i.thrown("Class not found "+n);let a=Object.create(i.prototype);if(this.cache.push(a),a.hxUnserialize(this),103!=this.buf.charCodeAt(this.pos++))throw $i.thrown("Invalid custom data");return a;case 77:let l=new Ca;this.cache.push(l);this.buf;for(;104!=this.buf.charCodeAt(this.pos);){let e=this.unserialize();l.set(e,this.unserialize())}return this.pos++,l;case 82:let h=this.readDigits();if(h<0||h>=this.scache.length)throw $i.thrown("Invalid string reference");return this.scache[h];case 97:this.buf;let o=[];for(this.cache.push(o);;){let e=this.buf.charCodeAt(this.pos);if(104==e){this.pos++;break}if(117==e){this.pos++;let e=this.readDigits();o[o.length+e-1]=null}else o.push(this.unserialize())}return o;case 98:let _=new va;this.cache.push(_);this.buf;for(;104!=this.buf.charCodeAt(this.pos);){let e=this.unserialize(),t=this.unserialize();_.h[e]=t}return this.pos++,_;case 99:let u=this.unserialize(),d=this.resolver.resolveClass(u);if(null==d)throw $i.thrown("Class not found "+u);let p=Object.create(d.prototype);return this.cache.push(p),this.unserializeObject(p),p;case 100:return this.readFloat();case 102:return!1;case 105:return this.readDigits();case 106:let f=this.unserialize(),x=this.resolver.resolveEnum(f);if(null==x)throw $i.thrown("Enum not found "+f);this.pos++;let g=this.readDigits(),b=x.__constructs__.slice()[g];if(null==b)throw $i.thrown("Unknown enum index "+f+"@"+g);let m=this.unserializeEnum(x,b);return this.cache.push(m),m;case 107:return NaN;case 108:let A=new ka;this.cache.push(A);this.buf;for(;104!=this.buf.charCodeAt(this.pos);)A.add(this.unserialize());return this.pos++,A;case 109:return-1/0;case 110:return null;case 111:let w={};return this.cache.push(w),this.unserializeObject(w),w;case 112:return 1/0;case 113:let y=new ya;this.cache.push(y);this.buf;let k=this.buf.charCodeAt(this.pos++);for(;58==k;){let e=this.readDigits(),t=this.unserialize();y.h[e]=t,k=this.buf.charCodeAt(this.pos++)}if(104!=k)throw $i.thrown("Invalid IntMap format");return y;case 114:let B=this.readDigits();if(B<0||B>=this.cache.length)throw $i.thrown("Invalid reference");return this.cache[B];case 115:let C=this.readDigits(),v=this.buf;if(58!=this.buf.charCodeAt(this.pos++)||this.length-this.pos<C)throw $i.thrown("Invalid bytes length");let S=_a.CODES;null==S&&(S=_a.initCodes(),_a.CODES=S);let M=this.pos,I=3&C,T=M+(C-I),F=new da(new ArrayBuffer(3*(C>>2)+(I>=2?I-1:0))),E=0;for(;M<T;){let e=S[v.charCodeAt(M++)],t=S[v.charCodeAt(M++)];F.b[E++]=e<<2|t>>4;let s=S[v.charCodeAt(M++)];F.b[E++]=t<<4|s>>2;let r=S[v.charCodeAt(M++)];F.b[E++]=s<<6|r}if(I>=2){let e=S[v.charCodeAt(M++)],t=S[v.charCodeAt(M++)];if(F.b[E++]=e<<2|t>>4,3==I){let e=S[v.charCodeAt(M++)];F.b[E++]=t<<4|e>>2}}return this.pos+=C,this.cache.push(F),F;case 116:return!0;case 118:let D;return this.buf.charCodeAt(this.pos)>=48&&this.buf.charCodeAt(this.pos)<=57&&this.buf.charCodeAt(this.pos+1)>=48&&this.buf.charCodeAt(this.pos+1)<=57&&this.buf.charCodeAt(this.pos+2)>=48&&this.buf.charCodeAt(this.pos+2)<=57&&this.buf.charCodeAt(this.pos+3)>=48&&this.buf.charCodeAt(this.pos+3)<=57&&45==this.buf.charCodeAt(this.pos+4)?(D=c.strDate(c.substr(this.buf,this.pos,19)),this.pos+=19):D=new Date(this.readFloat()),this.cache.push(D),D;case 119:let R=this.unserialize(),V=this.resolver.resolveEnum(R);if(null==V)throw $i.thrown("Enum not found "+R);let O=this.unserializeEnum(V,this.unserialize());return this.cache.push(O),O;case 120:throw $i.thrown(this.unserialize());case 121:let P=this.readDigits();if(58!=this.buf.charCodeAt(this.pos++)||this.length-this.pos<P)throw $i.thrown("Invalid string length");let Q=c.substr(this.buf,this.pos,P);return this.pos+=P,Q=decodeURIComponent(Q.split("+").join(" ")),this.scache.push(Q),Q;case 122:return 0}throw this.pos--,$i.thrown("Invalid char "+this.buf.charAt(this.pos)+" at position "+this.pos)}static initCodes(){let e=[],t=0,s=_a.BASE64.length;for(;t<s;){let s=t++;e[_a.BASE64.charCodeAt(s)]=s}return e}static run(e){return new _a(e).unserialize()}}s["haxe.Unserializer"]=_a,_a.__name__="haxe.Unserializer",Object.assign(_a.prototype,{__class__:_a});class ca extends $i{constructor(e,t,s){super(String(e),t,s),this.value=e}unwrap(){return this.value}}s["haxe.ValueException"]=ca,ca.__name__="haxe.ValueException",ca.__super__=$i,Object.assign(ca.prototype,{__class__:ca});class ua{constructor(){this.a1=1,this.a2=0}update(e,t,s){let r=this.a1,n=this.a2,i=t,a=t+s;for(;i<a;){let t=i++;r=(r+e.b[t])%65521,n=(n+r)%65521}this.a1=r,this.a2=n}equals(e){return e.a1==this.a1&&e.a2==this.a2}static read(e){let t=new ua,s=e.readByte(),r=e.readByte(),n=e.readByte(),i=e.readByte();return t.a1=n<<8|i,t.a2=s<<8|r,t}}s["haxe.crypto.Adler32"]=ua,ua.__name__="haxe.crypto.Adler32",Object.assign(ua.prototype,{__class__:ua});class da{constructor(e){this.length=e.byteLength,this.b=new Uint8Array(e),this.b.bufferValue=e,e.hxBytes=this,e.bytes=this.b}blit(e,t,s,r){if(e<0||s<0||r<0||e+r>this.length||s+r>t.length)throw $i.thrown(Ra.OutsideBounds);0==s&&r==t.b.byteLength?this.b.set(t.b,e):this.b.set(t.b.subarray(s,s+r),e)}fill(e,t,s){let r=0,n=t;for(;r<n;){r++;this.b[e++]=s}}getDouble(e){return null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength)),this.data.getFloat64(e,!0)}getFloat(e){return null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength)),this.data.getFloat32(e,!0)}setDouble(e,t){null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength)),this.data.setFloat64(e,t,!0)}setFloat(e,t){null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength)),this.data.setFloat32(e,t,!0)}getUInt16(e){return null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength)),this.data.getUint16(e,!0)}setUInt16(e,t){null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength)),this.data.setUint16(e,t,!0)}getInt32(e){return null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength)),this.data.getInt32(e,!0)}setInt32(e,t){null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength)),this.data.setInt32(e,t,!0)}getString(e,t,s){if(e<0||t<0||e+t>this.length)throw $i.thrown(Ra.OutsideBounds);null==s&&(s=pa.UTF8);let r="",n=this.b,i=e,a=e+t;switch(s._hx_index){case 0:for(;i<a;){let e=n[i++];if(e<128){if(0==e)break;r+=String.fromCodePoint(e)}else if(e<224){let t=(63&e)<<6|127&n[i++];r+=String.fromCodePoint(t)}else if(e<240){let t=(31&e)<<12|(127&n[i++])<<6|127&n[i++];r+=String.fromCodePoint(t)}else{let t=(15&e)<<18|(127&n[i++])<<12|(127&n[i++])<<6|127&n[i++];r+=String.fromCodePoint(t)}}break;case 1:for(;i<a;){let e=n[i++]|n[i++]<<8;r+=String.fromCodePoint(e)}}return r}toString(){return this.getString(0,this.length)}static ofString(e,t){if(t==pa.RawNative){let t=new Uint8Array(e.length<<1),s=0,r=e.length;for(;s<r;){let r=s++,n=e.charCodeAt(r);t[r<<1]=255&n,t[r<<1|1]=n>>8}return new da(t.buffer)}let s=[],r=0;for(;r<e.length;){let t=e.charCodeAt(r++);55296<=t&&t<=56319&&(t=t-55232<<10|1023&e.charCodeAt(r++)),t<=127?s.push(t):t<=2047?(s.push(192|t>>6),s.push(128|63&t)):t<=65535?(s.push(224|t>>12),s.push(128|t>>6&63),s.push(128|63&t)):(s.push(240|t>>18),s.push(128|t>>12&63),s.push(128|t>>6&63),s.push(128|63&t))}return new da(new Uint8Array(s).buffer)}static ofData(e){let t=e.hxBytes;return null!=t?t:new da(e)}}s["haxe.io.Bytes"]=da,da.__name__="haxe.io.Bytes",Object.assign(da.prototype,{__class__:da});var pa=n["haxe.io.Encoding"]={__ename__:"haxe.io.Encoding",__constructs__:["UTF8","RawNative"],UTF8:{_hx_index:0,__enum__:"haxe.io.Encoding",toString:r},RawNative:{_hx_index:1,__enum__:"haxe.io.Encoding",toString:r}};pa.__empty_constructs__=[pa.UTF8,pa.RawNative];class fa{static decode(e,t){if(null==t&&(t=!0),t)for(;61==c.cca(e,e.length-1);)e=c.substr(e,0,-1);return new xa(fa.BYTES).decodeBytes(da.ofString(e))}}s["haxe.crypto.Base64"]=fa,fa.__name__="haxe.crypto.Base64";class xa{constructor(e){let t=e.length,s=1;for(;t>1<<s;)++s;if(s>8||t!=1<<s)throw $i.thrown("BaseCode : base length must be a power of two.");this.base=e,this.nbits=s}initTable(){let e=[],t=0;for(;t<256;){e[t++]=-1}let s=0,r=this.base.length;for(;s<r;){let t=s++;e[this.base.b[t]]=t}this.tbl=e}decodeBytes(e){let t=this.nbits;this.base;null==this.tbl&&this.initTable();let s=this.tbl,r=e.length*t>>3,n=new da(new ArrayBuffer(r)),i=0,a=0,l=0,h=0;for(;h<r;){for(;a<8;){a+=t,i<<=t;let r=s[e.b[l++]];if(-1==r)throw $i.thrown("BaseCode : invalid encoded char");i|=r}a-=8,n.b[h++]=i>>a&255}return n}}s["haxe.crypto.BaseCode"]=xa,xa.__name__="haxe.crypto.BaseCode",Object.assign(xa.prototype,{__class__:xa});class ga{constructor(){}bitOR(e,t){return(e>>>1|t>>>1)<<1|(1&e|1&t)}bitXOR(e,t){return(e>>>1^t>>>1)<<1|1&e^1&t}bitAND(e,t){return(e>>>1&t>>>1)<<1|1&e&t}addme(e,t){let s=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(s>>16)<<16|65535&s}hex(e){let t="",s="0123456789abcdef",r=0;for(;r<e.length;){let n=e[r];++r,t+=s.charAt(n>>4&15)+s.charAt(15&n),t+=s.charAt(n>>12&15)+s.charAt(n>>8&15),t+=s.charAt(n>>20&15)+s.charAt(n>>16&15),t+=s.charAt(n>>28&15)+s.charAt(n>>24&15)}return t}rol(e,t){return e<<t|e>>>32-t}cmn(e,t,s,r,n,i){return this.addme(this.rol(this.addme(this.addme(t,e),this.addme(r,i)),n),s)}ff(e,t,s,r,n,i,a){return this.cmn(this.bitOR(this.bitAND(t,s),this.bitAND(~t,r)),e,t,n,i,a)}gg(e,t,s,r,n,i,a){return this.cmn(this.bitOR(this.bitAND(t,r),this.bitAND(s,~r)),e,t,n,i,a)}hh(e,t,s,r,n,i,a){return this.cmn(this.bitXOR(this.bitXOR(t,s),r),e,t,n,i,a)}ii(e,t,s,r,n,i,a){return this.cmn(this.bitXOR(s,this.bitOR(t,~r)),e,t,n,i,a)}doEncode(e){let t,s=1732584193,r=-271733879,n=-1732584194,i=271733878,a=0;for(;a<e.length;){let l=s,h=r,o=n,_=i;t=0,s=this.ff(s,r,n,i,e[a],7,-680876936),i=this.ff(i,s,r,n,e[a+1],12,-389564586),n=this.ff(n,i,s,r,e[a+2],17,606105819),r=this.ff(r,n,i,s,e[a+3],22,-1044525330),s=this.ff(s,r,n,i,e[a+4],7,-176418897),i=this.ff(i,s,r,n,e[a+5],12,1200080426),n=this.ff(n,i,s,r,e[a+6],17,-1473231341),r=this.ff(r,n,i,s,e[a+7],22,-45705983),s=this.ff(s,r,n,i,e[a+8],7,1770035416),i=this.ff(i,s,r,n,e[a+9],12,-1958414417),n=this.ff(n,i,s,r,e[a+10],17,-42063),r=this.ff(r,n,i,s,e[a+11],22,-1990404162),s=this.ff(s,r,n,i,e[a+12],7,1804603682),i=this.ff(i,s,r,n,e[a+13],12,-40341101),n=this.ff(n,i,s,r,e[a+14],17,-1502002290),r=this.ff(r,n,i,s,e[a+15],22,1236535329),s=this.gg(s,r,n,i,e[a+1],5,-165796510),i=this.gg(i,s,r,n,e[a+6],9,-1069501632),n=this.gg(n,i,s,r,e[a+11],14,643717713),r=this.gg(r,n,i,s,e[a],20,-373897302),s=this.gg(s,r,n,i,e[a+5],5,-701558691),i=this.gg(i,s,r,n,e[a+10],9,38016083),n=this.gg(n,i,s,r,e[a+15],14,-660478335),r=this.gg(r,n,i,s,e[a+4],20,-405537848),s=this.gg(s,r,n,i,e[a+9],5,568446438),i=this.gg(i,s,r,n,e[a+14],9,-1019803690),n=this.gg(n,i,s,r,e[a+3],14,-187363961),r=this.gg(r,n,i,s,e[a+8],20,1163531501),s=this.gg(s,r,n,i,e[a+13],5,-1444681467),i=this.gg(i,s,r,n,e[a+2],9,-51403784),n=this.gg(n,i,s,r,e[a+7],14,1735328473),r=this.gg(r,n,i,s,e[a+12],20,-1926607734),s=this.hh(s,r,n,i,e[a+5],4,-378558),i=this.hh(i,s,r,n,e[a+8],11,-2022574463),n=this.hh(n,i,s,r,e[a+11],16,1839030562),r=this.hh(r,n,i,s,e[a+14],23,-35309556),s=this.hh(s,r,n,i,e[a+1],4,-1530992060),i=this.hh(i,s,r,n,e[a+4],11,1272893353),n=this.hh(n,i,s,r,e[a+7],16,-155497632),r=this.hh(r,n,i,s,e[a+10],23,-1094730640),s=this.hh(s,r,n,i,e[a+13],4,681279174),i=this.hh(i,s,r,n,e[a],11,-358537222),n=this.hh(n,i,s,r,e[a+3],16,-722521979),r=this.hh(r,n,i,s,e[a+6],23,76029189),s=this.hh(s,r,n,i,e[a+9],4,-640364487),i=this.hh(i,s,r,n,e[a+12],11,-421815835),n=this.hh(n,i,s,r,e[a+15],16,530742520),r=this.hh(r,n,i,s,e[a+2],23,-995338651),s=this.ii(s,r,n,i,e[a],6,-198630844),i=this.ii(i,s,r,n,e[a+7],10,1126891415),n=this.ii(n,i,s,r,e[a+14],15,-1416354905),r=this.ii(r,n,i,s,e[a+5],21,-57434055),s=this.ii(s,r,n,i,e[a+12],6,1700485571),i=this.ii(i,s,r,n,e[a+3],10,-1894986606),n=this.ii(n,i,s,r,e[a+10],15,-1051523),r=this.ii(r,n,i,s,e[a+1],21,-2054922799),s=this.ii(s,r,n,i,e[a+8],6,1873313359),i=this.ii(i,s,r,n,e[a+15],10,-30611744),n=this.ii(n,i,s,r,e[a+6],15,-1560198380),r=this.ii(r,n,i,s,e[a+13],21,1309151649),s=this.ii(s,r,n,i,e[a+4],6,-145523070),i=this.ii(i,s,r,n,e[a+11],10,-1120210379),n=this.ii(n,i,s,r,e[a+2],15,718787259),r=this.ii(r,n,i,s,e[a+9],21,-343485551),s=this.addme(s,l),r=this.addme(r,h),n=this.addme(n,o),i=this.addme(i,_),a+=16}return[s,r,n,i]}static encode(e){let t=new ga,s=t.doEncode(ga.str2blks(e));return t.hex(s)}static str2blks(e){let t=da.ofString(e),s=1+(t.length+8>>6),r=[],n=0,i=16*s;for(;n<i;){r[n++]=0}let a=0,l=t.length,h=8*l;for(;a<l;)r[a>>2]|=t.b[a]<<(h+a)%4*8,++a;r[a>>2]|=128<<(h+a)%4*8;let o=16*s-2;return r[o]=255&h,r[o]|=(h>>>8&255)<<8,r[o]|=(h>>>16&255)<<16,r[o]|=(h>>>24&255)<<24,r}}s["haxe.crypto.Md5"]=ga,ga.__name__="haxe.crypto.Md5",Object.assign(ga.prototype,{__class__:ga});class ba{static sort(e,t){ba.rec(e,t,0,e.length)}static rec(e,t,s,r){let n=s+r>>1;if(r-s<12){if(r<=s)return;let n=s+1,i=r;for(;n<i;){let r=n++;for(;r>s&&t(e[r],e[r-1])<0;)ba.swap(e,r-1,r),--r}}else ba.rec(e,t,s,n),ba.rec(e,t,n,r),ba.doMerge(e,t,s,n,r,n-s,r-n)}static doMerge(e,t,s,r,n,i,a){let l,h,o,_;if(0==i||0==a)return;if(i+a==2)return void(t(e[r],e[s])<0&&ba.swap(e,r,s));i>a?(o=i>>1,l=s+o,h=ba.lower(e,t,r,n,l),_=h-r):(_=a>>1,h=r+_,l=ba.upper(e,t,s,r,h),o=l-s),ba.rotate(e,t,l,r,h);let c=l+_;ba.doMerge(e,t,s,l,c,o,_),ba.doMerge(e,t,c,h,n,i-o,a-_)}static rotate(e,t,s,r,n){if(s==r||r==n)return;let i=ba.gcd(n-s,r-s);for(;0!=i--;){let t=e[s+i],a=r-s,l=s+i,h=s+i+a;for(;h!=s+i;)e[l]=e[h],l=h,n-h>a?h+=a:h=s+(a-(n-h));e[l]=t}}static gcd(e,t){for(;0!=t;){let s=e%t;e=t,t=s}return e}static upper(e,t,s,r,n){let i,a,l=r-s;for(;l>0;)i=l>>1,a=s+i,t(e[n],e[a])<0?l=i:(s=a+1,l=l-i-1);return s}static lower(e,t,s,r,n){let i,a,l=r-s;for(;l>0;)i=l>>1,a=s+i,t(e[a],e[n])<0?(s=a+1,l=l-i-1):l=i;return s}static swap(e,t,s){let r=e[t];e[t]=e[s],e[s]=r}}s["haxe.ds.ArraySort"]=ba,ba.__name__="haxe.ds.ArraySort";class ma{constructor(){}set(e,t){this.root=this.setLoop(e,t,this.root)}get(e){let t=this.root;for(;null!=t;){let s=this.compare(e,t.key);if(0==s)return t.value;t=s<0?t.left:t.right}return null}iterator(){let e=[];return ma.iteratorLoop(this.root,e),new Oa(e)}setLoop(e,t,s){if(null==s)return new Aa(null,e,t,null);let r=this.compare(e,s.key);if(0==r)return new Aa(s.left,e,t,s.right,null==s?0:s._height);if(r<0){let r=this.setLoop(e,t,s.left);return this.balance(r,s.key,s.value,s.right)}{let r=this.setLoop(e,t,s.right);return this.balance(s.left,s.key,s.value,r)}}balance(e,t,s,r){let n=null==e?0:e._height,i=null==r?0:r._height;if(n>i+2){let n=e.left,i=e.right;return(null==n?0:n._height)>=(null==i?0:i._height)?new Aa(e.left,e.key,e.value,new Aa(e.right,t,s,r)):new Aa(new Aa(e.left,e.key,e.value,e.right.left),e.right.key,e.right.value,new Aa(e.right.right,t,s,r))}if(i>n+2){let n=r.right,i=r.left;return(null==n?0:n._height)>(null==i?0:i._height)?new Aa(new Aa(e,t,s,r.left),r.key,r.value,r.right):new Aa(new Aa(e,t,s,r.left.left),r.left.key,r.left.value,new Aa(r.left.right,r.key,r.value,r.right))}return new Aa(e,t,s,r,(n>i?n:i)+1)}compare(e,t){return f.compare(e,t)}static iteratorLoop(e,t){null!=e&&(ma.iteratorLoop(e.left,t),t.push(e.value),ma.iteratorLoop(e.right,t))}}s["haxe.ds.BalancedTree"]=ma,ma.__name__="haxe.ds.BalancedTree",ma.__interfaces__=[qi],Object.assign(ma.prototype,{__class__:ma});class Aa{constructor(e,t,s,r,n){if(null==n&&(n=-1),this.left=e,this.key=t,this.value=s,this.right=r,-1==n){let e,t=this.left,s=this.right;if((null==t?0:t._height)>(null==s?0:s._height)){let t=this.left;e=null==t?0:t._height}else{let t=this.right;e=null==t?0:t._height}this._height=e+1}else this._height=n}}s["haxe.ds.TreeNode"]=Aa,Aa.__name__="haxe.ds.TreeNode",Object.assign(Aa.prototype,{__class__:Aa});class wa extends ma{constructor(){super()}compare(e,t){let s=e._hx_index-t._hx_index;if(0!=s)return s;let r=y.enumParameters(e),n=y.enumParameters(t);return 0==r.length&&0==n.length?0:this.compareArgs(r,n)}compareArgs(e,t){let s=e.length-t.length;if(0!=s)return s;let r=0,n=e.length;for(;r<n;){let s=r++,n=this.compareArg(e[s],t[s]);if(0!=n)return n}return 0}compareArg(e,t){return f.isEnumValue(e)&&f.isEnumValue(t)?this.compare(e,t):e instanceof Array&&t instanceof Array?this.compareArgs(e,t):f.compare(e,t)}}s["haxe.ds.EnumValueMap"]=wa,wa.__name__="haxe.ds.EnumValueMap",wa.__interfaces__=[qi],wa.__super__=ma,Object.assign(wa.prototype,{__class__:wa});class ya{constructor(){this.h={}}remove(e){return!!this.h.hasOwnProperty(e)&&(delete this.h[e],!0)}keys(){let e=[];for(var t in this.h)this.h.hasOwnProperty(t)&&e.push(0|t);return new Oa(e)}iterator(){return{ref:this.h,it:this.keys(),hasNext:function(){return this.it.hasNext()},next:function(){let e=this.it.next();return this.ref[e]}}}}s["haxe.ds.IntMap"]=ya,ya.__name__="haxe.ds.IntMap",ya.__interfaces__=[qi],Object.assign(ya.prototype,{__class__:ya});class ka{constructor(){this.length=0}add(e){let t=new Ba(e,null);null==this.h?this.h=t:this.q.next=t,this.q=t,this.length++}push(e){let t=new Ba(e,this.h);this.h=t,null==this.q&&(this.q=t),this.length++}remove(e){let t=null,s=this.h;for(;null!=s;){if(s.item==e)return null==t?this.h=s.next:t.next=s.next,this.q==s&&(this.q=t),this.length--,!0;t=s,s=s.next}return!1}}s["haxe.ds.List"]=ka,ka.__name__="haxe.ds.List",Object.assign(ka.prototype,{__class__:ka});class Ba{constructor(e,t){this.item=e,this.next=t}}s["haxe.ds._List.ListNode"]=Ba,Ba.__name__="haxe.ds._List.ListNode",Object.assign(Ba.prototype,{__class__:Ba});class Ca{constructor(){this.h={__keys__:{}}}set(t,s){let r=t.__id__;null==r&&(r=t.__id__=e.$haxeUID++),this.h[r]=s,this.h.__keys__[r]=t}remove(e){let t=e.__id__;return null!=this.h.__keys__[t]&&(delete this.h[t],delete this.h.__keys__[t],!0)}keys(){let e=[];for(var t in this.h.__keys__)this.h.hasOwnProperty(t)&&e.push(this.h.__keys__[t]);return new Oa(e)}}s["haxe.ds.ObjectMap"]=Ca,Ca.__name__="haxe.ds.ObjectMap",Ca.__interfaces__=[qi],Object.assign(Ca.prototype,{__class__:Ca});class va{constructor(){this.h=Object.create(null)}static keysIterator(e){let t=Object.keys(e),s=t.length,r=0;return{hasNext:function(){return r<s},next:function(){return r+=1,t[r-1]}}}static valueIterator(e){let t=Object.keys(e),s=t.length,r=0;return{hasNext:function(){return r<s},next:function(){return r+=1,e[t[r-1]]}}}static kvIterator(e){let t=Object.keys(e),s=t.length,r=0;return{hasNext:function(){return r<s},next:function(){r+=1;let s=t[r-1];return{key:s,value:e[s]}}}}}s["haxe.ds.StringMap"]=va,va.__name__="haxe.ds.StringMap",va.__interfaces__=[qi],Object.assign(va.prototype,{__class__:va});class Sa{static blit(e,t,s,r,n){if(e==s){if(t<r){let s=t+n,i=r+n,a=0,l=n;for(;a<l;){a++;--s,--i,e[i]=e[s]}}else if(t>r){let s=t,i=r,a=0,l=n;for(;a<l;){a++;e[i]=e[s],++s,++i}}}else{let i=0,a=n;for(;i<a;){let n=i++;s[r+n]=e[t+n]}}}}class Ma{constructor(){this.pos=0,this.size=0}add(e){if(this.pos+e.length>this.size&&this.grow(e.length),0==this.size)return;let t=new Uint8Array(e.b.buffer,e.b.byteOffset,e.length);this.u8.set(t,this.pos),this.pos+=e.length}addBytes(e,t,s){if(t<0||s<0||t+s>e.length)throw $i.thrown(Ra.OutsideBounds);if(this.pos+s>this.size&&this.grow(s),0==this.size)return;let r=new Uint8Array(e.b.buffer,e.b.byteOffset+t,s);this.u8.set(r,this.pos),this.pos+=s}grow(e){let t=this.pos+e,s=0==this.size?16:this.size;for(;s<t;)s=3*s>>1;let r=new ArrayBuffer(s),n=new Uint8Array(r);this.size>0&&n.set(this.u8),this.size=s,this.buffer=r,this.u8=n,this.view=new DataView(this.buffer)}getBytes(){if(0==this.size)return new da(new ArrayBuffer(0));let e=new da(this.buffer);return e.length=this.pos,e}}s["haxe.io.BytesBuffer"]=Ma,Ma.__name__="haxe.io.BytesBuffer",Object.assign(Ma.prototype,{__class__:Ma});class Ia{readByte(){throw $i.thrown("Not implemented")}readBytes(e,t,s){let r=s,n=e.b;if(t<0||s<0||t+s>e.length)throw $i.thrown(Ra.OutsideBounds);try{for(;r>0;)n[t]=this.readByte(),++t,--r}catch(e){if(!($i.caught(e).unwrap()instanceof Da))throw e}return s-r}set_bigEndian(e){return this.bigEndian=e,e}readFullBytes(e,t,s){for(;s>0;){let r=this.readBytes(e,t,s);if(0==r)throw $i.thrown(Ra.Blocked);t+=r,s-=r}}read(e){let t=new da(new ArrayBuffer(e)),s=0;for(;e>0;){let r=this.readBytes(t,s,e);if(0==r)throw $i.thrown(Ra.Blocked);s+=r,e-=r}return t}readDouble(){let e=this.readInt32(),t=this.readInt32();return this.bigEndian?Va.i64ToDouble(t,e):Va.i64ToDouble(e,t)}readInt16(){let e=this.readByte(),t=this.readByte(),s=this.bigEndian?t|e<<8:e|t<<8;return 0!=(32768&s)?s-65536:s}readUInt16(){let e=this.readByte(),t=this.readByte();return this.bigEndian?t|e<<8:e|t<<8}readUInt24(){let e=this.readByte(),t=this.readByte(),s=this.readByte();return this.bigEndian?s|t<<8|e<<16:e|t<<8|s<<16}readInt32(){let e=this.readByte(),t=this.readByte(),s=this.readByte(),r=this.readByte();return this.bigEndian?r|s<<8|t<<16|e<<24:e|t<<8|s<<16|r<<24}readString(e,t){let s=new da(new ArrayBuffer(e));return this.readFullBytes(s,0,e),s.getString(0,e,t)}}s["haxe.io.Input"]=Ia,Ia.__name__="haxe.io.Input",Object.assign(Ia.prototype,{__class__:Ia});class Ta extends Ia{constructor(e,t,s){if(super(),null==t&&(t=0),null==s&&(s=e.length-t),t<0||s<0||t+s>e.length)throw $i.thrown(Ra.OutsideBounds);this.b=e.b,this.pos=t,this.len=s,this.totlen=s}readByte(){if(0==this.len)throw $i.thrown(new Da);return this.len--,this.b[this.pos++]}readBytes(e,t,s){if(t<0||s<0||t+s>e.length)throw $i.thrown(Ra.OutsideBounds);if(0==this.len&&s>0)throw $i.thrown(new Da);this.len<s&&(s=this.len);let r=this.b,n=e.b,i=0,a=s;for(;i<a;){let e=i++;n[t+e]=r[this.pos+e]}return this.pos+=s,this.len-=s,s}}s["haxe.io.BytesInput"]=Ta,Ta.__name__="haxe.io.BytesInput",Ta.__super__=Ia,Object.assign(Ta.prototype,{__class__:Ta});class Fa{flush(){}close(){}}s["haxe.io.Output"]=Fa,Fa.__name__="haxe.io.Output",Object.assign(Fa.prototype,{__class__:Fa});class Ea extends Fa{constructor(){super(),this.b=new Ma}writeBytes(e,t,s){return this.b.addBytes(e,t,s),s}getBytes(){return this.b.getBytes()}}s["haxe.io.BytesOutput"]=Ea,Ea.__name__="haxe.io.BytesOutput",Ea.__super__=Fa,Object.assign(Ea.prototype,{__class__:Ea});class Da{constructor(){}toString(){return"Eof"}}s["haxe.io.Eof"]=Da,Da.__name__="haxe.io.Eof",Object.assign(Da.prototype,{__class__:Da});var Ra=n["haxe.io.Error"]={__ename__:"haxe.io.Error",__constructs__:["Blocked","Overflow","OutsideBounds","Custom"],Blocked:{_hx_index:0,__enum__:"haxe.io.Error",toString:r},Overflow:{_hx_index:1,__enum__:"haxe.io.Error",toString:r},OutsideBounds:{_hx_index:2,__enum__:"haxe.io.Error",toString:r},Custom:(t=function(e){return{_hx_index:3,e,__enum__:"haxe.io.Error",toString:r}},t.__params__=["e"],t)};Ra.__empty_constructs__=[Ra.Blocked,Ra.Overflow,Ra.OutsideBounds];class Va{static i64ToDouble(e,t){return Va.helper.setInt32(0,e,!0),Va.helper.setInt32(4,t,!0),Va.helper.getFloat64(0,!0)}}s["haxe.io.FPHelper"]=Va,Va.__name__="haxe.io.FPHelper";class Oa{constructor(e){this.current=0,this.array=e}hasNext(){return this.current<this.array.length}next(){return this.array[this.current++]}}s["haxe.iterators.ArrayIterator"]=Oa,Oa.__name__="haxe.iterators.ArrayIterator",Object.assign(Oa.prototype,{__class__:Oa});var Pa=n["haxe.macro.Binop"]={__ename__:"haxe.macro.Binop",__constructs__:["OpAdd","OpMult","OpDiv","OpSub","OpAssign","OpEq","OpNotEq","OpGt","OpGte","OpLt","OpLte","OpAnd","OpOr","OpXor","OpBoolAnd","OpBoolOr","OpShl","OpShr","OpUShr","OpMod","OpAssignOp","OpInterval","OpArrow","OpIn"],OpAdd:{_hx_index:0,__enum__:"haxe.macro.Binop",toString:r},OpMult:{_hx_index:1,__enum__:"haxe.macro.Binop",toString:r},OpDiv:{_hx_index:2,__enum__:"haxe.macro.Binop",toString:r},OpSub:{_hx_index:3,__enum__:"haxe.macro.Binop",toString:r},OpAssign:{_hx_index:4,__enum__:"haxe.macro.Binop",toString:r},OpEq:{_hx_index:5,__enum__:"haxe.macro.Binop",toString:r},OpNotEq:{_hx_index:6,__enum__:"haxe.macro.Binop",toString:r},OpGt:{_hx_index:7,__enum__:"haxe.macro.Binop",toString:r},OpGte:{_hx_index:8,__enum__:"haxe.macro.Binop",toString:r},OpLt:{_hx_index:9,__enum__:"haxe.macro.Binop",toString:r},OpLte:{_hx_index:10,__enum__:"haxe.macro.Binop",toString:r},OpAnd:{_hx_index:11,__enum__:"haxe.macro.Binop",toString:r},OpOr:{_hx_index:12,__enum__:"haxe.macro.Binop",toString:r},OpXor:{_hx_index:13,__enum__:"haxe.macro.Binop",toString:r},OpBoolAnd:{_hx_index:14,__enum__:"haxe.macro.Binop",toString:r},OpBoolOr:{_hx_index:15,__enum__:"haxe.macro.Binop",toString:r},OpShl:{_hx_index:16,__enum__:"haxe.macro.Binop",toString:r},OpShr:{_hx_index:17,__enum__:"haxe.macro.Binop",toString:r},OpUShr:{_hx_index:18,__enum__:"haxe.macro.Binop",toString:r},OpMod:{_hx_index:19,__enum__:"haxe.macro.Binop",toString:r},OpAssignOp:(t=function(e){return{_hx_index:20,op:e,__enum__:"haxe.macro.Binop",toString:r}},t.__params__=["op"],t),OpInterval:{_hx_index:21,__enum__:"haxe.macro.Binop",toString:r},OpArrow:{_hx_index:22,__enum__:"haxe.macro.Binop",toString:r},OpIn:{_hx_index:23,__enum__:"haxe.macro.Binop",toString:r}};Pa.__empty_constructs__=[Pa.OpAdd,Pa.OpMult,Pa.OpDiv,Pa.OpSub,Pa.OpAssign,Pa.OpEq,Pa.OpNotEq,Pa.OpGt,Pa.OpGte,Pa.OpLt,Pa.OpLte,Pa.OpAnd,Pa.OpOr,Pa.OpXor,Pa.OpBoolAnd,Pa.OpBoolOr,Pa.OpShl,Pa.OpShr,Pa.OpUShr,Pa.OpMod,Pa.OpInterval,Pa.OpArrow,Pa.OpIn];var Qa=n["haxe.macro.Unop"]={__ename__:"haxe.macro.Unop",__constructs__:["OpIncrement","OpDecrement","OpNot","OpNeg","OpNegBits"],OpIncrement:{_hx_index:0,__enum__:"haxe.macro.Unop",toString:r},OpDecrement:{_hx_index:1,__enum__:"haxe.macro.Unop",toString:r},OpNot:{_hx_index:2,__enum__:"haxe.macro.Unop",toString:r},OpNeg:{_hx_index:3,__enum__:"haxe.macro.Unop",toString:r},OpNegBits:{_hx_index:4,__enum__:"haxe.macro.Unop",toString:r}};Qa.__empty_constructs__=[Qa.OpIncrement,Qa.OpDecrement,Qa.OpNot,Qa.OpNeg,Qa.OpNegBits];var La=n["haxe.zip.Huffman"]={__ename__:"haxe.zip.Huffman",__constructs__:["Found","NeedBit","NeedBits"],Found:(t=function(e){return{_hx_index:0,i:e,__enum__:"haxe.zip.Huffman",toString:r}},t.__params__=["i"],t),NeedBit:(t=function(e,t){return{_hx_index:1,left:e,right:t,__enum__:"haxe.zip.Huffman",toString:r}},t.__params__=["left","right"],t),NeedBits:(t=function(e,t){return{_hx_index:2,n:e,table:t,__enum__:"haxe.zip.Huffman",toString:r}},t.__params__=["n","table"],t)};La.__empty_constructs__=[];class Ga{constructor(){}treeDepth(e){switch(e._hx_index){case 0:e.i;return 0;case 1:let t=e.right,s=e.left,r=this.treeDepth(s),n=this.treeDepth(t);return 1+(r<n?r:n);case 2:e.table,e.n;throw $i.thrown("assert")}}treeCompress(e){let t=this.treeDepth(e);if(0==t)return e;if(1==t){if(1==e._hx_index){let t=e.right,s=e.left;return La.NeedBit(this.treeCompress(s),this.treeCompress(t))}throw $i.thrown("assert")}let s=[],r=0,n=1<<t;for(;r<n;){r++;s.push(La.Found(-1))}return this.treeWalk(s,0,0,t,e),La.NeedBits(t,s)}treeWalk(e,t,s,r,n){if(1==n._hx_index){let i=n.right,a=n.left;r>0?(this.treeWalk(e,t,s+1,r-1,a),this.treeWalk(e,t|1<<s,s+1,r-1,i)):e[t]=this.treeCompress(n)}else e[t]=this.treeCompress(n)}treeMake(e,t,s,r){if(r>t)throw $i.thrown("Invalid huffman");let n=s<<5|r;return e.h.hasOwnProperty(n)?La.Found(e.h[n]):(s<<=1,++r,La.NeedBit(this.treeMake(e,t,s,r),this.treeMake(e,t,1|s,r)))}make(e,t,s,r){if(1==s)return La.NeedBit(La.Found(0),La.Found(0));let n=[],i=[];if(r>32)throw $i.thrown("Invalid huffman");let a=0,l=r;for(;a<l;){a++;n.push(0),i.push(0)}let h=0,o=s;for(;h<o;){let s=e[h+++t];if(s>=r)throw $i.thrown("Invalid huffman");n[s]++}let _=0,c=1,u=r-1;for(;c<u;){let e=c++;_=_+n[e]<<1,i[e]=_}let d=new ya,p=0,f=s;for(;p<f;){let s=p++,r=e[s+t];if(0!=r){let e=i[r-1];i[r-1]=e+1,d.h[e<<5|r]=s}}return this.treeCompress(La.NeedBit(this.treeMake(d,r,0,1),this.treeMake(d,r,1,1)))}}s["haxe.zip.HuffTools"]=Ga,Ga.__name__="haxe.zip.HuffTools",Object.assign(Ga.prototype,{__class__:Ga});class za{constructor(e){this.buffer=new da(new ArrayBuffer(65536)),this.pos=0,e&&(this.crc=new ua)}slide(){null!=this.crc&&this.crc.update(this.buffer,0,32768);let e=new da(new ArrayBuffer(65536));this.pos-=32768,e.blit(0,this.buffer,32768,this.pos),this.buffer=e}addBytes(e,t,s){this.pos+s>65536&&this.slide(),this.buffer.blit(this.pos,e,t,s),this.pos+=s}addByte(e){65536==this.pos&&this.slide(),this.buffer.b[this.pos]=e,this.pos++}getLastChar(){return this.buffer.b[this.pos-1]}available(){return this.pos}checksum(){return null!=this.crc&&this.crc.update(this.buffer,0,this.pos),this.crc}}s["haxe.zip._InflateImpl.Window"]=za,za.__name__="haxe.zip._InflateImpl.Window",Object.assign(za.prototype,{__class__:za});var Ua=n["haxe.zip._InflateImpl.State"]={__ename__:"haxe.zip._InflateImpl.State",__constructs__:["Head","Block","CData","Flat","Crc","Dist","DistOne","Done"],Head:{_hx_index:0,__enum__:"haxe.zip._InflateImpl.State",toString:r},Block:{_hx_index:1,__enum__:"haxe.zip._InflateImpl.State",toString:r},CData:{_hx_index:2,__enum__:"haxe.zip._InflateImpl.State",toString:r},Flat:{_hx_index:3,__enum__:"haxe.zip._InflateImpl.State",toString:r},Crc:{_hx_index:4,__enum__:"haxe.zip._InflateImpl.State",toString:r},Dist:{_hx_index:5,__enum__:"haxe.zip._InflateImpl.State",toString:r},DistOne:{_hx_index:6,__enum__:"haxe.zip._InflateImpl.State",toString:r},Done:{_hx_index:7,__enum__:"haxe.zip._InflateImpl.State",toString:r}};Ua.__empty_constructs__=[Ua.Head,Ua.Block,Ua.CData,Ua.Flat,Ua.Crc,Ua.Dist,Ua.DistOne,Ua.Done];class Wa{constructor(e,t,s){null==s&&(s=!0),null==t&&(t=!0),this.isFinal=!1,this.htools=new Ga,this.huffman=this.buildFixedHuffman(),this.huffdist=null,this.len=0,this.dist=0,this.state=t?Ua.Head:Ua.Block,this.input=e,this.bits=0,this.nbits=0,this.needed=0,this.output=null,this.outpos=0,this.lengths=[],this.lengths.push(-1),this.lengths.push(-1),this.lengths.push(-1),this.lengths.push(-1),this.lengths.push(-1),this.lengths.push(-1),this.lengths.push(-1),this.lengths.push(-1),this.lengths.push(-1),this.lengths.push(-1),this.lengths.push(-1),this.lengths.push(-1),this.lengths.push(-1),this.lengths.push(-1),this.lengths.push(-1),this.lengths.push(-1),this.lengths.push(-1),this.lengths.push(-1),this.lengths.push(-1),this.window=new za(s)}buildFixedHuffman(){if(null!=Wa.FIXED_HUFFMAN)return Wa.FIXED_HUFFMAN;let e=[],t=0;for(;t<288;){let s=t++;e.push(s<=143?8:s<=255?9:s<=279?7:8)}return Wa.FIXED_HUFFMAN=this.htools.make(e,0,288,10),Wa.FIXED_HUFFMAN}readBytes(e,t,s){if(this.needed=s,this.outpos=t,this.output=e,s>0)for(;this.inflateLoop(););return s-this.needed}getBits(e){for(;this.nbits<e;)this.bits|=this.input.readByte()<<this.nbits,this.nbits+=8;let t=this.bits&(1<<e)-1;return this.nbits-=e,this.bits>>=e,t}getBit(){0==this.nbits&&(this.nbits=8,this.bits=this.input.readByte());let e=1==(1&this.bits);return this.nbits--,this.bits>>=1,e}getRevBits(e){return 0==e?0:this.getBit()?1<<e-1|this.getRevBits(e-1):this.getRevBits(e-1)}resetBits(){this.bits=0,this.nbits=0}addBytes(e,t,s){this.window.addBytes(e,t,s),this.output.blit(this.outpos,e,t,s),this.needed-=s,this.outpos+=s}addByte(e){this.window.addByte(e),this.output.b[this.outpos]=e,this.needed--,this.outpos++}addDistOne(e){let t=this.window.getLastChar(),s=0,r=e;for(;s<r;){s++;this.addByte(t)}}addDist(e,t){this.addBytes(this.window.buffer,this.window.pos-e,t)}applyHuffman(e){switch(e._hx_index){case 0:return e.i;case 1:let t=e.right,s=e.left;return this.applyHuffman(this.getBit()?t:s);case 2:let r=e.table,n=e.n;return this.applyHuffman(r[this.getBits(n)])}}inflateLengths(e,t){let s=0,r=0;for(;s<t;){let n=this.applyHuffman(this.huffman);switch(n){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:r=n,e[s]=n,++s;break;case 16:let i=s+3+this.getBits(2);if(i>t)throw $i.thrown("Invalid data");for(;s<i;)e[s]=r,++s;break;case 17:if(s+=3+this.getBits(3),s>t)throw $i.thrown("Invalid data");break;case 18:if(s+=11+this.getBits(7),s>t)throw $i.thrown("Invalid data");break;default:throw $i.thrown("Invalid data")}}}inflateLoop(){switch(this.state._hx_index){case 0:let e=this.input.readByte();if(8!=(15&e))throw $i.thrown("Invalid data");let t=this.input.readByte(),s=0!=(32&t);if(((e<<8)+t)%31!=0)throw $i.thrown("Invalid data");if(s)throw $i.thrown("Unsupported dictionary");return this.state=Ua.Block,!0;case 1:switch(this.isFinal=this.getBit(),this.getBits(2)){case 0:if(this.len=this.input.readUInt16(),this.input.readUInt16()!=65535-this.len)throw $i.thrown("Invalid data");this.state=Ua.Flat;let e=this.inflateLoop();return this.resetBits(),e;case 1:return this.huffman=this.buildFixedHuffman(),this.huffdist=null,this.state=Ua.CData,!0;case 2:let t=this.getBits(5)+257,s=this.getBits(5)+1,r=this.getBits(4)+4,n=0,i=r;for(;n<i;){let e=n++;this.lengths[Wa.CODE_LENGTHS_POS[e]]=this.getBits(3)}let a=r,l=19;for(;a<l;){let e=a++;this.lengths[Wa.CODE_LENGTHS_POS[e]]=0}this.huffman=this.htools.make(this.lengths,0,19,8);let h=[],o=0,_=t+s;for(;o<_;){o++;h.push(0)}return this.inflateLengths(h,t+s),this.huffdist=this.htools.make(h,t,s,16),this.huffman=this.htools.make(h,0,t,16),this.state=Ua.CData,!0;default:throw $i.thrown("Invalid data")}break;case 2:let r=this.applyHuffman(this.huffman);if(r<256)return this.addByte(r),this.needed>0;if(256==r)return this.state=this.isFinal?Ua.Crc:Ua.Block,!0;{r-=257;let e=Wa.LEN_EXTRA_BITS_TBL[r];if(-1==e)throw $i.thrown("Invalid data");this.len=Wa.LEN_BASE_VAL_TBL[r]+this.getBits(e);let t=null==this.huffdist?this.getRevBits(5):this.applyHuffman(this.huffdist);if(e=Wa.DIST_EXTRA_BITS_TBL[t],-1==e)throw $i.thrown("Invalid data");if(this.dist=Wa.DIST_BASE_VAL_TBL[t]+this.getBits(e),this.dist>this.window.available())throw $i.thrown("Invalid data");return this.state=1==this.dist?Ua.DistOne:Ua.Dist,!0}case 3:let n=this.len<this.needed?this.len:this.needed,i=this.input.read(n);return this.len-=n,this.addBytes(i,0,n),0==this.len&&(this.state=this.isFinal?Ua.Crc:Ua.Block),this.needed>0;case 4:let a=this.window.checksum();if(null==a)return this.state=Ua.Done,!0;let l=ua.read(this.input);if(!a.equals(l))throw $i.thrown("Invalid CRC");return this.state=Ua.Done,!0;case 5:for(;this.len>0&&this.needed>0;){let e=this.len<this.dist?this.len:this.dist,t=this.needed<e?this.needed:e;this.addDist(this.dist,t),this.len-=t}return 0==this.len&&(this.state=Ua.CData),this.needed>0;case 6:let h=this.len<this.needed?this.len:this.needed;return this.addDistOne(h),this.len-=h,0==this.len&&(this.state=Ua.CData),this.needed>0;case 7:return!1}}static run(e,t){null==t&&(t=65536);let s=new da(new ArrayBuffer(t)),r=new Ma,n=new Wa(e);for(;;){let e=n.readBytes(s,0,t);if(r.addBytes(s,0,e),e<t)break}return r.getBytes()}}s["haxe.zip.InflateImpl"]=Wa,Wa.__name__="haxe.zip.InflateImpl",Object.assign(Wa.prototype,{__class__:Wa});class Na{static run(e,t){return Wa.run(new Ta(e),t)}}s["haxe.zip.Uncompress"]=Na,Na.__name__="haxe.zip.Uncompress";class ja{constructor(e,t){if(-101!=e||-102!=t){let s=window.document.createElement("canvas");s.width=e,s.height=t,this.ctx=s.getContext("2d",null)}}getPixels(){let e=this.ctx.canvas.width,t=this.ctx.canvas.height,s=this.ctx.getImageData(0,0,e,t).data.buffer;return new $a(e,t,da.ofData(s),On.RGBA)}}s["hxd.BitmapData"]=ja,ja.__name__="hxd.BitmapData",Object.assign(ja.prototype,{__class__:ja});var Ya=n["hxd.Cursor"]={__ename__:"hxd.Cursor",__constructs__:["Default","Button","Move","TextInput","Hide","Custom","Callback"],Default:{_hx_index:0,__enum__:"hxd.Cursor",toString:r},Button:{_hx_index:1,__enum__:"hxd.Cursor",toString:r},Move:{_hx_index:2,__enum__:"hxd.Cursor",toString:r},TextInput:{_hx_index:3,__enum__:"hxd.Cursor",toString:r},Hide:{_hx_index:4,__enum__:"hxd.Cursor",toString:r},Custom:(t=function(e){return{_hx_index:5,custom:e,__enum__:"hxd.Cursor",toString:r}},t.__params__=["custom"],t),Callback:(t=function(e){return{_hx_index:6,f:e,__enum__:"hxd.Cursor",toString:r}},t.__params__=["f"],t)};Ya.__empty_constructs__=[Ya.Default,Ya.Button,Ya.Move,Ya.TextInput,Ya.Hide];class Xa{constructor(e,t,s,r){this.frames=e,this.speed=t,this.offsetX=s,this.offsetY=r,this.frameDelay=1/t,this.frameTime=0,this.frameIndex=0}reset(){this.frameTime=0,this.frameIndex=0}update(e){let t=this.frameTime+e,s=this.frameDelay,r=this.frameIndex;for(;t>=s;)t-=s,++r;return this.frameTime=t,r>=this.frames.length&&(r%=this.frames.length),r!=this.frameIndex?(this.frameIndex=r,r):-1}}s["hxd.CustomCursor"]=Xa,Xa.__name__="hxd.CustomCursor",Object.assign(Xa.prototype,{__class__:Xa});var Za=n["hxd.EventKind"]={__ename__:"hxd.EventKind",__constructs__:["EPush","ERelease","EMove","EOver","EOut","EWheel","EFocus","EFocusLost","EKeyDown","EKeyUp","EReleaseOutside","ETextInput","ECheck"],EPush:{_hx_index:0,__enum__:"hxd.EventKind",toString:r},ERelease:{_hx_index:1,__enum__:"hxd.EventKind",toString:r},EMove:{_hx_index:2,__enum__:"hxd.EventKind",toString:r},EOver:{_hx_index:3,__enum__:"hxd.EventKind",toString:r},EOut:{_hx_index:4,__enum__:"hxd.EventKind",toString:r},EWheel:{_hx_index:5,__enum__:"hxd.EventKind",toString:r},EFocus:{_hx_index:6,__enum__:"hxd.EventKind",toString:r},EFocusLost:{_hx_index:7,__enum__:"hxd.EventKind",toString:r},EKeyDown:{_hx_index:8,__enum__:"hxd.EventKind",toString:r},EKeyUp:{_hx_index:9,__enum__:"hxd.EventKind",toString:r},EReleaseOutside:{_hx_index:10,__enum__:"hxd.EventKind",toString:r},ETextInput:{_hx_index:11,__enum__:"hxd.EventKind",toString:r},ECheck:{_hx_index:12,__enum__:"hxd.EventKind",toString:r}};Za.__empty_constructs__=[Za.EPush,Za.ERelease,Za.EMove,Za.EOver,Za.EOut,Za.EWheel,Za.EFocus,Za.EFocusLost,Za.EKeyDown,Za.EKeyUp,Za.EReleaseOutside,Za.ETextInput,Za.ECheck];class Ha{constructor(e,t,s){null==s&&(s=0),null==t&&(t=0),this.button=0,this.kind=e,this.relX=t,this.relY=s}}s["hxd.Event"]=Ha,Ha.__name__="hxd.Event",Object.assign(Ha.prototype,{__class__:Ha});class Ka{static _new(e){return{pos:0,array:new Float32Array(new ArrayBuffer(e<<2))}}}class qa{static initialize(){qa.initDone&&qa.dispose(),qa.initDone=!0,qa.keyPressed=[],il.getInstance().addEventTarget(qa.onEvent)}static dispose(){qa.initDone&&(il.getInstance().removeEventTarget(qa.onEvent),qa.initDone=!1,qa.keyPressed=[])}static onEvent(e){switch(e.kind._hx_index){case 0:e.button<5&&(qa.keyPressed[e.button]=nl.frameCount+1);break;case 1:e.button<5&&(qa.keyPressed[e.button]=-(nl.frameCount+1));break;case 5:qa.keyPressed[e.wheelDelta>0?6:5]=nl.frameCount+1;break;case 8:if(!qa.ALLOW_KEY_REPEAT&&qa.keyPressed[e.keyCode]>0)return;qa.keyPressed[e.keyCode]=nl.frameCount+1;break;case 9:qa.keyPressed[e.keyCode]=-(nl.frameCount+1)}}}s["hxd.Key"]=qa,qa.__name__="hxd.Key";var Ja=n["hxd.Flags"]={__ename__:"hxd.Flags",__constructs__:["ReadOnly","AlphaPremultiplied","FlipY"],ReadOnly:{_hx_index:0,__enum__:"hxd.Flags",toString:r},AlphaPremultiplied:{_hx_index:1,__enum__:"hxd.Flags",toString:r},FlipY:{_hx_index:2,__enum__:"hxd.Flags",toString:r}};Ja.__empty_constructs__=[Ja.ReadOnly,Ja.AlphaPremultiplied,Ja.FlipY];class $a{constructor(e,t,s,r,n){null==n&&(n=0),this.width=e,this.height=t,this.bytes=s,this.set_innerFormat(r),this.offset=n;let i=0;null==i&&(i=0);let a=i;this.flags=a}set_innerFormat(e){return this.innerFormat=e,this.stride=$a.calcStride(this.width,e),this.bytesPerPixel=$a.calcStride(1,e),e}invalidFormat(){throw $i.thrown("Unsupported format for this operation : "+x.string(this.innerFormat))}makeSquare(e){let t=this.width,s=this.height,r=0==t?0:1,n=0==s?0:1;for(;r<t;)r<<=1;for(;n<s;)n<<=1;if(t==r&&s==n)return this;let i=this.bytesPerPixel,a=new da(new ArrayBuffer(r*n*i)),l=0,h=this.offset,o=0,_=s;for(;o<_;){o++;a.blit(l,this.bytes,h,t*i),l+=t*i,h+=t*i;let e=0,s=(r-t)*i>>2;for(;e<s;){e++;a.setInt32(l,0),l+=4}}let c=0,u=(n-s)*r*i>>2;for(;c<u;){c++;a.setInt32(l,0),l+=4}return e?new $a(r,n,a,this.innerFormat):(this.bytes=a,this.width=r,this.height=n,this)}copyInner(){let e=this.bytes;this.bytes=new da(new ArrayBuffer(this.height*this.stride)),this.bytes.blit(0,e,this.offset,this.height*this.stride),this.offset=0,this.flags&=-1-(1<<Ja.ReadOnly._hx_index)}setFlip(e){if(null==e&&(e=!1),0!=(this.flags&1<<Ja.FlipY._hx_index)==e)return;0!=(this.flags&1<<Ja.ReadOnly._hx_index)&&this.copyInner(),e?this.flags|=1<<Ja.FlipY._hx_index:this.flags&=-1-(1<<Ja.FlipY._hx_index),this.stride%4!=0&&this.invalidFormat();let t=0,s=this.height>>1;for(;t<s;){let e=t++,s=e*this.stride+this.offset,r=(this.height-1-e)*this.stride+this.offset,n=0,i=this.stride>>2;for(;n<i;){n++;let e=this.bytes.getInt32(s),t=this.bytes.getInt32(r);this.bytes.setInt32(s,t),this.bytes.setInt32(r,e),s+=4,r+=4}}}convert(e){if(this.innerFormat==e)return;0!=(this.flags&1<<Ja.ReadOnly._hx_index)&&this.copyInner();let t=this.bytes.b,s=this.innerFormat;switch(s._hx_index){case 0:switch(e._hx_index){case 1:let s=0,r=this.width*this.height;for(;s<r;){let e=(s++<<2)+this.offset,r=t[e],n=t[e+1],i=t[e+2],a=t[e+3];t[e++]=a,t[e++]=i,t[e++]=n,t[e]=r}break;case 2:let n=0,i=this.width*this.height;for(;n<i;){let e=(n++<<2)+this.offset,s=t[e],r=t[e+1];t[e]=r;let i=t[e+2];t[e+1]=i;let a=t[e+3];t[e+2]=a,t[e+3]=s}break;default:throw $i.thrown("Cannot convert from "+x.string(this.innerFormat)+" to "+x.string(e))}break;case 1:switch(e._hx_index){case 0:let s=0,r=this.width*this.height;for(;s<r;){let e=(s++<<2)+this.offset,r=t[e],n=t[e+1],i=t[e+2],a=t[e+3];t[e++]=a,t[e++]=i,t[e++]=n,t[e]=r}break;case 2:let n=0,i=this.width*this.height;for(;n<i;){let e=(n++<<2)+this.offset,s=t[e],r=t[e+2];t[e]=r,t[e+2]=s}break;default:throw $i.thrown("Cannot convert from "+x.string(this.innerFormat)+" to "+x.string(e))}break;case 2:switch(e._hx_index){case 0:let s=0,r=this.width*this.height;for(;s<r;){let e=(s++<<2)+this.offset,r=t[e+3],n=t[e+2];t[e+3]=n;let i=t[e+1];t[e+2]=i;let a=t[e];t[e+1]=a,t[e]=r}break;case 1:let n=0,i=this.width*this.height;for(;n<i;){let e=(n++<<2)+this.offset,s=t[e],r=t[e+2];t[e]=r,t[e+2]=s}break;default:throw $i.thrown("Cannot convert from "+x.string(this.innerFormat)+" to "+x.string(e))}break;case 18:if(18!=e._hx_index)throw $i.thrown("Cannot convert from "+x.string(this.innerFormat)+" to "+x.string(e));if(s.v!=e.v)throw $i.thrown("Cannot convert from "+x.string(this.innerFormat)+" to "+x.string(e));break;default:throw $i.thrown("Cannot convert from "+x.string(this.innerFormat)+" to "+x.string(e))}this.set_innerFormat(e)}getPixel(e,t){let s=(e+(0!=(this.flags&1<<Ja.FlipY._hx_index)?this.height-1-t:t)*this.width)*this.bytesPerPixel+this.offset;switch(this.innerFormat._hx_index){case 0:let e=this.bytes.getInt32(s);return e>>>24|e>>8&65280|e<<8&16711680|e<<24;case 1:return this.bytes.getInt32(s);case 2:let t=this.bytes.getInt32(s);return-16711936&t|t<<16&16711680|t>>16&255;default:return this.invalidFormat(),0}}dispose(){this.bytes=null}static calcStride(e,t){let s;switch(t._hx_index){case 3:s=8;break;case 4:s=16;break;case 5:s=1;break;case 6:s=2;break;case 7:s=4;break;case 8:s=2;break;case 9:s=4;break;case 10:s=8;break;case 11:s=3;break;case 12:s=6;break;case 13:s=12;break;case 0:case 1:case 2:case 14:case 15:case 16:case 17:s=4;break;case 18:let r=t.v;if(1==r||4==r)return e>>1;s=1}return e*s}static alloc(e,t,s){return new $a(e,t,new da(new ArrayBuffer(t*$a.calcStride(e,s))),s)}}s["hxd.Pixels"]=$a,$a.__name__="hxd.Pixels",Object.assign($a.prototype,{__class__:$a});class el{static get_loader(){let e=bl.currentInstance;if(null==e)throw $i.thrown("Resource loader not initialized: call to hxd.Res.initXXX() required");return e}static set_loader(e){return bl.currentInstance=e}}s["hxd.Res"]=el,el.__name__="hxd.Res";class tl{constructor(e){this.defaultCursor=Ya.Default,this.mouseCheckMove=!0,this.enablePhysicalMouse=!0,this.isOut=!1,this.onOver=new Ha(Za.EOver),this.onOut=new Ha(Za.EOut),this.checkPos=new Ha(Za.ECheck),this.focusLost=new Ha(Za.EFocusLost),this.lastTouch=0,this.mouseY=-1,this.mouseX=-1,this.overIndex=-1,this.scenes=[],this.pendingEvents=[],this.pushList=[],this.overList=[],this.overCandidates=[],null==e&&(e=il.getInstance()),this.window=e,e.addEventTarget(ao(this,this.onEvent))}onRemove(e){if(e==this.currentFocus&&(this.currentFocus=null),this.overIndex>=0){let t=this.overList.indexOf(e);t>=0&&(c.remove(this.overList,e),t<this.overIndex&&this.overIndex--)}else c.remove(this.overList,e),this.selectCursor();c.remove(this.pushList,e)}addScene(e,t){e.setEvents(this),null==t?this.scenes.push(e):this.scenes.splice(t,0,e)}removeScene(e){c.remove(this.scenes,e)&&e.setEvents(null)}blur(){null!=this.currentFocus&&(this.focusLost.cancel=!1,this.currentFocus.handleEvent(this.focusLost),this.focusLost.cancel||(this.currentFocus=null))}checkFocus(){if(null==this.currentFocus)return;let e=this.currentFocus.getInteractiveScene();null!=e?e.isInteractiveVisible(this.currentFocus)||this.blur():this.currentFocus=null}emitEvent(e){let t=e.relX,s=e.relY,r=0,n=!1,i=!1,a=!1,l=!1,h=!1,o=!1;switch(this.overIndex=0,e.kind._hx_index){case 0:h=!0,l=!0;break;case 1:l=!0;break;case 5:case 8:case 9:case 11:if(null!=this.currentFocus&&(e.relX=e.relY=0,this.currentFocus.handleEvent(e),e.relX=t,e.relY=s,!e.propagate))return;break;case 2:case 12:i=!0,a=!0}let _=0,u=this.scenes;for(;_<u.length;){let d=u[_];++_;let p=null;for(;;){let _=d.handleEvent(e,p);if(null==_){e.relX=t,e.relY=s;break}if(i){if(a){let t=this.overList.indexOf(_);if(-1==t){if(this.overCandidates.length==r)this.overCandidates[r]={i:_,s:d,x:e.relX,y:e.relY,z:e.relZ};else{let t=this.overCandidates[r];t.i=_,t.s=d,t.x=e.relX,t.y=e.relY,t.z=e.relZ}++r,this.overList.splice(this.overIndex++,0,_),o=!0}else{if(t<this.overIndex){for(;this.overList[t]=this.overList[t+1],++t,t<this.overIndex;);this.overList[this.overIndex]=_,o=!0}else if(t>this.overIndex){for(;this.overList[t]=this.overList[t-1],--t,t>this.overIndex;);this.overList[this.overIndex]=_,o=!0}this.overIndex++}a=e.propagate}}else l&&(e.kind==Za.EPush?this.pushList.push(_):c.remove(this.pushList,_)),h&&_==this.currentFocus&&(h=!1);if(e.relX=t,e.relY=s,!e.propagate){n=!0;break}p=_,e.propagate=!1}if(n)break}if(h&&null!=this.currentFocus&&this.blur(),i){if(this.overIndex<this.overList.length){for(;this.overIndex<this.overList.length;){this.overList.pop().handleEvent(this.onOut)}o=!0}if(0!=r){let e=0,t=this.onOver;for(;;){let s=this.overCandidates[e++];if(t.relX=s.x,t.relY=s.y,t.relZ=s.z,s.s.isInteractiveVisible(s.i)?s.i.handleEvent(t):c.remove(this.overList,s.i),s.i=null,s.s=null,!(e<r))break}}}if(this.overIndex=-1,o&&this.selectCursor(),n||e==this.checkPos||(e.kind==Za.EPush?this.pushList.push(null):e.kind==Za.ERelease&&c.remove(this.pushList,null),this.dispatchListeners(e)),e.kind==Za.ERelease&&this.pushList.length>0){let r=0,n=this.pushList;for(;r<n.length;){let i=n[r];if(++r,null==i)e.kind=Za.EReleaseOutside,this.dispatchListeners(e),e.kind=Za.ERelease;else{let r=i.getInteractiveScene();if(null==r)continue;e.kind=Za.EReleaseOutside,r.dispatchEvent(e,i),e.kind=Za.ERelease,e.relX=t,e.relY=s}}this.pushList=[]}}checkEvents(){let e=this.pendingEvents,t=!this.mouseCheckMove,s=null==this.currentFocus;if(e.length>0){this.pendingEvents=[];let r=0;for(;r<e.length;){let n=e[r];++r;let i=n.relX,a=n.relY;switch(n.kind._hx_index){case 0:case 1:this.mouseX=n.relX,this.mouseY=n.relY,this.lastTouch=n.touchId;break;case 2:t=!0,this.mouseX=n.relX,this.mouseY=n.relY,this.lastTouch=n.touchId;break;case 3:this.isOut=!1,this.selectCursor();continue;case 4:if(this.isOut=!0,this.overList.length>0){let e=this.overList.length-1;for(;e>=0;)this.onOut.cancel=!1,this.overList[e].handleEvent(this.onOut),c.remove(this.overList,this.overList[e]),--e;this.selectCursor()}continue;case 5:case 8:case 9:case 11:s||(s=!0,this.checkFocus())}(null==this.currentDrag||null!=this.currentDrag.ref&&this.currentDrag.ref!=n.touchId||(n.propagate=!0,n.cancel=!1,this.currentDrag.f(n),n.relX=i,n.relY=a,n.propagate))&&this.emitEvent(n)}}s||this.checkFocus(),t||this.isOut||null!=this.currentDrag||(this.checkPos.relX=this.mouseX,this.checkPos.relY=this.mouseY,this.checkPos.touchId=this.lastTouch,this.checkPos.cancel=!1,this.checkPos.propagate=!1,this.emitEvent(this.checkPos))}updateCursor(e){-1!=this.overList.indexOf(e)&&this.selectCursor()}selectCursor(){let e=this.defaultCursor,t=0,s=this.overList;for(;t<s.length;){let r=s[t];if(++t,null!=r.cursor){e=r.cursor;break}}if(6==e._hx_index){(0,e.f)()}else al.setCursor(e)}onEvent(e){(this.enablePhysicalMouse||e.kind!=Za.EMove)&&this.pendingEvents.push(e)}dispatchListeners(e){let t=e.relX,s=e.relY;e.propagate=!0;let r=0,n=this.scenes;for(;r<n.length;){let i=n[r];if(++r,e.cancel=!1,i.dispatchListeners(e),e.relX=t,e.relY=s,!e.propagate)break}}}s["hxd.SceneEvents"]=tl,tl.__name__="hxd.SceneEvents",Object.assign(tl.prototype,{__class__:tl});var sl=n["hxd.Platform"]={__ename__:"hxd.Platform",__constructs__:["IOS","Android","WebGL","PC","Console","FlashPlayer"],IOS:{_hx_index:0,__enum__:"hxd.Platform",toString:r},Android:{_hx_index:1,__enum__:"hxd.Platform",toString:r},WebGL:{_hx_index:2,__enum__:"hxd.Platform",toString:r},PC:{_hx_index:3,__enum__:"hxd.Platform",toString:r},Console:{_hx_index:4,__enum__:"hxd.Platform",toString:r},FlashPlayer:{_hx_index:5,__enum__:"hxd.Platform",toString:r}};sl.__empty_constructs__=[sl.IOS,sl.Android,sl.WebGL,sl.PC,sl.Console,sl.FlashPlayer];var rl=n["hxd.SystemValue"]={__ename__:"hxd.SystemValue",__constructs__:["IsTouch","IsWindowed","IsMobile"],IsTouch:{_hx_index:0,__enum__:"hxd.SystemValue",toString:r},IsWindowed:{_hx_index:1,__enum__:"hxd.SystemValue",toString:r},IsMobile:{_hx_index:2,__enum__:"hxd.SystemValue",toString:r}};rl.__empty_constructs__=[rl.IsTouch,rl.IsWindowed,rl.IsMobile];class nl{static update(){nl.frameCount++;let e=c.now()/1e3;if(nl.elapsedTime=e-nl.lastTimeStamp,nl.lastTimeStamp=e,nl.elapsedTime<nl.maxDeltaTime){let e=nl.elapsedTime;nl.currentDT=e+nl.smoothFactor*(nl.currentDT-e)}else nl.elapsedTime=1/nl.wantedFPS;nl.dt=nl.currentDT}static skip(){nl.lastTimeStamp=c.now()/1e3}}s["hxd.Timer"]=nl,nl.__name__="hxd.Timer";class il{constructor(e,t){this.useScreenPixels=!0,this.curMouseY=0,this.curMouseX=0;let s=this,r=null!=e;if(this.eventTargets=new ka,this.resizeEvents=new ka,null==e){if(null==(e=window.document.getElementById("webgl")))throw $i.thrown("Missing canvas #webgl");"1"==e.getAttribute("globalEvents")&&(t=!0)}this.canvas=e,this.propagateKeyEvents=t;let n=e.getAttribute("propagateKeyEvents");null!=n&&(this.propagateKeyEvents="0"!=n&&"false"!=n),this.focused=t,this.element=t?window:e,this.canvasPos=e.getBoundingClientRect(),r?e.addEventListener("mousemove",ao(this,this.onMouseMove)):window.addEventListener("mousemove",ao(this,this.onMouseMove)),this.element.addEventListener("mousedown",ao(this,this.onMouseDown)),this.element.addEventListener("mouseup",ao(this,this.onMouseUp)),this.element.addEventListener("wheel",ao(this,this.onMouseWheel)),this.element.addEventListener("touchstart",ao(this,this.onTouchStart)),this.element.addEventListener("touchmove",ao(this,this.onTouchMove)),this.element.addEventListener("touchend",ao(this,this.onTouchEnd)),this.element.addEventListener("keydown",ao(this,this.onKeyDown)),this.element.addEventListener("keyup",ao(this,this.onKeyUp)),this.element.addEventListener("keypress",ao(this,this.onKeyPress));let i=ao(this,this.onFocus);this.element.addEventListener("blur",(function(){i(false)}));let a=ao(this,this.onFocus);this.element.addEventListener("focus",(function(){a(true)})),e.oncontextmenu=function(e){return e.stopPropagation(),e.preventDefault(),!1},t?(e.addEventListener("mousedown",(function(e){s.onMouseDown(e),e.stopPropagation(),e.preventDefault()})),this.element.addEventListener("contextmenu",(function(e){return e.stopPropagation(),e.preventDefault(),!1}))):(null==e.getAttribute("tabindex")&&e.setAttribute("tabindex","1"),e.style.outline="none"),this.curW=this.get_width(),this.curH=this.get_height(),this.timer=new ha(100),this.timer.run=ao(this,this.checkResize)}checkResize(){this.canvasPos=this.canvas.getBoundingClientRect();let e=this.get_width(),t=this.get_height();this.curW==e&&this.curH==t||(this.curW=e,this.curH=t,this.onResize(null))}onClose(){return!0}event(e){let t=this.eventTargets.h;for(;null!=t;){let s=t.item;t=t.next,s(e)}}addEventTarget(e){this.eventTargets.add(e)}removeEventTarget(e){let t=this.eventTargets.h;for(;null!=t;){let s=t.item;t=t.next;let r=s;if(f.compareMethods(r,e)){this.eventTargets.remove(r);break}}}addResizeEvent(e){this.resizeEvents.push(e)}removeResizeEvent(e){let t=this.resizeEvents.h;for(;null!=t;){let s=t.item;t=t.next;let r=s;if(f.compareMethods(r,e)){this.resizeEvents.remove(e);break}}}onResize(e){let t=this.resizeEvents.h;for(;null!=t;){let e=t.item;t=t.next,e()}}getPixelRatio(){return this.useScreenPixels?window.devicePixelRatio:1}get_width(){return Math.round(this.canvasPos.width*this.getPixelRatio())}get_height(){return Math.round(this.canvasPos.height*this.getPixelRatio())}get_mouseX(){return Math.round((this.curMouseX-this.canvasPos.left)*this.getPixelRatio())}get_mouseY(){return Math.round((this.curMouseY-this.canvasPos.top)*this.getPixelRatio())}onMouseDown(e){e.clientX==this.curMouseX&&e.clientY==this.curMouseY||this.onMouseMove(e);let t,s=new Ha(Za.EPush,this.get_mouseX(),this.get_mouseY()),r=e.button;switch(r){case 1:t=2;break;case 2:t=1;break;default:t=r}s.button=t,this.event(s)}onMouseUp(e){e.clientX==this.curMouseX&&e.clientY==this.curMouseY||this.onMouseMove(e);let t,s=new Ha(Za.ERelease,this.get_mouseX(),this.get_mouseY()),r=e.button;switch(r){case 1:t=2;break;case 2:t=1;break;default:t=r}s.button=t,this.event(s)}onMouseMove(e){this.curMouseX=e.clientX,this.curMouseY=e.clientY,this.event(new Ha(Za.EMove,this.get_mouseX(),this.get_mouseY()))}onMouseWheel(e){e.preventDefault();let t=new Ha(Za.EWheel,this.get_mouseX(),this.get_mouseY());t.wheelDelta=e.deltaY/120,this.event(t)}onTouchStart(e){let t,s,r;e.preventDefault();let n=0,i=e.changedTouches;for(;n<i.length;){let e=i[n];++n,t=Math.round((e.clientX-this.canvasPos.left)*this.getPixelRatio()),s=Math.round((e.clientY-this.canvasPos.top)*this.getPixelRatio()),r=new Ha(Za.EPush,t,s),r.touchId=e.identifier,this.event(r)}}onTouchMove(e){let t,s,r;e.preventDefault();let n=0,i=e.changedTouches;for(;n<i.length;){let e=i[n];++n,t=Math.round((e.clientX-this.canvasPos.left)*this.getPixelRatio()),s=Math.round((e.clientY-this.canvasPos.top)*this.getPixelRatio()),r=new Ha(Za.EMove,t,s),r.touchId=e.identifier,this.event(r)}}onTouchEnd(e){let t,s,r;e.preventDefault();let n=0,i=e.changedTouches;for(;n<i.length;){let e=i[n];++n,t=Math.round((e.clientX-this.canvasPos.left)*this.getPixelRatio()),s=Math.round((e.clientY-this.canvasPos.top)*this.getPixelRatio()),r=new Ha(Za.ERelease,t,s),r.touchId=e.identifier,this.event(r)}}onKeyUp(e){let t=new Ha(Za.EKeyUp,this.get_mouseX(),this.get_mouseY());t.keyCode=e.keyCode,this.event(t),this.propagateKeyEvents||(e.preventDefault(),e.stopPropagation())}onKeyDown(e){let t=new Ha(Za.EKeyDown,this.get_mouseX(),this.get_mouseY());if(t.keyCode=e.keyCode,this.event(t),!this.propagateKeyEvents){switch(t.keyCode){case 8:case 9:case 16:case 17:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:e.preventDefault()}e.stopPropagation()}}onKeyPress(e){let t=new Ha(Za.ETextInput,this.get_mouseX(),this.get_mouseY());t.charCode=e.charCode,this.event(t),this.propagateKeyEvents||(e.preventDefault(),e.stopPropagation())}onFocus(e){this.event(new Ha(e?Za.EFocus:Za.EFocusLost)),this.focused=e}set_displayMode(e){let t=window.document,s=t.documentElement,r=e!=ll.Windowed;return t.fullscreenElement==s==r?ll.Windowed:(e!=ll.Windowed?s.requestFullscreen():t.exitFullscreen(),e)}static getInstance(){return null==il.inst&&(il.inst=new il),il.inst}}s["hxd.Window"]=il,il.__name__="hxd.Window",Object.assign(il.prototype,{__class__:il});class al{static setLoop(e){al.loopInit||(al.loopInit=!0,al.browserLoop()),al.loopFunc=e}static browserLoop(){let e=window;(e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame)(al.browserLoop),null!=al.loopFunc&&al.loopFunc()}static start(e){e()}static setNativeCursor(e){if(null!=al.currentNativeCursor&&y.enumEq(e,al.currentNativeCursor))return;al.currentNativeCursor=e,al.currentCustomCursor=null;let t=il.getInstance().canvas;if(null!=t){let s;switch(e._hx_index){case 0:s="default";break;case 1:s="pointer";break;case 2:s="move";break;case 3:s="text";break;case 4:s="none";break;case 5:let t=e.custom;if(null==t.alloc){t.alloc=[];let e=0,s=t.frames;for(;e<s.length;){let r=s[e];++e,t.alloc.push('url("'+r.ctx.canvas.toDataURL("image/png")+'") '+t.offsetX+" "+t.offsetY+", default")}}t.frames.length>1&&(al.currentCustomCursor=t,t.reset()),s=t.alloc[t.frameIndex];break;case 6:e.f;throw $i.thrown("assert")}t.style.cursor=s}}static getDefaultFrameRate(){return 60}static getValue(e){switch(e._hx_index){case 0:return al.get_platform()==sl.Android||al.get_platform()==sl.IOS;case 1:return!0;case 2:return al.get_platform()==sl.Android||al.get_platform()==sl.IOS}}static updateCursor(){if(null!=al.currentCustomCursor){let e=al.currentCustomCursor.update(nl.elapsedTime);if(-1!=e){let t=il.getInstance().canvas;null!=t&&(t.style.cursor=al.currentCustomCursor.alloc[e])}}}static get_platform(){let t=e.navigator.userAgent.toLowerCase();return t.indexOf("android")>=0?sl.Android:t.indexOf("ipad")>=0||t.indexOf("iphone")>=0||t.indexOf("ipod")>=0?sl.IOS:sl.PC}}s["hxd.System"]=al,al.__name__="hxd.System";var ll=n["hxd.DisplayMode"]={__ename__:"hxd.DisplayMode",__constructs__:["Windowed","Borderless","Fullscreen","FullscreenResize"],Windowed:{_hx_index:0,__enum__:"hxd.DisplayMode",toString:r},Borderless:{_hx_index:1,__enum__:"hxd.DisplayMode",toString:r},Fullscreen:{_hx_index:2,__enum__:"hxd.DisplayMode",toString:r},FullscreenResize:{_hx_index:3,__enum__:"hxd.DisplayMode",toString:r}};ll.__empty_constructs__=[ll.Windowed,ll.Borderless,ll.Fullscreen,ll.FullscreenResize];class hl{getBytes(){return null}open(){}skip(e){}readByte(){return 0}read(e,t,s){}close(){}load(e){if(!this.get_isAvailable())throw $i.thrown("load() not implemented");null!=e&&e()}loadBitmap(e){throw $i.thrown("loadBitmap() not implemented")}watch(e){}get_isAvailable(){return!0}get_path(){throw $i.thrown("path() not implemented")}get_extension(){let e=this.name.split(".");return 1==e.length?"":e.pop().toLowerCase()}}s["hxd.fs.FileEntry"]=hl,hl.__name__="hxd.fs.FileEntry",Object.assign(hl.prototype,{__class__:hl});class ol{}s["hxd.fs.FileSystem"]=ol,ol.__name__="hxd.fs.FileSystem",ol.__isInterface__=!0,Object.assign(ol.prototype,{__class__:ol});class _l extends hl{constructor(e,t,s,r){super(),this.fs=e,this.name=t,this.relPath=s,this.data=r}getBytes(){return null==this.bytes&&this.open(),this.bytes}open(){if(null==this.bytes&&(this.bytes=aa.getBytes(this.data),null==this.bytes))throw $i.thrown("Missing resource "+this.data);this.readPos=0}skip(e){this.readPos+=e}readByte(){return this.bytes.b[this.readPos++]}read(e,t,s){e.blit(t,this.bytes,this.readPos,s),this.readPos+=s}close(){this.bytes=null,this.readPos=0}load(e){null!=e&&ha.delay(e,1)}loadBitmap(e){let t=null,s=0,r=aa.content;for(;s<r.length;){let e=r[s];if(++s,e.name==this.data){t=e.data;break}}if(null==t)throw $i.thrown("Missing resource "+this.data);let n=new Image;n.onload=function(t){e(n)};let i="",a=0,l=(3-4*(6*t.length>>3)%3)%3;for(;a<l;){a++;i+="="}let h="data:image/"+this.get_extension()+";base64,"+t;n.src=h+i}get_path(){return"."==this.relPath?"<root>":this.relPath}}s["hxd.fs._EmbedFileSystem.EmbedEntry"]=_l,_l.__name__="hxd.fs._EmbedFileSystem.EmbedEntry",_l.__super__=hl,Object.assign(_l.prototype,{__class__:_l});class cl{constructor(e){this.root=e}splitPath(e){return"."==e?[]:e.split("/")}exists(e){let t=this.root,s=0,r=this.splitPath(e);for(;s<r.length;){let e=r[s];if(++s,t=f.field(t,e),null==t)return!1}return!0}get(e){if(!this.exists(e))throw $i.thrown(new dl(e));let t=cl.resolve(e);return new _l(this,e.split("/").pop(),e,t)}static resolve(e){return"R_"+e.replace(cl.invalidChars.r,"_")}}s["hxd.fs.EmbedFileSystem"]=cl,cl.__name__="hxd.fs.EmbedFileSystem",cl.__interfaces__=[ol],Object.assign(cl.prototype,{__class__:cl});class ul extends Ia{constructor(e){super(),this.f=e,e.open()}skip(e){this.f.skip(e)}readByte(){return this.f.readByte()}readBytes(e,t,s){return this.f.read(e,t,s),s}close(){this.f.close()}}s["hxd.fs.FileInput"]=ul,ul.__name__="hxd.fs.FileInput",ul.__super__=Ia,Object.assign(ul.prototype,{__class__:ul});class dl{constructor(e){this.path=e}toString(){return"Resource file not found '"+this.path+"'"}}s["hxd.fs.NotFound"]=dl,dl.__name__="hxd.fs.NotFound",Object.assign(dl.prototype,{__class__:dl});class pl{constructor(){}onContextLost(){}static get(){return null==pl.inst&&(pl.inst=new pl),pl.inst}}s["hxd.impl.Allocator"]=pl,pl.__name__="hxd.impl.Allocator",Object.assign(pl.prototype,{__class__:pl});class fl{constructor(e){this.i=0,this.a=e,this.l=this.a.length}hasNext(){return this.i<this.l}next(){return this.a[this.i++]}}s["hxd.impl.ArrayIterator_hxd_snd_Channel"]=fl,fl.__name__="hxd.impl.ArrayIterator_hxd_snd_Channel",Object.assign(fl.prototype,{__class__:fl});class xl{constructor(e){xl._hx_skip_constructor||this._hx_constructor(e)}_hx_constructor(e){this.entry=e}toString(){return this.entry.get_path()}watch(e){xl.LIVE_UPDATE&&this.entry.watch(e)}}s["hxd.res.Resource"]=xl,xl.__name__="hxd.res.Resource",Object.assign(xl.prototype,{__class__:xl});class gl extends xl{constructor(e){super(e)}getFormat(){return this.getSize(),this.inf.format}getSize(){if(null!=this.inf)return this.inf;let e,t,s=new ul(this.entry),r=0,n=0,i=0;try{t=s.readUInt16()}catch(e){if(!($i.caught(e).unwrap()instanceof Da))throw e;t=0}switch(t){case 17476:e=4,s.skip(10),n=s.readInt32(),r=s.readInt32(),s.skip(64);let t=s.readInt32();switch(16777215&t){case 4805697:switch((t>>>24)-48){case 1:i=4;break;case 2:i=5;break;default:i=0}break;case 5527620:switch((t>>>24)-48){case 1:i=1;break;case 2:case 3:i=2;break;case 4:case 5:i=3;break;default:i=0}break;default:if(808540228==t){s.skip(40);let e=s.readInt32();switch(e){case 95:i=6;break;case 98:i=7;break;default:throw $i.thrown(this.entry.get_path()+" has unsupported DXGI format "+e)}}}if(0==i)throw $i.thrown(this.entry.get_path()+" has unsupported 4CC "+String.fromCodePoint(255&t)+String.fromCodePoint(t>>8&255)+String.fromCodePoint(t>>16&255)+String.fromCodePoint(t>>>24));break;case 18759:e=2,s.readInt32(),r=s.readUInt16(),n=s.readUInt16();break;case 20617:for(e=1,s.set_bigEndian(!0),s.skip(6);;){let e=s.readInt32();if(1229472850==s.readInt32()){r=s.readInt32(),n=s.readInt32();break}s.skip(e+4)}break;case 55551:e=0,s.set_bigEndian(!0);e:for(;;)switch(s.readUInt16()){case 65472:case 65473:case 65474:s.readUInt16(),s.readByte();n=s.readUInt16(),r=s.readUInt16();break e;default:s.skip(s.readUInt16()-2)}break;default:if("tga"!=this.entry.get_extension())throw $i.thrown("Unsupported texture format "+this.entry.get_path());e=3,s.skip(10),r=s.readUInt16(),n=s.readUInt16()}return s.close(),this.inf={width:r,height:n,format:e,bc:i},this.inf}getPixels(e,t){let s;switch(this.getSize(),this.inf.format){case 0:let e,r=this.entry.getBytes();try{e=wl.decode(r)}catch(e){let t=$i.caught(e).unwrap();throw $i.thrown("Failed to decode JPG "+this.entry.get_path()+" ("+x.string(t)+")")}s=new $a(e.width,e.height,e.pixels,On.BGRA);break;case 1:let n=this.entry.getBytes(),i=new hr(new Ta(n));i.checkCRC=!1,s=$a.alloc(this.inf.width,this.inf.height,On.BGRA);let a=i.read();or.extract32(a,s.bytes,t),t&&(s.flags|=1<<Ja.FlipY._hx_index);break;case 2:let l=this.entry.getBytes(),h=new js(new Ta(l)).read();s=new $a(this.inf.width,this.inf.height,Ys.extractFullBGRA(h,0),On.BGRA);break;case 3:let o=this.entry.getBytes(),_=new ur(new Ta(o)).read();if(_.header.imageType!=cr.UncompressedTrueColor||32!=_.header.bitsPerPixel)throw $i.thrown("Not supported "+x.string(_.header.imageType)+"/"+_.header.bitsPerPixel);let c=_.header.width,u=_.header.height;s=$a.alloc(c,u,On.ARGB);let d=class{static fromPixels(e){return e.convert(On.ARGB),e.setFlip(!1),e}}.fromPixels(s),p=0,f=u;for(;p<f;){let e=p++,t=0,s=c;for(;t<s;){let s=t++,r=_.imageData[s+e*c];d.bytes.setInt32((s+e*d.width<<2)+d.offset,r>>>24|r>>8&65280|r<<8&16711680|r<<24)}}switch(_.header.imageOrigin._hx_index){case 0:s.flags|=1<<Ja.FlipY._hx_index;break;case 2:break;default:throw $i.thrown("Not supported "+x.string(_.header.imageOrigin))}break;case 4:let g=this.entry.getBytes();s=new $a(this.inf.width,this.inf.height,g,On.S3TC(this.inf.bc),128+(this.inf.bc>=6?20:0))}return null!=e&&s.convert(e),null!=t&&s.setFlip(t),s}watchCallb(){let e=this.inf.width,t=this.inf.height;this.inf=null;let s=this.getSize();e==s.width&&t==s.height||this.tex.resize(e,t),this.tex.realloc=null,this.loadTexture()}loadTexture(){let e=this;if(0==this.getFormat()||gl.DEFAULT_ASYNC)this.tex.flags|=1<<Sn.Loading._hx_index,this.entry.loadBitmap((function(t){let s=class{static toBitmap(e){let t=new ja(e.width,e.height);return t.ctx.drawImage(e,0,0),t}}.toBitmap(t);if(e.tex.alloc(),s.ctx.canvas.width!=e.tex.width||s.ctx.canvas.height!=e.tex.height){let t=s.getPixels();t.makeSquare(),e.tex.uploadPixels(t),t.dispose()}else e.tex.uploadBitmap(s);if(s.ctx=null,s.pixel=null,e.tex.realloc=ao(e,e.loadTexture),e.tex.flags&=-1-(1<<Sn.Loading._hx_index),null!=e.tex.waitLoads){let t=e.tex.waitLoads;e.tex.waitLoads=null;let s=0;for(;s<t.length;){let e=t[s];++s,e()}}gl.ENABLE_AUTO_WATCH&&e.watch(ao(e,e.watchCallb))}));else{let t=function(){e.tex.alloc();let t=e.getPixels(e.tex.format);t.width==e.tex.width&&t.height==e.tex.height||t.makeSquare(),e.tex.uploadPixels(t),t.dispose(),e.tex.realloc=ao(e,e.loadTexture),gl.ENABLE_AUTO_WATCH&&e.watch(ao(e,e.watchCallb))};this.entry.get_isAvailable()?t():this.entry.load(t)}}toTexture(){if(null!=this.tex)return this.tex;this.getSize();let e=this.inf.width,t=this.inf.height;if(!gl.ALLOW_NPOT){let s=1,r=1;for(;s<e;)s<<=1;for(;r<t;)r<<=1;e=s,t=r}let s=Pn.nativeFormat;return 4==this.inf.format&&(s=On.S3TC(this.inf.bc)),this.tex=new Pn(e,t,[Sn.NoAlloc],s),gl.DEFAULT_FILTER!=Bn.Linear&&this.tex.set_filter(gl.DEFAULT_FILTER),this.tex.setName(this.entry.get_path()),this.loadTexture(),this.tex}toTile(){let e=this.getSize();return Dr.fromTexture(this.toTexture()).sub(0,0,e.width,e.height)}}s["hxd.res.Image"]=gl,gl.__name__="hxd.res.Image",gl.__super__=xl,Object.assign(gl.prototype,{__class__:gl});class bl{constructor(e){this.fs=e,this.cache=new va}loadCache(e,t){let s=this.cache.h[e];if(null==s){let r=this.fs.get(e),n=bl.currentInstance;bl.currentInstance=this,s=y.createInstance(t,[r]),bl.currentInstance=n,this.cache.h[e]=s}else if(null==(Ss.__downcastCheck(s,t)?s:null))throw $i.thrown(e+" has been reintrepreted from "+x.string(Ss.getClass(s))+" to "+x.string(t));return s}}s["hxd.res.Loader"]=bl,bl.__name__="hxd.res.Loader",Object.assign(bl.prototype,{__class__:bl});var ml=n["hxd.res.Filter"]={__ename__:"hxd.res.Filter",__constructs__:["Fast","Chromatic"],Fast:{_hx_index:0,__enum__:"hxd.res.Filter",toString:r},Chromatic:{_hx_index:1,__enum__:"hxd.res.Filter",toString:r}};ml.__empty_constructs__=[ml.Fast,ml.Chromatic];class Al{constructor(){}}s["hxd.res._NanoJpeg.Component"]=Al,Al.__name__="hxd.res._NanoJpeg.Component",Object.assign(Al.prototype,{__class__:Al});class wl{constructor(){this.comps=[new Al,new Al,new Al].slice(0);let e=new Array(64),t=new Array(64),s=new Array(64),r=new Array(64);this.qtab=[e,t,s,r].slice(0);let n=new Array(16);this.counts=n;let i=new Array(64);this.block=i,this.njZZ=[0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63].slice(0),this.vlctab=[null,null,null,null,null,null,null,null].slice(0)}njInit(e,t,s,r){this.bytes=e,this.pos=t,this.filter=null==r?ml.Chromatic:r,s<0&&(s=e.length-t),null==this.vlctab[0]&&(this.vlctab[0]=new da(new ArrayBuffer(131072))),null==this.vlctab[1]&&(this.vlctab[1]=new da(new ArrayBuffer(131072))),null==this.vlctab[2]&&(this.vlctab[2]=new da(new ArrayBuffer(131072))),null==this.vlctab[3]&&(this.vlctab[3]=new da(new ArrayBuffer(131072))),this.size=s,this.qtused=0,this.qtavail=0,this.rstinterval=0,this.length=0,this.buf=0,this.bufbits=0,this.progressive=!1,this.comps[0].dcpred=0,this.comps[1].dcpred=0,this.comps[2].dcpred=0}cleanup(){this.bytes=null;let e=0,t=this.comps;for(;e<t.length;){let s=t[e];++e,null!=s.pixels&&(s.pixels=null)}null!=this.vlctab[0]&&(this.vlctab[0]=null),null!=this.vlctab[1]&&(this.vlctab[1]=null),null!=this.vlctab[2]&&(this.vlctab[2]=null),null!=this.vlctab[3]&&(this.vlctab[3]=null),null!=this.vlctab[4]&&(this.vlctab[4]=null),null!=this.vlctab[5]&&(this.vlctab[5]=null),null!=this.vlctab[6]&&(this.vlctab[6]=null),null!=this.vlctab[7]&&(this.vlctab[7]=null)}njShowBits(e){if(0==e)return 0;for(;this.bufbits<e;){if(this.size<=0){this.buf=this.buf<<8|255,this.bufbits+=8;continue}let e=this.bytes.b[this.pos];if(this.pos++,this.size--,this.bufbits+=8,this.buf=this.buf<<8|e,255==e){let e=this.bytes.b[this.pos];switch(this.pos++,this.size--,e){case 217:this.size=0;break;case 0:case 255:break;default:this.buf=this.buf<<8|e,this.bufbits+=8}}}return this.buf>>this.bufbits-e&(1<<e)-1}njDecodeSOF(){switch(this.length=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1],this.pos+=2,this.size-=2,this.length-=2,8!=this.bytes.b[this.pos]&&this.notSupported(),this.height=this.bytes.b[this.pos+1]<<8|this.bytes.b[this.pos+2],this.width=this.bytes.b[this.pos+3]<<8|this.bytes.b[this.pos+4],this.ncomp=this.bytes.b[this.pos+5],this.pos+=6,this.size-=6,this.length-=6,this.ncomp){case 1:case 3:break;default:this.notSupported()}let e=0,t=0,s=0,r=this.ncomp;for(;s<r;){let r=s++,n=this.comps[r];n.cid=this.bytes.b[this.pos],n.ssx=this.bytes.b[this.pos+1]>>4,0!=(n.ssx&n.ssx-1)&&this.notSupported(),n.ssy=15&this.bytes.b[this.pos+1],0!=(n.ssy&n.ssy-1)&&this.notSupported(),n.qtsel=this.bytes.b[this.pos+2],this.pos+=3,this.size-=3,this.length-=3,this.qtused|=1<<n.qtsel,n.ssx>e&&(e=n.ssx),n.ssy>t&&(t=n.ssy)}if(1==this.ncomp){let s=this.comps[0];t=1,e=t,s.ssx=s.ssy=e}this.mbsizex=e<<3,this.mbsizey=t<<3,this.mbwidth=(this.width+this.mbsizex-1)/this.mbsizex|0,this.mbheight=(this.height+this.mbsizey-1)/this.mbsizey|0;let n=0,i=this.ncomp;for(;n<i;){let s=n++,r=this.comps[s];r.width=(this.width*r.ssx+e-1)/e|0,r.stride=r.width+7&2147483640,r.height=(this.height*r.ssy+t-1)/t|0,r.stride=this.mbwidth*this.mbsizex*r.ssx/e|0,(r.width<3&&r.ssx!=e||r.height<3&&r.ssy!=t)&&this.notSupported(),r.pixels=new da(new ArrayBuffer(r.stride*(this.mbheight*this.mbsizey*r.ssy/t|0)))}let a=this.length;this.pos+=a,this.size-=a,this.length-=a}njDecodeDQT(){for(this.length=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1],this.pos+=2,this.size-=2,this.length-=2;this.length>=65;){let e=this.bytes.b[this.pos];this.qtavail|=1<<e;let t=this.qtab[e],s=0;for(;s<64;){let e=s++;t[e]=this.bytes.b[this.pos+(e+1)]}this.pos+=65,this.size-=65,this.length-=65}}njDecodeDHT(){for(this.length=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1],this.pos+=2,this.size-=2,this.length-=2;this.length>=17;){let e=this.bytes.b[this.pos];e=e>>4&1|(3&e)<<1,this.counts[0]=this.bytes.b[this.pos+1],this.counts[1]=this.bytes.b[this.pos+2],this.counts[2]=this.bytes.b[this.pos+3],this.counts[3]=this.bytes.b[this.pos+4],this.counts[4]=this.bytes.b[this.pos+5],this.counts[5]=this.bytes.b[this.pos+6],this.counts[6]=this.bytes.b[this.pos+7],this.counts[7]=this.bytes.b[this.pos+8],this.counts[8]=this.bytes.b[this.pos+9],this.counts[9]=this.bytes.b[this.pos+10],this.counts[10]=this.bytes.b[this.pos+11],this.counts[11]=this.bytes.b[this.pos+12],this.counts[12]=this.bytes.b[this.pos+13],this.counts[13]=this.bytes.b[this.pos+14],this.counts[14]=this.bytes.b[this.pos+15],this.counts[15]=this.bytes.b[this.pos+16],this.pos+=17,this.size-=17,this.length-=17;let t=this.vlctab[e],s=0,r=65536,n=65536,i=1;for(;i<17;){let e=i++;n>>=1;let a=this.counts[e-1];if(0==a)continue;r-=a<<16-e;let l=0,h=a;for(;l<h;){let r=l++,i=this.bytes.b[this.pos+r],a=0,h=n;for(;a<h;){a++;t.b[s++]=e,t.b[s++]=i}}this.pos+=a,this.size-=a,this.length-=a}for(;0!=r--;)t.b[s]=0,s+=2}}njDecodeDRI(){this.length=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1],this.pos+=2,this.size-=2,this.length-=2,this.rstinterval=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1];let e=this.length;this.pos+=e,this.size-=e,this.length-=e}njDecodeBlock(e,t){let s,r=e.pixels,n=0,i=0;for(;i<64;){let e=i++;this.block[e]=0}let a,l=e,h=l.dcpred,o=this.vlctab[e.dctabsel],_=this.njShowBits(16),c=o.b[_<<1];if(this.bufbits<c&&this.njShowBits(c),this.bufbits-=c,_=o.b[_<<1|1],this.vlcCode=_,c=15&_,0==c)a=0;else{let e=this.njShowBits(c);this.bufbits-=c,_=e,_<1<<c-1&&(_+=1+(-1<<c)),a=_}l.dcpred=h+a;let u=this.qtab[e.qtsel],d=this.vlctab[e.actabsel];for(this.block[0]=e.dcpred*u[0];;){let e=this.njShowBits(16),t=d.b[e<<1];if(this.bufbits<t&&this.njShowBits(t),this.bufbits-=t,e=d.b[e<<1|1],this.vlcCode=e,t=15&e,0==t)s=0;else{let r=this.njShowBits(t);this.bufbits-=t,e=r,e<1<<t-1&&(e+=1+(-1<<t)),s=e}if(0==this.vlcCode)break;if(n+=1+(this.vlcCode>>4),this.block[this.njZZ[n]]=s*u[n],!(n<63))break}let p,f,x=this.block[4]<<11,g=this.block[6],b=this.block[2],m=this.block[1],A=this.block[7],w=this.block[5],y=this.block[3];if(0==(x|g|b|m|A|w|y)){let e=this.block[7]=this.block[0]<<3,t=this.block[6]=e,s=this.block[5]=t,r=this.block[4]=s,n=this.block[3]=r,i=this.block[2]=n,a=this.block[1]=i;this.block[0]=a}else p=128+(this.block[0]<<11),f=565*(m+A),m=f+2276*m,A=f-3406*A,f=2408*(w+y),w=f-799*w,y=f-4017*y,f=p+x,p-=x,x=1108*(b+g),g=x-3784*g,b=x+1568*b,x=m+w,m-=w,w=A+y,A-=y,y=f+b,f-=b,b=p+g,p-=g,g=181*(m+A)+128>>8,m=181*(m-A)+128>>8,this.block[0]=y+x>>8,this.block[1]=b+g>>8,this.block[2]=p+m>>8,this.block[3]=f+w>>8,this.block[4]=f-w>>8,this.block[5]=p-m>>8,this.block[6]=b-g>>8,this.block[7]=y-x>>8;let k,B,C=this.block[12]<<11,v=this.block[14],S=this.block[10],M=this.block[9],I=this.block[15],T=this.block[13],F=this.block[11];if(0==(C|v|S|M|I|T|F)){let e=this.block[15]=this.block[8]<<3,t=this.block[14]=e,s=this.block[13]=t,r=this.block[12]=s,n=this.block[11]=r,i=this.block[10]=n,a=this.block[9]=i;this.block[8]=a}else k=128+(this.block[8]<<11),B=565*(M+I),M=B+2276*M,I=B-3406*I,B=2408*(T+F),T=B-799*T,F=B-4017*F,B=k+C,k-=C,C=1108*(S+v),v=C-3784*v,S=C+1568*S,C=M+T,M-=T,T=I+F,I-=F,F=B+S,B-=S,S=k+v,k-=v,v=181*(M+I)+128>>8,M=181*(M-I)+128>>8,this.block[8]=F+C>>8,this.block[9]=S+v>>8,this.block[10]=k+M>>8,this.block[11]=B+T>>8,this.block[12]=B-T>>8,this.block[13]=k-M>>8,this.block[14]=S-v>>8,this.block[15]=F-C>>8;let E,D,R=this.block[20]<<11,V=this.block[22],O=this.block[18],P=this.block[17],Q=this.block[23],L=this.block[21],G=this.block[19];if(0==(R|V|O|P|Q|L|G)){let e=this.block[23]=this.block[16]<<3,t=this.block[22]=e,s=this.block[21]=t,r=this.block[20]=s,n=this.block[19]=r,i=this.block[18]=n,a=this.block[17]=i;this.block[16]=a}else E=128+(this.block[16]<<11),D=565*(P+Q),P=D+2276*P,Q=D-3406*Q,D=2408*(L+G),L=D-799*L,G=D-4017*G,D=E+R,E-=R,R=1108*(O+V),V=R-3784*V,O=R+1568*O,R=P+L,P-=L,L=Q+G,Q-=G,G=D+O,D-=O,O=E+V,E-=V,V=181*(P+Q)+128>>8,P=181*(P-Q)+128>>8,this.block[16]=G+R>>8,this.block[17]=O+V>>8,this.block[18]=E+P>>8,this.block[19]=D+L>>8,this.block[20]=D-L>>8,this.block[21]=E-P>>8,this.block[22]=O-V>>8,this.block[23]=G-R>>8;let z,U,W=this.block[28]<<11,N=this.block[30],j=this.block[26],Y=this.block[25],X=this.block[31],Z=this.block[29],H=this.block[27];if(0==(W|N|j|Y|X|Z|H)){let e=this.block[31]=this.block[24]<<3,t=this.block[30]=e,s=this.block[29]=t,r=this.block[28]=s,n=this.block[27]=r,i=this.block[26]=n,a=this.block[25]=i;this.block[24]=a}else z=128+(this.block[24]<<11),U=565*(Y+X),Y=U+2276*Y,X=U-3406*X,U=2408*(Z+H),Z=U-799*Z,H=U-4017*H,U=z+W,z-=W,W=1108*(j+N),N=W-3784*N,j=W+1568*j,W=Y+Z,Y-=Z,Z=X+H,X-=H,H=U+j,U-=j,j=z+N,z-=N,N=181*(Y+X)+128>>8,Y=181*(Y-X)+128>>8,this.block[24]=H+W>>8,this.block[25]=j+N>>8,this.block[26]=z+Y>>8,this.block[27]=U+Z>>8,this.block[28]=U-Z>>8,this.block[29]=z-Y>>8,this.block[30]=j-N>>8,this.block[31]=H-W>>8;let K,q,J=this.block[36]<<11,$=this.block[38],ee=this.block[34],te=this.block[33],se=this.block[39],re=this.block[37],ne=this.block[35];if(0==(J|$|ee|te|se|re|ne)){let e=this.block[39]=this.block[32]<<3,t=this.block[38]=e,s=this.block[37]=t,r=this.block[36]=s,n=this.block[35]=r,i=this.block[34]=n,a=this.block[33]=i;this.block[32]=a}else K=128+(this.block[32]<<11),q=565*(te+se),te=q+2276*te,se=q-3406*se,q=2408*(re+ne),re=q-799*re,ne=q-4017*ne,q=K+J,K-=J,J=1108*(ee+$),$=J-3784*$,ee=J+1568*ee,J=te+re,te-=re,re=se+ne,se-=ne,ne=q+ee,q-=ee,ee=K+$,K-=$,$=181*(te+se)+128>>8,te=181*(te-se)+128>>8,this.block[32]=ne+J>>8,this.block[33]=ee+$>>8,this.block[34]=K+te>>8,this.block[35]=q+re>>8,this.block[36]=q-re>>8,this.block[37]=K-te>>8,this.block[38]=ee-$>>8,this.block[39]=ne-J>>8;let ie,ae,le=this.block[44]<<11,he=this.block[46],oe=this.block[42],_e=this.block[41],ce=this.block[47],ue=this.block[45],de=this.block[43];if(0==(le|he|oe|_e|ce|ue|de)){let e=this.block[47]=this.block[40]<<3,t=this.block[46]=e,s=this.block[45]=t,r=this.block[44]=s,n=this.block[43]=r,i=this.block[42]=n,a=this.block[41]=i;this.block[40]=a}else ie=128+(this.block[40]<<11),ae=565*(_e+ce),_e=ae+2276*_e,ce=ae-3406*ce,ae=2408*(ue+de),ue=ae-799*ue,de=ae-4017*de,ae=ie+le,ie-=le,le=1108*(oe+he),he=le-3784*he,oe=le+1568*oe,le=_e+ue,_e-=ue,ue=ce+de,ce-=de,de=ae+oe,ae-=oe,oe=ie+he,ie-=he,he=181*(_e+ce)+128>>8,_e=181*(_e-ce)+128>>8,this.block[40]=de+le>>8,this.block[41]=oe+he>>8,this.block[42]=ie+_e>>8,this.block[43]=ae+ue>>8,this.block[44]=ae-ue>>8,this.block[45]=ie-_e>>8,this.block[46]=oe-he>>8,this.block[47]=de-le>>8;let pe,fe,xe=this.block[52]<<11,ge=this.block[54],be=this.block[50],me=this.block[49],Ae=this.block[55],we=this.block[53],ye=this.block[51];if(0==(xe|ge|be|me|Ae|we|ye)){let e=this.block[55]=this.block[48]<<3,t=this.block[54]=e,s=this.block[53]=t,r=this.block[52]=s,n=this.block[51]=r,i=this.block[50]=n,a=this.block[49]=i;this.block[48]=a}else pe=128+(this.block[48]<<11),fe=565*(me+Ae),me=fe+2276*me,Ae=fe-3406*Ae,fe=2408*(we+ye),we=fe-799*we,ye=fe-4017*ye,fe=pe+xe,pe-=xe,xe=1108*(be+ge),ge=xe-3784*ge,be=xe+1568*be,xe=me+we,me-=we,we=Ae+ye,Ae-=ye,ye=fe+be,fe-=be,be=pe+ge,pe-=ge,ge=181*(me+Ae)+128>>8,me=181*(me-Ae)+128>>8,this.block[48]=ye+xe>>8,this.block[49]=be+ge>>8,this.block[50]=pe+me>>8,this.block[51]=fe+we>>8,this.block[52]=fe-we>>8,this.block[53]=pe-me>>8,this.block[54]=be-ge>>8,this.block[55]=ye-xe>>8;let ke,Be,Ce=this.block[60]<<11,ve=this.block[62],Se=this.block[58],Me=this.block[57],Ie=this.block[63],Te=this.block[61],Fe=this.block[59];if(0==(Ce|ve|Se|Me|Ie|Te|Fe)){let e=this.block[63]=this.block[56]<<3,t=this.block[62]=e,s=this.block[61]=t,r=this.block[60]=s,n=this.block[59]=r,i=this.block[58]=n,a=this.block[57]=i;this.block[56]=a}else ke=128+(this.block[56]<<11),Be=565*(Me+Ie),Me=Be+2276*Me,Ie=Be-3406*Ie,Be=2408*(Te+Fe),Te=Be-799*Te,Fe=Be-4017*Fe,Be=ke+Ce,ke-=Ce,Ce=1108*(Se+ve),ve=Ce-3784*ve,Se=Ce+1568*Se,Ce=Me+Te,Me-=Te,Te=Ie+Fe,Ie-=Fe,Fe=Be+Se,Be-=Se,Se=ke+ve,ke-=ve,ve=181*(Me+Ie)+128>>8,Me=181*(Me-Ie)+128>>8,this.block[56]=Fe+Ce>>8,this.block[57]=Se+ve>>8,this.block[58]=ke+Me>>8,this.block[59]=Be+Te>>8,this.block[60]=Be-Te>>8,this.block[61]=ke-Me>>8,this.block[62]=Se-ve>>8,this.block[63]=Fe-Ce>>8;let Ee,De,Re=t,Ve=e.stride,Oe=this.block[32]<<8,Pe=this.block[48],Qe=this.block[16],Le=this.block[8],Ge=this.block[56],ze=this.block[40],Ue=this.block[24];if(0==(Oe|Pe|Qe|Le|Ge|ze|Ue)){let e=128+(this.block[0]+32>>6);Oe=e<0?0:e>255?255:e,r.b[Re]=Oe,Re+=Ve,r.b[Re]=Oe,Re+=Ve,r.b[Re]=Oe,Re+=Ve,r.b[Re]=Oe,Re+=Ve,r.b[Re]=Oe,Re+=Ve,r.b[Re]=Oe,Re+=Ve,r.b[Re]=Oe,Re+=Ve,r.b[Re]=Oe,Re+=Ve}else{Ee=8192+(this.block[0]<<8),De=565*(Le+Ge)+4,Le=De+2276*Le>>3,Ge=De-3406*Ge>>3,De=2408*(ze+Ue)+4,ze=De-799*ze>>3,Ue=De-4017*Ue>>3,De=Ee+Oe,Ee-=Oe,Oe=1108*(Qe+Pe)+4,Pe=Oe-3784*Pe>>3,Qe=Oe+1568*Qe>>3,Oe=Le+ze,Le-=ze,ze=Ge+Ue,Ge-=Ue,Ue=De+Qe,De-=Qe,Qe=Ee+Pe,Ee-=Pe,Pe=181*(Le+Ge)+128>>8,Le=181*(Le-Ge)+128>>8;let e=128+(Ue+Oe>>14);r.b[Re]=e<0?0:e>255?255:e,Re+=Ve;let t=128+(Qe+Pe>>14);r.b[Re]=t<0?0:t>255?255:t,Re+=Ve;let s=128+(Ee+Le>>14);r.b[Re]=s<0?0:s>255?255:s,Re+=Ve;let n=128+(De+ze>>14);r.b[Re]=n<0?0:n>255?255:n,Re+=Ve;let i=128+(De-ze>>14);r.b[Re]=i<0?0:i>255?255:i,Re+=Ve;let a=128+(Ee-Le>>14);r.b[Re]=a<0?0:a>255?255:a,Re+=Ve;let l=128+(Qe-Pe>>14);r.b[Re]=l<0?0:l>255?255:l,Re+=Ve;let h=128+(Ue-Oe>>14);r.b[Re]=h<0?0:h>255?255:h}let We,Ne,je=1+t,Ye=e.stride,Xe=this.block[33]<<8,Ze=this.block[49],He=this.block[17],Ke=this.block[9],qe=this.block[57],Je=this.block[41],$e=this.block[25];if(0==(Xe|Ze|He|Ke|qe|Je|$e)){let e=128+(this.block[1]+32>>6);Xe=e<0?0:e>255?255:e,r.b[je]=Xe,je+=Ye,r.b[je]=Xe,je+=Ye,r.b[je]=Xe,je+=Ye,r.b[je]=Xe,je+=Ye,r.b[je]=Xe,je+=Ye,r.b[je]=Xe,je+=Ye,r.b[je]=Xe,je+=Ye,r.b[je]=Xe,je+=Ye}else{We=8192+(this.block[1]<<8),Ne=565*(Ke+qe)+4,Ke=Ne+2276*Ke>>3,qe=Ne-3406*qe>>3,Ne=2408*(Je+$e)+4,Je=Ne-799*Je>>3,$e=Ne-4017*$e>>3,Ne=We+Xe,We-=Xe,Xe=1108*(He+Ze)+4,Ze=Xe-3784*Ze>>3,He=Xe+1568*He>>3,Xe=Ke+Je,Ke-=Je,Je=qe+$e,qe-=$e,$e=Ne+He,Ne-=He,He=We+Ze,We-=Ze,Ze=181*(Ke+qe)+128>>8,Ke=181*(Ke-qe)+128>>8;let e=128+($e+Xe>>14);r.b[je]=e<0?0:e>255?255:e,je+=Ye;let t=128+(He+Ze>>14);r.b[je]=t<0?0:t>255?255:t,je+=Ye;let s=128+(We+Ke>>14);r.b[je]=s<0?0:s>255?255:s,je+=Ye;let n=128+(Ne+Je>>14);r.b[je]=n<0?0:n>255?255:n,je+=Ye;let i=128+(Ne-Je>>14);r.b[je]=i<0?0:i>255?255:i,je+=Ye;let a=128+(We-Ke>>14);r.b[je]=a<0?0:a>255?255:a,je+=Ye;let l=128+(He-Ze>>14);r.b[je]=l<0?0:l>255?255:l,je+=Ye;let h=128+($e-Xe>>14);r.b[je]=h<0?0:h>255?255:h}let et,tt,st=2+t,rt=e.stride,nt=this.block[34]<<8,it=this.block[50],at=this.block[18],lt=this.block[10],ht=this.block[58],ot=this.block[42],_t=this.block[26];if(0==(nt|it|at|lt|ht|ot|_t)){let e=128+(this.block[2]+32>>6);nt=e<0?0:e>255?255:e,r.b[st]=nt,st+=rt,r.b[st]=nt,st+=rt,r.b[st]=nt,st+=rt,r.b[st]=nt,st+=rt,r.b[st]=nt,st+=rt,r.b[st]=nt,st+=rt,r.b[st]=nt,st+=rt,r.b[st]=nt,st+=rt}else{et=8192+(this.block[2]<<8),tt=565*(lt+ht)+4,lt=tt+2276*lt>>3,ht=tt-3406*ht>>3,tt=2408*(ot+_t)+4,ot=tt-799*ot>>3,_t=tt-4017*_t>>3,tt=et+nt,et-=nt,nt=1108*(at+it)+4,it=nt-3784*it>>3,at=nt+1568*at>>3,nt=lt+ot,lt-=ot,ot=ht+_t,ht-=_t,_t=tt+at,tt-=at,at=et+it,et-=it,it=181*(lt+ht)+128>>8,lt=181*(lt-ht)+128>>8;let e=128+(_t+nt>>14);r.b[st]=e<0?0:e>255?255:e,st+=rt;let t=128+(at+it>>14);r.b[st]=t<0?0:t>255?255:t,st+=rt;let s=128+(et+lt>>14);r.b[st]=s<0?0:s>255?255:s,st+=rt;let n=128+(tt+ot>>14);r.b[st]=n<0?0:n>255?255:n,st+=rt;let i=128+(tt-ot>>14);r.b[st]=i<0?0:i>255?255:i,st+=rt;let a=128+(et-lt>>14);r.b[st]=a<0?0:a>255?255:a,st+=rt;let l=128+(at-it>>14);r.b[st]=l<0?0:l>255?255:l,st+=rt;let h=128+(_t-nt>>14);r.b[st]=h<0?0:h>255?255:h}let ct,ut,dt=3+t,pt=e.stride,ft=this.block[35]<<8,xt=this.block[51],gt=this.block[19],bt=this.block[11],mt=this.block[59],At=this.block[43],wt=this.block[27];if(0==(ft|xt|gt|bt|mt|At|wt)){let e=128+(this.block[3]+32>>6);ft=e<0?0:e>255?255:e,r.b[dt]=ft,dt+=pt,r.b[dt]=ft,dt+=pt,r.b[dt]=ft,dt+=pt,r.b[dt]=ft,dt+=pt,r.b[dt]=ft,dt+=pt,r.b[dt]=ft,dt+=pt,r.b[dt]=ft,dt+=pt,r.b[dt]=ft,dt+=pt}else{ct=8192+(this.block[3]<<8),ut=565*(bt+mt)+4,bt=ut+2276*bt>>3,mt=ut-3406*mt>>3,ut=2408*(At+wt)+4,At=ut-799*At>>3,wt=ut-4017*wt>>3,ut=ct+ft,ct-=ft,ft=1108*(gt+xt)+4,xt=ft-3784*xt>>3,gt=ft+1568*gt>>3,ft=bt+At,bt-=At,At=mt+wt,mt-=wt,wt=ut+gt,ut-=gt,gt=ct+xt,ct-=xt,xt=181*(bt+mt)+128>>8,bt=181*(bt-mt)+128>>8;let e=128+(wt+ft>>14);r.b[dt]=e<0?0:e>255?255:e,dt+=pt;let t=128+(gt+xt>>14);r.b[dt]=t<0?0:t>255?255:t,dt+=pt;let s=128+(ct+bt>>14);r.b[dt]=s<0?0:s>255?255:s,dt+=pt;let n=128+(ut+At>>14);r.b[dt]=n<0?0:n>255?255:n,dt+=pt;let i=128+(ut-At>>14);r.b[dt]=i<0?0:i>255?255:i,dt+=pt;let a=128+(ct-bt>>14);r.b[dt]=a<0?0:a>255?255:a,dt+=pt;let l=128+(gt-xt>>14);r.b[dt]=l<0?0:l>255?255:l,dt+=pt;let h=128+(wt-ft>>14);r.b[dt]=h<0?0:h>255?255:h}let yt,kt,Bt=4+t,Ct=e.stride,vt=this.block[36]<<8,St=this.block[52],Mt=this.block[20],It=this.block[12],Tt=this.block[60],Ft=this.block[44],Et=this.block[28];if(0==(vt|St|Mt|It|Tt|Ft|Et)){let e=128+(this.block[4]+32>>6);vt=e<0?0:e>255?255:e,r.b[Bt]=vt,Bt+=Ct,r.b[Bt]=vt,Bt+=Ct,r.b[Bt]=vt,Bt+=Ct,r.b[Bt]=vt,Bt+=Ct,r.b[Bt]=vt,Bt+=Ct,r.b[Bt]=vt,Bt+=Ct,r.b[Bt]=vt,Bt+=Ct,r.b[Bt]=vt,Bt+=Ct}else{yt=8192+(this.block[4]<<8),kt=565*(It+Tt)+4,It=kt+2276*It>>3,Tt=kt-3406*Tt>>3,kt=2408*(Ft+Et)+4,Ft=kt-799*Ft>>3,Et=kt-4017*Et>>3,kt=yt+vt,yt-=vt,vt=1108*(Mt+St)+4,St=vt-3784*St>>3,Mt=vt+1568*Mt>>3,vt=It+Ft,It-=Ft,Ft=Tt+Et,Tt-=Et,Et=kt+Mt,kt-=Mt,Mt=yt+St,yt-=St,St=181*(It+Tt)+128>>8,It=181*(It-Tt)+128>>8;let e=128+(Et+vt>>14);r.b[Bt]=e<0?0:e>255?255:e,Bt+=Ct;let t=128+(Mt+St>>14);r.b[Bt]=t<0?0:t>255?255:t,Bt+=Ct;let s=128+(yt+It>>14);r.b[Bt]=s<0?0:s>255?255:s,Bt+=Ct;let n=128+(kt+Ft>>14);r.b[Bt]=n<0?0:n>255?255:n,Bt+=Ct;let i=128+(kt-Ft>>14);r.b[Bt]=i<0?0:i>255?255:i,Bt+=Ct;let a=128+(yt-It>>14);r.b[Bt]=a<0?0:a>255?255:a,Bt+=Ct;let l=128+(Mt-St>>14);r.b[Bt]=l<0?0:l>255?255:l,Bt+=Ct;let h=128+(Et-vt>>14);r.b[Bt]=h<0?0:h>255?255:h}let Dt,Rt,Vt=5+t,Ot=e.stride,Pt=this.block[37]<<8,Qt=this.block[53],Lt=this.block[21],Gt=this.block[13],zt=this.block[61],Ut=this.block[45],Wt=this.block[29];if(0==(Pt|Qt|Lt|Gt|zt|Ut|Wt)){let e=128+(this.block[5]+32>>6);Pt=e<0?0:e>255?255:e,r.b[Vt]=Pt,Vt+=Ot,r.b[Vt]=Pt,Vt+=Ot,r.b[Vt]=Pt,Vt+=Ot,r.b[Vt]=Pt,Vt+=Ot,r.b[Vt]=Pt,Vt+=Ot,r.b[Vt]=Pt,Vt+=Ot,r.b[Vt]=Pt,Vt+=Ot,r.b[Vt]=Pt,Vt+=Ot}else{Dt=8192+(this.block[5]<<8),Rt=565*(Gt+zt)+4,Gt=Rt+2276*Gt>>3,zt=Rt-3406*zt>>3,Rt=2408*(Ut+Wt)+4,Ut=Rt-799*Ut>>3,Wt=Rt-4017*Wt>>3,Rt=Dt+Pt,Dt-=Pt,Pt=1108*(Lt+Qt)+4,Qt=Pt-3784*Qt>>3,Lt=Pt+1568*Lt>>3,Pt=Gt+Ut,Gt-=Ut,Ut=zt+Wt,zt-=Wt,Wt=Rt+Lt,Rt-=Lt,Lt=Dt+Qt,Dt-=Qt,Qt=181*(Gt+zt)+128>>8,Gt=181*(Gt-zt)+128>>8;let e=128+(Wt+Pt>>14);r.b[Vt]=e<0?0:e>255?255:e,Vt+=Ot;let t=128+(Lt+Qt>>14);r.b[Vt]=t<0?0:t>255?255:t,Vt+=Ot;let s=128+(Dt+Gt>>14);r.b[Vt]=s<0?0:s>255?255:s,Vt+=Ot;let n=128+(Rt+Ut>>14);r.b[Vt]=n<0?0:n>255?255:n,Vt+=Ot;let i=128+(Rt-Ut>>14);r.b[Vt]=i<0?0:i>255?255:i,Vt+=Ot;let a=128+(Dt-Gt>>14);r.b[Vt]=a<0?0:a>255?255:a,Vt+=Ot;let l=128+(Lt-Qt>>14);r.b[Vt]=l<0?0:l>255?255:l,Vt+=Ot;let h=128+(Wt-Pt>>14);r.b[Vt]=h<0?0:h>255?255:h}let Nt,jt,Yt=6+t,Xt=e.stride,Zt=this.block[38]<<8,Ht=this.block[54],Kt=this.block[22],qt=this.block[14],Jt=this.block[62],$t=this.block[46],es=this.block[30];if(0==(Zt|Ht|Kt|qt|Jt|$t|es)){let e=128+(this.block[6]+32>>6);Zt=e<0?0:e>255?255:e,r.b[Yt]=Zt,Yt+=Xt,r.b[Yt]=Zt,Yt+=Xt,r.b[Yt]=Zt,Yt+=Xt,r.b[Yt]=Zt,Yt+=Xt,r.b[Yt]=Zt,Yt+=Xt,r.b[Yt]=Zt,Yt+=Xt,r.b[Yt]=Zt,Yt+=Xt,r.b[Yt]=Zt,Yt+=Xt}else{Nt=8192+(this.block[6]<<8),jt=565*(qt+Jt)+4,qt=jt+2276*qt>>3,Jt=jt-3406*Jt>>3,jt=2408*($t+es)+4,$t=jt-799*$t>>3,es=jt-4017*es>>3,jt=Nt+Zt,Nt-=Zt,Zt=1108*(Kt+Ht)+4,Ht=Zt-3784*Ht>>3,Kt=Zt+1568*Kt>>3,Zt=qt+$t,qt-=$t,$t=Jt+es,Jt-=es,es=jt+Kt,jt-=Kt,Kt=Nt+Ht,Nt-=Ht,Ht=181*(qt+Jt)+128>>8,qt=181*(qt-Jt)+128>>8;let e=128+(es+Zt>>14);r.b[Yt]=e<0?0:e>255?255:e,Yt+=Xt;let t=128+(Kt+Ht>>14);r.b[Yt]=t<0?0:t>255?255:t,Yt+=Xt;let s=128+(Nt+qt>>14);r.b[Yt]=s<0?0:s>255?255:s,Yt+=Xt;let n=128+(jt+$t>>14);r.b[Yt]=n<0?0:n>255?255:n,Yt+=Xt;let i=128+(jt-$t>>14);r.b[Yt]=i<0?0:i>255?255:i,Yt+=Xt;let a=128+(Nt-qt>>14);r.b[Yt]=a<0?0:a>255?255:a,Yt+=Xt;let l=128+(Kt-Ht>>14);r.b[Yt]=l<0?0:l>255?255:l,Yt+=Xt;let h=128+(es-Zt>>14);r.b[Yt]=h<0?0:h>255?255:h}let ts,ss,rs=7+t,ns=e.stride,is=this.block[39]<<8,as=this.block[55],ls=this.block[23],hs=this.block[15],os=this.block[63],_s=this.block[47],cs=this.block[31];if(0==(is|as|ls|hs|os|_s|cs)){let e=128+(this.block[7]+32>>6);is=e<0?0:e>255?255:e,r.b[rs]=is,rs+=ns,r.b[rs]=is,rs+=ns,r.b[rs]=is,rs+=ns,r.b[rs]=is,rs+=ns,r.b[rs]=is,rs+=ns,r.b[rs]=is,rs+=ns,r.b[rs]=is,rs+=ns,r.b[rs]=is,rs+=ns}else{ts=8192+(this.block[7]<<8),ss=565*(hs+os)+4,hs=ss+2276*hs>>3,os=ss-3406*os>>3,ss=2408*(_s+cs)+4,_s=ss-799*_s>>3,cs=ss-4017*cs>>3,ss=ts+is,ts-=is,is=1108*(ls+as)+4,as=is-3784*as>>3,ls=is+1568*ls>>3,is=hs+_s,hs-=_s,_s=os+cs,os-=cs,cs=ss+ls,ss-=ls,ls=ts+as,ts-=as,as=181*(hs+os)+128>>8,hs=181*(hs-os)+128>>8;let e=128+(cs+is>>14);r.b[rs]=e<0?0:e>255?255:e,rs+=ns;let t=128+(ls+as>>14);r.b[rs]=t<0?0:t>255?255:t,rs+=ns;let s=128+(ts+hs>>14);r.b[rs]=s<0?0:s>255?255:s,rs+=ns;let n=128+(ss+_s>>14);r.b[rs]=n<0?0:n>255?255:n,rs+=ns;let i=128+(ss-_s>>14);r.b[rs]=i<0?0:i>255?255:i,rs+=ns;let a=128+(ts-hs>>14);r.b[rs]=a<0?0:a>255?255:a,rs+=ns;let l=128+(ls-as>>14);r.b[rs]=l<0?0:l>255?255:l,rs+=ns;let h=128+(cs-is>>14);r.b[rs]=h<0?0:h>255?255:h}}notSupported(){throw $i.thrown("This JPG file is not supported")}njDecodeScan(){this.length=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1],this.pos+=2,this.size-=2,this.length-=2,this.bytes.b[this.pos]!=this.ncomp&&this.notSupported(),this.pos+=1,this.size-=1,this.length-=1;let e=0,t=this.ncomp;for(;e<t;){let t=e++,s=this.comps[t];s.dctabsel=this.bytes.b[this.pos+1]>>4<<1,s.actabsel=(3&this.bytes.b[this.pos+1])<<1|1,this.pos+=2,this.size-=2,this.length-=2}let s=this.bytes.b[this.pos],r=this.bytes.b[this.pos+1],n=this.bytes.b[this.pos+2];(!this.progressive&&0!=s||r!=63-s||0!=n)&&this.notSupported();let i=this.length;this.pos+=i,this.size-=i,this.length-=i;let a=0,l=0,h=this.rstinterval,o=0;for(;;){let e=0,t=this.ncomp;for(;e<t;){let t=e++,s=this.comps[t],r=0,n=s.ssy;for(;r<n;){let e=r++,t=0,n=s.ssx;for(;t<n;){let r=t++;this.njDecodeBlock(s,(l*s.ssy+e)*s.stride+a*s.ssx+r<<3)}}}if(++a>=this.mbwidth&&(a=0,++l>=this.mbheight))break;if(0!=this.rstinterval&&0==--h){this.bufbits&=248;this.njShowBits(16);this.bufbits-=16;o=o+1&7,h=this.rstinterval,this.comps[0].dcpred=0,this.comps[1].dcpred=0,this.comps[2].dcpred=0}}}njUpsampleH(e){let t=e.width-3,s=new da(new ArrayBuffer(e.width*e.height<<1)),r=s,n=e.pixels,i=0,a=0,l=0,h=e.height;for(;l<h;){l++;let s=139*n.b[i]+-11*n.b[i+1]+64>>7;r.b[a]=s<0?0:s>255?255:s;let h=104*n.b[i]+27*n.b[i+1]+-3*n.b[i+2]+64>>7;r.b[a+1]=h<0?0:h>255?255:h;let o=28*n.b[i]+109*n.b[i+1]+-9*n.b[i+2]+64>>7;r.b[a+2]=o<0?0:o>255?255:o;let _=0,c=t;for(;_<c;){let e=_++,t=-9*n.b[i+e]+111*n.b[i+e+1]+29*n.b[i+e+2]+-3*n.b[i+e+3]+64>>7;r.b[a+(e<<1)+3]=t<0?0:t>255?255:t;let s=-3*n.b[i+e]+29*n.b[i+e+1]+111*n.b[i+e+2]+-9*n.b[i+e+3]+64>>7;r.b[a+(e<<1)+4]=s<0?0:s>255?255:s}i+=e.stride,a+=e.width<<1;let u=28*n.b[i-1]+109*n.b[i-2]+-9*n.b[i-3]+64>>7;r.b[a-3]=u<0?0:u>255?255:u;let d=104*n.b[i-1]+27*n.b[i-2]+-3*n.b[i-3]+64>>7;r.b[a-2]=d<0?0:d>255?255:d;let p=139*n.b[i-1]+-11*n.b[i-2]+64>>7;r.b[a-1]=p<0?0:p>255?255:p}e.width<<=1,e.stride=e.width,e.pixels=s}njUpsampleV(e){let t=e.width,s=e.stride,r=s+s,n=new da(new ArrayBuffer(e.width*e.height<<1)),i=0,a=0,l=n,h=e.pixels,o=0,_=t;for(;o<_;){a=o++,i=a;let n=139*h.b[i]+-11*h.b[i+s]+64>>7;l.b[a]=n<0?0:n>255?255:n,a+=t;let _=104*h.b[i]+27*h.b[i+s]+-3*h.b[i+r]+64>>7;l.b[a]=_<0?0:_>255?255:_,a+=t;let c=28*h.b[i]+109*h.b[i+s]+-9*h.b[i+r]+64>>7;l.b[a]=c<0?0:c>255?255:c,a+=t,i+=s;let u=0,d=e.height-2;for(;u<d;){u++;let e=-9*h.b[i-s]+111*h.b[i]+29*h.b[i+s]+-3*h.b[i+r]+64>>7;l.b[a]=e<0?0:e>255?255:e,a+=t;let n=-3*h.b[i-s]+29*h.b[i]+111*h.b[i+s]+-9*h.b[i+r]+64>>7;l.b[a]=n<0?0:n>255?255:n,a+=t,i+=s}i+=s;let p=28*h.b[i]+109*h.b[i-s]+-9*h.b[i-r]+64>>7;l.b[a]=p<0?0:p>255?255:p,a+=t;let f=104*h.b[i]+27*h.b[i-s]+-3*h.b[i-r]+64>>7;l.b[a]=f<0?0:f>255?255:f,a+=t;let x=139*h.b[i]+-11*h.b[i-s]+64>>7;l.b[a]=x<0?0:x>255?255:x}e.height<<=1,e.stride=e.width,e.pixels=n}njUpsample(e){let t=0,s=0;for(;e.width<this.width;)e.width<<=1,++t;for(;e.height<this.height;)e.height<<=1,++s;let r=new da(new ArrayBuffer(e.width*e.height)),n=e.pixels,i=0,a=r,l=0,h=e.height;for(;l<h;){let r=(l++>>s)*e.stride,h=0,o=e.width;for(;h<o;){let e=h++;a.b[i++]=n.b[(e>>t)+r]}}e.stride=e.width,e.pixels=r}njConvert(){let e=0,t=this.ncomp;for(;e<t;){let t=e++,s=this.comps[t];switch(this.filter._hx_index){case 0:(s.width<this.width||s.height<this.height)&&this.njUpsample(s);break;case 1:for(;s.width<this.width||s.height<this.height;)s.width<this.width&&this.njUpsampleH(s),s.height<this.height&&this.njUpsampleV(s)}if(s.width<this.width||s.height<this.height)throw $i.thrown("assert")}let s=new da(new ArrayBuffer(this.width*this.height*4));if(3!=this.ncomp)throw $i.thrown("TODO");{let e=this.comps[0].pixels,t=this.comps[1].pixels,r=this.comps[2].pixels,n=s,i=0,a=0,l=0,h=0,o=0,_=this.height;for(;o<_;){o++;let s=0,_=this.width;for(;s<_;){s++;let o=e.b[i++]<<8,_=t.b[a++]-128,c=r.b[l++]-128,u=o+359*c+128>>8,d=u<0?0:u>255?255:u,p=o-88*_-183*c+128>>8,f=p<0?0:p>255?255:p,x=o+454*_+128>>8,g=x<0?0:x>255?255:x;n.b[h++]=g,n.b[h++]=f,n.b[h++]=d,n.b[h++]=255}i+=this.comps[0].stride-this.width,a+=this.comps[1].stride-this.width,l+=this.comps[2].stride-this.width}}return s}njDecode(){if(this.size<2||255!=this.bytes.b[this.pos]||216!=this.bytes.b[this.pos+1])throw $i.thrown("This file is not a JPEG");this.pos+=2,this.size-=2,this.length-=2;e:for(;;)switch(this.pos+=2,this.size-=2,this.length-=2,this.bytes.b[this.pos+-1]){case 192:this.njDecodeSOF();break;case 194:if(this.progressive=!0,this.progressive)throw $i.thrown("Unsupported progressive JPG");null==this.vlctab[4]&&(this.vlctab[4]=new da(new ArrayBuffer(131072))),null==this.vlctab[5]&&(this.vlctab[5]=new da(new ArrayBuffer(131072))),null==this.vlctab[6]&&(this.vlctab[6]=new da(new ArrayBuffer(131072))),null==this.vlctab[7]&&(this.vlctab[7]=new da(new ArrayBuffer(131072))),this.njDecodeSOF();break;case 195:throw $i.thrown("Unsupported lossless JPG");case 196:this.njDecodeDHT();break;case 218:this.njDecodeScan();break e;case 219:this.njDecodeDQT();break;case 221:this.njDecodeDRI();break;case 254:this.length=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1],this.pos+=2,this.size-=2,this.length-=2;let e=this.length;this.pos+=e,this.size-=e,this.length-=e;break;default:switch(240&this.bytes.b[this.pos+-1]){case 192:throw $i.thrown("Unsupported jpeg type "+(15&this.bytes.b[this.pos+-1]));case 224:this.length=this.bytes.b[this.pos]<<8|this.bytes.b[this.pos+1],this.pos+=2,this.size-=2,this.length-=2;let e=this.length;this.pos+=e,this.size-=e,this.length-=e;break;default:throw $i.thrown("Unsupported jpeg tag 0x"+b.hex(this.bytes.b[this.pos+-1],2))}}let e=this.njConvert();return this.cleanup(),{pixels:e,width:this.width,height:this.height}}static decode(e,t,s,r){return null==r&&(r=-1),null==s&&(s=0),null==wl.inst&&(wl.inst=new wl),wl.inst.njInit(e,s,r,t),wl.inst.njDecode()}}s["hxd.res.NanoJpeg"]=wl,wl.__name__="hxd.res.NanoJpeg",Object.assign(wl.prototype,{__class__:wl});class yl extends xl{constructor(e){xl._hx_skip_constructor=!0,super(),xl._hx_skip_constructor=!1,this._hx_constructor(e)}_hx_constructor(e){this.lastPlay=0,super._hx_constructor(e)}getData(){if(null!=this.data)return this.data;let e=this.entry.getBytes();switch(e.b[0]){case 73:case 255:this.data=new Ol(e);break;case 79:throw $i.thrown("OGG format requires -lib stb_ogg_sound (for "+this.entry.get_path()+")");case 82:this.data=new Ql(e)}if(null==this.data)throw $i.thrown("Unsupported sound format "+this.entry.get_path());return yl.ENABLE_AUTO_WATCH&&this.watch(ao(this,this.watchCallb)),this.data}play(e,t,s,r){return null==t&&(t=1),null==e&&(e=!1),this.lastPlay=c.now()/1e3,this.channel=Vl.get().play(this,s,r),this.channel.loop=e,this.channel.set_volume(t),this.channel}watchCallb(){let e=this.data;this.data=null;let t=this.getData();if(null!=e&&(e.channels!=t.channels||e.samples!=t.samples||e.sampleFormat!=t.sampleFormat||e.samplingRate!=t.samplingRate)){let e=Vl.get().getAll(this);for(;e.hasNext();){let s=e.next();s.duration=t.get_duration(),s.set_position(s.position)}}}}s["hxd.res.Sound"]=yl,yl.__name__="hxd.res.Sound",yl.__super__=xl,Object.assign(yl.prototype,{__class__:yl});class kl{constructor(){kl._hx_skip_constructor||this._hx_constructor()}_hx_constructor(){this.volume=1,this.bindedEffects=[],this.effects=[],this.mute=!1,this.priority=0}set_volume(e){return this.currentFade=null,this.volume=e}updateCurrentVolume(e){if(null!=this.currentFade){let t=this.currentFade,s=e-t.start;s>=t.duration?(this.set_volume(t.targetVolume),null!=t.onEnd&&t.onEnd()):(this.set_volume(t.startVolume+s/t.duration*(t.targetVolume-t.startVolume)),this.currentFade=t)}this.currentVolume=this.volume}removeEffect(e){c.remove(this.effects,e)}}s["hxd.snd.ChannelBase"]=kl,kl.__name__="hxd.snd.ChannelBase",Object.assign(kl.prototype,{__class__:kl});class Bl extends kl{constructor(){kl._hx_skip_constructor=!0,super(),kl._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.queue=[],this.positionChanged=!1,this.isLoading=!1,this.isVirtual=!1,this.lastStamp=0,this.audibleVolume=1,this.allowVirtual=!0,this.loop=!1,this.pause=!1,this.position=0,super._hx_constructor(),this.id=Bl.ID++}onEnd(){}set_position(e){return this.lastStamp=c.now()/1e3,this.positionChanged=!0,e>this.duration?e=this.duration:e<0&&(e=0),this.position=e}updateCurrentVolume(e){if(this.pause&&null!=this.currentFade){let t=this.currentFade;this.currentFade=null,this.updateCurrentVolume(e),this.currentFade=t}if(super.updateCurrentVolume(e),this.channelGroup.updateCurrentVolume(e),this.currentVolume*=this.channelGroup.currentVolume*this.soundGroup.volume,null!=this.manager){let e=0,t=this.channelGroup.effects;for(;e<t.length;){let s=t[e];++e,this.currentVolume*=s.getVolumeModifier()}let s=0,r=this.effects;for(;s<r.length;){let e=r[s];++s,this.currentVolume*=e.getVolumeModifier()}}}calcAudibleVolume(e){if(this.updateCurrentVolume(e),this.audibleVolume=this.currentVolume,null!=this.manager){let e=0,t=this.channelGroup.effects;for(;e<t.length;){let s=t[e];++e,this.audibleVolume=s.applyAudibleVolumeModifier(this.audibleVolume)}let s=0,r=this.effects;for(;s<r.length;){let e=r[s];++s,this.audibleVolume=e.applyAudibleVolumeModifier(this.audibleVolume)}}}stop(){null!=this.manager&&this.manager.releaseChannel(this)}}s["hxd.snd.Channel"]=Bl,Bl.__name__="hxd.snd.Channel",Bl.__super__=kl,Object.assign(Bl.prototype,{__class__:Bl});class Cl extends kl{constructor(e){super(),this.name=e}}s["hxd.snd.ChannelGroup"]=Cl,Cl.__name__="hxd.snd.ChannelGroup",Cl.__super__=kl,Object.assign(Cl.prototype,{__class__:Cl});var vl=n["hxd.snd.SampleFormat"]={__ename__:"hxd.snd.SampleFormat",__constructs__:["UI8","I16","F32"],UI8:{_hx_index:0,__enum__:"hxd.snd.SampleFormat",toString:r},I16:{_hx_index:1,__enum__:"hxd.snd.SampleFormat",toString:r},F32:{_hx_index:2,__enum__:"hxd.snd.SampleFormat",toString:r}};vl.__empty_constructs__=[vl.UI8,vl.I16,vl.F32];class Sl{isLoading(){return!1}decode(e,t,s,r){let n=this.getBytesPerSample();if(s<0||r<0||t<0||t+r*n>e.length){let i="sampleStart = "+s;throw i+=" sampleCount = "+r,i+=" outPos = "+t,i+=" bpp = "+n,i+=" out.length = "+e.length,$i.thrown(i)}if(s+r>=this.samples){let i=0;return s<this.samples&&(i=this.samples-s,this.decodeBuffer(e,t,s,i)),void e.fill(t+i*n,(r-i)*n,0)}this.decodeBuffer(e,t,s,r)}resample(e,t,s){if(this.sampleFormat==t&&this.samplingRate==e&&this.channels==s)return this;let r=Math.ceil(this.samples*(e/this.samplingRate)),n=this.getBytesPerSample(),i=new da(new ArrayBuffer(n*this.samples));this.decodeBuffer(i,0,0,this.samples);let a,l=s*r;switch(t._hx_index){case 0:a=1;break;case 1:a=2;break;case 2:a=4}let h=new da(new ArrayBuffer(l*a));this.resampleBuffer(h,0,i,0,e,t,s,this.samples);let o=new Ql(null);return o.channels=s,o.samples=r,o.sampleFormat=t,o.samplingRate=e,o.rawData=h,o}resampleBuffer(e,t,s,r,n,i,a,l){let h=this.getBytesPerSample(),o=Math.ceil(l*(n/this.samplingRate)),_=l!=o;if(!_&&this.sampleFormat==vl.I16&&i==vl.I16&&1==a&&2==this.channels){let n=r,i=t,a=0,h=l;for(;a<h;){a++;let t=s.getUInt16(n);n+=2;let r,l=s.getUInt16(n);n+=2,(t^l)>=32768?(0!=(32768&t)&&(t|=-65536),0!=(32768&l)&&(l|=-65536),r=t+l>>1&65535):r=t+l>>1,e.setUInt16(i,r),i+=2}return}let c=this.channels,u=a<c?a:c,d=a-u,p=0,f=0,x=0,g=o;for(;x<g;){let n=x++/(o-1)*(l-1),a=0|n,c=n-a,g=r+a*h;a==l-1&&(_=!1);let b=0,m=u;for(;b<m;){b++;let r,n=0;switch(this.sampleFormat._hx_index){case 0:r=s.b[g]/255,_&&(n=s.b[g+h]/255),++g;break;case 1:let e=s.getUInt16(g);if(r=(0==(32768&e)?e:-65536|e)/32768,_){let e=s.getUInt16(g+h);n=(0==(32768&e)?e:-65536|e)/32768}g+=2;break;case 2:r=s.getFloat(g),_&&(n=s.getFloat(g+h)),g+=4}switch(p=_?r+c*(n-r):r,i._hx_index){case 0:f=128*(p+1)|0,f>255&&(f=255),e.b[t++]=f;break;case 1:f=32768*p|0,f>32767&&(f=32767),f&=65535,e.setUInt16(t,f),t+=2;break;case 2:e.setFloat(t,p),t+=4}}let A=0,w=d;for(;A<w;){A++;switch(i._hx_index){case 0:e.b[t++]=f;break;case 1:e.setUInt16(t,f),t+=2;break;case 2:e.setFloat(t,p),t+=4}}}}decodeBuffer(e,t,s,r){throw $i.thrown("Not implemented")}getBytesPerSample(){let e;switch(this.sampleFormat._hx_index){case 0:e=1;break;case 1:e=2;break;case 2:e=4}return this.channels*e}load(e){e()}get_duration(){return this.samples/this.samplingRate}}s["hxd.snd.Data"]=Sl,Sl.__name__="hxd.snd.Data",Object.assign(Sl.prototype,{__class__:Sl});class Ml{constructor(){Ml._hx_skip_constructor||this._hx_constructor()}_hx_constructor(){}acquire(){}release(){}update(e){}bind(e,t){}apply(e,t){}unbind(e,t){}}s["hxd.snd.EffectDriver"]=Ml,Ml.__name__="hxd.snd.EffectDriver",Object.assign(Ml.prototype,{__class__:Ml});var Il=n["hxd.snd.DriverFeature"]={__ename__:"hxd.snd.DriverFeature",__constructs__:["MasterVolume"],MasterVolume:{_hx_index:0,__enum__:"hxd.snd.DriverFeature",toString:r}};Il.__empty_constructs__=[Il.MasterVolume];class Tl{}s["hxd.snd.Driver"]=Tl,Tl.__name__="hxd.snd.Driver",Tl.__isInterface__=!0,Object.assign(Tl.prototype,{__class__:Tl});class Fl{constructor(e){this.refs=0,this.priority=0,this.retainTime=0,this.lastStamp=0;let t=Vl.get().driver;null!=t&&(this.driver=t.getEffectDriver(e))}applyAudibleVolumeModifier(e){return e}getVolumeModifier(){return 1}}s["hxd.snd.Effect"]=Fl,Fl.__name__="hxd.snd.Effect",Object.assign(Fl.prototype,{__class__:Fl});class El{constructor(){this.position=new Xr,this.velocity=new Xr,this.direction=new Xr(1,0,0),this.up=new Xr(0,0,1)}}s["hxd.snd.Listener"]=El,El.__name__="hxd.snd.Listener",Object.assign(El.prototype,{__class__:El});class Dl{constructor(e){this.start=0,this.playing=!1,this.volume=-1,this.id=Dl.ID++,this.handle=e.createSource(),this.buffers=[]}dispose(){Vl.get().driver.destroySource(this.handle)}}s["hxd.snd.Source"]=Dl,Dl.__name__="hxd.snd.Source",Object.assign(Dl.prototype,{__class__:Dl});class Rl{constructor(e){this.handle=e.createBuffer(),this.refs=0,this.lastStop=c.now()/1e3}dispose(){Vl.get().driver.destroyBuffer(this.handle)}}s["hxd.snd.Buffer"]=Rl,Rl.__name__="hxd.snd.Buffer",Object.assign(Rl.prototype,{__class__:Rl});class Vl{constructor(){this.suspended=!1,this.timeOffset=0;try{this.driver=new Xl}catch(e){if("string"!=typeof $i.caught(e).unwrap())throw e;this.driver=null}if(this.masterVolume=1,this.hasMasterVolume=null==this.driver||this.driver.hasFeature(Il.MasterVolume),this.masterSoundGroup=new Pl("master"),this.masterChannelGroup=new Cl("master"),this.listener=new El,this.soundBufferMap=new va,this.soundBufferKeys=[],this.freeStreamBuffers=[],this.effectGC=[],this.soundBufferCount=0,null!=this.driver){this.sources=[];let e=0,t=Vl.MAX_SOURCES;for(;e<t;){e++;this.sources.push(new Dl(this.driver))}}this.cachedBytes=new da(new ArrayBuffer(24)),this.resampleBytes=new da(new ArrayBuffer(2*Vl.STREAM_BUFFER_SAMPLE_COUNT))}getTmpBytes(e){return this.cachedBytes.length<e&&(this.cachedBytes=new da(new ArrayBuffer(e))),this.cachedBytes}getResampleBytes(e){return this.resampleBytes.length<e&&(this.resampleBytes=new da(new ArrayBuffer(e))),this.resampleBytes}stopAll(){for(;null!=this.channels;)this.channels.stop()}getAll(e){let t=this.channels,s=[];for(;null!=t;)t.sound==e&&s.push(t),t=t.next;return new fl(s)}dispose(){if(this.stopAll(),null!=this.driver){let e=0,t=this.sources;for(;e<t.length;){let s=t[e];++e,s.dispose()}let s=va.valueIterator(this.soundBufferMap.h);for(;s.hasNext();){s.next().dispose()}let r=0,n=this.freeStreamBuffers;for(;r<n.length;){let e=n[r];++r,e.dispose()}let i=0,a=this.effectGC;for(;i<a.length;){let e=a[i];++i,e.driver.release()}this.driver.dispose()}this.sources=null,this.soundBufferMap=null,this.soundBufferKeys=null,this.freeStreamBuffers=null,this.effectGC=null,this.updateEvent.stop(),Vl.instance=null}play(e,t,s){null==s&&(s=this.masterSoundGroup),null==t&&(t=this.masterChannelGroup);let r=e.getData();if(0==r.samples)throw $i.thrown(x.string(e)+" has no samples");let n=new Bl;return n.sound=e,n.duration=r.get_duration(),n.manager=this,n.soundGroup=s,n.channelGroup=t,n.next=this.channels,n.isLoading=r.isLoading(),n.isVirtual=null==this.driver,this.channels=n,n}updateVirtualChannels(e){let t=this.channels;for(;null!=t;){if(t.pause||!t.isVirtual||t.isLoading){t=t.next;continue}let s=t,r=e-t.lastStamp;s.set_position(s.position+(r<0?0:r)),t.lastStamp=e;let n=t.next;for(;t.position>=t.duration;){let e=t;if(e.set_position(e.position-t.duration),t.onEnd(),null!=n&&null==n.manager&&(n=null),t.queue.length>0)t.sound=t.queue.shift(),t.duration=t.sound.getData().get_duration();else if(!t.loop){this.releaseChannel(t);break}}t=n}}update(){if(0!=this.timeOffset){let e=this.channels;for(;null!=e;)e.lastStamp+=this.timeOffset,null!=e.currentFade&&(e.currentFade.start+=this.timeOffset),e=e.next;let t=0,s=this.sources;for(;t<s.length;){let e=s[t];++t;let r=0,n=e.buffers;for(;r<n.length;){let e=n[r];++r,e.lastStop+=this.timeOffset}}this.timeOffset=0}if(this.now=c.now()/1e3,null==this.driver)return void this.updateVirtualChannels(this.now);let e=0,t=this.sources;for(;e<t.length;){let s=t[e];++e;let r=s.channel;if(null==r)continue;if(r.positionChanged){this.releaseSource(s);continue}let n=null,i=0,a=this.driver.getProcessedBuffers(s.handle);for(;i<a;){i++;let e=this.unqueueBuffer(s);null!=e&&(n=e,e.isEnd&&(r.sound=e.sound,r.duration=e.sound.getData().get_duration(),r.set_position(r.duration),r.positionChanged=!1,r.onEnd(),s.start=0))}if(0==s.buffers.length){n.isEnd?r.queue.length>0?(r.sound=r.queue[0],r.duration=r.sound.getData().get_duration(),r.set_position(0),this.releaseSource(s)):r.loop?(r.set_position(0),this.releaseSource(s)):this.releaseChannel(r):(r.set_position((n.start+n.samples)/n.sampleRate),this.releaseSource(s));continue}r.sound=s.buffers[0].sound,r.duration=r.sound.getData().get_duration();let l=this.driver.getPlayedSampleCount(s.handle);if(l<0&&(l=0),r.set_position((s.start+l)/s.buffers[0].sampleRate),r.positionChanged=!1,s.buffers.length<Vl.BUFFER_QUEUE_LENGTH){let e=s.buffers[s.buffers.length-1];if(e.isEnd)if(r.queue.length>0){let e=r.queue[0];this.queueBuffer(s,e,0)&&r.queue.shift()}else r.loop&&this.queueBuffer(s,e.sound,0);else this.queueBuffer(s,e.sound,e.start+e.samples)}}let s=this.channels;for(;null!=s;)s.calcAudibleVolume(this.now),s.isLoading&&!s.sound.getData().isLoading()&&(s.isLoading=!1),s.isVirtual=this.suspended||s.pause||s.mute||s.channelGroup.mute||s.allowVirtual&&s.audibleVolume<Vl.VIRTUAL_VOLUME_THRESHOLD||s.isLoading,s=s.next;let r,n=this.channels,i=ao(this,this.sortChannel);if(null==n)r=null;else{let e,t,s,a,l,h=1,o=0,_=0;for(;;){for(t=n,n=null,l=null,e=0;null!=t;){++e,s=t,o=0;let r=0,c=h;for(;r<c;){r++;if(++o,s=s.next,null==s)break}for(_=h;o>0||_>0&&null!=s;)0==o?(a=s,s=s.next,--_):0==_||null==s||i(t,s)<=0?(a=t,t=t.next,--o):(a=s,s=s.next,--_),null!=l?l.next=a:n=a,l=a;t=s}if(l.next=null,e<=1)break;h*=2}r=n}this.channels=r;let a=0,l=this.channels;for(;null!=l&&!l.isVirtual;)++a>this.sources.length?l.isVirtual=!0:l.soundGroup.maxAudible>=0&&(l.soundGroup.lastUpdate!=this.now&&(l.soundGroup.lastUpdate=this.now,l.soundGroup.numAudible=0),++l.soundGroup.numAudible>l.soundGroup.maxAudible&&(l.isVirtual=!0,--a)),l=l.next;let h=0,o=this.sources;for(;h<o.length;){let e=o[h];++h,null!=e.channel&&e.channel.isVirtual&&this.releaseSource(e)}let _=this.channels;for(;null!=_;){if(null!=_.source||_.isVirtual){_=_.next;continue}let e=null,t=0,s=this.sources;for(;t<s.length;){let r=s[t];if(++t,null==r.channel){e=r;break}}if(null==e)throw $i.thrown("could not get a source");e.channel=_,_.source=e,this.checkTargetFormat(_.sound.getData(),_.soundGroup.mono),e.start=Math.floor(_.position*this.targetRate),e.start<0&&(e.start=0),this.queueBuffer(e,_.sound,e.start),_.positionChanged=!1,_=_.next}let u=null,d=this.hasMasterVolume?1:this.masterVolume,p=0,f=this.sources;for(;p<f.length;){let e=f[p];++p;let t=e.channel;if(null==t)continue;let s=t.currentVolume*d;e.volume!=s&&(s<0&&(s=0),e.volume=s,this.driver.setSourceVolume(e.handle,s)),e.playing||(this.driver.playSource(e.handle),e.playing=!0);let r=t.bindedEffects.length;for(;--r>=0;){let s=t.bindedEffects[r];t.effects.indexOf(s)<0&&t.channelGroup.effects.indexOf(s)<0&&this.unbindEffect(t,e,s)}let n=0,i=t.channelGroup.effects;for(;n<i.length;){let s=i[n];++n,t.bindedEffects.indexOf(s)<0&&this.bindEffect(t,e,s)}let a=0,l=t.effects;for(;a<l.length;){let s=l[a];++a,t.bindedEffects.indexOf(s)<0&&this.bindEffect(t,e,s)}let h=0,o=t.bindedEffects;for(;h<o.length;){let e=o[h];++h,u=Vl.regEffect(u,e)}}let x=u,g=ao(this,this.sortEffect);if(null==x)u=null;else{let e,t,s,r,n,i=1,a=0,l=0;for(;;){for(t=x,x=null,n=null,e=0;null!=t;){++e,s=t,a=0;let h=0,o=i;for(;h<o;){h++;if(++a,s=s.next,null==s)break}for(l=i;a>0||l>0&&null!=s;)0==a?(r=s,s=s.next,--l):0==l||null==s||g(t,s)<=0?(r=t,t=t.next,--a):(r=s,s=s.next,--l),null!=n?n.next=r:x=r,n=r;t=s}if(n.next=null,e<=1)break;i*=2}u=x}let b=u;for(;null!=b;)b.driver.update(b),b=b.next;let m=0,A=this.sources;for(;m<A.length;){let e=A[m];++m;let t=e.channel;if(null==t)continue;let s=0,r=t.bindedEffects;for(;s<r.length;){let t=r[s];++s,t.driver.apply(t,e.handle)}}let w=0,y=this.effectGC;for(;w<y.length;){let e=y[w];if(++w,this.now-e.lastStamp>e.retainTime){e.driver.release(),c.remove(this.effectGC,e);break}}if(this.updateVirtualChannels(this.now),this.listener.direction.normalize(),this.listener.up.normalize(),this.hasMasterVolume&&this.driver.setMasterVolume(this.masterVolume),this.driver.setListenerParams(this.listener.position,this.listener.direction,this.listener.up,this.listener.velocity),this.driver.update(),this.soundBufferCount>=Vl.SOUND_BUFFER_CACHE_SIZE){let e=c.now()/1e3,t=0;for(;t<this.soundBufferKeys.length;){let s=this.soundBufferKeys[t],r=this.soundBufferMap.h[s];if(++t,r.refs>0||r.lastStop+60>e)continue;let n=this.soundBufferMap;Object.prototype.hasOwnProperty.call(n.h,s)&&delete n.h[s],c.remove(this.soundBufferKeys,s),--t,r.dispose(),--this.soundBufferCount}}}progressiveDecodeBuffer(e,t,s){let r=t.getData(),n=Math.ceil(Vl.STREAM_BUFFER_SAMPLE_COUNT/Vl.BUFFER_STREAM_SPLIT);e.streamStart==s&&e.streamSound==t||(e.streamSound=t,e.streamStart=s,e.streamPos=s);let i=s+Vl.STREAM_BUFFER_SAMPLE_COUNT;if(e.streamPos==i)return!0;let a=r.getBytesPerSample(),l=Vl.STREAM_BUFFER_SAMPLE_COUNT*a;(null==e.streamBuffer||e.streamBuffer.length<l)&&(e.streamBuffer=new da(new ArrayBuffer(l)),e.streamPos=s);let h=i-e.streamPos;return h>n&&(h=n),r.decode(e.streamBuffer,(e.streamPos-s)*a,e.streamPos,h),e.streamPos+=h,e.streamPos==i}queueBuffer(e,t,s){let r=t.getData(),n=e.channel.soundGroup,i=null;if(r.get_duration()<=Vl.STREAM_DURATION)i=this.getSoundBuffer(t,n),this.driver.queueBuffer(e.handle,i.handle,s,!0);else{if(e.buffers.length>0&&Vl.BUFFER_STREAM_SPLIT>1&&!this.progressiveDecodeBuffer(e,t,s))return!1;i=this.getStreamBuffer(e,t,n,s),this.driver.queueBuffer(e.handle,i.handle,0,i.isEnd)}return e.buffers.push(i),!0}unqueueBuffer(e){let t=e.buffers.shift();return null==t?null:(this.driver.unqueueBuffer(e.handle,t.handle),t.isStream?this.freeStreamBuffers.unshift(t):0==--t.refs&&(t.lastStop=c.now()/1e3),t)}bindEffect(e,t,s){0!=s.refs||c.remove(this.effectGC,s)||s.driver.acquire(),++s.refs,s.driver.bind(s,t.handle),e.bindedEffects.push(s)}unbindEffect(e,t,s){s.driver.unbind(s,t.handle),c.remove(e.bindedEffects,s),0==--s.refs&&(s.lastStamp=this.now,this.effectGC.push(s))}releaseSource(e){if(null!=e.channel){let t=0,s=e.channel.bindedEffects.slice();for(;t<s.length;){let r=s[t];++t,this.unbindEffect(e.channel,e,r)}e.channel.bindedEffects=[],e.channel.source=null,e.channel=null}for(e.playing&&(e.playing=!1,this.driver.stopSource(e.handle),e.volume=-1);e.buffers.length>0;)this.unqueueBuffer(e)}checkTargetFormat(e,t){let s;switch(null==t&&(t=!1),this.targetRate=e.samplingRate,this.targetChannels=t||1==e.channels?1:2,e.sampleFormat._hx_index){case 0:s=vl.UI8;break;case 1:s=vl.I16;break;case 2:s=vl.F32}return this.targetFormat=s,this.targetChannels==e.channels&&this.targetFormat==e.sampleFormat&&this.targetRate==e.samplingRate}getSoundBuffer(e,t){let s=this,r=e.getData(),n=t.mono,i=e.entry.get_path();n&&1!=r.channels&&(i+="mono");let a=this.soundBufferMap.h[i];return null==a&&(a=new Rl(this.driver),a.isStream=!1,a.isEnd=!0,a.sound=e,r.load((function(){s.fillSoundBuffer(a,r,n)})),this.soundBufferMap.h[i]=a,this.soundBufferKeys.push(i),++this.soundBufferCount),++a.refs,a}fillSoundBuffer(e,t,s){null==s&&(s=!1),this.checkTargetFormat(t,s)||(t=t.resample(this.targetRate,this.targetFormat,this.targetChannels));let r=t.samples*t.getBytesPerSample(),n=this.getTmpBytes(r);t.decode(n,0,0,t.samples),this.driver.setBufferData(e.handle,n,r,this.targetFormat,this.targetChannels,this.targetRate),e.sampleRate=this.targetRate,e.samples=t.samples}getStreamBuffer(e,t,s,r){let n=t.getData(),i=this.freeStreamBuffers.shift();null==i&&(i=new Rl(this.driver),i.isStream=!0);let a=Vl.STREAM_BUFFER_SAMPLE_COUNT;r+a>=n.samples?(a=n.samples-r,i.isEnd=!0):i.isEnd=!1,i.sound=t,i.samples=a,i.start=r;let l,h=a*n.getBytesPerSample();if(e.streamSound==t&&e.streamStart==r){for(;!this.progressiveDecodeBuffer(e,t,r););l=e.streamBuffer}else l=this.getTmpBytes(h),n.decode(l,0,r,a);if(!this.checkTargetFormat(n,s.mono)){let e,t=Math.ceil(a*(this.targetRate/n.samplingRate))*this.targetChannels;switch(this.targetFormat._hx_index){case 0:e=1;break;case 1:e=2;break;case 2:e=4}h=t*e;let s=this.getResampleBytes(h);n.resampleBuffer(s,0,l,0,this.targetRate,this.targetFormat,this.targetChannels,a),l=s}return this.driver.setBufferData(i.handle,l,h,this.targetFormat,this.targetChannels,this.targetRate),i.sampleRate=this.targetRate,i}sortChannel(e,t){return e.isVirtual!=t.isVirtual?e.isVirtual?1:-1:e.channelGroup.priority!=t.channelGroup.priority?e.channelGroup.priority<t.channelGroup.priority?1:-1:e.priority!=t.priority?e.priority<t.priority?1:-1:e.audibleVolume!=t.audibleVolume?e.audibleVolume<t.audibleVolume?1:-1:e.id<t.id?1:-1}sortEffect(e,t){return t.priority-e.priority}releaseChannel(e){if(null==e.manager)return;if(this.channels==e)this.channels=e.next;else{let t=this.channels;for(;t.next!=e;)t=t.next;t.next=e.next}let t=0,s=e.effects;for(;t<s.length;){let r=s[t];++t,e.removeEffect(r)}null!=e.source&&this.releaseSource(e.source),e.next=null,e.manager=null,e.effects=null,e.bindedEffects=null,e.currentFade=null;let r=e.sound;null!=r&&r.channel==e&&(r.channel=null)}static get(){return null==Vl.instance&&(Vl.instance=new Vl,Vl.instance.updateEvent=na.add(ao(t=Vl.instance,t.update)),Vl.instance.updateEvent.isBlocking=!1),Vl.instance}static regEffect(e,t){let s=e;for(;null!=s;){if(s==t)return e;s=s.next}return t.next=e,t}}s["hxd.snd.Manager"]=Vl,Vl.__name__="hxd.snd.Manager",Object.assign(Vl.prototype,{__class__:Vl});class Ol extends Sl{constructor(e){super();let t=new nr(new Ta(e)).read();this.samples=t.sampleCount;let s=t.frames[0].data,r=-1,n=0,i=s.length-24;for(;n<i;){let e=n++;if(76==s.b[e]&&65==s.b[e+1]&&77==s.b[e+2]&&69==s.b[e+3]){r=e;break}}if(r>=0){let e=s.b[r+21]<<16|s.b[r+22]<<8|s.b[r+23],t=e>>12,n=4095&e;this.samples-=t+n+1152}let a=t.frames[0].header;this.sampleFormat=vl.F32,this.samplingRate=Hs.srEnum2Num(a.samplingRate),this.channels=a.channelMode==tr.Mono?1:2;let l=jl.get();if(null==l)return;l.decodeAudioData(e.b.bufferValue,ao(this,this.processBuffer));let h=0|l.sampleRate;this.samples=Math.ceil(this.samples*h/this.samplingRate),this.samplingRate=h}isLoading(){return null==this.buffer}load(e){null!=this.buffer?e():this.onEnd=e}processBuffer(e){let t=e.getChannelData(0);if(this.samples=e.length,1==this.channels)return void(this.buffer=da.ofData(t.buffer));let s=e.numberOfChannels<2?t:e.getChannelData(1),r=new Float32Array(2*t.length),n=0,i=0,a=e.length;for(;i<a;){let e=i++;r[n++]=t[e],r[n++]=s[e]}this.buffer=da.ofData(r.buffer),null!=this.onEnd&&(this.onEnd(),this.onEnd=null)}decodeBuffer(e,t,s,r){null==this.buffer?e.fill(t,4*r*this.channels,0):e.blit(t,this.buffer,4*s*this.channels,4*r*this.channels)}}s["hxd.snd.Mp3Data"]=Ol,Ol.__name__="hxd.snd.Mp3Data",Ol.__super__=Sl,Object.assign(Ol.prototype,{__class__:Ol});class Pl{constructor(e){this.name=e,this.maxAudible=-1,this.volume=1,this.mono=!1}}s["hxd.snd.SoundGroup"]=Pl,Pl.__name__="hxd.snd.SoundGroup",Object.assign(Pl.prototype,{__class__:Pl});class Ql extends Sl{constructor(e){super(),null!=e&&this.init(new xr(new Ta(e)).read())}init(e){let t,s=e.header;switch(this.samplingRate=s.samplingRate,this.channels=s.channels,s.bitsPerSample){case 8:t=vl.UI8;break;case 16:t=vl.I16;break;default:throw $i.thrown("Unsupported WAV "+s.bitsPerSample+" bits")}this.sampleFormat=t,this.rawData=e.data,this.samples=this.rawData.length/this.getBytesPerSample()|0}decodeBuffer(e,t,s,r){let n=this.getBytesPerSample();e.blit(t,this.rawData,s*n,r*n)}}s["hxd.snd.WavData"]=Ql,Ql.__name__="hxd.snd.WavData",Ql.__super__=Sl,Object.assign(Ql.prototype,{__class__:Ql});class Ll extends Fl{constructor(){super("lowpass"),this.priority=100,this.gainHF=1}}s["hxd.snd.effect.LowPass"]=Ll,Ll.__name__="hxd.snd.effect.LowPass",Ll.__super__=Fl,Object.assign(Ll.prototype,{__class__:Ll});class Gl extends Fl{constructor(e){null==e&&(e=1),super("pitch"),this.value=e}}s["hxd.snd.effect.Pitch"]=Gl,Gl.__name__="hxd.snd.effect.Pitch",Gl.__super__=Fl,Object.assign(Gl.prototype,{__class__:Gl});class zl extends Fl{constructor(){super("spatialization"),this.position=new Xr,this.velocity=new Xr,this.direction=new Xr,this.referenceDistance=1,this.rollOffFactor=1}getVolumeModifier(){if(null==this.fadeDistance)return 1;let e=Vl.get().listener.position,t=this.position,s=t.x-e.x,r=t.y-e.y,n=t.z-e.z,i=Math.sqrt(s*s+r*r+n*n);null!=this.maxDistance?i-=this.maxDistance:i-=this.referenceDistance;let a=1-i/this.fadeDistance;return a>1&&(a=1),a<0&&(a=0),a}applyAudibleVolumeModifier(e){let t=Vl.get().listener.position,s=this.position,r=s.x-t.x,n=s.y-t.y,i=s.z-t.z,a=Math.sqrt(r*r+n*n+i*i),l=this.referenceDistance;if(a<l&&(a=l),null!=this.maxDistance){let e=this.maxDistance;a>e&&(a=e)}return e*(this.referenceDistance/(this.referenceDistance+this.rollOffFactor*(a-this.referenceDistance)))}}s["hxd.snd.effect.Spatialization"]=zl,zl.__name__="hxd.snd.effect.Spatialization",zl.__super__=Fl,Object.assign(zl.prototype,{__class__:zl});class Ul{constructor(){}}s["hxd.snd.webaudio.BufferHandle"]=Ul,Ul.__name__="hxd.snd.webaudio.BufferHandle",Object.assign(Ul.prototype,{__class__:Ul});class Wl{constructor(){this.buffers=[],this.sampleOffset=0,this.pitch=1,this.firstPlay=!0}updateDestination(){this.destination=this.gain,null!=this.lowPass&&(this.lowPass.connect(this.destination),this.destination=this.lowPass),null!=this.panner&&(this.panner.connect(this.destination),this.destination=this.panner),this.gain.connect(jl.destination);let e=0,t=this.buffers;for(;e<t.length;){let s=t[e];++e,null!=s.node&&s.restart(this)}}applyPitch(){let e=0,t=0,s=this.buffers;for(;t<s.length;){let r=s[t];++t,e=r.readjust(e,this)}}}s["hxd.snd.webaudio.SourceHandle"]=Wl,Wl.__name__="hxd.snd.webaudio.SourceHandle",Object.assign(Wl.prototype,{__class__:Wl});class Nl{constructor(){}get_currentSample(){return this.consumed?this.buffer.samples:null==this.node||!this.dirty||this.node.context.currentTime<this.lastTime?0:(this.lastSamples+=Math.floor((this.node.context.currentTime-this.lastTime)*this.buffer.inst.sampleRate*this.node.playbackRate.value),this.lastTime=this.node.context.currentTime,this.lastSamples)}set(e,t){this.buffer=e,this.offset=isNaN(t)?0:t,this.dirty=!1,this.consumed=!1,this.starts=0,this.ends=0}start(e,t,s){if(this.dirty=!0,this.consumed=!1,null!=this.node&&this.stop(),t.firstPlay&&this.buffer.samples>10){t.firstPlay=!1;let e=[],s=0,r=this.buffer.inst.numberOfChannels;for(;s<r;){let t=s++;e.push(this.buffer.inst.getChannelData(t))}let n=e,i=0,a=0;for(;i<10;){let e=0;for(;e<n.length;)n[e][i]*=a,++e;++i,a+=.1,a>1&&(a=1)}}return this.node=e.createBufferSource(),this.node.buffer=this.buffer.inst,this.node.addEventListener("ended",ao(this,this.onBufferConsumed)),this.node.connect(t.destination),this.node.playbackRate.value=t.pitch,this.node.start(s,this.offset),this.lastSamples=0,this.lastTime=s,this.starts=s,this.ends=s+(this.buffer.inst.duration-this.offset)/t.pitch}readjust(e,t){if(this.consumed||null==this.node)return this.ends;let s=t.driver.ctx,r=s.currentTime;this.node.playbackRate.setValueAtTime(t.pitch,r);let n=r-this.starts;return n<0?this.start(s,t,0==e?r:e):(this.starts=r-n/t.pitch,this.ends=this.starts+(this.buffer.inst.duration-this.offset)/t.pitch)}restart(e){if(this.consumed||null==this.node)return;let t=jl.get();t.currentTime>this.starts?(this.offset+=(t.currentTime-this.starts)*e.pitch,this.start(t,e,t.currentTime)):this.start(t,e,this.starts)}stop(e){null==e&&(e=!0),null!=this.node&&(this.node.removeEventListener("ended",ao(this,this.onBufferConsumed)),e?this.node.disconnect():this.node.stop(),this.node=null)}onBufferConsumed(e){this.node.removeEventListener("ended",ao(this,this.onBufferConsumed)),this.node.disconnect(),this.node=null,this.consumed=!0}clear(){this.buffer=null,this.node=null}}s["hxd.snd.webaudio.BufferPlayback"]=Nl,Nl.__name__="hxd.snd.webaudio.BufferPlayback",Object.assign(Nl.prototype,{__class__:Nl});class jl{static get(){if(null==jl.ctx){try{jl.ctx=new AudioContext}catch(e){try{jl.ctx=new window.webkitAudioContext}catch(e){jl.ctx=null}}if(null==jl.ctx)throw $i.thrown("WebAudio API not available in this browser!");"suspended"==jl.ctx.state&&jl.waitForPageInput(),jl.ctx.addEventListener("statechange",(function(e){"suspended"==jl.ctx.state&&jl.waitForPageInput()})),jl.bufferPool=[],jl.gainPool=[],jl.masterGain=jl.ctx.createGain(),jl.masterGain.connect(jl.ctx.destination),jl.destination=jl.masterGain}return jl.ctx}static waitForPageInput(){jl.suspended||(window.document.addEventListener("click",jl.resumeContext),window.document.addEventListener("keydown",jl.resumeContext),window.document.body.addEventListener("keydown",jl.resumeContext),window.document.body.addEventListener("touchend",jl.resumeContext),jl.suspended=!0)}static resumeContext(e){jl.suspended&&(null!=jl.ctx&&jl.ctx.resume(),window.document.removeEventListener("click",jl.resumeContext),window.document.removeEventListener("keydown",jl.resumeContext),window.document.body.removeEventListener("keydown",jl.resumeContext),window.document.body.removeEventListener("touchend",jl.resumeContext),jl.suspended=!1)}static getBuffer(e,t,s){let r=0,n=jl.bufferPool;for(;r<n.length;){let i=n[r];if(++r,i.channels==e&&i.samples==t&&i.rate==s)return 0!=i.pool.length?i.pool.pop():jl.ctx.createBuffer(e,t,s)}let i=new Yl(e,t,s);return jl.bufferPool.push(i),jl.ctx.createBuffer(e,t,s)}static putBuffer(e){let t=0|e.sampleRate,s=0,r=jl.bufferPool;for(;s<r.length;){let n=r[s];if(++s,n.channels==e.numberOfChannels&&n.samples==e.length&&n.rate==t){n.pool.push(e);break}}}}s["hxd.snd.webaudio.Context"]=jl,jl.__name__="hxd.snd.webaudio.Context";class Yl{constructor(e,t,s){this.pool=[],this.channels=e,this.samples=t,this.rate=s}}s["hxd.snd.webaudio._Context.BufferPool"]=Yl,Yl.__name__="hxd.snd.webaudio._Context.BufferPool",Object.assign(Yl.prototype,{__class__:Yl});class Xl{constructor(){this.playbackPool=[],this.ctx=jl.get()}hasFeature(e){return!0}setMasterVolume(e){jl.masterGain.gain.value=e}setListenerParams(e,t,s,r){this.ctx.listener.setPosition(-e.x,e.y,e.z),this.ctx.listener.setOrientation(-t.x,t.y,t.z,-s.x,s.y,s.z)}createSource(){let e=new Wl;return e.driver=this,e.gain=0!=jl.gainPool.length?jl.gainPool.pop():jl.ctx.createGain(),e.updateDestination(),e}playSource(e){if(!e.playing&&(e.playing=!0,0!=e.buffers.length)){let t=this.ctx.currentTime,s=0,r=e.buffers;for(;s<r.length;){let n=r[s];++s,n.consumed||(t=n.start(this.ctx,e,t))}}}stopSource(e){e.playing=!1,e.sampleOffset=0}setSourceVolume(e,t){e.gain.gain.value=t}destroySource(e){this.stopSource(e),e.gain.disconnect(),e.driver=null;let t=e.gain;jl.gainPool.push(t),t.gain.value=1,e.gain=null;let s=0,r=e.buffers;for(;s<r.length;){let e=r[s];++s,e.stop(),e.clear(),this.playbackPool.push(e)}e.buffers=[]}createBuffer(){let e=new Ul;return e.samples=0,e}setBufferData(e,t,s,r,n,i){let a;switch(r._hx_index){case 0:a=1;break;case 1:a=2;break;case 2:a=4}let l=s/a/n|0;if(e.samples=l,0!=l)switch(null==e.inst?e.inst=jl.getBuffer(n,l,i):e.inst.sampleRate==i&&e.inst.numberOfChannels==n&&e.inst.length==l||(jl.putBuffer(e.inst),e.inst=jl.getBuffer(n,l,i)),r._hx_index){case 0:let s=new Uint8Array(t.b.bufferValue);if(1==n){let t=e.inst.getChannelData(0),r=0,n=l;for(;r<n;){let e=r++;t[e]=s[e]/255}}else{let t=e.inst.getChannelData(0),r=e.inst.getChannelData(1),i=0,a=0,h=l;for(;a<h;){let e=a++;t[e]=s[i]/255,r[e]=s[i+1]/255,i+=n}}break;case 1:let r=new Int16Array(t.b.bufferValue);if(1==n){let t=e.inst.getChannelData(0),s=0,n=l;for(;s<n;){let e=s++;t[e]=r[e]/32768}}else{let t=e.inst.getChannelData(0),s=e.inst.getChannelData(1),i=0,a=0,h=l;for(;a<h;){let e=a++;t[e]=r[i]/32768,s[e]=r[i+1]/32768,i+=n}}break;case 2:let i=new Float32Array(t.b.bufferValue);if(1==n){let t=e.inst.getChannelData(0),s=0,r=l;for(;s<r;){let e=s++;t[e]=i[e]}}else{let t=e.inst.getChannelData(0),s=e.inst.getChannelData(1),r=0,a=0,h=l;for(;a<h;){let e=a++;t[e]=i[r],s[e]=i[r+1],r+=n}}}}destroyBuffer(e){null!=e.inst&&jl.putBuffer(e.inst),e.inst=null}queueBuffer(e,t,s,r){let n=0!=this.playbackPool.length?this.playbackPool.pop():new Nl;if(null!=t.inst&&(n.set(t,s/t.inst.length*t.inst.duration),t.isEnd=r,e.buffers.push(n),e.playing))if(1!=e.buffers.length){let t,s=e.buffers[e.buffers.length-2].ends,r=this.ctx;if(isFinite(s)){let e=this.ctx.currentTime;t=s<e?e:s}else t=this.ctx.currentTime;n.start(r,e,t)}else n.start(this.ctx,e,this.ctx.currentTime)}unqueueBuffer(e,t){for(;0<e.buffers.length;){let s=e.buffers[0];if(s.buffer==t){e.buffers.splice(0,1),s.stop(!t.isEnd),s.clear(),this.playbackPool.push(s);break}}t.isEnd||!e.playing?e.sampleOffset=0:e.sampleOffset+=t.samples}getProcessedBuffers(e){let t=0,s=0,r=e.buffers;for(;s<r.length;){let e=r[s];++s,e.consumed&&++t}return t}getPlayedSampleCount(e){let t=0,s=null,r=0,n=e.buffers;for(;r<n.length;){let e=n[r];if(++r,e.consumed)t+=e.buffer.samples;else if(e.dirty){s=e;break}}return null!=s?e.sampleOffset+t+s.get_currentSample():e.sampleOffset+t}update(){}dispose(){}getEffectDriver(e){switch(e){case"lowpass":return new Zl;case"pitch":return new Hl;case"spatialization":return new Kl;default:return new Ml}}}s["hxd.snd.webaudio.Driver"]=Xl,Xl.__name__="hxd.snd.webaudio.Driver",Xl.__interfaces__=[Tl],Object.assign(Xl.prototype,{__class__:Xl});class Zl extends Ml{constructor(){Ml._hx_skip_constructor=!0,super(),Ml._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.pool=[],super._hx_constructor()}get(e){if(0!=this.pool.length)return this.pool.pop();let t=e.createBiquadFilter();return t.type="lowpass",t}bind(e,t){t.lowPass=this.get(t.driver.ctx),t.updateDestination(),this.apply(e,t)}apply(e,t){let s=t.driver.ctx.sampleRate/2,r=Math.log(s/40)/Math.LN2;t.lowPass.frequency.value=s*Math.pow(2,r*(e.gainHF-1))}unbind(e,t){this.pool.push(t.lowPass),t.lowPass.disconnect(),t.lowPass=null,null!=t.driver&&t.updateDestination()}}s["hxd.snd.webaudio.LowPassDriver"]=Zl,Zl.__name__="hxd.snd.webaudio.LowPassDriver",Zl.__super__=Ml,Object.assign(Zl.prototype,{__class__:Zl});class Hl extends Ml{constructor(){super()}apply(e,t){t.pitch!=e.value&&(t.pitch=e.value,t.applyPitch())}unbind(e,t){t.pitch=1,t.applyPitch()}}s["hxd.snd.webaudio.PitchDriver"]=Hl,Hl.__name__="hxd.snd.webaudio.PitchDriver",Hl.__super__=Ml,Object.assign(Hl.prototype,{__class__:Hl});class Kl extends Ml{constructor(){Ml._hx_skip_constructor=!0,super(),Ml._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.pool=[],super._hx_constructor()}get(e){if(0!=this.pool.length)return this.pool.pop();return e.createPanner()}bind(e,t){t.panner=this.get(t.driver.ctx),t.updateDestination(),this.apply(e,t)}apply(e,t){t.panner.setPosition(-e.position.x,e.position.y,e.position.z),t.panner.setOrientation(-e.direction.x,e.direction.y,e.direction.z),t.panner.rolloffFactor=e.rollOffFactor,t.panner.refDistance=e.referenceDistance;let s=null==e.maxDistance?340282347e30:e.maxDistance;t.panner.maxDistance=s}unbind(e,t){this.pool.push(t.panner),t.panner.disconnect(),t.panner=null,null!=t.driver&&t.updateDestination()}}s["hxd.snd.webaudio.SpatializationDriver"]=Kl,Kl.__name__="hxd.snd.webaudio.SpatializationDriver",Kl.__super__=Ml,Object.assign(Kl.prototype,{__class__:Kl});var ql=n["hxsl.Type"]={__ename__:"hxsl.Type",__constructs__:["TVoid","TInt","TBool","TFloat","TString","TVec","TMat3","TMat4","TMat3x4","TBytes","TSampler2D","TSampler2DArray","TSamplerCube","TStruct","TFun","TArray","TBuffer","TChannel"],TVoid:{_hx_index:0,__enum__:"hxsl.Type",toString:r},TInt:{_hx_index:1,__enum__:"hxsl.Type",toString:r},TBool:{_hx_index:2,__enum__:"hxsl.Type",toString:r},TFloat:{_hx_index:3,__enum__:"hxsl.Type",toString:r},TString:{_hx_index:4,__enum__:"hxsl.Type",toString:r},TVec:(t=function(e,t){return{_hx_index:5,size:e,t,__enum__:"hxsl.Type",toString:r}},t.__params__=["size","t"],t),TMat3:{_hx_index:6,__enum__:"hxsl.Type",toString:r},TMat4:{_hx_index:7,__enum__:"hxsl.Type",toString:r},TMat3x4:{_hx_index:8,__enum__:"hxsl.Type",toString:r},TBytes:(t=function(e){return{_hx_index:9,size:e,__enum__:"hxsl.Type",toString:r}},t.__params__=["size"],t),TSampler2D:{_hx_index:10,__enum__:"hxsl.Type",toString:r},TSampler2DArray:{_hx_index:11,__enum__:"hxsl.Type",toString:r},TSamplerCube:{_hx_index:12,__enum__:"hxsl.Type",toString:r},TStruct:(t=function(e){return{_hx_index:13,vl:e,__enum__:"hxsl.Type",toString:r}},t.__params__=["vl"],t),TFun:(t=function(e){return{_hx_index:14,variants:e,__enum__:"hxsl.Type",toString:r}},t.__params__=["variants"],t),TArray:(t=function(e,t){return{_hx_index:15,t:e,size:t,__enum__:"hxsl.Type",toString:r}},t.__params__=["t","size"],t),TBuffer:(t=function(e,t){return{_hx_index:16,t:e,size:t,__enum__:"hxsl.Type",toString:r}},t.__params__=["t","size"],t),TChannel:(t=function(e){return{_hx_index:17,size:e,__enum__:"hxsl.Type",toString:r}},t.__params__=["size"],t)};ql.__empty_constructs__=[ql.TVoid,ql.TInt,ql.TBool,ql.TFloat,ql.TString,ql.TMat3,ql.TMat4,ql.TMat3x4,ql.TSampler2D,ql.TSampler2DArray,ql.TSamplerCube];var Jl=n["hxsl.VecType"]={__ename__:"hxsl.VecType",__constructs__:["VInt","VFloat","VBool"],VInt:{_hx_index:0,__enum__:"hxsl.VecType",toString:r},VFloat:{_hx_index:1,__enum__:"hxsl.VecType",toString:r},VBool:{_hx_index:2,__enum__:"hxsl.VecType",toString:r}};Jl.__empty_constructs__=[Jl.VInt,Jl.VFloat,Jl.VBool];var $l=n["hxsl.SizeDecl"]={__ename__:"hxsl.SizeDecl",__constructs__:["SConst","SVar"],SConst:(t=function(e){return{_hx_index:0,v:e,__enum__:"hxsl.SizeDecl",toString:r}},t.__params__=["v"],t),SVar:(t=function(e){return{_hx_index:1,v:e,__enum__:"hxsl.SizeDecl",toString:r}},t.__params__=["v"],t)};$l.__empty_constructs__=[];class eh{constructor(e,t){this.msg=e,this.pos=t}toString(){return"Error("+this.msg+")@"+x.string(this.pos)}static t(e,t){throw $i.thrown(new eh(e,t))}}s["hxsl.Error"]=eh,eh.__name__="hxsl.Error",Object.assign(eh.prototype,{__class__:eh});var th=n["hxsl.VarKind"]={__ename__:"hxsl.VarKind",__constructs__:["Global","Input","Param","Var","Local","Output","Function"],Global:{_hx_index:0,__enum__:"hxsl.VarKind",toString:r},Input:{_hx_index:1,__enum__:"hxsl.VarKind",toString:r},Param:{_hx_index:2,__enum__:"hxsl.VarKind",toString:r},Var:{_hx_index:3,__enum__:"hxsl.VarKind",toString:r},Local:{_hx_index:4,__enum__:"hxsl.VarKind",toString:r},Output:{_hx_index:5,__enum__:"hxsl.VarKind",toString:r},Function:{_hx_index:6,__enum__:"hxsl.VarKind",toString:r}};th.__empty_constructs__=[th.Global,th.Input,th.Param,th.Var,th.Local,th.Output,th.Function];var sh=n["hxsl.VarQualifier"]={__ename__:"hxsl.VarQualifier",__constructs__:["Const","Private","Nullable","PerObject","Name","Shared","Precision","Range","Ignore","PerInstance"],Const:(t=function(e){return{_hx_index:0,max:e,__enum__:"hxsl.VarQualifier",toString:r}},t.__params__=["max"],t),Private:{_hx_index:1,__enum__:"hxsl.VarQualifier",toString:r},Nullable:{_hx_index:2,__enum__:"hxsl.VarQualifier",toString:r},PerObject:{_hx_index:3,__enum__:"hxsl.VarQualifier",toString:r},Name:(t=function(e){return{_hx_index:4,n:e,__enum__:"hxsl.VarQualifier",toString:r}},t.__params__=["n"],t),Shared:{_hx_index:5,__enum__:"hxsl.VarQualifier",toString:r},Precision:(t=function(e){return{_hx_index:6,p:e,__enum__:"hxsl.VarQualifier",toString:r}},t.__params__=["p"],t),Range:(t=function(e,t){return{_hx_index:7,min:e,max:t,__enum__:"hxsl.VarQualifier",toString:r}},t.__params__=["min","max"],t),Ignore:{_hx_index:8,__enum__:"hxsl.VarQualifier",toString:r},PerInstance:(t=function(e){return{_hx_index:9,v:e,__enum__:"hxsl.VarQualifier",toString:r}},t.__params__=["v"],t)};sh.__empty_constructs__=[sh.Private,sh.Nullable,sh.PerObject,sh.Shared,sh.Ignore];var rh=n["hxsl.Prec"]={__ename__:"hxsl.Prec",__constructs__:["Low","Medium","High"],Low:{_hx_index:0,__enum__:"hxsl.Prec",toString:r},Medium:{_hx_index:1,__enum__:"hxsl.Prec",toString:r},High:{_hx_index:2,__enum__:"hxsl.Prec",toString:r}};rh.__empty_constructs__=[rh.Low,rh.Medium,rh.High];var nh=n["hxsl.Const"]={__ename__:"hxsl.Const",__constructs__:["CNull","CBool","CInt","CFloat","CString"],CNull:{_hx_index:0,__enum__:"hxsl.Const",toString:r},CBool:(t=function(e){return{_hx_index:1,b:e,__enum__:"hxsl.Const",toString:r}},t.__params__=["b"],t),CInt:(t=function(e){return{_hx_index:2,v:e,__enum__:"hxsl.Const",toString:r}},t.__params__=["v"],t),CFloat:(t=function(e){return{_hx_index:3,v:e,__enum__:"hxsl.Const",toString:r}},t.__params__=["v"],t),CString:(t=function(e){return{_hx_index:4,v:e,__enum__:"hxsl.Const",toString:r}},t.__params__=["v"],t)};nh.__empty_constructs__=[nh.CNull];var ih=n["hxsl.FunctionKind"]={__ename__:"hxsl.FunctionKind",__constructs__:["Vertex","Fragment","Init","Helper"],Vertex:{_hx_index:0,__enum__:"hxsl.FunctionKind",toString:r},Fragment:{_hx_index:1,__enum__:"hxsl.FunctionKind",toString:r},Init:{_hx_index:2,__enum__:"hxsl.FunctionKind",toString:r},Helper:{_hx_index:3,__enum__:"hxsl.FunctionKind",toString:r}};ih.__empty_constructs__=[ih.Vertex,ih.Fragment,ih.Init,ih.Helper];var ah=n["hxsl.TGlobal"]={__ename__:"hxsl.TGlobal",__constructs__:["Radians","Degrees","Sin","Cos","Tan","Asin","Acos","Atan","Pow","Exp","Log","Exp2","Log2","Sqrt","Inversesqrt","Abs","Sign","Floor","Ceil","Fract","Mod","Min","Max","Clamp","Mix","Step","Smoothstep","Length","Distance","Dot","Cross","Normalize","LReflect","Texture","TextureLod","Texel","TexelLod","ToInt","ToFloat","ToBool","Vec2","Vec3","Vec4","IVec2","IVec3","IVec4","BVec2","BVec3","BVec4","Mat2","Mat3","Mat4","Mat3x4","Saturate","Pack","Unpack","PackNormal","UnpackNormal","ScreenToUv","UvToScreen","DFdx","DFdy","Fwidth","ChannelRead","ChannelReadLod","ChannelFetch","ChannelFetchLod","Trace","VertexID","InstanceID","FragCoord"],Radians:{_hx_index:0,__enum__:"hxsl.TGlobal",toString:r},Degrees:{_hx_index:1,__enum__:"hxsl.TGlobal",toString:r},Sin:{_hx_index:2,__enum__:"hxsl.TGlobal",toString:r},Cos:{_hx_index:3,__enum__:"hxsl.TGlobal",toString:r},Tan:{_hx_index:4,__enum__:"hxsl.TGlobal",toString:r},Asin:{_hx_index:5,__enum__:"hxsl.TGlobal",toString:r},Acos:{_hx_index:6,__enum__:"hxsl.TGlobal",toString:r},Atan:{_hx_index:7,__enum__:"hxsl.TGlobal",toString:r},Pow:{_hx_index:8,__enum__:"hxsl.TGlobal",toString:r},Exp:{_hx_index:9,__enum__:"hxsl.TGlobal",toString:r},Log:{_hx_index:10,__enum__:"hxsl.TGlobal",toString:r},Exp2:{_hx_index:11,__enum__:"hxsl.TGlobal",toString:r},Log2:{_hx_index:12,__enum__:"hxsl.TGlobal",toString:r},Sqrt:{_hx_index:13,__enum__:"hxsl.TGlobal",toString:r},Inversesqrt:{_hx_index:14,__enum__:"hxsl.TGlobal",toString:r},Abs:{_hx_index:15,__enum__:"hxsl.TGlobal",toString:r},Sign:{_hx_index:16,__enum__:"hxsl.TGlobal",toString:r},Floor:{_hx_index:17,__enum__:"hxsl.TGlobal",toString:r},Ceil:{_hx_index:18,__enum__:"hxsl.TGlobal",toString:r},Fract:{_hx_index:19,__enum__:"hxsl.TGlobal",toString:r},Mod:{_hx_index:20,__enum__:"hxsl.TGlobal",toString:r},Min:{_hx_index:21,__enum__:"hxsl.TGlobal",toString:r},Max:{_hx_index:22,__enum__:"hxsl.TGlobal",toString:r},Clamp:{_hx_index:23,__enum__:"hxsl.TGlobal",toString:r},Mix:{_hx_index:24,__enum__:"hxsl.TGlobal",toString:r},Step:{_hx_index:25,__enum__:"hxsl.TGlobal",toString:r},Smoothstep:{_hx_index:26,__enum__:"hxsl.TGlobal",toString:r},Length:{_hx_index:27,__enum__:"hxsl.TGlobal",toString:r},Distance:{_hx_index:28,__enum__:"hxsl.TGlobal",toString:r},Dot:{_hx_index:29,__enum__:"hxsl.TGlobal",toString:r},Cross:{_hx_index:30,__enum__:"hxsl.TGlobal",toString:r},Normalize:{_hx_index:31,__enum__:"hxsl.TGlobal",toString:r},LReflect:{_hx_index:32,__enum__:"hxsl.TGlobal",toString:r},Texture:{_hx_index:33,__enum__:"hxsl.TGlobal",toString:r},TextureLod:{_hx_index:34,__enum__:"hxsl.TGlobal",toString:r},Texel:{_hx_index:35,__enum__:"hxsl.TGlobal",toString:r},TexelLod:{_hx_index:36,__enum__:"hxsl.TGlobal",toString:r},ToInt:{_hx_index:37,__enum__:"hxsl.TGlobal",toString:r},ToFloat:{_hx_index:38,__enum__:"hxsl.TGlobal",toString:r},ToBool:{_hx_index:39,__enum__:"hxsl.TGlobal",toString:r},Vec2:{_hx_index:40,__enum__:"hxsl.TGlobal",toString:r},Vec3:{_hx_index:41,__enum__:"hxsl.TGlobal",toString:r},Vec4:{_hx_index:42,__enum__:"hxsl.TGlobal",toString:r},IVec2:{_hx_index:43,__enum__:"hxsl.TGlobal",toString:r},IVec3:{_hx_index:44,__enum__:"hxsl.TGlobal",toString:r},IVec4:{_hx_index:45,__enum__:"hxsl.TGlobal",toString:r},BVec2:{_hx_index:46,__enum__:"hxsl.TGlobal",toString:r},BVec3:{_hx_index:47,__enum__:"hxsl.TGlobal",toString:r},BVec4:{_hx_index:48,__enum__:"hxsl.TGlobal",toString:r},Mat2:{_hx_index:49,__enum__:"hxsl.TGlobal",toString:r},Mat3:{_hx_index:50,__enum__:"hxsl.TGlobal",toString:r},Mat4:{_hx_index:51,__enum__:"hxsl.TGlobal",toString:r},Mat3x4:{_hx_index:52,__enum__:"hxsl.TGlobal",toString:r},Saturate:{_hx_index:53,__enum__:"hxsl.TGlobal",toString:r},Pack:{_hx_index:54,__enum__:"hxsl.TGlobal",toString:r},Unpack:{_hx_index:55,__enum__:"hxsl.TGlobal",toString:r},PackNormal:{_hx_index:56,__enum__:"hxsl.TGlobal",toString:r},UnpackNormal:{_hx_index:57,__enum__:"hxsl.TGlobal",toString:r},ScreenToUv:{_hx_index:58,__enum__:"hxsl.TGlobal",toString:r},UvToScreen:{_hx_index:59,__enum__:"hxsl.TGlobal",toString:r},DFdx:{_hx_index:60,__enum__:"hxsl.TGlobal",toString:r},DFdy:{_hx_index:61,__enum__:"hxsl.TGlobal",toString:r},Fwidth:{_hx_index:62,__enum__:"hxsl.TGlobal",toString:r},ChannelRead:{_hx_index:63,__enum__:"hxsl.TGlobal",toString:r},ChannelReadLod:{_hx_index:64,__enum__:"hxsl.TGlobal",toString:r},ChannelFetch:{_hx_index:65,__enum__:"hxsl.TGlobal",toString:r},ChannelFetchLod:{_hx_index:66,__enum__:"hxsl.TGlobal",toString:r},Trace:{_hx_index:67,__enum__:"hxsl.TGlobal",toString:r},VertexID:{_hx_index:68,__enum__:"hxsl.TGlobal",toString:r},InstanceID:{_hx_index:69,__enum__:"hxsl.TGlobal",toString:r},FragCoord:{_hx_index:70,__enum__:"hxsl.TGlobal",toString:r}};ah.__empty_constructs__=[ah.Radians,ah.Degrees,ah.Sin,ah.Cos,ah.Tan,ah.Asin,ah.Acos,ah.Atan,ah.Pow,ah.Exp,ah.Log,ah.Exp2,ah.Log2,ah.Sqrt,ah.Inversesqrt,ah.Abs,ah.Sign,ah.Floor,ah.Ceil,ah.Fract,ah.Mod,ah.Min,ah.Max,ah.Clamp,ah.Mix,ah.Step,ah.Smoothstep,ah.Length,ah.Distance,ah.Dot,ah.Cross,ah.Normalize,ah.LReflect,ah.Texture,ah.TextureLod,ah.Texel,ah.TexelLod,ah.ToInt,ah.ToFloat,ah.ToBool,ah.Vec2,ah.Vec3,ah.Vec4,ah.IVec2,ah.IVec3,ah.IVec4,ah.BVec2,ah.BVec3,ah.BVec4,ah.Mat2,ah.Mat3,ah.Mat4,ah.Mat3x4,ah.Saturate,ah.Pack,ah.Unpack,ah.PackNormal,ah.UnpackNormal,ah.ScreenToUv,ah.UvToScreen,ah.DFdx,ah.DFdy,ah.Fwidth,ah.ChannelRead,ah.ChannelReadLod,ah.ChannelFetch,ah.ChannelFetchLod,ah.Trace,ah.VertexID,ah.InstanceID,ah.FragCoord];var lh=n["hxsl.Component"]={__ename__:"hxsl.Component",__constructs__:["X","Y","Z","W"],X:{_hx_index:0,__enum__:"hxsl.Component",toString:r},Y:{_hx_index:1,__enum__:"hxsl.Component",toString:r},Z:{_hx_index:2,__enum__:"hxsl.Component",toString:r},W:{_hx_index:3,__enum__:"hxsl.Component",toString:r}};lh.__empty_constructs__=[lh.X,lh.Y,lh.Z,lh.W];var hh=n["hxsl.TExprDef"]={__ename__:"hxsl.TExprDef",__constructs__:["TConst","TVar","TGlobal","TParenthesis","TBlock","TBinop","TUnop","TVarDecl","TCall","TSwiz","TIf","TDiscard","TReturn","TFor","TContinue","TBreak","TArray","TArrayDecl","TSwitch","TWhile","TMeta"],TConst:(t=function(e){return{_hx_index:0,c:e,__enum__:"hxsl.TExprDef",toString:r}},t.__params__=["c"],t),TVar:(t=function(e){return{_hx_index:1,v:e,__enum__:"hxsl.TExprDef",toString:r}},t.__params__=["v"],t),TGlobal:(t=function(e){return{_hx_index:2,g:e,__enum__:"hxsl.TExprDef",toString:r}},t.__params__=["g"],t),TParenthesis:(t=function(e){return{_hx_index:3,e,__enum__:"hxsl.TExprDef",toString:r}},t.__params__=["e"],t),TBlock:(t=function(e){return{_hx_index:4,el:e,__enum__:"hxsl.TExprDef",toString:r}},t.__params__=["el"],t),TBinop:(t=function(e,t,s){return{_hx_index:5,op:e,e1:t,e2:s,__enum__:"hxsl.TExprDef",toString:r}},t.__params__=["op","e1","e2"],t),TUnop:(t=function(e,t){return{_hx_index:6,op:e,e1:t,__enum__:"hxsl.TExprDef",toString:r}},t.__params__=["op","e1"],t),TVarDecl:(t=function(e,t){return{_hx_index:7,v:e,init:t,__enum__:"hxsl.TExprDef",toString:r}},t.__params__=["v","init"],t),TCall:(t=function(e,t){return{_hx_index:8,e,args:t,__enum__:"hxsl.TExprDef",toString:r}},t.__params__=["e","args"],t),TSwiz:(t=function(e,t){return{_hx_index:9,e,regs:t,__enum__:"hxsl.TExprDef",toString:r}},t.__params__=["e","regs"],t),TIf:(t=function(e,t,s){return{_hx_index:10,econd:e,eif:t,eelse:s,__enum__:"hxsl.TExprDef",toString:r}},t.__params__=["econd","eif","eelse"],t),TDiscard:{_hx_index:11,__enum__:"hxsl.TExprDef",toString:r},TReturn:(t=function(e){return{_hx_index:12,e,__enum__:"hxsl.TExprDef",toString:r}},t.__params__=["e"],t),TFor:(t=function(e,t,s){return{_hx_index:13,v:e,it:t,loop:s,__enum__:"hxsl.TExprDef",toString:r}},t.__params__=["v","it","loop"],t),TContinue:{_hx_index:14,__enum__:"hxsl.TExprDef",toString:r},TBreak:{_hx_index:15,__enum__:"hxsl.TExprDef",toString:r},TArray:(t=function(e,t){return{_hx_index:16,e,index:t,__enum__:"hxsl.TExprDef",toString:r}},t.__params__=["e","index"],t),TArrayDecl:(t=function(e){return{_hx_index:17,el:e,__enum__:"hxsl.TExprDef",toString:r}},t.__params__=["el"],t),TSwitch:(t=function(e,t,s){return{_hx_index:18,e,cases:t,def:s,__enum__:"hxsl.TExprDef",toString:r}},t.__params__=["e","cases","def"],t),TWhile:(t=function(e,t,s){return{_hx_index:19,e,loop:t,normalWhile:s,__enum__:"hxsl.TExprDef",toString:r}},t.__params__=["e","loop","normalWhile"],t),TMeta:(t=function(e,t,s){return{_hx_index:20,m:e,args:t,e:s,__enum__:"hxsl.TExprDef",toString:r}},t.__params__=["m","args","e"],t)};hh.__empty_constructs__=[hh.TDiscard,hh.TContinue,hh.TBreak];class oh{static allocVarId(){return++oh.UID}static getName(e){if(null==e.qualifiers)return e.name;let t=0,s=e.qualifiers;for(;t<s.length;){let e=s[t];if(++t,4==e._hx_index){return e.n}}return e.name}static getConstBits(e){let t=e.type;switch(t._hx_index){case 1:let s=0,r=e.qualifiers;for(;s<r.length;){let e=r[s];if(++s,0==e._hx_index){let t=e.max;if(null!=t){let e=0;for(;t>=1<<e;)++e;return e}return 8}}break;case 2:return 1;case 17:t.size;return 3+oh.MAX_CHANNELS_BITS}return 0}static isConst(e){let t,s=e.type;if(17==s._hx_index){s.size;t=!0}else t=!1;if(t)return!0;if(null!=e.qualifiers){let t=0,s=e.qualifiers;for(;t<s.length;){let e=s[t];if(++t,0==e._hx_index){e.max;return!0}}}return!1}static hasQualifier(e,t){if(null!=e.qualifiers){let s=0,r=e.qualifiers;for(;s<r.length;){let e=r[s];if(++s,e==t)return!0}}return!1}static isSampler(e){switch(e._hx_index){case 10:case 11:case 12:return!0;case 17:e.size;return!0;default:return!1}}static toString(e){switch(e._hx_index){case 5:let t,s=e.t,r=e.size;switch(s._hx_index){case 0:t="I";break;case 1:t="";break;case 2:t="B"}return t+"Vec"+r;case 9:return"Bytes"+e.size;case 13:let i=e.vl,a=[],l=0;for(;l<i.length;){let e=i[l];++l,a.push(e.name+" : "+oh.toString(e.type))}return"{"+a.join(",")+"}";case 15:let h,o=e.size,_=e.t,u=oh.toString(_)+"[";switch(o._hx_index){case 0:h=""+o.v;break;case 1:h=o.v.name}return u+h+"]";case 16:let d,p=e.size,f=e.t,x="buffer "+oh.toString(f)+"[";switch(p._hx_index){case 0:d=""+p.v;break;case 1:d=p.v.name}return x+d+"]";default:return c.substr(n[e.__enum__].__constructs__[e._hx_index],1,null)}}static hasSideEffect(e){let t=e.e;switch(t._hx_index){case 0:t.c;return!1;case 1:t.v;return!1;case 2:t.g;return!1;case 3:let e=t.e;return oh.hasSideEffect(e);case 4:let s=t.el,r=0;for(;r<s.length;){let e=s[r];if(++r,oh.hasSideEffect(e))return!0}return!1;case 5:let n=t.e2,i=t.e1,a=t.op;switch(a._hx_index){case 4:return!0;case 20:a.op;return!0;default:let e=n,t=i;return!!oh.hasSideEffect(t)||oh.hasSideEffect(e)}break;case 6:t.op;let l=t.e1;return oh.hasSideEffect(l);case 7:t.init,t.v;return!0;case 8:t.args,t.e;return!0;case 9:t.regs;let h=t.e;return oh.hasSideEffect(h);case 10:let o=t.eelse,_=t.eif,c=t.econd;return!(!oh.hasSideEffect(c)&&!oh.hasSideEffect(_))||null!=o&&oh.hasSideEffect(o);case 12:t.e;return!0;case 13:t.v;let u=t.loop,d=t.it;return!!oh.hasSideEffect(d)||oh.hasSideEffect(u);case 11:case 14:case 15:return!0;case 16:let p=t.index,f=t.e;return!!oh.hasSideEffect(f)||oh.hasSideEffect(p);case 17:let x=t.el,g=0;for(;g<x.length;){let e=x[g];if(++g,oh.hasSideEffect(e))return!0}return!1;case 18:let b=t.def,m=t.cases,A=t.e,w=0;for(;w<m.length;){let e=m[w];++w;let t=0,s=e.values;for(;t<s.length;){let e=s[t];if(++t,oh.hasSideEffect(e))return!0}if(oh.hasSideEffect(e.expr))return!0}return!!oh.hasSideEffect(A)||null!=b&&oh.hasSideEffect(b);case 19:t.normalWhile;let y=t.loop,k=t.e;return!!oh.hasSideEffect(k)||oh.hasSideEffect(y);case 20:t.args,t.m;let B=t.e;return oh.hasSideEffect(B)}}static iter(e,t){let s=e.e;switch(s._hx_index){case 0:s.c;break;case 1:s.v;break;case 2:s.g;break;case 3:t(s.e);break;case 4:let e=s.el,r=0;for(;r<e.length;){let s=e[r];++r,t(s)}break;case 5:s.op;let n=s.e2;t(s.e1),t(n);break;case 6:s.op;t(s.e1);break;case 7:s.v;let i=s.init;null!=i&&t(i);break;case 8:let a=s.args;t(s.e);let l=0;for(;l<a.length;){let e=a[l];++l,t(e)}break;case 9:s.regs;t(s.e);break;case 10:let h=s.eelse,o=s.eif;t(s.econd),t(o),null!=h&&t(h);break;case 12:let _=s.e;null!=_&&t(_);break;case 13:s.v;let c=s.loop;t(s.it),t(c);break;case 11:case 14:case 15:break;case 16:let u=s.index;t(s.e),t(u);break;case 17:let d=s.el,p=0;for(;p<d.length;){let e=d[p];++p,t(e)}break;case 18:let f=s.def,x=s.cases;t(s.e);let g=0;for(;g<x.length;){let e=x[g];++g;let s=0,r=e.values;for(;s<r.length;){let e=r[s];++s,t(e)}t(e.expr)}null!=f&&t(f);break;case 19:s.normalWhile;let b=s.loop;t(s.e),t(b);break;case 20:s.args,s.m;t(s.e)}}static map(e,t){let s,r=e.e;switch(r._hx_index){case 0:r.c;s=e.e;break;case 1:r.v;s=e.e;break;case 2:r.g;s=e.e;break;case 3:let n=r.e;s=hh.TParenthesis(t(n));break;case 4:let i=r.el,a=[],l=0;for(;l<i.length;){let e=i[l];++l,a.push(t(e))}s=hh.TBlock(a);break;case 5:let h=r.e2,o=r.e1,_=r.op;s=hh.TBinop(_,t(o),t(h));break;case 6:let c=r.e1,u=r.op;s=hh.TUnop(u,t(c));break;case 7:let d=r.init,p=r.v;s=hh.TVarDecl(p,null!=d?t(d):null);break;case 8:let f=r.args,x=t(r.e),g=[],b=0;for(;b<f.length;){let e=f[b];++b,g.push(t(e))}s=hh.TCall(x,g);break;case 9:let m=r.regs,A=r.e;s=hh.TSwiz(t(A),m);break;case 10:let w=r.eelse,y=r.eif,k=r.econd;s=hh.TIf(t(k),t(y),null!=w?t(w):null);break;case 12:let B=r.e;s=hh.TReturn(null!=B?t(B):null);break;case 13:let C=r.loop,v=r.it,S=r.v;s=hh.TFor(S,t(v),t(C));break;case 11:case 14:case 15:s=e.e;break;case 16:let M=r.index,I=r.e;s=hh.TArray(t(I),t(M));break;case 17:let T=r.el,F=[],E=0;for(;E<T.length;){let e=T[E];++E,F.push(t(e))}s=hh.TArrayDecl(F);break;case 18:let D=r.def,R=r.cases,V=t(r.e),O=[],P=0;for(;P<R.length;){let e=R[P];++P;let s=[],r=0,n=e.values;for(;r<n.length;){let e=n[r];++r,s.push(t(e))}O.push({values:s,expr:t(e.expr)})}s=hh.TSwitch(V,O,null==D?null:t(D));break;case 19:let Q=r.normalWhile,L=r.loop,G=r.e;s=hh.TWhile(t(G),t(L),Q);break;case 20:let z=r.e,U=r.args,W=r.m;s=hh.TMeta(W,U,t(z))}return{e:s,t:e.t,p:e.p}}static size(e){switch(e._hx_index){case 0:return 0;case 1:case 3:return 1;case 2:case 4:case 10:case 11:case 12:return 0;case 5:e.t;return e.size;case 6:return 9;case 7:return 16;case 8:return 12;case 9:return e.size;case 13:let t=e.vl,s=0,r=0;for(;r<t.length;){let e=t[r];++r,s+=oh.size(e.type)}return s;case 14:e.variants;return 0;case 15:let n=e.size,i=e.t;switch(n._hx_index){case 0:let e=i,t=n.v;return oh.size(e)*t;case 1:n.v;return 0}break;case 16:let a=e.size;if(0==a._hx_index){let t=e.t,s=a.v;return oh.size(t)*s}return 0;case 17:return e.size}}}s["hxsl.Tools"]=oh,oh.__name__="hxsl.Tools";class _h{static toString(e){let t=n[e.__enum__].__constructs__[e._hx_index];return t.charAt(0).toLowerCase()+c.substr(t,1,null)}}s["hxsl.Tools2"]=_h,_h.__name__="hxsl.Tools2";class ch extends Un{constructor(){Un._hx_skip_constructor=!0,super(),Un._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.Batch_Count__=0,super._hx_constructor()}updateConstants(e){this.constBits=0;let t=this.Batch_Count__;if(t>>>17!=0)throw $i.thrown("Batch_Count is out of range "+t+">131071");this.constBits|=t,this.updateConstantsFinal(e)}getParamValue(e){switch(e){case 0:return this.Batch_Count__;case 1:return this.Batch_Buffer__}return null}getParamFloatValue(e){return 0}}s["hxsl.BatchShader"]=ch,ch.__name__="hxsl.BatchShader",ch.__super__=Un,Object.assign(ch.prototype,{__class__:ch});class uh{constructor(){}}s["hxsl.SearchMap"]=uh,uh.__name__="hxsl.SearchMap",Object.assign(uh.prototype,{__class__:uh});class dh{constructor(){this.constsToGlobal=!1,this.linkCache=new uh,this.linkShaders=new va,this.batchShaders=new ya,this.byID=new va}getLinkShader(e){let t=[],s=0;for(;s<e.length;){let r=e[s];++s,t.push(x.string(r))}let r=t.join(","),n=this.linkShaders.h[r];if(null!=n)return n;let i=new Lh(""),a=c.substr(ga.encode(r),0,8);i.data={name:"shaderLinker_"+a,vars:[],funs:[]};let l=null,h=Object.create(null),o=0,_=ql.TVec(4,Jl.VFloat),u=function(e,t,s,r){let n=[],i=t,a=0,h=s.length;for(;a<h;){let e=a++,t=r(s[s.length-1-e],i-(s.length-1-e));i-=oh.size(t.t),n.unshift(t)}return{e:hh.TCall({e:hh.TGlobal(e),t:ql.TVoid,p:l},n),t:ql.TVec(t,Jl.VFloat),p:l}},d=function(e,t,s){let r=null==s?e:oh.getName(s)+"."+e,n=h[r];if(null!=n)return n;if(n={id:oh.allocVarId(),name:e,type:t,kind:th.Var,parent:s},null==s)i.data.vars.push(n);else{let e=s.type;if(13!=e._hx_index)throw $i.thrown("assert");e.vl.push(n)}return h[r]=n,n},p=null;p=function(e,t){switch(e._hx_index){case 0:let s=e.v;return{e:hh.TConst(nh.CFloat(s)),t:ql.TFloat,p:l};case 1:let r=e.size,n=e.v,i=h[n];if(null!=i)return{e:hh.TVar(i),t:i.type,p:l};let a=n.split("."),o=null;for(;a.length>1;)o=d(a.shift(),ql.TStruct([]),o);return null!=r&&(t=r),i=d(a.shift(),1==t?ql.TFloat:ql.TVec(t,Jl.VFloat),o),{e:hh.TVar(i),t:i.type,p:l};case 2:let c=e.v;return{e:hh.TCall({e:hh.TGlobal(ah.PackNormal),t:ql.TVoid,p:l},[p(c,3)]),t:_,p:l};case 3:let f=e.v;return{e:hh.TCall({e:hh.TGlobal(ah.Pack),t:ql.TVoid,p:l},[p(f,1)]),t:_,p:l};case 4:let x=e.a;return u(ah.Vec2,2,x,p);case 5:let g=e.a;return u(ah.Vec3,3,g,p);case 6:let b=e.a;return u(ah.Vec4,4,b,p);case 7:let m=e.swiz,A=e.a;return{e:hh.TSwiz(p(A,4),m),t:ql.TVec(m.length,Jl.VFloat),p:l}}};let f=function(e){o+=1;let t={id:oh.allocVarId(),type:_,name:"OUTPUT"+(o-1),kind:th.Output};return i.data.vars.push(t),{e:hh.TBinop(Pa.OpAssign,{e:hh.TVar(t),t:_,p:l},p(e,4)),t:ql.TVoid,p:l}},g=function(e,t){let s={id:oh.allocVarId(),type:ql.TFun([]),name:(""+x.string(e)).toLowerCase(),kind:th.Function},r=[],n=0;for(;n<t.length;){let e=t[n];++n,r.push(f(e))}let a={kind:e,ref:s,args:[],ret:ql.TVoid,expr:{e:hh.TBlock(r),p:l,t:ql.TVoid}};i.data.funs.push(a)};return g(ih.Vertex,[Sh.Value("output.position")]),g(ih.Fragment,e),n=Object.create(Un.prototype),n.shader=i,this.linkShaders.h[r]=n,n.updateConstantsFinal(null),n}link(e,t){let s=this.linkCache,r=e;for(;null!=r;){let e=r.s;r=r.next;let t=e.instance;null==s.next&&(s.next=new ya);let n=s.next.h[t.id];null==n&&(n=new uh,s.next.h[t.id]=n),s=n}return null==s.linked&&(s.linked=this.compileRuntimeShader(e,t)),s.linked}compileRuntimeShader(e,t){let s=[],r=0,n=e;for(;null!=n;){let e=n.s;n=n.next;let t=e,i=t.instance;s.push({inst:i,p:t.priority,index:r++})}s.reverse(),ba.sort(s,(function(e,t){return t.p-e.p}));let i,a=new vh(t);try{let e=[],t=0;for(;t<s.length;){let r=s[t];++t,e.push(r.inst.shader)}i=a.link(e)}catch(h){let e=$i.caught(h).unwrap();if(e instanceof eh){let t=e,r=[],n=0;for(;n<s.length;){let e=s[n];++n,r.push(Mh.shaderToString(e.inst.shader))}let i=r;throw t.msg+="\n\nin\n\n"+i.join("\n-----\n"),$i.thrown(t)}throw h}let l=new ya,h=0,o=a.allVars;for(;h<o.length;){let e=o[h];if(++h,e.v.kind==th.Param){let t=e.v.type;if(13==t._hx_index){t.vl;continue}let r=s[e.instanceIndex];l.h[e.id]={instance:r.index,index:r.inst.params.h[e.merged[0].id]}}}let _;try{_=(new zh).split(i)}catch(h){let e=$i.caught(h).unwrap();if(e instanceof eh){let t=e;throw t.msg+="\n\nin\n\n"+Mh.shaderToString(i),$i.thrown(t)}throw h}if(t){let e=0,t=_.vertex.vars;for(;e<t.length;){let s=t[e];++e,null!=s.qualifiers&&s.qualifiers.indexOf(sh.PerObject)>=0&&(s.kind=th.Local)}}let c=(new gh).dce(_.vertex,_.fragment),u=this.buildRuntimeShader(c.vertex,c.fragment,l),d=[],p=e;for(;null!=p;){let e=p.s;p=p.next;let t=e;d.push(new Eh(t.shader,t.constBits))}u.spec={instances:d,signature:null};let f=0,x=s.length;for(;f<x;){let e=f++,t=s[s.length-1-e];u.spec.instances[t.index].index=e}let g=[],b=0,m=u.spec.instances;for(;b<m.length;){let e=m[b];++b,g.push(e.shader.data.name+"_"+e.bits+"_"+e.index)}let A=g.join(":");u.spec.signature=ga.encode(A),u.signature=ga.encode(Mh.shaderToString(u.vertex.data)+Mh.shaderToString(u.fragment.data)),u.batchMode=t;let w=this.byID.h[u.signature];return null!=w?u.id=w.id:this.byID.h[u.signature]=u,u}buildRuntimeShader(e,t,s){let r=new Dh;return r.vertex=this.flattenShader(e,ih.Vertex,s),r.vertex.vertex=!0,r.fragment=this.flattenShader(t,ih.Fragment,s),r.globals=new ya,this.initGlobals(r,r.vertex),this.initGlobals(r,r.fragment),r}initGlobals(e,t){let s=t.globals;for(;null!=s;)e.globals.h[s.gid]=!0,s=s.next;let r=t.params;for(;null!=r;)null!=r.perObjectGlobal&&(e.globals.h[r.perObjectGlobal.gid]=!0),r=r.next}getPath(e){return null==e.parent?e.name:this.getPath(e.parent)+"."+e.name}flattenShader(e,t,s){let r=new wh,n=new Fh,i=r.flatten(e,t,this.constsToGlobal),a=[];n.consts=r.consts,n.texturesCount=0;let l=r.allocData.keys();for(;l.hasNext();){let e=l.next(),t=r.allocData.h[e.__id__];switch(e.kind._hx_index){case 0:let r=[],i=0;for(;i<t.length;){let e=t[i];++i,null!=e.v&&r.push(new Th(e.pos,this.getPath(e.v),e.v.type))}let l=r,h=0,o=l.length-1;for(;h<o;){let e=h++;l[e].next=l[e+1]}let _=e.type;if(15!=_._hx_index)throw $i.thrown("assert");{let e=_.size,t=_.t;if(5!=t._hx_index)throw $i.thrown("assert");if(4!=t.size)throw $i.thrown("assert");if(1!=t.t._hx_index)throw $i.thrown("assert");if(0!=e._hx_index)throw $i.thrown("assert");{let t=e.v;n.globals=l[0],n.globalsSize=t}}break;case 2:let c=[],u=0;for(;u<t.length;){let e=t[u];if(++u,null==e.v)continue;let r=s.h[e.v.id];if(null!=r)c.push(new Ih(e.v.name,e.pos,r.instance,r.index,e.v.type));else{let t=new Ih(e.v.name,e.pos,-1,-1,e.v.type);t.perObjectGlobal=new Th(-1,this.getPath(e.v),e.v.type),c.push(t)}}let d=0,p=c.length-1;for(;d<p;){let e=d++;c[e].next=c[e+1]}let f=e.type;if(15!=f._hx_index)throw $i.thrown("assert");{let e=f.size,t=f.t,s=t;if(oh.isSampler(s))a.push({t:s,all:c}),n.texturesCount+=c.length;else switch(t._hx_index){case 5:if(4!=t.size)throw $i.thrown("assert");if(1!=t.t._hx_index)throw $i.thrown("assert");if(0!=e._hx_index)throw $i.thrown("assert");{let t=e.v;n.params=c[0],n.paramsSize=t}break;case 16:t.size,t.t;n.buffers=c[0],n.bufferCount=c.length;break;default:throw $i.thrown("assert")}}break;default:throw $i.thrown("assert")}}if(a.length>0){a.sort((function(e,t){return e.t._hx_index-t.t._hx_index})),n.textures=a[0].all[0];let e=1,t=a.length;for(;e<t;){let t=e++,s=a[t-1].all;s[s.length-1].next=a[t].all[0]}}return null==n.globals&&(n.globalsSize=0),null==n.params&&(n.paramsSize=0),null==n.buffers&&(n.bufferCount=0),n.data=i,n}static get(){let e=dh.INST;return null==e&&(e=new dh,dh.INST=e),e}}s["hxsl.Cache"]=dh,dh.__name__="hxsl.Cache",Object.assign(dh.prototype,{__class__:dh});var ph=n["hxsl.Channel"]={__ename__:"hxsl.Channel",__constructs__:["Unknown","R","G","B","A","PackedFloat","PackedNormal"],Unknown:{_hx_index:0,__enum__:"hxsl.Channel",toString:r},R:{_hx_index:1,__enum__:"hxsl.Channel",toString:r},G:{_hx_index:2,__enum__:"hxsl.Channel",toString:r},B:{_hx_index:3,__enum__:"hxsl.Channel",toString:r},A:{_hx_index:4,__enum__:"hxsl.Channel",toString:r},PackedFloat:{_hx_index:5,__enum__:"hxsl.Channel",toString:r},PackedNormal:{_hx_index:6,__enum__:"hxsl.Channel",toString:r}};ph.__empty_constructs__=[ph.Unknown,ph.R,ph.G,ph.B,ph.A,ph.PackedFloat,ph.PackedNormal];class fh{constructor(){this.varMap=new ya}tvar(e){let t=this.varMap.h[e.id];return null!=t||(t={id:oh.allocVarId(),type:e.type,name:e.name,kind:e.kind},this.varMap.h[e.id]=t,null!=e.parent&&(t.parent=this.tvar(e.parent)),null!=e.qualifiers&&(t.qualifiers=e.qualifiers.slice()),t.type=this.ttype(e.type)),t}tfun(e){let t=this.ttype(e.ret),s=e.kind,r=this.tvar(e.ref),n=[],i=0,a=e.args;for(;i<a.length;){let e=a[i];++i,n.push(this.tvar(e))}return{ret:t,kind:s,ref:r,args:n,expr:this.texpr(e.expr)}}ttype(e){switch(e._hx_index){case 13:let t=e.vl,s=[],r=0;for(;r<t.length;){let e=t[r];++r,s.push(this.tvar(e))}return ql.TStruct(s);case 14:let n=e.variants;return ql.TFun(n);case 15:let i,a=e.size,l=e.t,h=this.ttype(l);switch(a._hx_index){case 0:a.v;i=a;break;case 1:let e=a.v;i=$l.SVar(this.tvar(e))}return ql.TArray(h,i);default:return e}}texpr(e){let t=oh.map(e,ao(this,this.texpr));t.t=this.ttype(e.t);let s,r=t.e;switch(r._hx_index){case 1:let e=r.v;s=hh.TVar(this.tvar(e));break;case 7:let n=r.init,i=r.v;s=hh.TVarDecl(this.tvar(i),n);break;case 13:let a=r.loop,l=r.it,h=r.v;s=hh.TFor(this.tvar(h),l,a);break;default:s=t.e}return t.e=s,t}shader(e){let t=e.name,s=[],r=0,n=e.vars;for(;r<n.length;){let e=n[r];++r,s.push(this.tvar(e))}let i=s,a=[],l=0,h=e.funs;for(;l<h.length;){let e=h[l];++l,a.push(this.tfun(e))}return{name:t,vars:i,funs:a}}static shaderData(e){return(new fh).shader(e)}}s["hxsl.Clone"]=fh,fh.__name__="hxsl.Clone",Object.assign(fh.prototype,{__class__:fh});class xh{constructor(e){this.v=e,this.used=!1,this.deps=new ya}}s["hxsl._Dce.VarDeps"]=xh,xh.__name__="hxsl._Dce.VarDeps",Object.assign(xh.prototype,{__class__:xh});class gh{constructor(){}dce(e,t){this.used=new ya,this.channelVars=[];let s=[],r=0,n=e.vars;for(;r<n.length;){let e=n[r];++r;let t=this.get(e);e.kind==th.Input&&s.push(t),e.kind==th.Output&&(t.keep=!0)}let i=0,a=t.vars;for(;i<a.length;){let e=a[i];++i;let t=this.get(e);e.kind==th.Output&&(t.keep=!0)}let l=0,h=e.funs;for(;l<h.length;){let e=h[l];++l,this.check(e.expr,[],[])}let o=0,_=t.funs;for(;o<_.length;){let e=_[o];++o,this.check(e.expr,[],[])}let u=[];for(;;){let r=this.used.iterator();for(;r.hasNext();){let e=r.next();e.keep&&this.markRec(e)}for(;s.length>1&&!s[s.length-1].used;)s.pop();let n=0;for(;n<s.length;){let e=s[n];++n,this.markRec(e)}u=[];let i=0,a=e.funs;for(;i<a.length;){let e=a[i];++i,u.push(this.mapExpr(e.expr,!1))}let l=0,h=t.funs;for(;l<h.length;){let e=h[l];++l,u.push(this.mapExpr(e.expr,!1))}this.markAsKeep=!1;let o=0;for(;o<u.length;){let e=u[o];++o,this.checkBranches(e)}if(!this.markAsKeep)break}let d=0,p=e.funs;for(;d<p.length;){let e=p[d];++d,e.expr=u.shift()}let f=0,x=t.funs;for(;f<x.length;){let e=x[f];++f,e.expr=u.shift()}let g=this.used.iterator();for(;g.hasNext();){let s=g.next();s.used||s.v.kind!=th.Input&&(c.remove(e.vars,s.v),c.remove(t.vars,s.v))}return{fragment:t,vertex:e}}get(e){let t=this.used.h[e.id];return null==t&&(t=new xh(e),this.used.h[e.id]=t),t}markRec(e){if(e.used)return;e.used=!0;let t=e.deps.iterator();for(;t.hasNext();){let e=t.next();this.markRec(e)}}link(e,t){let s=this.get(e),r=0;for(;r<t.length;){let n=t[r];++r,null!=n?n.deps.h[e.id]=s:s.keep||(s.keep=!0,this.markAsKeep=!0)}}check(e,t,s){let r=e.e;switch(r._hx_index){case 1:let n=r.v;this.link(n,t);break;case 4:let i=r.el,a=[],l=0,h=i.length;for(;l<h;){let e=l++;this.check(i[e],e<i.length-1?a:t,s)}break;case 5:let o=r.e2,_=r.e1,c=r.op;switch(c._hx_index){case 4:_.t,_.p;let r=_.e;switch(r._hx_index){case 1:let n=o,i=r.v,a=this.get(i);t.push(a),this.check(n,t,s),t.pop(),s.indexOf(a)<0&&s.push(a);break;case 9:r.regs;let l=r.e,h=(l.t,l.p,l.e);if(1==h._hx_index){let e=o,r=h.v,n=this.get(r);t.push(n),this.check(e,t,s),t.pop(),s.indexOf(n)<0&&s.push(n)}else{let r=ao(this,this.check),n=t,i=s;oh.iter(e,(function(e){r(e,n,i)}))}break;default:let _=ao(this,this.check),c=t,u=s;oh.iter(e,(function(e){_(e,c,u)}))}break;case 20:c.op,_.t,_.p;let n=_.e;switch(n._hx_index){case 1:let r=o,i=n.v,a=this.get(i);t.push(a),this.check(r,t,s),t.pop(),s.indexOf(a)<0&&s.push(a);break;case 9:n.regs;let l=n.e,h=(l.t,l.p,l.e);if(1==h._hx_index){let e=o,r=h.v,n=this.get(r);t.push(n),this.check(e,t,s),t.pop(),s.indexOf(n)<0&&s.push(n)}else{let r=ao(this,this.check),n=t,i=s;oh.iter(e,(function(e){r(e,n,i)}))}break;default:let _=ao(this,this.check),c=t,u=s;oh.iter(e,(function(e){_(e,c,u)}))}break;default:let i=ao(this,this.check),a=t,l=s;oh.iter(e,(function(e){i(e,a,l)}))}break;case 7:let u=r.init,d=r.v;if(null!=u)t.push(this.get(d)),this.check(u,t,s),t.pop();else{let r=ao(this,this.check),n=t,i=s;oh.iter(e,(function(e){r(e,n,i)}))}break;case 8:let p=r.args,f=r.e,x=(f.t,f.p,f.e);if(2==x._hx_index)switch(x.g._hx_index){case 63:if(3==p.length){let r=p[2],n=p[0],i=(n.t,n.p,n.e);if(1==i._hx_index){r.t,r.p;let n=r.e;if(0==n._hx_index){let r=n.c;if(2==r._hx_index){let e=i.v,n=p[1],a=r.v;this.check(n,t,s),null==this.channelVars[a]?(this.channelVars[a]=e,this.link(e,t)):this.link(this.channelVars[a],t)}else{let r=ao(this,this.check),n=t,i=s;oh.iter(e,(function(e){r(e,n,i)}))}}else{let r=ao(this,this.check),n=t,i=s;oh.iter(e,(function(e){r(e,n,i)}))}}else{let r=ao(this,this.check),n=t,i=s;oh.iter(e,(function(e){r(e,n,i)}))}}else{let r=ao(this,this.check),n=t,i=s;oh.iter(e,(function(e){r(e,n,i)}))}break;case 64:if(4==p.length){let r=p[3],n=p[0],i=(n.t,n.p,n.e);if(1==i._hx_index){r.t,r.p;let n=r.e;if(0==n._hx_index){let r=n.c;if(2==r._hx_index){let e=i.v,n=p[1],a=p[2],l=r.v;this.check(n,t,s),this.check(a,t,s),null==this.channelVars[l]?(this.channelVars[l]=e,this.link(e,t)):this.link(this.channelVars[l],t)}else{let r=ao(this,this.check),n=t,i=s;oh.iter(e,(function(e){r(e,n,i)}))}}else{let r=ao(this,this.check),n=t,i=s;oh.iter(e,(function(e){r(e,n,i)}))}}else{let r=ao(this,this.check),n=t,i=s;oh.iter(e,(function(e){r(e,n,i)}))}}else{let r=ao(this,this.check),n=t,i=s;oh.iter(e,(function(e){r(e,n,i)}))}break;default:let r=ao(this,this.check),n=t,i=s;oh.iter(e,(function(e){r(e,n,i)}))}else{let r=ao(this,this.check),n=t,i=s;oh.iter(e,(function(e){r(e,n,i)}))}break;case 10:let g=r.eelse,b=r.eif,m=r.econd,A=[];this.check(b,t,A),null!=g&&this.check(g,t,A);let w=A.length,y=0;for(;y<t.length;){let e=t[y];++y,A.indexOf(e)<0&&A.push(e)}this.check(m,A,s);let k=0,B=w;for(;k<B;){let e=A[k++];s.indexOf(e)<0&&s.push(e)}break;case 13:let C=r.loop,v=r.it,S=(r.v,[]);this.check(C,t,S),this.check(v,S,s);let M=0;for(;M<S.length;){let e=S[M];++M,s.indexOf(e)<0&&s.push(e)}break;default:let I=ao(this,this.check),T=t,F=s;oh.iter(e,(function(e){I(e,T,F)}))}}checkBranches(e){let t=e.e;if(10==t._hx_index){t.eelse,t.eif;let e=t.econd,s=[null];this.check(e,s,[])}oh.iter(e,ao(this,this.checkBranches))}mapExpr(e,t){let s=this,r=e.e;switch(r._hx_index){case 4:let n=r.el,i=[],a=0,l=0;for(;l<n.length;){let e=n[l];++l;let s=t&&a==n.length-1,r=this.mapExpr(e,s);(oh.hasSideEffect(r)||s)&&i.push(r),++a}return{e:hh.TBlock(i),p:e.p,t:e.t};case 5:r.e2;let h=r.e1,o=r.op;switch(o._hx_index){case 4:h.t,h.p;let t=h.e;switch(t._hx_index){case 1:let r=t.v;return this.get(r).used?oh.map(e,(function(e){return s.mapExpr(e,!0)})):{e:hh.TConst(nh.CNull),t:e.t,p:e.p};case 9:t.regs;let n=t.e,i=(n.t,n.p,n.e);if(1==i._hx_index){let t=i.v;return this.get(t).used?oh.map(e,(function(e){return s.mapExpr(e,!0)})):{e:hh.TConst(nh.CNull),t:e.t,p:e.p}}return oh.map(e,(function(e){return s.mapExpr(e,!0)}));default:return oh.map(e,(function(e){return s.mapExpr(e,!0)}))}break;case 20:o.op,h.t,h.p;let r=h.e;switch(r._hx_index){case 1:let t=r.v;return this.get(t).used?oh.map(e,(function(e){return s.mapExpr(e,!0)})):{e:hh.TConst(nh.CNull),t:e.t,p:e.p};case 9:r.regs;let n=r.e,i=(n.t,n.p,n.e);if(1==i._hx_index){let t=i.v;return this.get(t).used?oh.map(e,(function(e){return s.mapExpr(e,!0)})):{e:hh.TConst(nh.CNull),t:e.t,p:e.p}}return oh.map(e,(function(e){return s.mapExpr(e,!0)}));default:return oh.map(e,(function(e){return s.mapExpr(e,!0)}))}break;default:return oh.map(e,(function(e){return s.mapExpr(e,!0)}))}break;case 7:r.init;let _=r.v;return this.get(_).used?oh.map(e,(function(e){return s.mapExpr(e,!0)})):{e:hh.TConst(nh.CNull),t:e.t,p:e.p};case 8:let c=r.args,u=r.e,d=(u.t,u.p,u.e);if(2!=d._hx_index)return oh.map(e,(function(e){return s.mapExpr(e,!0)}));switch(d.g._hx_index){case 63:if(3==c.length){let t=c[2],r=(c[0],t.t,t.p,t.e);if(0==r._hx_index){let t=r.c;if(2==t._hx_index){let s=c[1],r=t.v,n=this.channelVars[r];return{e:hh.TCall({e:hh.TGlobal(ah.Texture),p:e.p,t:ql.TVoid},[{e:hh.TVar(n),t:n.type,p:e.p},this.mapExpr(s,!0)]),t:ql.TVoid,p:e.p}}return oh.map(e,(function(e){return s.mapExpr(e,!0)}))}return oh.map(e,(function(e){return s.mapExpr(e,!0)}))}return oh.map(e,(function(e){return s.mapExpr(e,!0)}));case 64:if(4==c.length){let t=c[3],r=(c[0],t.t,t.p,t.e);if(0==r._hx_index){let t=r.c;if(2==t._hx_index){let s=c[1],r=c[2],n=t.v,i=this.channelVars[n];return{e:hh.TCall({e:hh.TGlobal(ah.TextureLod),p:e.p,t:ql.TVoid},[{e:hh.TVar(i),t:i.type,p:e.p},this.mapExpr(s,!0),this.mapExpr(r,!0)]),t:ql.TVoid,p:e.p}}return oh.map(e,(function(e){return s.mapExpr(e,!0)}))}return oh.map(e,(function(e){return s.mapExpr(e,!0)}))}return oh.map(e,(function(e){return s.mapExpr(e,!0)}));case 65:if(3==c.length){let t=c[2],r=(c[0],t.t,t.p,t.e);if(0==r._hx_index){let t=r.c;if(2==t._hx_index){let s=c[1],r=t.v,n=this.channelVars[r];return{e:hh.TCall({e:hh.TGlobal(ah.Texel),p:e.p,t:ql.TVoid},[{e:hh.TVar(n),t:n.type,p:e.p},this.mapExpr(s,!0)]),t:ql.TVoid,p:e.p}}return oh.map(e,(function(e){return s.mapExpr(e,!0)}))}return oh.map(e,(function(e){return s.mapExpr(e,!0)}))}return oh.map(e,(function(e){return s.mapExpr(e,!0)}));case 66:if(4==c.length){let t=c[3],r=(c[0],t.t,t.p,t.e);if(0==r._hx_index){let t=r.c;if(2==t._hx_index){let s=c[1],r=c[2],n=t.v,i=this.channelVars[n];return{e:hh.TCall({e:hh.TGlobal(ah.Texel),p:e.p,t:ql.TVoid},[{e:hh.TVar(i),t:i.type,p:e.p},this.mapExpr(s,!0),this.mapExpr(r,!0)]),t:ql.TVoid,p:e.p}}return oh.map(e,(function(e){return s.mapExpr(e,!0)}))}return oh.map(e,(function(e){return s.mapExpr(e,!0)}))}return oh.map(e,(function(e){return s.mapExpr(e,!0)}));default:return oh.map(e,(function(e){return s.mapExpr(e,!0)}))}break;case 10:let p=r.eelse,f=r.eif,x=r.econd,g=this.mapExpr(x,!0),b=this.mapExpr(f,t),m=null==p?null:this.mapExpr(p,t);return t||oh.hasSideEffect(b)||null!=m&&oh.hasSideEffect(m)?{e:hh.TIf(g,b,m),p:g.p,t:g.t}:{e:hh.TConst(nh.CNull),t:g.t,p:g.p};case 13:let A=r.loop,w=r.it,y=r.v,k=this.mapExpr(w,!0),B=this.mapExpr(A,!1);return oh.hasSideEffect(B)?{e:hh.TFor(y,k,B),p:e.p,t:e.t}:{e:hh.TConst(nh.CNull),t:e.t,p:e.p};default:return oh.map(e,(function(e){return s.mapExpr(e,!0)}))}}}s["hxsl.Dce"]=gh,gh.__name__="hxsl.Dce",Object.assign(gh.prototype,{__class__:gh});class bh{constructor(){this.varMap=new Ca,this.funMap=new Ca,this.constants=new ya}setConstant(e,t){this.constants.h[e.id]=hh.TConst(t)}mapVar(e){let t=this.varMap.h[e.__id__];if(null!=t)return e==t?t:this.mapVar(t);if(null!=e.parent&&(this.mapVar(e.parent),t=this.varMap.h[e.__id__],null!=t))return e==t?t:this.mapVar(t);let s,r=e.type;if(17==r._hx_index){r.size;s=!0}else s=!1;t={id:s?e.id:oh.allocVarId(),name:e.name,type:e.type,kind:e.kind},null!=e.parent&&(t.parent=this.mapVar(e.parent)),null!=e.qualifiers&&(t.qualifiers=e.qualifiers.slice()),this.varMap.set(e,t),this.varMap.set(t,t);let n=t.type;switch(n._hx_index){case 13:let e=n.vl,s=[],r=0;for(;r<e.length;){let t=e[r];++r,s.push(this.mapVar(t))}t.type=ql.TStruct(s);break;case 15:let i=n.size;if(1==i._hx_index){let e=n.t,s=i.v,r=this.constants.h[s.id];if(null!=r)if(null==r)eh.t("Integer value expected for array size constant "+s.name,null);else if(0==r._hx_index){let n=r.c;if(2==n._hx_index){let s,r=n.v,i=t.type;if(15==i._hx_index){i.size,i.t;s=!0}else s=!1;t.type=s?ql.TArray(e,$l.SConst(r)):ql.TBuffer(e,$l.SConst(r))}else eh.t("Integer value expected for array size constant "+s.name,null)}else eh.t("Integer value expected for array size constant "+s.name,null);else{let r,n=this.mapVar(s),i=t.type;if(15==i._hx_index){i.size,i.t;r=!0}else r=!1;t.type=r?ql.TArray(e,$l.SVar(n)):ql.TBuffer(e,$l.SVar(n))}}break;case 16:let a=n.size;if(1==a._hx_index){let e=n.t,s=a.v,r=this.constants.h[s.id];if(null!=r)if(null==r)eh.t("Integer value expected for array size constant "+s.name,null);else if(0==r._hx_index){let n=r.c;if(2==n._hx_index){let s,r=n.v,i=t.type;if(15==i._hx_index){i.size,i.t;s=!0}else s=!1;t.type=s?ql.TArray(e,$l.SConst(r)):ql.TBuffer(e,$l.SConst(r))}else eh.t("Integer value expected for array size constant "+s.name,null)}else eh.t("Integer value expected for array size constant "+s.name,null);else{let r,n=this.mapVar(s),i=t.type;if(15==i._hx_index){i.size,i.t;r=!0}else r=!1;t.type=r?ql.TArray(e,$l.SVar(n)):ql.TBuffer(e,$l.SVar(n))}}}return t}eval(e){let t=[],s=0,r=e.funs;for(;s<r.length;){let e=r[s];++s;let n=e.kind,i=this.mapVar(e.ref),a=[],l=0,h=e.args;for(;l<h.length;){let e=h[l];++l,a.push(this.mapVar(e))}let o={kind:n,ref:i,args:a,ret:e.ret,expr:e.expr};this.inlineCalls&&e.kind==ih.Helper||t.push(o),this.funMap.set(o.ref,e)}let n=0,i=t.length;for(;n<i;){let e=n++;this.curFun=t[e],this.curFun.expr=this.evalExpr(this.curFun.expr,!1)}let a=e.name,l=[],h=0,o=e.vars;for(;h<o.length;){let e=o[h];++h,l.push(this.mapVar(e))}return{name:a,vars:l,funs:t}}hasReturn(e){return this.markReturn=!1,this.hasReturnLoop(e),this.markReturn}hasReturnLoop(e){let t=e.e;if(12==t._hx_index){t.e;this.markReturn=!0}else this.markReturn||oh.iter(e,ao(this,this.hasReturnLoop))}handleReturn(e,t){null==t&&(t=!1);let s=e.e;switch(s._hx_index){case 3:let r=s.e,n=this.handleReturn(r,t);return{e:hh.TParenthesis(n),t:n.t,p:e.p};case 4:let i=s.el,a=0,l=i.length,h=[];e:for(;a<l;){let e=i[a++];if(a==l)h.push(this.handleReturn(e,t));else{let s=e.e;switch(s._hx_index){case 10:if(null==s.eelse){let r=s.econd,n=s.eif;if(t&&this.hasReturn(n)){h.push(this.handleReturn({e:hh.TIf(r,n,{e:hh.TBlock(i.slice(a)),t:e.t,p:e.p}),t:e.t,p:e.p}));break e}h.push(this.handleReturn(e))}else h.push(this.handleReturn(e));break;case 12:let r=s.e;h.push(this.handleReturn(r,t));break e;default:h.push(this.handleReturn(e))}}}let o=t?h[h.length-1].t:e.t;return{e:hh.TBlock(h),t:o,p:e.p};case 10:let _=s.eelse,c=s.eif,u=s.econd;if(null!=_&&t){let s=this.handleReturn(u),r=this.handleReturn(c,t);return{e:hh.TIf(s,r,this.handleReturn(_,t)),t:r.t,p:e.p}}return oh.map(e,ao(this,this.handleReturnDef));case 12:let d=s.e;return t||eh.t("Cannot inline not final return",e.p),null==d?{e:hh.TBlock([]),t:ql.TVoid,p:e.p}:this.handleReturn(d,!0);default:return oh.map(e,ao(this,this.handleReturnDef))}}handleReturnDef(e){return this.handleReturn(e)}evalCall(e,t,s,r){switch(e._hx_index){case 38:if(1==t.length){let e=t[0],s=(e.t,e.p,e.e);if(0==s._hx_index){let e=s.c;if(2==e._hx_index){let t=e.v;return hh.TConst(nh.CFloat(t))}return null}return null}return null;case 63:case 64:let n,i=t[0].e;if(0!=i._hx_index)throw eh.t("Cannot eval complex channel "+Mh.toString(t[0],!0)+" "+this.constantsToString(),r),$i.thrown("assert");{let e=i.c;if(2!=e._hx_index)throw eh.t("Cannot eval complex channel "+Mh.toString(t[0],!0)+" "+this.constantsToString(),r),$i.thrown("assert");n=e.v}let a,l,h=s[0],o=h.e;if(1!=o._hx_index)throw $i.thrown("assert");{let e=o.v;a=hh.TVar(this.mapVar(e))}h={e:a,t:h.t,p:h.p};let _=h.t;if(17!=_._hx_index)throw $i.thrown("assert");l=_.size;let c=y.createEnumIndex(ph,7&n,null),u=[h],d=1,p=t.length;for(;d<p;){let e=d++;u.push(t[e])}u.push({e:hh.TConst(nh.CInt(n>>3)),t:ql.TInt,p:r});let f={e:hh.TCall({e:hh.TGlobal(e),t:ql.TVoid,p:r},u),t:ql.TVoid,p:r};switch(c._hx_index){case 0:let e={e:hh.TConst(nh.CFloat(0)),t:ql.TFloat,p:r};return 1==l?e.e:hh.TCall({e:hh.TGlobal([ah.Vec2,ah.Vec3,ah.Vec4][l-2]),t:ql.TVoid,p:r},[e]);case 1:case 2:case 3:case 4:let t;switch(l){case 1:switch(c._hx_index){case 1:t=[lh.X];break;case 2:t=[lh.Y];break;case 3:t=[lh.Z];break;case 4:t=[lh.W];break;default:throw $i.thrown("Invalid channel value "+x.string(c)+" for "+l+" channels")}break;case 2:switch(c._hx_index){case 1:t=[lh.X,lh.Y];break;case 2:t=[lh.Y,lh.Z];break;case 3:t=[lh.Z,lh.W];break;default:throw $i.thrown("Invalid channel value "+x.string(c)+" for "+l+" channels")}break;case 3:switch(c._hx_index){case 1:t=[lh.X,lh.Y,lh.Z];break;case 2:t=[lh.Y,lh.Z,lh.W];break;default:throw $i.thrown("Invalid channel value "+x.string(c)+" for "+l+" channels")}break;default:throw $i.thrown("Invalid channel value "+x.string(c)+" for "+l+" channels")}return hh.TSwiz(f,t);case 5:return hh.TCall({e:hh.TGlobal(ah.Unpack),t:ql.TVoid,p:r},[f]);case 6:return hh.TCall({e:hh.TGlobal(ah.UnpackNormal),t:ql.TVoid,p:r},[f])}break;case 67:let g=t,b=0;for(;b<g.length;){let e=g[b];++b,sa.trace(Mh.toString(e),{fileName:e.p.file,lineNumber:0,className:null,methodName:null})}return hh.TBlock([]);default:return null}}constantsToString(){let e=[],t=this.constants.keys();for(;t.hasNext();){let s=t.next();e.push(s+" => "+Mh.toString({e:this.constants.h[s],t:ql.TVoid,p:null},!0))}return e.toString()}ifBlock(e){let t;if(null!=e){let s,r=e.e;if(10==r._hx_index){r.eelse,r.eif,r.econd;s=!0}else s=!1;t=!s}else t=!0;return t?e:{e:hh.TBlock([e]),t:e.t,p:e.p}}evalExpr(e,t){null==t&&(t=!0);let s,r=this,n=e.e;switch(n._hx_index){case 0:n.c;s=e.e;break;case 1:let i=n.v,a=this.constants.h[i.id];if(null!=a)s=a;else{let e=this.mapVar(i);s=hh.TVar(e)}break;case 2:n.g;s=e.e;break;case 3:let l=n.e,h=this.evalExpr(l,t),o=h.e;if(0==o._hx_index){o.c;s=h.e}else s=hh.TParenthesis(h);break;case 4:let _=n.el,c=[],u=_.length-1,d=0,p=_.length;for(;d<p;){let e=d++,s=t&&e==u,r=this.evalExpr(_[e],s),n=r.e;switch(n._hx_index){case 0:n.c;s&&c.push(r);break;case 1:n.v;s&&c.push(r);break;default:c.push(r)}}s=1==c.length&&this.curFun.kind!=ih.Init?c[0].e:hh.TBlock(c);break;case 5:let f=n.e2,g=n.e1,b=n.op,m=this.evalExpr(g),A=this.evalExpr(f);switch(b._hx_index){case 0:let e=A.e,t=m.e;if(0==t._hx_index){let r=t.c;switch(r._hx_index){case 2:if(0==e._hx_index){let t=e.c;if(2==t._hx_index){let e=r.v,n=t.v;s=hh.TConst(nh.CInt(e+n|0))}else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A);break;case 3:if(0==e._hx_index){let t=e.c;if(3==t._hx_index){let e=r.v,n=t.v;s=hh.TConst(nh.CFloat(e+n))}else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A);break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 1:let r=A.e,n=m.e;if(0==n._hx_index){let e=n.c;switch(e._hx_index){case 2:if(0==r._hx_index){let t=r.c;if(2==t._hx_index){let r=e.v,n=t.v;s=hh.TConst(nh.CInt(r*n|0))}else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A);break;case 3:if(0==r._hx_index){let t=r.c;if(3==t._hx_index){let r=e.v,n=t.v;s=hh.TConst(nh.CFloat(r*n))}else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A);break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 2:let i=A.e,a=m.e;if(0==a._hx_index){let e=a.c;switch(e._hx_index){case 2:if(0==i._hx_index){let t=i.c;if(2==t._hx_index){let r=e.v,n=t.v;s=hh.TConst(nh.CInt(r/n|0))}else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A);break;case 3:if(0==i._hx_index){let t=i.c;if(3==t._hx_index){let r=e.v,n=t.v;s=hh.TConst(nh.CFloat(r/n))}else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A);break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 3:let l=A.e,h=m.e;if(0==h._hx_index){let e=h.c;switch(e._hx_index){case 2:if(0==l._hx_index){let t=l.c;if(2==t._hx_index){let r=e.v,n=t.v;s=hh.TConst(nh.CInt(r-n|0))}else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A);break;case 3:if(0==l._hx_index){let t=l.c;if(3==t._hx_index){let r=e.v,n=t.v;s=hh.TConst(nh.CFloat(r-n))}else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A);break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 4:case 21:s=hh.TBinop(b,m,A);break;case 5:let o=A.e,_=m.e;if(0==_._hx_index){let e=_.c;switch(e._hx_index){case 0:s=0==o._hx_index?0==o.c._hx_index?hh.TConst(nh.CBool(!0)):hh.TConst(nh.CBool(!1)):hh.TBinop(b,m,A);break;case 1:let t=e.b;if(0==o._hx_index){let e=o.c;switch(e._hx_index){case 0:s=hh.TConst(nh.CBool(!1));break;case 1:let r=t,n=e.b;s=hh.TConst(nh.CBool(0==(r==n?0:1)));break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 2:let r=e.v;if(0==o._hx_index){let e=o.c;switch(e._hx_index){case 0:s=hh.TConst(nh.CBool(!1));break;case 2:let t=r,n=e.v;s=hh.TConst(nh.CBool(t-n==0));break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 3:let n=e.v;if(0==o._hx_index){let e=o.c;switch(e._hx_index){case 0:s=hh.TConst(nh.CBool(!1));break;case 3:let t=n,r=e.v;s=hh.TConst(nh.CBool(0==(t>r?1:t==r?0:-1)));break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 4:let i=e.v;if(0==o._hx_index){let e=o.c;switch(e._hx_index){case 0:s=hh.TConst(nh.CBool(!1));break;case 4:let t=i,r=e.v;s=hh.TConst(nh.CBool(0==(t>r?1:t==r?0:-1)));break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 6:let c=A.e,u=m.e;if(0==u._hx_index){let e=u.c;switch(e._hx_index){case 0:s=0==c._hx_index?0==c.c._hx_index?hh.TConst(nh.CBool(!1)):hh.TConst(nh.CBool(!0)):hh.TBinop(b,m,A);break;case 1:let t=e.b;if(0==c._hx_index){let e=c.c;switch(e._hx_index){case 0:s=hh.TConst(nh.CBool(!0));break;case 1:let r=t,n=e.b;s=hh.TConst(nh.CBool(0!=(r==n?0:1)));break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 2:let r=e.v;if(0==c._hx_index){let e=c.c;switch(e._hx_index){case 0:s=hh.TConst(nh.CBool(!0));break;case 2:let t=r,n=e.v;s=hh.TConst(nh.CBool(t-n!=0));break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 3:let n=e.v;if(0==c._hx_index){let e=c.c;switch(e._hx_index){case 0:s=hh.TConst(nh.CBool(!0));break;case 3:let t=n,r=e.v;s=hh.TConst(nh.CBool(0!=(t>r?1:t==r?0:-1)));break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 4:let i=e.v;if(0==c._hx_index){let e=c.c;switch(e._hx_index){case 0:s=hh.TConst(nh.CBool(!0));break;case 4:let t=i,r=e.v;s=hh.TConst(nh.CBool(0!=(t>r?1:t==r?0:-1)));break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 7:let d=A.e,p=m.e;if(0==p._hx_index){let e=p.c;switch(e._hx_index){case 0:s=0==d._hx_index?(d.c._hx_index,hh.TConst(nh.CBool(!1))):hh.TBinop(b,m,A);break;case 1:let t=e.b;if(0==d._hx_index){let e=d.c;switch(e._hx_index){case 0:s=hh.TConst(nh.CBool(!0));break;case 1:let r=t,n=e.b;s=hh.TConst(nh.CBool((r==n?0:1)>0));break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 2:let r=e.v;if(0==d._hx_index){let e=d.c;switch(e._hx_index){case 0:s=hh.TConst(nh.CBool(!0));break;case 2:let t=r,n=e.v;s=hh.TConst(nh.CBool(t-n>0));break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 3:let n=e.v;if(0==d._hx_index){let e=d.c;switch(e._hx_index){case 0:s=hh.TConst(nh.CBool(!0));break;case 3:let t=n,r=e.v;s=hh.TConst(nh.CBool((t>r?1:t==r?0:-1)>0));break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 4:let i=e.v;if(0==d._hx_index){let e=d.c;switch(e._hx_index){case 0:s=hh.TConst(nh.CBool(!0));break;case 4:let t=i,r=e.v;s=hh.TConst(nh.CBool((t>r?1:t==r?0:-1)>0));break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 8:let f=A.e,x=m.e;if(0==x._hx_index){let e=x.c;switch(e._hx_index){case 0:s=0==f._hx_index?0==f.c._hx_index?hh.TConst(nh.CBool(!0)):hh.TConst(nh.CBool(!1)):hh.TBinop(b,m,A);break;case 1:let t=e.b;if(0==f._hx_index){let e=f.c;switch(e._hx_index){case 0:s=hh.TConst(nh.CBool(!0));break;case 1:let r=t,n=e.b;s=hh.TConst(nh.CBool((r==n?0:1)>=0));break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 2:let r=e.v;if(0==f._hx_index){let e=f.c;switch(e._hx_index){case 0:s=hh.TConst(nh.CBool(!0));break;case 2:let t=r,n=e.v;s=hh.TConst(nh.CBool(t-n>=0));break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 3:let n=e.v;if(0==f._hx_index){let e=f.c;switch(e._hx_index){case 0:s=hh.TConst(nh.CBool(!0));break;case 3:let t=n,r=e.v;s=hh.TConst(nh.CBool((t>r?1:t==r?0:-1)>=0));break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 4:let i=e.v;if(0==f._hx_index){let e=f.c;switch(e._hx_index){case 0:s=hh.TConst(nh.CBool(!0));break;case 4:let t=i,r=e.v;s=hh.TConst(nh.CBool((t>r?1:t==r?0:-1)>=0));break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 9:let g=A.e,w=m.e;if(0==w._hx_index){let e=w.c;switch(e._hx_index){case 0:s=0==g._hx_index?0==g.c._hx_index?hh.TConst(nh.CBool(!1)):hh.TConst(nh.CBool(!0)):hh.TBinop(b,m,A);break;case 1:let t=e.b;if(0==g._hx_index){let e=g.c;switch(e._hx_index){case 0:s=hh.TConst(nh.CBool(!1));break;case 1:let r=t,n=e.b;s=hh.TConst(nh.CBool((r==n?0:1)<0));break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 2:let r=e.v;if(0==g._hx_index){let e=g.c;switch(e._hx_index){case 0:s=hh.TConst(nh.CBool(!1));break;case 2:let t=r,n=e.v;s=hh.TConst(nh.CBool(t-n<0));break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 3:let n=e.v;if(0==g._hx_index){let e=g.c;switch(e._hx_index){case 0:s=hh.TConst(nh.CBool(!1));break;case 3:let t=n,r=e.v;s=hh.TConst(nh.CBool((t>r?1:t==r?0:-1)<0));break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 4:let i=e.v;if(0==g._hx_index){let e=g.c;switch(e._hx_index){case 0:s=hh.TConst(nh.CBool(!1));break;case 4:let t=i,r=e.v;s=hh.TConst(nh.CBool((t>r?1:t==r?0:-1)<0));break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 10:let y=A.e,k=m.e;if(0==k._hx_index){let e=k.c;switch(e._hx_index){case 0:s=0==y._hx_index?(y.c._hx_index,hh.TConst(nh.CBool(!0))):hh.TBinop(b,m,A);break;case 1:let t=e.b;if(0==y._hx_index){let e=y.c;switch(e._hx_index){case 0:s=hh.TConst(nh.CBool(!1));break;case 1:let r=t,n=e.b;s=hh.TConst(nh.CBool((r==n?0:1)<=0));break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 2:let r=e.v;if(0==y._hx_index){let e=y.c;switch(e._hx_index){case 0:s=hh.TConst(nh.CBool(!1));break;case 2:let t=r,n=e.v;s=hh.TConst(nh.CBool(t-n<=0));break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 3:let n=e.v;if(0==y._hx_index){let e=y.c;switch(e._hx_index){case 0:s=hh.TConst(nh.CBool(!1));break;case 3:let t=n,r=e.v;s=hh.TConst(nh.CBool((t>r?1:t==r?0:-1)<=0));break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 4:let i=e.v;if(0==y._hx_index){let e=y.c;switch(e._hx_index){case 0:s=hh.TConst(nh.CBool(!1));break;case 4:let t=i,r=e.v;s=hh.TConst(nh.CBool((t>r?1:t==r?0:-1)<=0));break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 11:let B=A.e,C=m.e;if(0==C._hx_index){let e=C.c;if(2==e._hx_index)if(0==B._hx_index){let t=B.c;if(2==t._hx_index){let r=e.v,n=t.v;s=hh.TConst(nh.CInt(r&n))}else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A);else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A);break;case 12:let v=A.e,S=m.e;if(0==S._hx_index){let e=S.c;if(2==e._hx_index)if(0==v._hx_index){let t=v.c;if(2==t._hx_index){let r=e.v,n=t.v;s=hh.TConst(nh.CInt(r|n))}else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A);else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A);break;case 13:let M=A.e,I=m.e;if(0==I._hx_index){let e=I.c;if(2==e._hx_index)if(0==M._hx_index){let t=M.c;if(2==t._hx_index){let r=e.v,n=t.v;s=hh.TConst(nh.CInt(r^n))}else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A);else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A);break;case 14:let T=A.e,F=m.e;if(0==F._hx_index){let e=F.c;if(1==e._hx_index){let t=e.b;if(0==T._hx_index){let e=T.c;if(1==e._hx_index){let r=t,n=e.b;s=hh.TConst(nh.CBool(r&&n))}else{let e=t;s=0==e?hh.TConst(nh.CBool(e)):A.e}}else{let e=t;s=0==e?hh.TConst(nh.CBool(e)):A.e}}else if(0==T._hx_index){let e=T.c;if(1==e._hx_index){let t=e.b;s=0==t?hh.TConst(nh.CBool(t)):m.e}else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A)}else if(0==T._hx_index){let e=T.c;if(1==e._hx_index){let t=e.b;s=0==t?hh.TConst(nh.CBool(t)):m.e}else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A);break;case 15:let E=A.e,D=m.e;if(0==D._hx_index){let e=D.c;if(1==e._hx_index){let t=e.b;if(0==E._hx_index){let e=E.c;if(1==e._hx_index){let r=t,n=e.b;s=hh.TConst(nh.CBool(r||n))}else{let e=t;s=1==e?hh.TConst(nh.CBool(e)):A.e}}else{let e=t;s=1==e?hh.TConst(nh.CBool(e)):A.e}}else if(0==E._hx_index){let e=E.c;if(1==e._hx_index){let t=e.b;s=1==t?hh.TConst(nh.CBool(t)):m.e}else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A)}else if(0==E._hx_index){let e=E.c;if(1==e._hx_index){let t=e.b;s=1==t?hh.TConst(nh.CBool(t)):m.e}else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A);break;case 16:let R=A.e,V=m.e;if(0==V._hx_index){let e=V.c;if(2==e._hx_index)if(0==R._hx_index){let t=R.c;if(2==t._hx_index){let r=e.v,n=t.v;s=hh.TConst(nh.CInt(r<<n))}else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A);else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A);break;case 17:let O=A.e,P=m.e;if(0==P._hx_index){let e=P.c;if(2==e._hx_index)if(0==O._hx_index){let t=O.c;if(2==t._hx_index){let r=e.v,n=t.v;s=hh.TConst(nh.CInt(r>>n))}else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A);else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A);break;case 18:let Q=A.e,L=m.e;if(0==L._hx_index){let e=L.c;if(2==e._hx_index)if(0==Q._hx_index){let t=Q.c;if(2==t._hx_index){let r=e.v,n=t.v;s=hh.TConst(nh.CInt(r>>>n))}else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A);else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A);break;case 19:let G=A.e,z=m.e;if(0==z._hx_index){let e=z.c;switch(e._hx_index){case 2:if(0==G._hx_index){let t=G.c;if(2==t._hx_index){let r=e.v,n=t.v;s=hh.TConst(nh.CInt(r%n|0))}else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A);break;case 3:if(0==G._hx_index){let t=G.c;if(3==t._hx_index){let r=e.v,n=t.v;s=hh.TConst(nh.CFloat(r%n))}else s=hh.TBinop(b,m,A)}else s=hh.TBinop(b,m,A);break;default:s=hh.TBinop(b,m,A)}}else s=hh.TBinop(b,m,A);break;case 20:b.op;s=hh.TBinop(b,m,A);break;case 22:case 23:throw $i.thrown("assert")}break;case 6:let w=n.e1,y=n.op,k=this.evalExpr(w),B=k.e;if(0==B._hx_index){let e=B.c;switch(y._hx_index){case 2:if(1==e._hx_index){let t=e.b;s=hh.TConst(nh.CBool(!t))}else s=hh.TUnop(y,k);break;case 3:switch(e._hx_index){case 2:let t=e.v;s=hh.TConst(nh.CInt(-t));break;case 3:let r=e.v;s=hh.TConst(nh.CFloat(-r));break;default:s=hh.TUnop(y,k)}break;default:s=hh.TUnop(y,k)}}else s=hh.TUnop(y,k);break;case 7:let C=n.init,v=n.v;s=hh.TVarDecl(this.mapVar(v),null==C?null:this.evalExpr(C));break;case 8:let S=n.args,M=n.e,I=this.evalExpr(M),T=[],F=0;for(;F<S.length;){let e=S[F];++F,T.push(this.evalExpr(e))}let E=T,D=I.e;switch(D._hx_index){case 1:if(this.inlineCalls){let e=D.v;if(null!=this.funMap.h.__keys__[e.__id__]){let t=this.funMap.h[e.__id__],n=[],i=[],a=0,l=t.args.length;for(;a<l;){let e=a++,s=t.args[e],l=E[e],h=l.e;switch(h._hx_index){case 0:h.c;let e=this.constants.h[s.id];i.push((function(){null==e?r.constants.remove(s.id):r.constants.h[s.id]=e})),this.constants.h[s.id]=l.e;break;case 1:let t=h.v;t.type,t.qualifiers,t.parent,t.name,t.id;switch(t.kind._hx_index){case 0:case 1:case 2:let e=this.constants.h[s.id];i.push((function(){null==e?r.constants.remove(s.id):r.constants.h[s.id]=e})),this.constants.h[s.id]=l.e;break;default:let t=this.varMap.h[s.__id__];null==t?i.push((function(){r.varMap.remove(s)})):(this.varMap.remove(s),i.push((function(){r.varMap.set(s,t)})));let a=this.mapVar(s);n.push({e:hh.TVarDecl(a,l),t:ql.TVoid,p:l.p})}break;default:let a=this.varMap.h[s.__id__];null==a?i.push((function(){r.varMap.remove(s)})):(this.varMap.remove(s),i.push((function(){r.varMap.set(s,a)})));let o=this.mapVar(s);n.push({e:hh.TVarDecl(o,l),t:ql.TVoid,p:l.p})}}let h=this.handleReturn(this.evalExpr(t.expr,!1),!0),o=0;for(;o<i.length;){let e=i[o];++o,e()}let _=h.e;if(4==_._hx_index){let e=_.el,t=0;for(;t<e.length;){let s=e[t];++t,n.push(s)}}else n.push(h);s=hh.TBlock(n)}else s=eh.t("Cannot eval non-static call expresssion '"+(new Mh).exprString(I)+"'",I.p)}else s=hh.TCall(I,E);break;case 2:let t=D.g,n=this.evalCall(t,E,S,e.p);s=null!=n?n:hh.TCall(I,E);break;default:s=eh.t("Cannot eval non-static call expresssion '"+(new Mh).exprString(I)+"'",I.p)}break;case 9:let R=n.regs,V=n.e;s=hh.TSwiz(this.evalExpr(V),R.slice());break;case 10:let O=n.eelse,P=n.eif,Q=n.econd,L=this.evalExpr(Q),G=L.e;if(0==G._hx_index){let r=G.c;if(1==r._hx_index){s=r.b?this.evalExpr(P,t).e:null==O?hh.TConst(nh.CNull):this.evalExpr(O,t).e}else if(t&&null!=O&&this.eliminateConditionals)s=hh.TCall({e:hh.TGlobal(ah.Mix),t:e.t,p:e.p},[this.evalExpr(O,!0),this.evalExpr(P,!0),{e:hh.TCall({e:hh.TGlobal(ah.ToFloat),t:ql.TFun([]),p:L.p},[L]),t:ql.TFloat,p:e.p}]);else{if(P=this.evalExpr(P,t),null!=O){O=this.evalExpr(O,t);let e=O.e;0==e._hx_index&&0==e.c._hx_index&&(O=null)}P=this.ifBlock(P),O=this.ifBlock(O),s=hh.TIf(L,P,O)}}else if(t&&null!=O&&this.eliminateConditionals)s=hh.TCall({e:hh.TGlobal(ah.Mix),t:e.t,p:e.p},[this.evalExpr(O,!0),this.evalExpr(P,!0),{e:hh.TCall({e:hh.TGlobal(ah.ToFloat),t:ql.TFun([]),p:L.p},[L]),t:ql.TFloat,p:e.p}]);else{if(P=this.evalExpr(P,t),null!=O){O=this.evalExpr(O,t);let e=O.e;0==e._hx_index&&0==e.c._hx_index&&(O=null)}P=this.ifBlock(P),O=this.ifBlock(O),s=hh.TIf(L,P,O)}break;case 11:s=hh.TDiscard;break;case 12:let z=n.e;s=hh.TReturn(null==z?null:this.evalExpr(z));break;case 13:let U,W=n.loop,N=n.it,j=n.v,Y=this.mapVar(j),X=this.evalExpr(N),Z=X.e;if(5==Z._hx_index){let e=Z.e2,t=Z.e1;if(21==Z.op._hx_index){t.t,t.p;let s=t.e;if(0==s._hx_index){let t=s.c;if(2==t._hx_index){e.t,e.p;let s=e.e;if(0==s._hx_index){let e=s.c;if(2==e._hx_index){let s=t.v,r=e.v;if(this.unrollLoops){let e=[],t=s,n=r;for(;t<n;){let s=t++;this.constants.h[j.id]=hh.TConst(nh.CInt(s)),e.push(this.evalExpr(W,!1))}this.constants.remove(j.id),U=hh.TBlock(e)}else U=hh.TFor(Y,X,this.ifBlock(this.evalExpr(W,!1)))}else U=hh.TFor(Y,X,this.ifBlock(this.evalExpr(W,!1)))}else U=hh.TFor(Y,X,this.ifBlock(this.evalExpr(W,!1)))}else U=hh.TFor(Y,X,this.ifBlock(this.evalExpr(W,!1)))}else U=hh.TFor(Y,X,this.ifBlock(this.evalExpr(W,!1)))}else U=hh.TFor(Y,X,this.ifBlock(this.evalExpr(W,!1)))}else U=hh.TFor(Y,X,this.ifBlock(this.evalExpr(W,!1)));this.varMap.remove(j),s=U;break;case 14:s=hh.TContinue;break;case 15:s=hh.TBreak;break;case 16:let H=n.index,K=n.e,q=this.evalExpr(K),J=this.evalExpr(H),$=J.e,ee=q.e;if(17==ee._hx_index)if(0==$._hx_index){let e=$.c;if(2==e._hx_index){let t=ee.el,r=e.v;s=r>=0&&r<t.length?t[r].e:hh.TArray(q,J)}else s=hh.TArray(q,J)}else s=hh.TArray(q,J);else s=hh.TArray(q,J);break;case 17:let te=n.el,se=[],re=0;for(;re<te.length;){let e=te[re];++re,se.push(this.evalExpr(e))}s=hh.TArrayDecl(se);break;case 18:let ne=n.def,ie=n.cases,ae=n.e,le=this.evalExpr(ae),he=[],oe=0;for(;oe<ie.length;){let e=ie[oe];++oe;let s=[],r=0,n=e.values;for(;r<n.length;){let e=n[r];++r,s.push(this.evalExpr(e))}he.push({values:s,expr:this.evalExpr(e.expr,t)})}let _e=he,ce=null==ne?null:this.evalExpr(ne,t),ue=!1,de=le.e;if(0==de._hx_index){let e=de.c;if(2!=e._hx_index)throw $i.thrown("Unsupported switch constant "+x.string(e));{let t=e.v,s=0;for(;s<_e.length;){let e=_e[s];++s;let r=0,n=e.values;for(;r<n.length;){let s=n[r];++r;let i=s.e;if(0==i._hx_index){let s=i.c;switch(s._hx_index){case 2:if(s.v==t)return e.expr;break;case 3:if(s.v==t)return e.expr}}else ue=!0}}}}else ue=!0;s=ue?hh.TSwitch(le,_e,ce):null==ce?hh.TBlock([]):ce.e;break;case 19:let pe=n.normalWhile,fe=n.loop,xe=n.e,ge=this.evalExpr(xe),be=this.evalExpr(fe,!1);s=hh.TWhile(ge,this.ifBlock(be),pe);break;case 20:let me,Ae=n.e,we=n.args,ye=n.m;if("unroll"==ye){this.unrollLoops;this.unrollLoops=!0,me=this.evalExpr(Ae,t),this.unrollLoops=!1}else me=this.evalExpr(Ae,t);s=hh.TMeta(ye,we,me)}return{e:s,t:e.t,p:e.p}}}s["hxsl.Eval"]=bh,bh.__name__="hxsl.Eval",Object.assign(bh.prototype,{__class__:bh});class mh{constructor(e,t,s,r){this.g=e,this.t=t,this.pos=s,this.size=r}}s["hxsl._Flatten.Alloc"]=mh,mh.__name__="hxsl._Flatten.Alloc",Object.assign(mh.prototype,{__class__:mh});var Ah=n["hxsl.ARead"]={__ename__:"hxsl.ARead",__constructs__:["AIndex","AOffset"],AIndex:(t=function(e){return{_hx_index:0,a:e,__enum__:"hxsl.ARead",toString:r}},t.__params__=["a"],t),AOffset:(t=function(e,t,s){return{_hx_index:1,a:e,stride:t,delta:s,__enum__:"hxsl.ARead",toString:r}},t.__params__=["a","stride","delta"],t)};Ah.__empty_constructs__=[];class wh{constructor(){}flatten(e,t,s){if(this.globals=[],this.params=[],this.outVars=[],s){this.consts=[];let t=e.funs[0].expr.p,s={id:oh.allocVarId(),name:"__consts__",kind:th.Global,type:null};this.econsts={e:hh.TVar(s),t:null,p:t};let r=e.name,n=e.vars.slice(),i=[],a=0,l=e.funs;for(;a<l.length;){let e=l[a];++a,i.push(this.mapFun(e,ao(this,this.mapConsts)))}let h=0,o=(e={name:r,vars:n,funs:i}).vars;for(;h<o.length;){let e=o[h];++h;let s=e.type;if(9==s._hx_index){s.size;this.allocConst(255,t)}}this.consts.length>0&&(s.type=this.econsts.t=ql.TArray(ql.TFloat,$l.SConst(this.consts.length)),e.vars.push(s))}this.varMap=new Ca,this.allocData=new Ca;let r,n=0,i=e.vars;for(;n<i.length;){let e=i[n];++n,this.gatherVar(e)}switch(t._hx_index){case 0:r="vertex";break;case 1:r="fragment";break;default:throw $i.thrown("assert")}this.pack(r+"Globals",th.Global,this.globals,Jl.VFloat),this.pack(r+"Params",th.Param,this.params,Jl.VFloat);let a=this.globals.concat(this.params),l=this.packTextures(r+"Textures",a,ql.TSampler2D).concat(this.packTextures(r+"TexturesCube",a,ql.TSamplerCube)).concat(this.packTextures(r+"TexturesArray",a,ql.TSampler2DArray));this.packBuffers(a);let h=[],o=0,_=e.funs;for(;o<_.length;){let e=_[o];++o,h.push(this.mapFun(e,ao(this,this.mapExpr)))}let c=h,u=0;for(;u<l.length;){let e=l[u];++u,e.pos>>=2}return{name:e.name,vars:this.outVars,funs:c}}mapFun(e,t){return{kind:e.kind,ret:e.ret,args:e.args,ref:e.ref,expr:t(e.expr)}}mapExpr(e){let t=e.e;switch(t._hx_index){case 1:let s=t.v,r=this.varMap.h[s.__id__];null!=r&&(e=this.access(r,s.type,e.p,Ah.AIndex(r)));break;case 16:let n=t.e,i=(n.t,n.e);if(1==i._hx_index){let s,r=t.index,a=n.p,l=i.v,h=r.e;if(0==h._hx_index){let e=h.c;if(2==e._hx_index){e.v;s=!0}else s=!1}else s=!1;if(s)e=oh.map(e,ao(this,this.mapExpr));else{let t=this.varMap.h[l.__id__];if(null!=t){let s=l.type;if(15!=s._hx_index)throw $i.thrown("assert");{s.size;let n=s.t,i=this.varSize(n,t.t);if(0==i||0!=(3&i))throw $i.thrown(new eh("Dynamic access to an Array which size is not 4 components-aligned is not allowed",e.p));i>>=2,r=this.mapExpr(r);let l={e:hh.TCall({e:hh.TGlobal(ah.ToInt),t:ql.TFun([]),p:a},[r]),t:ql.TInt,p:a};e=this.access(t,n,a,Ah.AOffset(t,i,1==i?l:{e:hh.TBinop(Pa.OpMult,l,{e:hh.TConst(nh.CInt(i)),t:ql.TInt,p:a}),t:ql.TInt,p:a}))}}}}else e=oh.map(e,ao(this,this.mapExpr));break;default:e=oh.map(e,ao(this,this.mapExpr))}return this.optimize(e)}mapConsts(e){let t=e.e;switch(t._hx_index){case 0:let s=t.c;switch(s._hx_index){case 2:let t=s.v;return this.allocConst(t,e.p);case 3:let r=s.v;return this.allocConst(r,e.p);default:return e}break;case 2:switch(t.g._hx_index){case 0:this.allocConst(Math.PI/180,e.p);break;case 1:this.allocConst(180/Math.PI,e.p);break;case 9:this.allocConst(1.4426950408889634,e.p);break;case 10:this.allocConst(.6931471805599453,e.p);break;case 24:this.allocConst(1,e.p);break;case 26:this.allocConst(2,e.p),this.allocConst(3,e.p);break;case 54:this.allocConsts([1,255,65025,16581375],e.p),this.allocConsts([.00392156862745098,.00392156862745098,.00392156862745098,0],e.p);break;case 55:this.allocConsts([1,.00392156862745098,15378700499807768e-21,6.030862941101084e-8],e.p);break;case 56:this.allocConst(1,e.p),this.allocConst(.5,e.p);break;case 57:this.allocConst(.5,e.p);break;case 58:this.allocConsts([.5,.5],e.p),this.allocConsts([.5,-.5],e.p);break;case 59:this.allocConsts([2,-2],e.p),this.allocConsts([-1,1],e.p)}break;case 5:let r=t.e2;t.e1;if(1==t.op._hx_index){r.p,r.e;8==r.t._hx_index&&this.allocConst(1,e.p)}break;case 8:let n=t.args,i=t.e,a=(i.t,i.p,i.e);if(2==a._hx_index&&42==a.g._hx_index&&2==n.length){let t=n[1],s=n[0],r=s.t,i=(s.p,s.e);if(1==i._hx_index){let s=i.v;s.type,s.qualifiers,s.parent,s.name,s.id;switch(s.kind._hx_index){case 0:if(5==r._hx_index&&3==r.size&&1==r.t._hx_index){t.t,t.p;let s=t.e;if(0==s._hx_index){let t=s.c;if(2==t._hx_index&&1==t.v)return e}}break;case 1:if(5==r._hx_index&&3==r.size&&1==r.t._hx_index){t.t,t.p;let s=t.e;if(0==s._hx_index){let t=s.c;if(2==t._hx_index&&1==t.v)return e}}break;case 2:if(5==r._hx_index&&3==r.size&&1==r.t._hx_index){t.t,t.p;let s=t.e;if(0==s._hx_index){let t=s.c;if(2==t._hx_index&&1==t.v)return e}}break;case 3:if(5==r._hx_index&&3==r.size&&1==r.t._hx_index){t.t,t.p;let s=t.e;if(0==s._hx_index){let t=s.c;if(2==t._hx_index&&1==t.v)return e}}}}}break;case 16:let l=t.index,h=t.e,o=(l.t,l.p,l.e);if(0==o._hx_index){let t=o.c;if(2==t._hx_index){t.v;let s=h,r=l;return{e:hh.TArray(this.mapConsts(s),r),t:e.t,p:e.p}}{let t=h.t;if(15==t._hx_index){t.size;let s=t.t,r=this.varSize(s,Jl.VFloat)>>2;this.allocConst(r,e.p)}}}else{let t=h.t;if(15==t._hx_index){t.size;let s=t.t,r=this.varSize(s,Jl.VFloat)>>2;this.allocConst(r,e.p)}}}return oh.map(e,ao(this,this.mapConsts))}allocConst(e,t){let s=this.consts.indexOf(e);return s<0&&(s=this.consts.length,this.consts.push(e)),{e:hh.TArray(this.econsts,{e:hh.TConst(nh.CInt(s)),t:ql.TInt,p:t}),t:ql.TFloat,p:t}}allocConsts(e,t){let s=this,r=e.length-1&3,n=-1,i=0,a=this.consts.length-(e.length-1);for(;i<a;){let t=i++;if(t>>2!=t+r>>2)continue;let s=!0,a=0,l=e.length;for(;a<l;){let r=a++;if(this.consts[t+r]!=e[r]){s=!1;break}}if(s){n=t;break}}if(n<0){for(;this.consts.length>>2!=this.consts.length+r>>2;)this.consts.push(0);n=this.consts.length;let t=0;for(;t<e.length;){let s=e[t];++t,this.consts.push(s)}}switch(e.length){case 1:return{e:hh.TArray(s.econsts,{e:hh.TConst(nh.CInt(n)),t:ql.TInt,p:t}),t:ql.TFloat,p:t};case 2:return{e:hh.TCall({e:hh.TGlobal(ah.Vec2),t:ql.TVoid,p:t},[{e:hh.TArray(s.econsts,{e:hh.TConst(nh.CInt(n)),t:ql.TInt,p:t}),t:ql.TFloat,p:t},{e:hh.TArray(s.econsts,{e:hh.TConst(nh.CInt(n+1)),t:ql.TInt,p:t}),t:ql.TFloat,p:t}]),t:ql.TVec(2,Jl.VFloat),p:t};case 3:return{e:hh.TCall({e:hh.TGlobal(ah.Vec3),t:ql.TVoid,p:t},[{e:hh.TArray(s.econsts,{e:hh.TConst(nh.CInt(n)),t:ql.TInt,p:t}),t:ql.TFloat,p:t},{e:hh.TArray(s.econsts,{e:hh.TConst(nh.CInt(n+1)),t:ql.TInt,p:t}),t:ql.TFloat,p:t},{e:hh.TArray(s.econsts,{e:hh.TConst(nh.CInt(n+2)),t:ql.TInt,p:t}),t:ql.TFloat,p:t}]),t:ql.TVec(3,Jl.VFloat),p:t};case 4:return{e:hh.TCall({e:hh.TGlobal(ah.Vec4),t:ql.TVoid,p:t},[{e:hh.TArray(s.econsts,{e:hh.TConst(nh.CInt(n)),t:ql.TInt,p:t}),t:ql.TFloat,p:t},{e:hh.TArray(s.econsts,{e:hh.TConst(nh.CInt(n+1)),t:ql.TInt,p:t}),t:ql.TFloat,p:t},{e:hh.TArray(s.econsts,{e:hh.TConst(nh.CInt(n+3)),t:ql.TInt,p:t}),t:ql.TFloat,p:t},{e:hh.TArray(s.econsts,{e:hh.TConst(nh.CInt(n+4)),t:ql.TInt,p:t}),t:ql.TFloat,p:t}]),t:ql.TVec(4,Jl.VFloat),p:t};default:throw $i.thrown("assert")}}access(e,t,s,r){switch(t._hx_index){case 6:let n=this.access(e,ql.TMat3x4,s,r);return{e:hh.TCall({e:hh.TGlobal(ah.Mat3),t:ql.TFun([]),p:s},[n]),t:ql.TMat3,p:s};case 7:let i,a,l,h,o=hh.TGlobal(ah.Mat4),_=ql.TFun([]);switch(r._hx_index){case 0:let e=r.a;i={e:hh.TArray({e:hh.TVar(e.g),t:e.g.type,p:s},{e:hh.TConst(nh.CInt(e.pos>>2)),t:ql.TInt,p:s}),t:ql.TVec(4,e.t),p:s};break;case 1:let t=r.delta,n=(r.stride,r.a),a=n.pos>>2,l=0==a?t:{e:hh.TBinop(Pa.OpAdd,t,{e:hh.TConst(nh.CInt(a)),t:ql.TInt,p:s}),t:ql.TInt,p:s};i={e:hh.TArray({e:hh.TVar(n.g),t:n.g.type,p:s},l),t:ql.TVec(4,n.t),p:s}}switch(r._hx_index){case 0:let e=r.a;a={e:hh.TArray({e:hh.TVar(e.g),t:e.g.type,p:s},{e:hh.TConst(nh.CInt(1+(e.pos>>2))),t:ql.TInt,p:s}),t:ql.TVec(4,e.t),p:s};break;case 1:let t=r.delta,n=(r.stride,r.a),i=1+(n.pos>>2),l=0==i?t:{e:hh.TBinop(Pa.OpAdd,t,{e:hh.TConst(nh.CInt(i)),t:ql.TInt,p:s}),t:ql.TInt,p:s};a={e:hh.TArray({e:hh.TVar(n.g),t:n.g.type,p:s},l),t:ql.TVec(4,n.t),p:s}}switch(r._hx_index){case 0:let e=r.a;l={e:hh.TArray({e:hh.TVar(e.g),t:e.g.type,p:s},{e:hh.TConst(nh.CInt(2+(e.pos>>2))),t:ql.TInt,p:s}),t:ql.TVec(4,e.t),p:s};break;case 1:let t=r.delta,n=(r.stride,r.a),i=2+(n.pos>>2),a=0==i?t:{e:hh.TBinop(Pa.OpAdd,t,{e:hh.TConst(nh.CInt(i)),t:ql.TInt,p:s}),t:ql.TInt,p:s};l={e:hh.TArray({e:hh.TVar(n.g),t:n.g.type,p:s},a),t:ql.TVec(4,n.t),p:s}}switch(r._hx_index){case 0:let e=r.a;h={e:hh.TArray({e:hh.TVar(e.g),t:e.g.type,p:s},{e:hh.TConst(nh.CInt(3+(e.pos>>2))),t:ql.TInt,p:s}),t:ql.TVec(4,e.t),p:s};break;case 1:let t=r.delta,n=(r.stride,r.a),i=3+(n.pos>>2),a=0==i?t:{e:hh.TBinop(Pa.OpAdd,t,{e:hh.TConst(nh.CInt(i)),t:ql.TInt,p:s}),t:ql.TInt,p:s};h={e:hh.TArray({e:hh.TVar(n.g),t:n.g.type,p:s},a),t:ql.TVec(4,n.t),p:s}}return{e:hh.TCall({e:o,t:_,p:s},[i,a,l,h]),t:ql.TMat4,p:s};case 8:let c,u,d,p=hh.TGlobal(ah.Mat3x4),f=ql.TFun([]);switch(r._hx_index){case 0:let e=r.a;c={e:hh.TArray({e:hh.TVar(e.g),t:e.g.type,p:s},{e:hh.TConst(nh.CInt(e.pos>>2)),t:ql.TInt,p:s}),t:ql.TVec(4,e.t),p:s};break;case 1:let t=r.delta,n=(r.stride,r.a),i=n.pos>>2,a=0==i?t:{e:hh.TBinop(Pa.OpAdd,t,{e:hh.TConst(nh.CInt(i)),t:ql.TInt,p:s}),t:ql.TInt,p:s};c={e:hh.TArray({e:hh.TVar(n.g),t:n.g.type,p:s},a),t:ql.TVec(4,n.t),p:s}}switch(r._hx_index){case 0:let e=r.a;u={e:hh.TArray({e:hh.TVar(e.g),t:e.g.type,p:s},{e:hh.TConst(nh.CInt(1+(e.pos>>2))),t:ql.TInt,p:s}),t:ql.TVec(4,e.t),p:s};break;case 1:let t=r.delta,n=(r.stride,r.a),i=1+(n.pos>>2),a=0==i?t:{e:hh.TBinop(Pa.OpAdd,t,{e:hh.TConst(nh.CInt(i)),t:ql.TInt,p:s}),t:ql.TInt,p:s};u={e:hh.TArray({e:hh.TVar(n.g),t:n.g.type,p:s},a),t:ql.TVec(4,n.t),p:s}}switch(r._hx_index){case 0:let e=r.a;d={e:hh.TArray({e:hh.TVar(e.g),t:e.g.type,p:s},{e:hh.TConst(nh.CInt(2+(e.pos>>2))),t:ql.TInt,p:s}),t:ql.TVec(4,e.t),p:s};break;case 1:let t=r.delta,n=(r.stride,r.a),i=2+(n.pos>>2),a=0==i?t:{e:hh.TBinop(Pa.OpAdd,t,{e:hh.TConst(nh.CInt(i)),t:ql.TInt,p:s}),t:ql.TInt,p:s};d={e:hh.TArray({e:hh.TVar(n.g),t:n.g.type,p:s},a),t:ql.TVec(4,n.t),p:s}}return{e:hh.TCall({e:p,t:f,p:s},[c,u,d]),t:ql.TMat3x4,p:s};case 15:let x=t.size;if(0==x._hx_index){let r=t.t,n=x.v,i=e.size/n|0,a=[],l=0,h=n;for(;l<h;){let t=l++,n=new mh(e.g,e.t,e.pos+i*t,i);a.push(this.access(n,r,s,Ah.AIndex(n)))}let o=a;return{e:hh.TArrayDecl(o),t:r,p:s}}{if(oh.isSampler(t)){let e;switch(r._hx_index){case 0:let t=r.a;e={e:hh.TArray({e:hh.TVar(t.g),t:t.g.type,p:s},{e:hh.TConst(nh.CInt(t.pos>>2)),t:ql.TInt,p:s}),t:ql.TVec(4,t.t),p:s};break;case 1:let n=r.delta,i=(r.stride,r.a),a=i.pos>>2,l=0==a?n:{e:hh.TBinop(Pa.OpAdd,n,{e:hh.TConst(nh.CInt(a)),t:ql.TInt,p:s}),t:ql.TInt,p:s};e={e:hh.TArray({e:hh.TVar(i.g),t:i.g.type,p:s},l),t:ql.TVec(4,i.t),p:s}}return e.t=t,e}let n,i=this.varSize(t,e.t);if(i>4)return eh.t("Access not supported for "+oh.toString(t),null);switch(r._hx_index){case 0:let e=r.a;n={e:hh.TArray({e:hh.TVar(e.g),t:e.g.type,p:s},{e:hh.TConst(nh.CInt(e.pos>>2)),t:ql.TInt,p:s}),t:ql.TVec(4,e.t),p:s};break;case 1:let t=r.delta,i=(r.stride,r.a),a=i.pos>>2,l=0==a?t:{e:hh.TBinop(Pa.OpAdd,t,{e:hh.TConst(nh.CInt(a)),t:ql.TInt,p:s}),t:ql.TInt,p:s};n={e:hh.TArray({e:hh.TVar(i.g),t:i.g.type,p:s},l),t:ql.TVec(4,i.t),p:s}}if(4==i){if(0!=(3&e.pos))throw $i.thrown("assert")}else{let r=[],a=0,l=i;for(;a<l;){let t=a++;r.push(oh.SWIZ[t+(3&e.pos)])}n={e:hh.TSwiz(n,r),t,p:s}}switch(t._hx_index){case 1:n.t=ql.TFloat,n={e:hh.TCall({e:hh.TGlobal(ah.ToInt),t:ql.TFun([]),p:s},[n]),t,p:s};break;case 5:if(0==t.t._hx_index){let e=t.size;n.t=ql.TVec(e,Jl.VFloat),n={e:hh.TCall({e:hh.TGlobal([ah.IVec2,ah.IVec3,ah.IVec4][e-2]),t:ql.TFun([]),p:s},[n]),t,p:s}}}return n}default:if(oh.isSampler(t)){let e;switch(r._hx_index){case 0:let t=r.a;e={e:hh.TArray({e:hh.TVar(t.g),t:t.g.type,p:s},{e:hh.TConst(nh.CInt(t.pos>>2)),t:ql.TInt,p:s}),t:ql.TVec(4,t.t),p:s};break;case 1:let n=r.delta,i=(r.stride,r.a),a=i.pos>>2,l=0==a?n:{e:hh.TBinop(Pa.OpAdd,n,{e:hh.TConst(nh.CInt(a)),t:ql.TInt,p:s}),t:ql.TInt,p:s};e={e:hh.TArray({e:hh.TVar(i.g),t:i.g.type,p:s},l),t:ql.TVec(4,i.t),p:s}}return e.t=t,e}let g,b=this.varSize(t,e.t);if(b>4)return eh.t("Access not supported for "+oh.toString(t),null);switch(r._hx_index){case 0:let e=r.a;g={e:hh.TArray({e:hh.TVar(e.g),t:e.g.type,p:s},{e:hh.TConst(nh.CInt(e.pos>>2)),t:ql.TInt,p:s}),t:ql.TVec(4,e.t),p:s};break;case 1:let t=r.delta,n=(r.stride,r.a),i=n.pos>>2,a=0==i?t:{e:hh.TBinop(Pa.OpAdd,t,{e:hh.TConst(nh.CInt(i)),t:ql.TInt,p:s}),t:ql.TInt,p:s};g={e:hh.TArray({e:hh.TVar(n.g),t:n.g.type,p:s},a),t:ql.TVec(4,n.t),p:s}}if(4==b){if(0!=(3&e.pos))throw $i.thrown("assert")}else{let r=[],n=0,i=b;for(;n<i;){let t=n++;r.push(oh.SWIZ[t+(3&e.pos)])}g={e:hh.TSwiz(g,r),t,p:s}}switch(t._hx_index){case 1:g.t=ql.TFloat,g={e:hh.TCall({e:hh.TGlobal(ah.ToInt),t:ql.TFun([]),p:s},[g]),t,p:s};break;case 5:if(0==t.t._hx_index){let e=t.size;g.t=ql.TVec(e,Jl.VFloat),g={e:hh.TCall({e:hh.TGlobal([ah.IVec2,ah.IVec3,ah.IVec4][e-2]),t:ql.TFun([]),p:s},[g]),t,p:s}}}return g}}optimize(e){let t=e.e;switch(t._hx_index){case 8:let s=t.args,r=t.e,n=(r.t,r.p,r.e);if(2==n._hx_index&&52==n.g._hx_index&&1==s.length){let t=s[0],r=(t.t,t.p,t.e);if(8==r._hx_index){let t=r.e,s=(t.t,t.p,t.e);if(2==s._hx_index&&51==s.g._hx_index){let t=r.args,s=0,n=0;for(;n<4;){let e=t[t.length-1-s].t;n+=this.varSize(e,Jl.VFloat),++s}if(4==n){let r,n=0,i=s;for(;n<i;){n++;t.pop()}let a=e.e;if(8!=a._hx_index)throw $i.thrown("assert");a.args;r=a.e;return{e:hh.TCall(r,t),t:e.t,p:e.p}}}}}break;case 16:let i=t.index,a=t.e,l=(a.t,a.p,a.e);if(17==l._hx_index){i.t,i.p;let t=i.e;if(0==t._hx_index){let s=t.c;if(2==s._hx_index){let t=l.el,r=s.v;if(r>=0&&r<t.length)return t[r];eh.t("Reading outside array bounds",e.p)}}}}return e}packTextures(e,t,s){let r=[],n={id:oh.allocVarId(),name:e,type:s,kind:th.Param},i=0;for(;i<t.length;){let e=t[i];if(++i,e.type!=s){let t;if(s==ql.TSampler2D){let s=e.type;if(17==s._hx_index){s.size;t=!0}else t=!1}else t=!1;if(!t)continue}let a=new mh(n,null,r.length<<2,1);a.v=e,this.varMap.set(e,a),r.push(a)}return n.type=ql.TArray(s,$l.SConst(r.length)),r.length>0&&(this.outVars.push(n),this.allocData.set(n,r)),r}packBuffers(e){let t=[],s={id:oh.allocVarId(),name:"buffers",type:ql.TVoid,kind:th.Param},r=0;for(;r<e.length;){let n=e[r];++r;let i,a=n.type;if(16==a._hx_index){a.size,a.t;i=!0}else i=!1;if(i){let e=new mh(s,null,t.length,1);e.v=n,t.push(e),this.outVars.push(n)}}s.type=ql.TArray(ql.TBuffer(ql.TVoid,$l.SConst(0)),$l.SConst(t.length)),this.allocData.set(s,t)}pack(e,t,s,r){let n=[],i=0,a={id:oh.allocVarId(),name:e,type:ql.TVec(0,r),kind:t},l=0;for(;l<s.length;){let e,t=s[l];if(++l,oh.isSampler(t.type))e=!0;else{let s=t.type;if(16==s._hx_index){s.size,s.t;e=!0}else e=!1}if(e)continue;let h=this.varSize(t.type,r),o=null,_=0;for(;_<n.length;){let e=n[_];++_,null==e.v&&e.size>=h&&(null==o||o.size>e.size)&&(o=e)}if(null!=o){let e=o.size-h;if(e>0){let t=n.indexOf(o),s=new mh(a,r,o.pos+h,e);n.splice(t+1,0,s),o.size=h}o.v=t,this.varMap.set(t,o)}else{let e=new mh(a,r,i,h);i+=h,e.v=t,this.varMap.set(t,e),n.push(e);let s=(4-h%4)%4;if(s>0){let e=new mh(a,r,i,s);i+=s,n.push(e)}}}return a.type=ql.TArray(ql.TVec(4,r),$l.SConst(i>>2)),i>0&&(this.outVars.push(a),this.allocData.set(a,n)),a}varSize(e,t){switch(e._hx_index){case 1:case 3:if(t==Jl.VFloat)return 1;throw $i.thrown(oh.toString(e)+" size unknown for type "+x.string(t));case 5:let s=e.t,r=e.size;if(t==s)return r;throw $i.thrown(oh.toString(e)+" size unknown for type "+x.string(t));case 7:if(t==Jl.VFloat)return 16;throw $i.thrown(oh.toString(e)+" size unknown for type "+x.string(t));case 6:case 8:if(t==Jl.VFloat)return 12;throw $i.thrown(oh.toString(e)+" size unknown for type "+x.string(t));case 15:let n=e.size;if(0==n._hx_index){let s=e.t,r=n.v;return this.varSize(s,t)*r}throw $i.thrown(oh.toString(e)+" size unknown for type "+x.string(t));default:throw $i.thrown(oh.toString(e)+" size unknown for type "+x.string(t))}}gatherVar(e){let t=e.type;if(13==t._hx_index){let e=t.vl,s=0;for(;s<e.length;){let t=e[s];++s,this.gatherVar(t)}}else switch(e.kind._hx_index){case 0:oh.hasQualifier(e,sh.PerObject)?this.params.push(e):this.globals.push(e);break;case 2:this.params.push(e);break;default:this.outVars.push(e)}}}s["hxsl.Flatten"]=wh,wh.__name__="hxsl.Flatten",Object.assign(wh.prototype,{__class__:wh});class yh{constructor(){this.channels=[],this.map=new ya}set(e,t){let s=this.map,r=yh.allocID(e);s.h[r]=t}allocChannelID(e){let t=0,s=this.maxChannels;for(;t<s;){let s=t++;if(this.channels[s]==e)return s}if(this.maxChannels==1<<oh.MAX_CHANNELS_BITS)throw $i.thrown("Too many unique channels");let r=this.maxChannels++;return this.channels[r]=e,r}static allocID(e){null==yh.MAP&&(yh.MAP=new va,yh.ALL=[]);let t=yh.MAP.h[e];return null==t&&(t=yh.ALL.length,yh.ALL.push(e),yh.MAP.h[e]=t),t}}s["hxsl.Globals"]=yh,yh.__name__="hxsl.Globals",Object.assign(yh.prototype,{__class__:yh});class kh{constructor(){this.outIndex=0,this.uniformBuffer=0,this.exprIds=0,this.varNames=new ya,this.allNames=new va}decl(e){let t=0,s=this.decls;for(;t<s.length;){let r=s[t];if(++t,r==e)return}35==c.cca(e,0)?this.decls.unshift(e):this.decls.push(e)}addType(e){switch(e._hx_index){case 0:this.buf.b+=x.string("void");break;case 1:this.buf.b+=x.string("int");break;case 2:this.buf.b+=x.string("bool");break;case 3:this.buf.b+=x.string("float");break;case 4:this.buf.b+=x.string("string");break;case 5:let t=e.t,s=e.size;switch(t._hx_index){case 0:this.buf.b+=x.string("i");break;case 1:break;case 2:this.buf.b+=x.string("b")}this.buf.b+=x.string("vec"),this.buf.b+=x.string(s);break;case 6:this.buf.b+=x.string("mat3");break;case 7:this.buf.b+=x.string("mat4");break;case 8:this.decl(kh.MAT34),this.buf.b+=x.string("_mat3x4");break;case 9:let r=e.size;this.buf.b+=x.string("vec"),this.buf.b+=x.string(r);break;case 10:this.buf.b+=x.string("sampler2D");break;case 11:this.buf.b+=x.string("sampler2DArray"),null!=this.glES&&this.decl("precision lowp sampler2DArray;");break;case 12:this.buf.b+=x.string("samplerCube");break;case 13:let n=e.vl;this.buf.b+=x.string("struct { ");let i=0;for(;i<n.length;){let e=n[i];++i,this.addVar(e),this.buf.b+=x.string(";")}this.buf.b+=x.string(" }");break;case 14:e.variants;this.buf.b+=x.string("function");break;case 15:let a=e.size,l=e.t;switch(this.addType(l),this.buf.b+=x.string("["),a._hx_index){case 0:let e=a.v;if(1==e)if(this.intelDriverFix)this.buf.b+=x.string(2);else{let t=e;this.buf.b+=x.string(t)}else{let t=e;this.buf.b+=x.string(t)}break;case 1:let t=a.v,s=this.varName(t);this.buf.b+=x.string(s)}this.buf.b+=x.string("]");break;case 16:e.size,e.t;throw $i.thrown("assert");case 17:let h=e.size;this.buf.b+=x.string("channel"+h)}}addVar(e){let t=e.type;switch(t._hx_index){case 15:let s=t.size,r=t.t,n=e.type;switch(e.type=r,this.addVar(e),e.type=n,this.buf.b+=x.string("["),s._hx_index){case 0:let e=s.v;if(1==e)if(this.intelDriverFix)this.buf.b+=x.string(2);else{let t=e;this.buf.b+=x.string(t)}else{let t=e;this.buf.b+=x.string(t)}break;case 1:let t=s.v,r=this.varName(t);this.buf.b+=x.string(r)}this.buf.b+=x.string("]");break;case 16:let i=t.size,a=t.t;this.buf.b+=x.string("uniform_buffer"+this.uniformBuffer++),this.buf.b+=x.string(" { "),e.type=ql.TArray(a,i),this.addVar(e),e.type=ql.TBuffer(a,i),this.buf.b+=x.string("; }");break;default:this.addType(e.type),this.buf.b+=x.string(" ");let l=this.varName(e);this.buf.b+=x.string(l)}}addValue(e,t){let s=e.e;switch(s._hx_index){case 4:let r=s.el,n="val"+this.exprIds++,i=this.buf;this.buf=new g,this.addType(e.t),this.buf.b+=x.string(" "),this.buf.b+=x.string(n),this.buf.b+=x.string("(void)");let a=r.slice(),l=a[a.length-1];a[a.length-1]={e:hh.TReturn(l),t:e.t,p:l.p};let h={t:ql.TVoid,e:hh.TBlock(a),p:e.p};this.addExpr(h,""),this.exprValues.push(this.buf.b),this.buf=i,this.buf.b+=x.string(n),this.buf.b+=x.string("()");break;case 10:let o=s.eelse,_=s.eif,c=s.econd;this.buf.b+=x.string("( "),this.addValue(c,t),this.buf.b+=x.string(" ) ? "),this.addValue(_,t),this.buf.b+=x.string(" : "),this.addValue(o,t);break;case 20:s.args,s.m;let u=s.e;this.addValue(u,t);break;default:this.addExpr(e,t)}}addBlock(e,t){this.addExpr(e,t)}getFunName(e,t,s){switch(e._hx_index){case 20:if(s==ql.TInt&&null!=this.glES)return this.decl("int _imod( int x, int y ) { return int(mod(float(x),float(y))); }"),"_imod";break;case 33:let e=t[0].t;switch(e._hx_index){case 10:case 11:if(null!=this.glES&&this.glES<=2)return"texture2D";break;case 12:if(null!=this.glES&&this.glES<=2)return"textureCube";break;case 17:e.size;if(null!=this.glES&&this.glES<=2)return"texture2D"}break;case 34:let r=t[0].t;switch(r._hx_index){case 10:case 11:if(null!=this.glES&&this.glES<=2)return this.decl("#extension GL_EXT_shader_texture_lod : enable"),"texture2DLodEXT";break;case 12:if(null!=this.glES&&this.glES<=2)return this.decl("#extension GL_EXT_shader_texture_lod : enable"),"textureCubeLodEXT";break;case 17:r.size;if(null!=this.glES&&this.glES<=2)return this.decl("#extension GL_EXT_shader_texture_lod : enable"),"texture2DLodEXT"}break;case 35:case 36:return"texelFetch";case 50:if(t[0].t==ql.TMat3x4)return this.decl(kh.MAT34),this.decl("mat3 _mat3( _mat3x4 v ) { return mat3(v.a.xyz,v.b.xyz,v.c.xyz); }"),"_mat3";break;case 52:if(this.decl(kh.MAT34),1==t.length)return this.decl("_mat3x4 mat_to_34( mat4 m ) { return _mat3x4(m[0],m[1],m[2]); }"),"mat_to_34";break;case 54:this.decl("vec4 pack( float v ) { vec4 color = fract(v * vec4(1, 255, 255.*255., 255.*255.*255.)); return color - color.yzww * vec4(1. / 255., 1. / 255., 1. / 255., 0.); }");break;case 55:this.decl("float unpack( vec4 color ) { return dot(color,vec4(1., 1. / 255., 1. / (255. * 255.), 1. / (255. * 255. * 255.))); }");break;case 56:this.decl("vec4 packNormal( vec3 v ) { return vec4((v + vec3(1.)) * vec3(0.5),1.); }");break;case 57:this.decl("vec3 unpackNormal( vec4 v ) { return normalize((v.xyz - vec3(0.5)) * vec3(2.)); }");break;case 58:this.decl("vec2 screenToUv( vec2 v ) { return v * vec2(0.5,-0.5) + vec2(0.5,0.5); }");break;case 59:this.decl("vec2 uvToScreen( vec2 v ) { return v * vec2(2.,-2.) + vec2(-1., 1.); }");break;case 60:case 61:case 62:this.decl("#extension GL_OES_standard_derivatives:enable")}return kh.GLOBALS.get(e)}addExpr(e,t){let s=e.e;switch(s._hx_index){case 0:let r=s.c;switch(r._hx_index){case 0:this.buf.b+=x.string("null");break;case 1:let e=r.b;this.buf.b+=x.string(e);break;case 2:let t=r.v;this.buf.b+=x.string(t);break;case 3:let s=""+r.v;this.buf.b+=x.string(s),-1==s.indexOf(".")&&-1==s.indexOf("e")&&(this.buf.b+=x.string("."));break;case 4:let n=r.v;this.buf.b+=x.string('"'+n+'"')}break;case 1:let n=s.v,i=this.varName(n);this.buf.b+=x.string(i);break;case 2:let a=s.g,l=kh.GLOBALS.get(a);this.buf.b+=x.string(l);break;case 3:let h=s.e;this.buf.b+=x.string("("),this.addValue(h,t),this.buf.b+=x.string(")");break;case 4:let o=s.el;this.buf.b+=x.string("{\n");let _=t+"\t",c=0;for(;c<o.length;){let e=o[c];++c,this.buf.b+=x.string(_),this.addExpr(e,_),this.newLine(e)}this.buf.b+=x.string(t),this.buf.b+=x.string("}");break;case 5:let u=s.e2,d=s.e1,p=s.op,f=u.t,g=d.t;switch(p._hx_index){case 1:if(5==g._hx_index)if(3==g.size)if(1==g.t._hx_index)if(8==f._hx_index){let e;if(this.decl(kh.MAT34),this.decl("vec3 m3x4mult( vec3 v, _mat3x4 m) { vec4 ve = vec4(v,1.0); return vec3(dot(m.a,ve),dot(m.b,ve),dot(m.c,ve)); }"),20==p._hx_index){p.op;e=!0}else e=!1;e&&(this.addValue(d,t),this.buf.b+=x.string(" = ")),this.buf.b+=x.string("m3x4mult("),this.addValue(d,t),this.buf.b+=x.string(","),this.addValue(u,t),this.buf.b+=x.string(")")}else{this.addValue(d,t),this.buf.b+=x.string(" ");let e=Mh.opStr(p);this.buf.b+=x.string(e),this.buf.b+=x.string(" "),this.addValue(u,t)}else{this.addValue(d,t),this.buf.b+=x.string(" ");let e=Mh.opStr(p);this.buf.b+=x.string(e),this.buf.b+=x.string(" "),this.addValue(u,t)}else{this.addValue(d,t),this.buf.b+=x.string(" ");let e=Mh.opStr(p);this.buf.b+=x.string(e),this.buf.b+=x.string(" "),this.addValue(u,t)}else{this.addValue(d,t),this.buf.b+=x.string(" ");let e=Mh.opStr(p);this.buf.b+=x.string(e),this.buf.b+=x.string(" "),this.addValue(u,t)}break;case 5:if(5==g._hx_index){g.t;if(5==f._hx_index){f.t,f.size;let e,s=g.size;switch(this.buf.b+=x.string("vec"+s+"("),p._hx_index){case 5:e="equal";break;case 6:e="notEqual";break;case 7:e="greaterThan";break;case 8:e="greaterThanEqual";break;case 9:e="lessThan";break;case 10:e="lessThanEqual";break;default:throw $i.thrown("assert")}this.buf.b+=x.string(e),this.buf.b+=x.string("("),this.addValue(d,t),this.buf.b+=x.string(","),this.addValue(u,t),this.buf.b+=x.string("))")}else{this.addValue(d,t),this.buf.b+=x.string(" ");let e=Mh.opStr(p);this.buf.b+=x.string(e),this.buf.b+=x.string(" "),this.addValue(u,t)}}else{this.addValue(d,t),this.buf.b+=x.string(" ");let e=Mh.opStr(p);this.buf.b+=x.string(e),this.buf.b+=x.string(" "),this.addValue(u,t)}break;case 6:if(5==g._hx_index){g.t;if(5==f._hx_index){f.t,f.size;let e,s=g.size;switch(this.buf.b+=x.string("vec"+s+"("),p._hx_index){case 5:e="equal";break;case 6:e="notEqual";break;case 7:e="greaterThan";break;case 8:e="greaterThanEqual";break;case 9:e="lessThan";break;case 10:e="lessThanEqual";break;default:throw $i.thrown("assert")}this.buf.b+=x.string(e),this.buf.b+=x.string("("),this.addValue(d,t),this.buf.b+=x.string(","),this.addValue(u,t),this.buf.b+=x.string("))")}else{this.addValue(d,t),this.buf.b+=x.string(" ");let e=Mh.opStr(p);this.buf.b+=x.string(e),this.buf.b+=x.string(" "),this.addValue(u,t)}}else{this.addValue(d,t),this.buf.b+=x.string(" ");let e=Mh.opStr(p);this.buf.b+=x.string(e),this.buf.b+=x.string(" "),this.addValue(u,t)}break;case 7:if(5==g._hx_index){g.t;if(5==f._hx_index){f.t,f.size;let e,s=g.size;switch(this.buf.b+=x.string("vec"+s+"("),p._hx_index){case 5:e="equal";break;case 6:e="notEqual";break;case 7:e="greaterThan";break;case 8:e="greaterThanEqual";break;case 9:e="lessThan";break;case 10:e="lessThanEqual";break;default:throw $i.thrown("assert")}this.buf.b+=x.string(e),this.buf.b+=x.string("("),this.addValue(d,t),this.buf.b+=x.string(","),this.addValue(u,t),this.buf.b+=x.string("))")}else{this.addValue(d,t),this.buf.b+=x.string(" ");let e=Mh.opStr(p);this.buf.b+=x.string(e),this.buf.b+=x.string(" "),this.addValue(u,t)}}else{this.addValue(d,t),this.buf.b+=x.string(" ");let e=Mh.opStr(p);this.buf.b+=x.string(e),this.buf.b+=x.string(" "),this.addValue(u,t)}break;case 8:if(5==g._hx_index){g.t;if(5==f._hx_index){f.t,f.size;let e,s=g.size;switch(this.buf.b+=x.string("vec"+s+"("),p._hx_index){case 5:e="equal";break;case 6:e="notEqual";break;case 7:e="greaterThan";break;case 8:e="greaterThanEqual";break;case 9:e="lessThan";break;case 10:e="lessThanEqual";break;default:throw $i.thrown("assert")}this.buf.b+=x.string(e),this.buf.b+=x.string("("),this.addValue(d,t),this.buf.b+=x.string(","),this.addValue(u,t),this.buf.b+=x.string("))")}else{this.addValue(d,t),this.buf.b+=x.string(" ");let e=Mh.opStr(p);this.buf.b+=x.string(e),this.buf.b+=x.string(" "),this.addValue(u,t)}}else{this.addValue(d,t),this.buf.b+=x.string(" ");let e=Mh.opStr(p);this.buf.b+=x.string(e),this.buf.b+=x.string(" "),this.addValue(u,t)}break;case 9:if(5==g._hx_index){g.t;if(5==f._hx_index){f.t,f.size;let e,s=g.size;switch(this.buf.b+=x.string("vec"+s+"("),p._hx_index){case 5:e="equal";break;case 6:e="notEqual";break;case 7:e="greaterThan";break;case 8:e="greaterThanEqual";break;case 9:e="lessThan";break;case 10:e="lessThanEqual";break;default:throw $i.thrown("assert")}this.buf.b+=x.string(e),this.buf.b+=x.string("("),this.addValue(d,t),this.buf.b+=x.string(","),this.addValue(u,t),this.buf.b+=x.string("))")}else{this.addValue(d,t),this.buf.b+=x.string(" ");let e=Mh.opStr(p);this.buf.b+=x.string(e),this.buf.b+=x.string(" "),this.addValue(u,t)}}else{this.addValue(d,t),this.buf.b+=x.string(" ");let e=Mh.opStr(p);this.buf.b+=x.string(e),this.buf.b+=x.string(" "),this.addValue(u,t)}break;case 10:if(5==g._hx_index){g.t;if(5==f._hx_index){f.t,f.size;let e,s=g.size;switch(this.buf.b+=x.string("vec"+s+"("),p._hx_index){case 5:e="equal";break;case 6:e="notEqual";break;case 7:e="greaterThan";break;case 8:e="greaterThanEqual";break;case 9:e="lessThan";break;case 10:e="lessThanEqual";break;default:throw $i.thrown("assert")}this.buf.b+=x.string(e),this.buf.b+=x.string("("),this.addValue(d,t),this.buf.b+=x.string(","),this.addValue(u,t),this.buf.b+=x.string("))")}else{this.addValue(d,t),this.buf.b+=x.string(" ");let e=Mh.opStr(p);this.buf.b+=x.string(e),this.buf.b+=x.string(" "),this.addValue(u,t)}}else{this.addValue(d,t),this.buf.b+=x.string(" ");let e=Mh.opStr(p);this.buf.b+=x.string(e),this.buf.b+=x.string(" "),this.addValue(u,t)}break;case 18:this.decl("int _ushr( int i, int j ) { return int(uint(i) >> uint(j)); }"),this.buf.b+=x.string("_ushr("),this.addValue(d,t),this.buf.b+=x.string(","),this.addValue(u,t),this.buf.b+=x.string(")");break;case 19:if(e.t!=ql.TInt){let s;if(20==p._hx_index){p.op;s=!0}else s=!1;s&&(this.addValue(d,t),this.buf.b+=x.string(" = ")),this.addExpr({e:hh.TCall({e:hh.TGlobal(ah.Mod),t:ql.TFun([]),p:e.p},[d,u]),t:e.t,p:e.p},t)}else{this.addValue(d,t),this.buf.b+=x.string(" ");let e=Mh.opStr(p);this.buf.b+=x.string(e),this.buf.b+=x.string(" "),this.addValue(u,t)}break;case 20:switch(p.op._hx_index){case 1:if(5==g._hx_index)if(3==g.size)if(1==g.t._hx_index)if(8==f._hx_index){let e;if(this.decl(kh.MAT34),this.decl("vec3 m3x4mult( vec3 v, _mat3x4 m) { vec4 ve = vec4(v,1.0); return vec3(dot(m.a,ve),dot(m.b,ve),dot(m.c,ve)); }"),20==p._hx_index){p.op;e=!0}else e=!1;e&&(this.addValue(d,t),this.buf.b+=x.string(" = ")),this.buf.b+=x.string("m3x4mult("),this.addValue(d,t),this.buf.b+=x.string(","),this.addValue(u,t),this.buf.b+=x.string(")")}else{this.addValue(d,t),this.buf.b+=x.string(" ");let e=Mh.opStr(p);this.buf.b+=x.string(e),this.buf.b+=x.string(" "),this.addValue(u,t)}else{this.addValue(d,t),this.buf.b+=x.string(" ");let e=Mh.opStr(p);this.buf.b+=x.string(e),this.buf.b+=x.string(" "),this.addValue(u,t)}else{this.addValue(d,t),this.buf.b+=x.string(" ");let e=Mh.opStr(p);this.buf.b+=x.string(e),this.buf.b+=x.string(" "),this.addValue(u,t)}else{this.addValue(d,t),this.buf.b+=x.string(" ");let e=Mh.opStr(p);this.buf.b+=x.string(e),this.buf.b+=x.string(" "),this.addValue(u,t)}break;case 19:if(e.t!=ql.TInt){let s;if(20==p._hx_index){p.op;s=!0}else s=!1;s&&(this.addValue(d,t),this.buf.b+=x.string(" = ")),this.addExpr({e:hh.TCall({e:hh.TGlobal(ah.Mod),t:ql.TFun([]),p:e.p},[d,u]),t:e.t,p:e.p},t)}else{this.addValue(d,t),this.buf.b+=x.string(" ");let e=Mh.opStr(p);this.buf.b+=x.string(e),this.buf.b+=x.string(" "),this.addValue(u,t)}break;default:this.addValue(d,t),this.buf.b+=x.string(" ");let s=Mh.opStr(p);this.buf.b+=x.string(s),this.buf.b+=x.string(" "),this.addValue(u,t)}break;default:this.addValue(d,t),this.buf.b+=x.string(" ");let s=Mh.opStr(p);this.buf.b+=x.string(s),this.buf.b+=x.string(" "),this.addValue(u,t)}break;case 6:let b,m=s.e1,A=s.op,w=this.buf,y=w.b;switch(A._hx_index){case 0:b="++";break;case 1:b="--";break;case 2:b="!";break;case 3:b="-";break;case 4:b="~"}w.b=y+x.string(b),this.addValue(m,t);break;case 7:let k=s.init,B=s.v;if(this.locals.h[B.id]=B,null!=k){let e=this.varName(B);this.buf.b+=x.string(e),this.buf.b+=x.string(" = "),this.addValue(k,t)}else this.buf.b+=x.string("/*var*/");break;case 8:let C=s.args,v=s.e,S=(v.t,v.p,v.e);if(2==S._hx_index){let s=S.g;switch(s._hx_index){case 35:let r=C,n=s,i=this.getFunName(n,r,e.t);this.buf.b+=x.string(i),this.buf.b+=x.string("(");let a=0;for(;a<r.length;){let e=r[a];++a,this.addValue(e,t),this.buf.b+=x.string(", ")}this.buf.b+=x.string("0)");break;case 53:if(1==C.length){let e=C[0];this.buf.b+=x.string("clamp("),this.addValue(e,t),this.buf.b+=x.string(", 0., 1.)")}else{let s=v,r=C,n=s.e;if(2==n._hx_index){let t=n.g,s=this.getFunName(t,r,e.t);this.buf.b+=x.string(s)}else this.addValue(s,t);this.buf.b+=x.string("(");let i=!0,a=0;for(;a<r.length;){let e=r[a];++a,i?i=!1:this.buf.b+=x.string(", "),this.addValue(e,t)}this.buf.b+=x.string(")")}break;default:let l=C,h=v,o=h.e;if(2==o._hx_index){let t=o.g,s=this.getFunName(t,l,e.t);this.buf.b+=x.string(s)}else this.addValue(h,t);this.buf.b+=x.string("(");let _=!0,c=0;for(;c<l.length;){let e=l[c];++c,_?_=!1:this.buf.b+=x.string(", "),this.addValue(e,t)}this.buf.b+=x.string(")")}}else{let s=C,r=v,n=r.e;if(2==n._hx_index){let t=n.g,r=this.getFunName(t,s,e.t);this.buf.b+=x.string(r)}else this.addValue(r,t);this.buf.b+=x.string("(");let i=!0,a=0;for(;a<s.length;){let e=s[a];++a,i?i=!1:this.buf.b+=x.string(", "),this.addValue(e,t)}this.buf.b+=x.string(")")}break;case 9:let M=s.regs,I=s.e;if(3==I.t._hx_index){let e=0;for(;e<M.length;){let t=M[e];if(++e,t!=lh.X)throw $i.thrown("assert")}switch(M.length){case 1:this.addValue(I,t);break;case 2:this.decl("vec2 _vec2( float v ) { return vec2(v,v); }"),this.buf.b+=x.string("_vec2("),this.addValue(I,t),this.buf.b+=x.string(")");break;case 3:this.decl("vec3 _vec3( float v ) { return vec3(v,v,v); }"),this.buf.b+=x.string("_vec3("),this.addValue(I,t),this.buf.b+=x.string(")");break;case 4:this.decl("vec4 _vec4( float v ) { return vec4(v,v,v,v); }"),this.buf.b+=x.string("_vec4("),this.addValue(I,t),this.buf.b+=x.string(")");break;default:throw $i.thrown("assert")}}else{this.addValue(I,t),this.buf.b+=x.string(".");let e=0;for(;e<M.length;){let t=M[e];++e;let s,r=this.buf,n=r.b;switch(t._hx_index){case 0:s="x";break;case 1:s="y";break;case 2:s="z";break;case 3:s="w"}r.b=n+x.string(s)}}break;case 10:let T=s.eelse,F=s.eif,E=s.econd;this.buf.b+=x.string("if( "),this.addValue(E,t),this.buf.b+=x.string(") "),this.addExpr(F,t),null!=T&&(this.isBlock(F)||(this.buf.b+=x.string(";")),this.buf.b+=x.string(" else "),this.addExpr(T,t));break;case 11:this.buf.b+=x.string("discard");break;case 12:let D=s.e;null==D?this.buf.b+=x.string("return"):(this.buf.b+=x.string("return "),this.addValue(D,t));break;case 13:let R=s.loop,V=s.it,O=s.v;this.locals.h[O.id]=O;let P=V.e;if(5!=P._hx_index)throw $i.thrown("assert");if(21!=P.op._hx_index)throw $i.thrown("assert");{let e=P.e2,s=P.e1;this.buf.b+=x.string("for("),this.buf.b+=x.string(O.name+"="),this.addValue(s,t),this.buf.b+=x.string(";"+O.name+"<"),this.addValue(e,t),this.buf.b+=x.string(";"+O.name+"++) "),this.addBlock(R,t)}break;case 14:this.buf.b+=x.string("continue");break;case 15:this.buf.b+=x.string("break");break;case 16:let Q=s.index,L=s.e;this.addValue(L,t),this.buf.b+=x.string("["),this.addValue(Q,t),this.buf.b+=x.string("]");break;case 17:let G=s.el,z=e.t;if(15!=z._hx_index)throw $i.thrown("assert");{z.size;let e=z.t;this.addType(e)}this.buf.b+=x.string("["+G.length+"]"),this.buf.b+=x.string("(");let U=!0,W=0;for(;W<G.length;){let e=G[W];++W,U?U=!1:this.buf.b+=x.string(", "),this.addValue(e,t)}this.buf.b+=x.string(")");break;case 18:s.def,s.cases,s.e;this.buf.b+=x.string("switch(...)");break;case 19:let N=s.loop,j=s.e;if(0==s.normalWhile){let e=j,s=N;t+="\t",this.buf.b+=x.string("do "),this.addBlock(s,t),this.buf.b+=x.string(" while( "),this.addValue(e,t),this.buf.b+=x.string(" )")}else{let e=j,s=N;this.buf.b+=x.string("while( "),this.addValue(e,t),this.buf.b+=x.string(" ) "),this.addBlock(s,t)}break;case 20:s.args,s.m;let Y=s.e;this.addExpr(Y,t)}}varName(e){if(e.kind==th.Output){if(this.isVertex)return"gl_Position";if(null!=this.glES&&this.glES<=2)return null==this.outIndexes?"gl_FragColor":"gl_FragData["+this.outIndexes.h[e.id]+"]"}let t=this.varNames.h[e.id];if(null!=t)return t;if(t=e.name,Object.prototype.hasOwnProperty.call(kh.KWDS.h,t)&&(t="_"+t),Object.prototype.hasOwnProperty.call(this.allNames.h,t)){let e=2;for(t+="_";Object.prototype.hasOwnProperty.call(this.allNames.h,t+e);)++e;t+=e}return this.varNames.h[e.id]=t,this.allNames.h[t]=e.id,t}newLine(e){this.isBlock(e)?this.buf.b+=x.string("\n"):this.buf.b+=x.string(";\n")}isBlock(e){let t=e.e;switch(t._hx_index){case 4:t.el;return!0;case 13:t.it,t.v;let e=t.loop;return this.isBlock(e);case 19:t.e;if(1==t.normalWhile){let e=t.loop;return this.isBlock(e)}return!1;default:return!1}}initVar(e){switch(e.kind._hx_index){case 0:case 2:let t,s=e.type;if(16==s._hx_index){s.size,s.t;t=!0}else t=!1;t&&(this.buf.b+=x.string("layout(std140) ")),this.buf.b+=x.string("uniform ");break;case 1:this.buf.b+=x.string(null!=this.glES&&this.glES<=2?"attribute ":"in ");break;case 3:this.buf.b+=x.string(null!=this.glES&&this.glES<=2?"varying ":this.isVertex?"out ":"in ");break;case 4:break;case 5:if(null!=this.glES&&this.glES<=2)return void(this.outIndexes.h[e.id]=this.outIndex++);if(this.isVertex)return;null!=this.glES&&(this.buf.b+=x.string("layout(location="+this.outIndex+++") ")),this.buf.b+=x.string("out ");break;case 6:return}if(null!=e.qualifiers){let t=0,s=e.qualifiers;for(;t<s.length;){let e=s[t];if(++t,6==e._hx_index){switch(e.p._hx_index){case 0:this.buf.b+=x.string("lowp ");break;case 1:this.buf.b+=x.string("mediump ");break;case 2:this.buf.b+=x.string("highp ")}}}}this.addVar(e),this.buf.b+=x.string(";\n")}initVars(e){this.outIndex=0,this.uniformBuffer=0,this.outIndexes=new ya;let t=0,s=e.vars;for(;t<s.length;){let e=s[t];++t,this.initVar(e)}this.buf.b+=x.string("\n"),this.outIndex<2?this.outIndexes=null:!this.isVertex&&null!=this.glES&&this.glES<=2&&this.decl("#extension GL_EXT_draw_buffers : enable")}run(e){if(this.locals=new ya,this.decls=[],this.buf=new g,this.exprValues=[],this.decl("precision mediump float;"),1!=e.funs.length)throw $i.thrown("assert");let t=e.funs[0];this.isVertex=t.kind==ih.Vertex,this.initVars(e);let s=this.buf;this.buf=new g,this.buf.b+=x.string("void main(void) {\n");let r=t.expr.e;if(4==r._hx_index){let e=r.el,t=0;for(;t<e.length;){let s=e[t];++t,this.buf.b+=x.string("\t"),this.addExpr(s,"\t"),this.newLine(s)}}else this.addExpr(t.expr,"");this.buf.b+=x.string("}"),this.exprValues.push(this.buf.b),this.buf=s;let n=u.array(this.locals);n.sort((function(e,t){return f.compare(e.name,t.name)}));let i=0;for(;i<n.length;){let e=n[i];++i,this.addVar(e),this.buf.b+=x.string(";\n")}this.buf.b+=x.string("\n");let a=0,l=this.exprValues;for(;a<l.length;){let e=l[a];++a,this.buf.b+=x.string(e),this.buf.b+=x.string("\n\n")}return null!=this.glES?this.decl("#version "+(this.version<100?100:this.version)+(this.version>150?" es":"")):null!=this.version?this.decl("#version "+(this.version>150?150:this.version)):this.decl("#version 130"),this.decls.push(this.buf.b),this.buf=null,this.decls.join("\n")}}s["hxsl.GlslOut"]=kh,kh.__name__="hxsl.GlslOut",Object.assign(kh.prototype,{__class__:kh});class Bh{constructor(){}}s["hxsl._Linker.AllocatedVar"]=Bh,Bh.__name__="hxsl._Linker.AllocatedVar",Object.assign(Bh.prototype,{__class__:Bh});class Ch{constructor(e,t){this.name=e,this.uid=Ch.UID++,this.vertex=t,this.processed=new ya,this.usedFunctions=[],this.read=new ya,this.write=new ya}}s["hxsl._Linker.ShaderInfos"]=Ch,Ch.__name__="hxsl._Linker.ShaderInfos",Object.assign(Ch.prototype,{__class__:Ch});class vh{constructor(e){null==e&&(e=!1),this.debugDepth=0,this.batchMode=e}error(e,t){return eh.t(e,t)}mergeVar(e,t,s,r){switch(t.kind._hx_index){case 0:case 1:case 3:case 4:case 5:break;case 2:case 6:throw $i.thrown("assert")}t.kind!=s.kind&&t.kind!=th.Local&&s.kind!=th.Local&&this.error("'"+e+"' kind does not match : "+x.string(t.kind)+" should be "+x.string(s.kind),r);let n=s.type,i=t.type;if(13==i._hx_index)if(13==n._hx_index){let t=i.vl,s=n.vl,a=0;for(;a<t.length;){let n=t[a];++a;let i=null,l=0;for(;l<s.length;){let e=s[l];if(++l,n.name==e.name){i=e;break}}null==i?s.push(this.allocVar(n,r).v):this.mergeVar(e+"."+i.name,n,i,r)}}else y.enumEq(t.type,s.type)||this.error("'"+e+"' type does not match : "+oh.toString(t.type)+" should be "+oh.toString(s.type),r);else y.enumEq(t.type,s.type)||this.error("'"+e+"' type does not match : "+oh.toString(t.type)+" should be "+oh.toString(s.type),r)}allocVar(e,t,s,r){let n=this;if(null!=e.parent&&null==r){let n=(r=this.allocVar(e.parent,t)).v;for(s=n.name,n=n.parent;null!=n;)s=n.name+"."+s,n=n.parent}let i=null==s?e.name:s+"."+e.name;if(null!=e.qualifiers){let t=0,s=e.qualifiers;for(;t<s.length;){let e=s[t];if(++t,4==e._hx_index){i=e.n}}}let a=this.varMap.h[i],l=e.name;if(null!=a){let s,r=0,h=a.merged;for(;r<h.length;){let t=h[r];if(++r,t==e)return a}if(e.kind==th.Param&&!oh.hasQualifier(e,sh.Shared)&&!n.isBatchShader||e.kind==th.Function||e.kind==th.Var&&oh.hasQualifier(e,sh.Private))s=!0;else{let e=a.v;s=e.kind==th.Param&&!oh.hasQualifier(e,sh.Shared)&&!n.isBatchShader||e.kind==th.Function||e.kind==th.Var&&oh.hasQualifier(e,sh.Private)}if(!(s||e.kind==th.Param&&a.v.kind==th.Param))return a.merged.push(e),this.mergeVar(i,e,a.v,t),this.varIdMap.h[e.id]=a.id,a;{let t=2;for(;;){let s=this.varMap.h[i+t];if(null==s)break;let r=0,n=s.merged;for(;r<n.length;){let t=n[r];if(++r,t==e)return s}++t}l+=t,i+=t}}let h=this.allVars.length+1,o={id:h,name:l,type:e.type,kind:e.kind,qualifiers:e.qualifiers,parent:null==r?null:r.v},_=new Bh;_.v=o,_.merged=[e],_.path=i,_.id=h,_.parent=r,_.instanceIndex=this.curInstance,this.allVars.push(_),this.varMap.h[i]=_;let c=o.type;if(13==c._hx_index){let e=c.vl,s=[],r=0;for(;r<e.length;){let n=e[r];++r,s.push(this.allocVar(n,t,i,_).v)}o.type=ql.TStruct(s)}return _}mapExprVar(e){let t=e.e;switch(t._hx_index){case 1:let s=t.v;if(!this.locals.h.hasOwnProperty(s.id)){let t=this.allocVar(s,e.p);return null==this.curShader||this.curShader.write.h.hasOwnProperty(t.id)||(this.curShader.read.h[t.id]=t,null==this.curShader.vertex&&t.v.kind==th.Var&&(this.curShader.vertex=!1)),{e:hh.TVar(t.v),t:t.v.type,p:e.p}}break;case 5:let r=t.e2,n=t.e1,i=t.op,a=n.e;switch(i._hx_index){case 4:switch(a._hx_index){case 1:let t=a.v,s=t;if(!this.locals.h.hasOwnProperty(s.id)){let t=this.mapExprVar(r),a=this.allocVar(s,n.p);return null!=this.curShader&&(this.curShader.write.h[a.id]=a),{e:hh.TBinop(i,{e:hh.TVar(a.v),t:a.v.type,p:e.p},t),t:e.t,p:e.p}}{let s=t;if(!this.locals.h.hasOwnProperty(s.id)){let t=this.mapExprVar(n),a=this.mapExprVar(r),l=this.allocVar(s,t.p);return null!=this.curShader&&(this.curShader.write.h[l.id]=l),{e:hh.TBinop(i,t,a),t:e.t,p:e.p}}}break;case 9:a.regs;let l=a.e,h=(l.t,l.p,l.e);if(1==h._hx_index){let t=h.v;if(!this.locals.h.hasOwnProperty(t.id)){let s=this.mapExprVar(n),a=this.mapExprVar(r),l=this.allocVar(t,s.p);return null!=this.curShader&&(this.curShader.write.h[l.id]=l),{e:hh.TBinop(i,s,a),t:e.t,p:e.p}}}}break;case 20:i.op;switch(a._hx_index){case 1:let t=a.v;if(!this.locals.h.hasOwnProperty(t.id)){let s=this.mapExprVar(n),a=this.mapExprVar(r),l=this.allocVar(t,s.p);return null!=this.curShader&&(this.curShader.write.h[l.id]=l),{e:hh.TBinop(i,s,a),t:e.t,p:e.p}}break;case 9:a.regs;let s=a.e,l=(s.t,s.p,s.e);if(1==l._hx_index){let t=l.v;if(!this.locals.h.hasOwnProperty(t.id)){let s=this.mapExprVar(n),a=this.mapExprVar(r),l=this.allocVar(t,s.p);return null!=this.curShader&&(this.curShader.write.h[l.id]=l),{e:hh.TBinop(i,s,a),t:e.t,p:e.p}}}}}break;case 7:t.init;let l=t.v;this.locals.h[l.id]=!0;break;case 11:null!=this.curShader&&(this.curShader.vertex=!1,this.curShader.hasDiscard=!0);break;case 13:t.loop,t.it;let h=t.v;this.locals.h[h.id]=!0}return oh.map(e,ao(this,this.mapExprVar))}addShader(e,t,s,r){let n=new Ch(e,t);return this.curShader=n,n.priority=r,n.body=this.mapExprVar(s),this.shaders.push(n),this.curShader=null,n}sortByPriorityDesc(e,t){return e.priority==t.priority?e.uid-t.uid:t.priority-e.priority}buildDependency(e,t,s){let r=!s,n=0,i=this.shaders;for(;n<i.length;){let s=i[n];if(++n,s!=e){if(r&&s.write.h.hasOwnProperty(t.id)){if(e.vertex){if(0==s.vertex)continue;null==s.vertex&&(s.vertex=!0)}if(e.deps.set(s,!0),this.debugDepth++,this.initDependencies(s),this.debugDepth--,!s.read.h.hasOwnProperty(t.id))return}}else r=!0}t.v.kind==th.Var&&this.error("Variable "+t.path+" required by "+e.name+" is missing initializer",null)}initDependencies(e){if(null!=e.deps)return;e.deps=new Ca;let t=e.read.iterator();for(;t.hasNext();){let s=t.next();this.buildDependency(e,s,e.write.h.hasOwnProperty(s.id))}if(null==e.vertex){let t=e.deps.keys();for(;t.hasNext();){if(0==t.next().vertex){e.vertex=!1;break}}}if(e.vertex){let t=e.deps.keys();for(;t.hasNext();){let e=t.next();null==e.vertex&&(e.vertex=!0)}}}collect(e,t,s){if(e.onStack&&this.error("Loop in shader dependencies ("+e.name+")",null),e.marked==s)return;e.marked=s,e.onStack=!0;let r=[],n=e.deps.keys();for(;n.hasNext();){let e=n.next();r.push(e)}let i=r;i.sort(ao(this,this.sortByPriorityDesc));let a=0;for(;a<i.length;){let e=i[a];++a,this.collect(e,t,s)}null==e.vertex&&(e.vertex=s),e.vertex==s&&t.push(e),e.onStack=!1}uniqueLocals(e,t){let s=e.e;switch(s._hx_index){case 4:let r=s.el,n=new va,i=va.keysIterator(t.h);for(;i.hasNext();){let e=i.next();n.h[e]=!0}let a=n,l=0;for(;l<r.length;){let e=r[l];++l,this.uniqueLocals(e,a)}break;case 7:s.init;let h=s.v;if(Object.prototype.hasOwnProperty.call(t.h,h.name)){let e=2;for(;Object.prototype.hasOwnProperty.call(t.h,h.name+e);)++e;h.name+=e}t.h[h.name]=!0;break;default:let o=ao(this,this.uniqueLocals),_=t;oh.iter(e,(function(e){o(e,_)}))}}link(e){this.varMap=new va,this.varIdMap=new ya,this.allVars=[],this.shaders=[],this.locals=new ya;let t=new Ca,s=this,r=[],n=0;for(;n<e.length;){let s=e[n];++n;let i=s,a=i;null!=t.h.__keys__[i.__id__]&&(i=fh.shaderData(i)),t.set(i,a),r.push(i)}e=r,this.curInstance=0;let i=[],a=0;for(;a<e.length;){let t=e[a];++a,this.isBatchShader=this.batchMode&&b.startsWith(t.name,"batchShader_");let s=0,r=t.vars;for(;s<r.length;){let e=r[s];++s;let t=this.allocVar(e,null);this.isBatchShader&&t.v.kind==th.Param&&!b.startsWith(t.path,"Batch_")&&(t.v.kind=th.Local),e.kind==th.Output&&i.push(e)}let n=0,l=t.funs;for(;n<l.length;){let e=l[n];++n,this.allocVar(e.ref,e.expr.p).kind=e.kind}this.curInstance++}let l=0,h=[-3e3],o=[-2e3],_=[-1e3],c=0;for(;c<e.length;){let t=e[c];++c;let s=0,r=t.funs;for(;s<r.length;){let e=r[s];++s;let n=this.allocVar(e.ref,e.expr.p);if(null==n.kind)throw $i.thrown("assert");switch(n.kind._hx_index){case 0:case 1:this.addShader(t.name+"."+(n.kind==ih.Vertex?"vertex":"fragment"),n.kind==ih.Vertex,e.expr,l);break;case 2:let s,r;switch(e.ref.name){case"__init__fragment":s=_,r=!1;break;case"__init__vertex":s=o,r=!0;break;default:s=h,r=null}let i=e.expr.e;if(4==i._hx_index){let n=i.el,a=0,l=0;for(;l<n.length;){let i=n[l];++l,this.addShader(t.name+"."+e.ref.name+a++,r,i,s[0]++)}}else this.addShader(t.name+"."+e.ref.name,r,e.expr,s[0]++);break;case 3:throw $i.thrown("Unexpected helper function in linker "+n.v.name)}}++l}this.shaders.sort(ao(this,this.sortByPriorityDesc));let u=new Ch("<entry>",!1);u.deps=new Ca;let d=0;for(;d<i.length;){let e=i[d];++d,this.buildDependency(u,this.allocVar(e,null),!1)}let p=0,f=this.shaders;for(;p<f.length;){let e=f[p];++p,e.hasDiscard&&(this.initDependencies(e),u.deps.set(e,!0))}let x=0,g=this.shaders;for(;x<g.length;){let e=g[x];if(++x,null!=e.vertex)continue;let t=!0,s=e.read.iterator();for(;s.hasNext();){if(s.next().v.kind!=th.Param){t=!1;break}}t&&(e.vertex=!1)}let m=[],A=[];if(this.collect(u,m,!0),this.collect(u,A,!1),A.pop()!=u)throw $i.thrown("assert");let w=0,y=this.shaders;for(;w<y.length;){let e=y[w];++w,e.marked=null}let k=0,B=m.concat(A);for(;k<B.length;){let e=B[k];++k;let t=e.deps.keys();for(;t.hasNext();){let s=t.next();null==s.marked&&this.error(s.name+" needed by "+e.name+" is unreachable",null)}e.marked=!0}let C=[],v={},S=null;S=function(e){v.hasOwnProperty(e.id)||(v[e.id]=!0,null!=e.v.parent?S(e.parent):C.push(e.v))};let M=0,I=m.concat(A);for(;M<I.length;){let e=I[M];++M;let t=e.read.iterator();for(;t.hasNext();){let e=t.next();S(e)}let s=e.write.iterator();for(;s.hasNext();){let e=s.next();S(e)}}let T=null;T=function(e){let t=e.type;if(13==t._hx_index){let s=t.vl;if(e.kind!=th.Input){let t=[],r=0;for(;r<s.length;){let e=s[r];++r,v.hasOwnProperty(e.id)&&(T(e),t.push(e))}e.type=ql.TStruct(t)}}};let F=0;for(;F<C.length;){let e=C[F];++F,T(e)}let E=function(e,t,r){let n={id:oh.allocVarId(),name:t,type:ql.TFun([{ret:ql.TVoid,args:[]}]),kind:th.Function};C.push(n);let i=[],a=0;for(;a<r.length;){let e=r[a];++a;let t=e.body.e;if(4==t._hx_index){let e=t.el,s=0;for(;s<e.length;){let t=e[s];++s,i.push(t)}}else i.push(e.body)}let l={e:hh.TBlock(i),t:ql.TVoid,p:0==i.length?null:i[0].p};return s.uniqueLocals(l,new va),{kind:e,ref:n,ret:ql.TVoid,args:[],expr:l}},D=[E(ih.Vertex,"vertex",m),E(ih.Fragment,"fragment",A)],R=t.keys();for(;R.hasNext();){let e=R.next(),s=t.h[e.__id__];if(e==s)continue;let r=0,n=e.vars.length;for(;r<n;){let t=r++;this.allocVar(e.vars[t],null).merged.unshift(s.vars[t])}}return{name:"out",vars:C,funs:D}}}s["hxsl.Linker"]=vh,vh.__name__="hxsl.Linker",Object.assign(vh.prototype,{__class__:vh});var Sh=n["hxsl.Output"]={__ename__:"hxsl.Output",__constructs__:["Const","Value","PackNormal","PackFloat","Vec2","Vec3","Vec4","Swiz"],Const:(t=function(e){return{_hx_index:0,v:e,__enum__:"hxsl.Output",toString:r}},t.__params__=["v"],t),Value:(t=function(e,t){return{_hx_index:1,v:e,size:t,__enum__:"hxsl.Output",toString:r}},t.__params__=["v","size"],t),PackNormal:(t=function(e){return{_hx_index:2,v:e,__enum__:"hxsl.Output",toString:r}},t.__params__=["v"],t),PackFloat:(t=function(e){return{_hx_index:3,v:e,__enum__:"hxsl.Output",toString:r}},t.__params__=["v"],t),Vec2:(t=function(e){return{_hx_index:4,a:e,__enum__:"hxsl.Output",toString:r}},t.__params__=["a"],t),Vec3:(t=function(e){return{_hx_index:5,a:e,__enum__:"hxsl.Output",toString:r}},t.__params__=["a"],t),Vec4:(t=function(e){return{_hx_index:6,a:e,__enum__:"hxsl.Output",toString:r}},t.__params__=["a"],t),Swiz:(t=function(e,t){return{_hx_index:7,a:e,swiz:t,__enum__:"hxsl.Output",toString:r}},t.__params__=["a","swiz"],t)};Sh.__empty_constructs__=[];class Mh{constructor(e){null==e&&(e=!1),this.varId=e}shaderString(e){this.buffer=new g;let t=0,s=e.vars;for(;t<s.length;){let e=s[t];++t,this.addVar(e,th.Var),this.buffer.b+=x.string(";\n")}e.vars.length>0&&(this.buffer.b+=x.string("\n"));let r=0,n=e.funs;for(;r<n.length;){let e=n[r];++r,this.addFun(e),this.buffer.b+=x.string("\n\n")}return this.buffer.b}exprString(e){return this.buffer=new g,this.addExpr(e,""),this.buffer.b}addVar(e,t,s,r){if(null==s&&(s=""),null!=e.qualifiers){let t=0,s=e.qualifiers;for(;t<s.length;){let e,r=s[t];switch(++t,r._hx_index){case 0:let t=r.max;e="const"+(null==t?"":"("+t+")");break;case 1:e="private";break;case 2:e="nullable";break;case 3:e="perObject";break;case 4:e="name('"+r.n+"')";break;case 5:e="shared";break;case 6:let s=r.p;e=n[s.__enum__].__constructs__[s._hx_index].toLowerCase()+"p";break;case 7:let i=r.max;e="range("+r.min+","+i+")";break;case 8:e="ignore";break;case 9:e="perInstance("+r.v+")"}this.buffer.b+=x.string("@"+e+" ")}}if(e.kind!=t)switch(e.kind._hx_index){case 0:this.buffer.b+=x.string("@global ");break;case 1:this.buffer.b+=x.string("@input ");break;case 2:this.buffer.b+=x.string("@param ");break;case 3:this.buffer.b+=x.string("@var ");break;case 4:this.buffer.b+=x.string("@local ");break;case 5:this.buffer.b+=x.string("@output ");break;case 6:this.buffer.b+=x.string("@function ")}this.buffer.b+=x.string("var "),e.parent==r?this.buffer.b+=x.string(e.name+(this.varId?"@"+e.id:"")):this.addVarName(e),this.buffer.b+=x.string(" : ");let i=e.type;if(13==i._hx_index){let e=i.vl;this.buffer.b+=x.string("{");let t=!0,r=0;for(;r<e.length;){let n=e[r];++r,t?t=!1:this.buffer.b+=x.string(", "),this.addVar(n,n.kind,s,n)}this.buffer.b+=x.string("}")}else{let t=oh.toString(e.type);this.buffer.b+=x.string(t)}}addFun(e){this.buffer.b+=x.string("function "+e.ref.name+"(");let t=!0,s=0,r=e.args;for(;s<r.length;){let e=r[s];++s,t?(this.buffer.b+=x.string(" "),t=!1):this.buffer.b+=x.string(", "),this.addVar(e,th.Local)}e.args.length>0&&(this.buffer.b+=x.string(" "));let n=") : "+oh.toString(e.ret)+" ";this.buffer.b+=x.string(n),this.addExpr(e.expr,"")}addVarName(e){null!=e.parent&&(this.addVarName(e.parent),this.buffer.b+=x.string(".")),this.buffer.b+=x.string(e.name),this.varId&&(this.buffer.b+=x.string("@"+e.id))}addConst(e){let t,s=this.buffer,r=s.b;switch(e._hx_index){case 0:t="null";break;case 1:t=e.b;break;case 2:t=e.v;break;case 3:t=e.v;break;case 4:t='"'+e.v+'"'}s.b=r+x.string(t)}addExpr(e,t){let s=e.e;switch(s._hx_index){case 0:let e=s.c;this.addConst(e);break;case 1:let r=s.v;this.addVarName(r);break;case 2:let n=s.g,i=_h.toString(n);this.buffer.b+=x.string(i);break;case 3:let a=s.e;this.buffer.b+=x.string("("),this.addExpr(a,t),this.buffer.b+=x.string(")");break;case 4:let l=s.el;this.buffer.b+=x.string("{"),t+="\t";let h=0;for(;h<l.length;){let e=l[h];++h,this.buffer.b+=x.string("\n"+t),this.addExpr(e,t),this.buffer.b+=x.string(";")}t=c.substr(t,1,null),l.length>0&&(this.buffer.b+=x.string("\n"+t)),this.buffer.b+=x.string("}");break;case 5:let o=s.e2,_=s.e1,u=s.op;this.addExpr(_,t);let d=" "+Mh.opStr(u)+" ";this.buffer.b+=x.string(d),this.addExpr(o,t);break;case 6:let p,f=s.e1,g=s.op,b=this.buffer,m=b.b;switch(g._hx_index){case 0:p="++";break;case 1:p="--";break;case 2:p="!";break;case 3:p="-";break;case 4:p="~"}b.b=m+x.string(p),this.addExpr(f,t);break;case 7:let A=s.init,w=s.v;this.addVar(w,th.Local,t),null!=A&&(this.buffer.b+=x.string(" = "),this.addExpr(A,t));break;case 8:let y=s.args,k=s.e;this.addExpr(k,t),this.buffer.b+=x.string("(");let B=!0,C=0;for(;C<y.length;){let e=y[C];++C,B?B=!1:this.buffer.b+=x.string(", "),this.addExpr(e,t)}this.buffer.b+=x.string(")");break;case 9:let v=s.regs,S=s.e;this.addExpr(S,t),this.buffer.b+=x.string(".");let M=0;for(;M<v.length;){let e=v[M];++M,this.buffer.b+=x.string(Mh.SWIZ[e._hx_index])}break;case 10:let I=s.eelse,T=s.eif,F=s.econd;this.buffer.b+=x.string("if( "),this.addExpr(F,t),this.buffer.b+=x.string(" ) "),this.addExpr(T,t),null!=I&&(this.buffer.b+=x.string(" else "),this.addExpr(I,t));break;case 11:this.buffer.b+=x.string("discard");break;case 12:let E=s.e;this.buffer.b+=x.string("return"),null!=E&&(this.buffer.b+=x.string(" "),this.addExpr(E,t));break;case 13:let D=s.loop,R=s.it,V=s.v;this.buffer.b+=x.string("for( "),this.addVarName(V),this.buffer.b+=x.string(" in "),this.addExpr(R,t),this.buffer.b+=x.string(" ) "),this.addExpr(D,t);break;case 14:this.buffer.b+=x.string("continue");break;case 15:this.buffer.b+=x.string("break");break;case 16:let O=s.index,P=s.e;this.addExpr(P,t),this.buffer.b+=x.string("["),this.addExpr(O,t),this.buffer.b+=x.string("]");break;case 17:let Q=s.el;this.buffer.b+=x.string("[");let L=!0,G=0;for(;G<Q.length;){let e=Q[G];++G,L?L=!1:this.buffer.b+=x.string(", "),this.addExpr(e,t)}this.buffer.b+=x.string("]");break;case 18:let z=s.def,U=s.cases,W=s.e;this.buffer.b+=x.string("switch( "),this.addExpr(W,t),this.buffer.b+=x.string(") {");let N=t,j=0;for(;j<U.length;){let e=U[j];++j,this.buffer.b+=x.string("\n"+t),this.buffer.b+=x.string("case ");let s=!0,r=0,n=e.values;for(;r<n.length;){let e=n[r];++r,s?s=!1:this.buffer.b+=x.string(", "),this.addExpr(e,t)}t+="\t",this.buffer.b+=x.string(":\n"+t),this.addExpr(e.expr,t),t=N}null!=z&&(this.buffer.b+=x.string("\n"+t),t+="\t",this.buffer.b+=x.string("default:\n"+t),this.addExpr(z,t),t=N),this.buffer.b+=x.string("\n"+t+"}");break;case 19:let Y=s.loop,X=s.e;if(0==s.normalWhile){let e=X,s=Y,r=t;t+="\t",this.buffer.b+=x.string("do {\n"+t),this.addExpr(s,t),t=r,this.buffer.b+=x.string("\n"+t+"} while( "),this.addExpr(e,t),this.buffer.b+=x.string(" )")}else{let e=X,s=Y;this.buffer.b+=x.string("while( "),this.addExpr(e,t);let r=t;t+="\t",this.buffer.b+=x.string(" ) {\n"+t),this.addExpr(s,t),t=r,this.buffer.b+=x.string("\n"+t+"}")}break;case 20:let Z=s.e,H=s.args,K=s.m;if(this.buffer.b+=x.string(K),H.length>0){this.buffer.b+=x.string("(");let e=!0,t=0;for(;t<H.length;){let s=H[t];++t,e?e=!1:this.buffer.b+=x.string(", "),this.addConst(s)}this.buffer.b+=x.string(")")}this.buffer.b+=x.string(" "),this.addExpr(Z,t)}}static opStr(e){switch(e._hx_index){case 0:return"+";case 1:return"*";case 2:return"/";case 3:return"-";case 4:return"=";case 5:return"==";case 6:return"!=";case 7:return">";case 8:return">=";case 9:return"<";case 10:return"<=";case 11:return"&";case 12:return"|";case 13:return"^";case 14:return"&&";case 15:return"||";case 16:return"<<";case 17:return">>";case 18:return">>>";case 19:return"%";case 20:let t=e.op;return Mh.opStr(t)+"=";case 21:return"...";case 22:return"=>";case 23:return" in "}}static toString(e,t){return null==t&&(t=!1),new Mh(t).exprString(e)}static shaderToString(e,t){return null==t&&(t=!1),new Mh(t).shaderString(e)}}s["hxsl.Printer"]=Mh,Mh.__name__="hxsl.Printer",Object.assign(Mh.prototype,{__class__:Mh});class Ih{constructor(e,t,s,r,n){this.name=e,this.pos=t,this.instance=s,this.index=r,this.type=n}}s["hxsl.AllocParam"]=Ih,Ih.__name__="hxsl.AllocParam",Object.assign(Ih.prototype,{__class__:Ih});class Th{constructor(e,t,s){this.pos=e,this.path=t,this.gid=yh.allocID(t),this.type=s}}s["hxsl.AllocGlobal"]=Th,Th.__name__="hxsl.AllocGlobal",Object.assign(Th.prototype,{__class__:Th});class Fh{constructor(){}}s["hxsl.RuntimeShaderData"]=Fh,Fh.__name__="hxsl.RuntimeShaderData",Object.assign(Fh.prototype,{__class__:Fh});class Eh{constructor(e,t){this.shader=e,this.bits=t}}s["hxsl.ShaderInstanceDesc"]=Eh,Eh.__name__="hxsl.ShaderInstanceDesc",Object.assign(Eh.prototype,{__class__:Eh});class Dh{constructor(){this.id=Dh.UID++}}s["hxsl.RuntimeShader"]=Dh,Dh.__name__="hxsl.RuntimeShader",Object.assign(Dh.prototype,{__class__:Dh});class Rh{constructor(){}readVarInt(){let e=this.input.readByte();return e<128?e:255==e?this.input.readInt32():(127&e)<<8|this.input.readByte()}readType(){switch(this.input.readByte()){case 0:return ql.TVoid;case 1:return ql.TInt;case 2:return ql.TBool;case 3:return ql.TFloat;case 4:return ql.TString;case 5:let e=this.input.readByte(),t=Rh.TVECS.h[e];return null==t&&(t=ql.TVec(7&e,y.createEnumIndex(Jl,e>>3,null)),Rh.TVECS.h[e]=t),t;case 6:return ql.TMat3;case 7:return ql.TMat4;case 8:return ql.TMat3x4;case 9:return ql.TBytes(this.input.readInt32());case 10:return ql.TSampler2D;case 11:return ql.TSampler2DArray;case 12:return ql.TSamplerCube;case 13:let s=this.readVarInt(),r=this.types[s];if(null!=r)return r;let n=ao(this,this.readVar),i=[],a=0,l=this.readVarInt();for(;a<l;){a++;i.push(n())}return r=ql.TStruct(i),this.types[s]=r,r;case 14:return ql.TFun(null);case 15:let h=this.readType(),o=this.readVar();return ql.TArray(h,null==o?$l.SConst(this.readVarInt()):$l.SVar(o));case 16:let _=this.readType(),c=this.readVar();return ql.TBuffer(_,null==c?$l.SConst(this.readVarInt()):$l.SVar(c));case 17:return ql.TChannel(this.input.readByte());default:throw $i.thrown("assert")}}readString(){let e=this.readVarInt();return this.input.read(e).getString(0,e)}readConst(){switch(this.input.readByte()){case 0:return nh.CNull;case 1:return nh.CBool(0!=this.input.readByte());case 2:return nh.CInt(this.input.readInt32());case 3:return nh.CFloat(this.input.readDouble());case 4:return nh.CString(this.readString());default:throw $i.thrown("assert")}}readExpr(){let e,t=this.input.readByte(),s=this;if(0==t--)return null;switch(t){case 0:e=hh.TConst(this.readConst());break;case 1:e=hh.TVar(this.readVar());break;case 2:e=hh.TGlobal(Rh.TGLOBALS[this.input.readByte()]);break;case 3:e=hh.TParenthesis(this.readExpr());break;case 4:let t=ao(this,this.readExpr),r=[],n=0,i=this.readVarInt();for(;n<i;){n++;r.push(t())}e=hh.TBlock(r);break;case 5:let a=this.input.readByte();e=hh.TBinop(a>=128?Pa.OpAssignOp(Rh.BOPS[127&a]):Rh.BOPS[a],this.readExpr(),this.readExpr());break;case 6:e=hh.TUnop(Rh.UNOPS[this.input.readByte()],this.readExpr());break;case 7:e=hh.TVarDecl(this.readVar(),this.readExpr());break;case 8:let l=this.readExpr(),h=ao(this,this.readExpr),o=[],_=0,c=this.readVarInt();for(;_<c;){_++;o.push(h())}e=hh.TCall(l,o);break;case 9:let u=this.readExpr(),d=this.input.readUInt16(),p=Rh.TSWIZ.h[d];if(null==p){let e=[],t=0,s=1+(3&d);for(;t<s;){let s=t++;e.push(Rh.REGS[d>>2*s+2&3])}p=e,Rh.TSWIZ.h[d]=p}e=hh.TSwiz(u,p);break;case 10:e=hh.TIf(this.readExpr(),this.readExpr(),this.readExpr());break;case 11:e=hh.TDiscard;break;case 12:e=hh.TReturn(this.readExpr());break;case 13:e=hh.TFor(this.readVar(),this.readExpr(),this.readExpr());break;case 14:e=hh.TContinue;break;case 15:e=hh.TBreak;break;case 16:e=hh.TArray(this.readExpr(),this.readExpr());break;case 17:let f=ao(this,this.readExpr),x=[],g=0,b=this.readVarInt();for(;g<b;){g++;x.push(f())}e=hh.TArrayDecl(x);break;case 18:let m=this.readExpr(),A=[],w=0,y=this.readVarInt();for(;w<y;){w++;let e=ao(s,s.readExpr),t=[],r=0,n=s.readVarInt();for(;r<n;){r++;t.push(e())}A.push({values:t,expr:s.readExpr()})}e=hh.TSwitch(m,A,this.readExpr());break;case 19:e=hh.TWhile(this.readExpr(),this.readExpr(),0!=this.input.readByte());break;case 20:let k=this.readString(),B=ao(this,this.readConst),C=[],v=0,S=this.readVarInt();for(;v<S;){v++;C.push(B())}e=hh.TMeta(k,C,this.readExpr());break;default:throw $i.thrown("assert")}return{e,t:this.readType(),p:null}}readVar(){let e=this.readVarInt();if(0==e)return null;let t=this.varMap.h[e];if(null!=t)return t;t={id:oh.allocVarId(),name:this.readString(),type:null,kind:null},this.varMap.h[e]=t,t.type=this.readType(),t.kind=Rh.VKINDS[this.input.readByte()],t.parent=this.readVar();let s=this.input.readByte();if(s>0){t.qualifiers=[];let e=0,r=s;for(;e<r;){let s;e++;switch(this.input.readByte()){case 0:let e=this.input.readInt32();s=sh.Const(0==e?null:e);break;case 1:s=sh.Private;break;case 2:s=sh.Nullable;break;case 3:s=sh.PerObject;break;case 4:s=sh.Name(this.readString());break;case 5:s=sh.Shared;break;case 6:s=sh.Precision(Rh.PRECS[this.input.readByte()]);break;case 7:s=sh.Range(this.input.readDouble(),this.input.readDouble());break;case 8:s=sh.Ignore;break;case 9:s=sh.PerInstance(this.input.readInt32());break;default:throw $i.thrown("assert")}t.qualifiers.push(s)}}return t}readFun(){let e=Rh.FKIND[this.input.readByte()],t=this.readVar(),s=ao(this,this.readVar),r=[],n=0,i=this.readVarInt();for(;n<i;){n++;r.push(s())}return{kind:e,ref:t,args:r,ret:this.readType(),expr:this.readExpr()}}unserialize(e){if(this.input=new Ta(fa.decode(e,!1)),this.input.readByte()!=(255&Rh.SIGN)||this.input.readByte()!=(Rh.SIGN>>8&255)||this.input.readByte()!=(Rh.SIGN>>16&255))throw $i.thrown("Invalid HXSL data");this.varMap=new ya,this.types=[];let t=this.readString(),s=ao(this,this.readVar),r=[],n=0,i=this.readVarInt();for(;n<i;){n++;r.push(s())}let a=r,l=ao(this,this.readFun),h=[],o=0,_=this.readVarInt();for(;o<_;){o++;h.push(l())}return{name:t,vars:a,funs:h}}}s["hxsl.Serializer"]=Rh,Rh.__name__="hxsl.Serializer",Object.assign(Rh.prototype,{__class__:Rh});class Vh{constructor(e,t){this.s=e,this.next=t}static addSort(e,t){let s=null,r=t;for(;null!=r&&r.s.priority<e.priority;)s=r,r=r.next;return null==s?new Vh(e,t):(s.next=new Vh(e,s.next),t)}}s["hxsl.ShaderList"]=Vh,Vh.__name__="hxsl.ShaderList",Object.assign(Vh.prototype,{__class__:Vh});class Oh{constructor(e){this.id=oh.allocVarId(),this.shader=e,this.params=new ya}}s["hxsl.ShaderInstance"]=Oh,Oh.__name__="hxsl.ShaderInstance",Object.assign(Oh.prototype,{__class__:Oh});class Ph{constructor(e,t){this.v=e,this.globalId=t}}s["hxsl.ShaderGlobal"]=Ph,Ph.__name__="hxsl.ShaderGlobal",Object.assign(Ph.prototype,{__class__:Ph});class Qh{constructor(e,t,s){this.v=e,this.pos=t,this.bits=s}}s["hxsl.ShaderConst"]=Qh,Qh.__name__="hxsl.ShaderConst",Object.assign(Qh.prototype,{__class__:Qh});class Lh{constructor(e){this.instanceCache=new ya,this.consts=null,this.globals=[],""!=e&&(this.data=(new Rh).unserialize(e),this.initialize())}initialize(){let e=0,t=this.data.vars;for(;e<t.length;){let s=t[e];++e,this.browseVar(s)}}makeInstance(e){let t=new bh,s=this.consts;for(;null!=s;){let r,n=s.v,i=s.v.type;switch(i._hx_index){case 1:r=nh.CInt(e>>>s.pos&(1<<s.bits)-1);break;case 2:r=nh.CBool(0!=(e>>>s.pos&1));break;case 17:i.size;r=nh.CInt(e>>>s.pos&(1<<s.bits)-1);break;default:throw $i.thrown("assert")}t.setConstant(n,r),s=s.next}t.inlineCalls=!0,t.unrollLoops=Lh.UNROLL_LOOPS;let r=new Oh(t.eval(this.data));this.paramsCount=0;let n=0,i=this.data.vars;for(;n<i.length;){let e=i[n];++n,this.addParam(t,r,e)}return this.instanceCache.h[e]=r,r}addParam(e,t,s){let r=s.type;if(13==r._hx_index){let s=r.vl,n=0;for(;n<s.length;){let r=s[n];++n,this.addParam(e,t,r)}}else s.kind==th.Param&&(t.params.h[e.varMap.h[s.__id__].id]=this.paramsCount,this.paramsCount++)}browseVar(e,t){e.id=oh.allocVarId(),null==t?t=oh.getName(e):t+="."+e.name;let s=e.type;if(13==s._hx_index){let e=s.vl,r=0;for(;r<e.length;){let s=e[r];++r,this.browseVar(s,t)}}else{let s=0;if(e.kind==th.Global&&(s=yh.allocID(t),this.globals.push(new Ph(e,s))),!oh.isConst(e))return;let r=oh.getConstBits(e);if(r>0){let t=null==this.consts?0:this.consts.pos+this.consts.bits,n=new Qh(e,t,r);n.globalId=s,n.next=this.consts,this.consts=n}}}}s["hxsl.SharedShader"]=Lh,Lh.__name__="hxsl.SharedShader",Object.assign(Lh.prototype,{__class__:Lh});class Gh{constructor(e){this.v=e,this.read=0,this.write=0}}s["hxsl._Splitter.VarProps"]=Gh,Gh.__name__="hxsl._Splitter.VarProps",Object.assign(Gh.prototype,{__class__:Gh});class zh{constructor(){}split(e){let t=null,s=new ya,r=null,n=new ya;this.varNames=new va,this.varMap=new Ca;let i=0,a=e.funs;for(;i<a.length;){let e=a[i];switch(++i,e.kind._hx_index){case 0:this.vars=s,t=e,this.checkExpr(e.expr);break;case 1:this.vars=n,r=e,this.checkExpr(e.expr);break;default:throw $i.thrown("assert")}}t={ret:t.ret,ref:t.ref,kind:t.kind,args:t.args,expr:this.mapVars(t.expr)};let l=0,h=u.array(s);for(;l<h.length;){let e=h[l];++l;let r=e.v;switch(r.kind._hx_index){case 3:case 4:r.kind=n.h.hasOwnProperty(r.id)?th.Var:th.Local}switch(r.kind._hx_index){case 3:case 5:if(e.read>0||e.write>1){let e={id:oh.allocVarId(),name:r.name,kind:r.kind,type:r.type};this.vars=s;this.get(e);r.kind=th.Local;let i=t.expr.p,a={e:hh.TBinop(Pa.OpAssign,{e:hh.TVar(e),t:e.type,p:i},{e:hh.TVar(r),t:r.type,p:i}),t:e.type,p:i};if(this.addExpr(t,a),this.checkExpr(a),e.kind==th.Var){let t=n.h[r.id];this.varMap.set(r,e),n.remove(r.id);let s=new Gh(e);s.read=t.read,s.write=t.write,n.h[e.id]=s}}}}let o=[],_=[],c=n.iterator();for(;c.hasNext();){let e=c.next(),n=e.v;switch(n.kind._hx_index){case 1:let i={id:oh.allocVarId(),name:n.name,kind:th.Var,type:n.type};this.uniqueName(i);let a=s.h[n.id];null==a&&(a=new Gh(n),s.h[n.id]=a),a.read++;let l=new Gh(i);l.write=1,s.h[i.id]=l;let h=new Gh(i);h.read=1,_.push(h),this.addExpr(t,{e:hh.TBinop(Pa.OpAssign,{e:hh.TVar(i),t:n.type,p:t.expr.p},{e:hh.TVar(n),t:n.type,p:t.expr.p}),t:n.type,p:t.expr.p}),this.varMap.set(n,i),e.local=!0;break;case 3:if(e.write>0){let e={id:oh.allocVarId(),name:n.name,kind:th.Local,type:n.type};this.uniqueName(e),o.push({e:hh.TVarDecl(e,{e:hh.TVar(n),t:n.type,p:r.expr.p}),t:ql.TVoid,p:r.expr.p}),this.varMap.set(n,e)}}}let d=0;for(;d<_.length;){let e=_[d];++d,n.h[e.v.id]=e}let p=s.iterator();for(;p.hasNext();){let e=p.next();this.checkVar(e,!0,s,t.expr.p)}let f=n.iterator();for(;f.hasNext();){let e=f.next();this.checkVar(e,!1,s,r.expr.p)}let x=this.varMap.keys();for(;x.hasNext();){let e=x.next(),t=this.varMap.h[this.varMap.h[e.__id__].__id__];null!=t&&this.varMap.set(e,t)}r={ret:r.ret,ref:r.ref,kind:r.kind,args:r.args,expr:this.mapVars(r.expr)};let g=r.expr.e;if(4==g._hx_index){let e=g.el,t=0;for(;t<o.length;){let s=o[t];++t,e.unshift(s)}}else o.push(r.expr),r.expr={e:hh.TBlock(o),t:ql.TVoid,p:r.expr.p};let b=[],m=s.iterator();for(;m.hasNext();){let e=m.next();e.local||b.push(e.v)}let A=b,w=[],y=n.iterator();for(;y.hasNext();){let e=y.next();e.local||w.push(e.v)}let k=w;return A.sort((function(e,t){return e.id-t.id})),k.sort((function(e,t){return e.id-t.id})),{vertex:{name:"vertex",vars:A,funs:[t]},fragment:{name:"fragment",vars:k,funs:[r]}}}addExpr(e,t){let s=e.expr.e;if(4==s._hx_index){s.el.push(t)}else e.expr={e:hh.TBlock([e.expr,t]),t:ql.TVoid,p:e.expr.p}}checkVar(e,t,s,r){switch(e.v.kind._hx_index){case 3:if(!t){let t=s.h[e.v.id];if(null==t||0==t.write)throw $i.thrown(new eh("Varying "+e.v.name+" is not written by vertex shader",r))}break;case 4:if(e.requireInit)throw $i.thrown(new eh("Variable "+e.v.name+" is used without being initialized",r))}}mapVars(e){let t=e.e;switch(t._hx_index){case 1:let s=t.v,r=this.varMap.h[s.__id__];return null==r?e:{e:hh.TVar(r),t:e.t,p:e.p};case 7:let n=t.init,i=t.v,a=this.varMap.h[i.__id__];return null==a?oh.map(e,ao(this,this.mapVars)):{e:hh.TVarDecl(a,this.mapVars(n)),t:e.t,p:e.p};case 13:let l=t.loop,h=t.it,o=t.v,_=this.varMap.h[o.__id__];return null==_?oh.map(e,ao(this,this.mapVars)):{e:hh.TFor(_,this.mapVars(h),this.mapVars(l)),t:e.t,p:e.p};default:return oh.map(e,ao(this,this.mapVars))}}get(e){let t=this.vars.h[e.id];if(null==t){let s=this.varMap.h[e.__id__];if(null!=s)return this.get(s);let r=e.name;if(this.uniqueName(e),e.kind==th.Local&&r!=e.name){let t={id:oh.allocVarId(),name:e.name,kind:e.kind,type:e.type};this.varMap.set(e,t),e.name=r,e=t}t=new Gh(e),this.vars.h[e.id]=t}return t}uniqueName(e){if(e.kind==th.Global||e.kind==th.Output||e.kind==th.Input)return;e.parent=null;let t=this.varNames.h[e.name];if(null!=t&&t!=e){let t=e.name;for(;c.cca(t,t.length-1)>=48&&c.cca(t,t.length-1)<=57;)t=c.substr(t,0,-1);let s=t==e.name?2:x.parseInt(c.substr(e.name,t.length,null));for(;Object.prototype.hasOwnProperty.call(this.varNames.h,t+s);)++s;e.name=t+s}this.varNames.h[e.name]=e}checkExpr(e){let t=e.e;switch(t._hx_index){case 1:let s=t.v,r=this.get(s);0==r.write&&(r.requireInit=!0),r.read++;break;case 5:let n=t.e2,i=t.e1,a=t.op;switch(a._hx_index){case 4:i.t,i.p;let t=i.e;switch(t._hx_index){case 1:let s=n,r=t.v;this.get(r).write++,this.checkExpr(s);break;case 9:t.regs;let i=t.e,a=(i.t,i.p,i.e);if(1==a._hx_index){let e=n,t=a.v;this.get(t).write++,this.checkExpr(e)}else oh.iter(e,ao(this,this.checkExpr));break;default:oh.iter(e,ao(this,this.checkExpr))}break;case 20:a.op,i.t,i.p;let s=i.e;switch(s._hx_index){case 1:let t=n,r=s.v,i=this.get(r);0==i.write&&(i.requireInit=!0),i.read++,i.write++,this.checkExpr(t);break;case 9:s.regs;let a=s.e,l=(a.t,a.p,a.e);if(1==l._hx_index){let e=n,t=l.v,s=this.get(t);0==s.write&&(s.requireInit=!0),s.read++,s.write++,this.checkExpr(e)}else oh.iter(e,ao(this,this.checkExpr));break;default:oh.iter(e,ao(this,this.checkExpr))}break;default:oh.iter(e,ao(this,this.checkExpr))}break;case 7:let l=t.init,h=t.v,o=this.get(h);o.local=!0,null!=l&&(this.checkExpr(l),o.write++);break;case 13:let _=t.loop,c=t.it,u=t.v;this.checkExpr(c);let d=this.get(u);d.local=!0,d.write++,this.checkExpr(_);break;default:oh.iter(e,ao(this,this.checkExpr))}}}s["hxsl.Splitter"]=zh,zh.__name__="hxsl.Splitter",Object.assign(zh.prototype,{__class__:zh});class Uh{static getContextWebGL(e,t){let s=e.getContext("webgl",t);if(null!=s)return s;let r=e.getContext("experimental-webgl",t);return null!=r?r:null}}s["js.html._CanvasElement.CanvasUtil"]=Uh,Uh.__name__="js.html._CanvasElement.CanvasUtil",Math.__name__="Math";class Wh{constructor(e,t){this.x=e,this.y=t}}s["reckoner.TmpVec2D"]=Wh,Wh.__name__="reckoner.TmpVec2D",Object.assign(Wh.prototype,{__class__:Wh});class Nh extends Be{constructor(e,t){super(e,t)}initialize(){super.initialize(),this.world=new k;let e=this.world.area;e.posChanged=!0,e.x=d.width/2-.5*e.width,e.posChanged=!0,e.y=d.height/2-.5*e.height,this.layers.main.addChild(e);let t=this.world;_.world=t}update(){super.update(),this.world.update()}}s["scenes.PlayScene"]=Nh,Nh.__name__="scenes.PlayScene",Nh.__super__=Be,Object.assign(Nh.prototype,{__class__:Nh});class jh{}s["sinker.extensions.StringExtension"]=jh,jh.__name__="sinker.extensions.StringExtension";class Yh{constructor(e,t,s,r){if(this.content=e,this.appendCallStack=null!=s?s:Hh.appendCallStackDefault,null!=t)this.callStack=t;else{let e=Ki.callStack();e.shift(),this.callStack=e}this.positionInformation=r}toString(){let e=Ss.getClass(this),t=null!=e?e.__name__:"sneaker.exception.Exception";return this.appendCallStack?t+"\n"+this.content+"\nCall Stack:\n"+Hh.callStackFormat(this.callStack):t+"\n"+this.content}}s["sneaker.exception.Exception"]=Yh,Yh.__name__="sneaker.exception.Exception",Object.assign(Yh.prototype,{__class__:Yh});class Xh{static format(e){if(null==e)return"null";switch(e._hx_index){case 0:return x.string(e);case 1:let t=e.m;return Zh.formatModule(t);case 2:let s=e.column,r=e.line,n=e.file,i=e.s;return Zh.formatFilePos(i,n,r,s);case 3:let a=e.method,l=e.classname;return Zh.formatMethod(l,a);case 4:let h=e.v;return Zh.formatLocalFunction(h)}}static formatStackIndent(e,t){null==t&&(t="  ");let s="\n"+t,r="";r+=null==t?"null":""+t;r+=x.string(Xh.format(e[0]));let n=1,i=e.length;for(;n<i;){r+=null==s?"null":""+s;let t=n++;r+=x.string(Xh.format(e[t]))}return r}}s["sneaker.format.CallStackItemExtension"]=Xh,Xh.__name__="sneaker.format.CallStackItemExtension";class Zh{}Zh.formatLineColumn=function(e,t){return"line "+e+(null!=t?", col "+t:"")},Zh.formatModule=function(e){return e},Zh.formatFilePos=function(e,t,s,r){return""+(Zh.hideFilePath?"":t+Zh.separator)+Xh.format(e)+Zh.separator+Zh.formatLineColumn(s,r)},Zh.formatClass=function(e){if(null!=e){let t;if(Zh.hidePackagePath){let s=null,r=jh.dot;t=c.substr(e,(null!=s?e.lastIndexOf(r,s):e.lastIndexOf(r))+1,null)}else t=e;return""+t}return"?"},Zh.formatMethod=function(e,t){return Zh.formatClass(e)+"::"+t},Zh.formatLocalFunction=function(e){return"fn "+e},s["sneaker.format.CallStackItemFormat"]=Zh,Zh.__name__="sneaker.format.CallStackItemFormat";class Hh{}Hh.callStackFormat=function(e){return Xh.formatStackIndent(e)},s["sneaker.exception.ExceptionSettings"]=Hh,Hh.__name__="sneaker.exception.ExceptionSettings";class Kh extends Yh{constructor(e,t){let s=Ki.callStack();s.shift(),super("This method must be overridden by a subclass.\nPosition: "+qh.formatClassMethod(t),s,e,t)}}s["sneaker.exception.NotOverriddenException"]=Kh,Kh.__name__="sneaker.exception.NotOverriddenException",Kh.__super__=Yh,Object.assign(Kh.prototype,{__class__:Kh});class qh{static formatClassMethod(e){return null==e?qh.noPositionInfo:e.className+"::"+e.methodName}}s["sneaker.format.PosInfosExtension"]=qh,qh.__name__="sneaker.format.PosInfosExtension";class Jh{constructor(e,t,s){null==s&&(s=1024),null==t&&(t=8192),this.buffer=new eo,this.onFull=e,this.maxLength=t,this.maxCount=s,this.currentCount=0}}s["sneaker.string_buffer.StringBufferBox"]=Jh,Jh.__name__="sneaker.string_buffer.StringBufferBox",Object.assign(Jh.prototype,{__class__:Jh});class $h{}s["sneaker.string_buffer.interfaces.StringBuffer"]=$h,$h.__name__="sneaker.string_buffer.interfaces.StringBuffer",$h.__isInterface__=!0,Object.assign($h.prototype,{__class__:$h});class eo{constructor(e){this.data=new g,this.onAdd=null!=e?e:eo.defaultOnAdd}add(e){let t=x.string(e);this.onAdd(t)&&(this.data.b+=null==t?"null":""+t)}}eo.defaultOnAdd=function(e){return!0},s["sneaker.string_buffer.CensoredStringBuffer"]=eo,eo.__name__="sneaker.string_buffer.CensoredStringBuffer",eo.__interfaces__=[$h],Object.assign(eo.prototype,{__class__:eo});class to{static println_String(e){if(so.useBuffer)return to.lastBuffered=e,void to.buffer.buffer.add((null==e?"null":""+e)+"\n");to.lastPrinted=e,console.log(e)}}s["sneaker.print.Printer"]=to,to.__name__="sneaker.print.Printer";class so{}s["sneaker.print.PrinterSettings"]=so,so.__name__="sneaker.print.PrinterSettings";class ro extends g{constructor(){super()}}s["sneaker.string_buffer.StringBuffer"]=ro,ro.__name__="sneaker.string_buffer.StringBuffer",ro.__interfaces__=[$h],ro.__super__=g,Object.assign(ro.prototype,{__class__:ro});class no{constructor(e,t){null==t&&(t=-1),this.internalName=e,this.internalBits=t}}s["sneaker.tag.Tag"]=no,no.__name__="sneaker.tag.Tag",Object.assign(no.prototype,{__class__:no});class io{}function ao(t,s){return null==s?null:(null==s.__id__&&(s.__id__=e.$haxeUID++),null==t.hx__closures__?t.hx__closures__={}:r=t.hx__closures__[s.__id__],null==r&&(r=s.bind(t),t.hx__closures__[s.__id__]=r),r);var r}s["sneaker.tag.Tags"]=io,io.__name__="sneaker.tag.Tags",e.$haxeUID|=0,"undefined"!=typeof performance&&"function"==typeof performance.now&&(c.now=performance.now.bind(performance)),s.Math=Math,null==String.fromCodePoint&&(String.fromCodePoint=function(e){return e<65536?String.fromCharCode(e):String.fromCharCode(55232+(e>>10))+String.fromCharCode(56320+(1023&e))}),String.prototype.__class__=s.String=String,String.__name__="String",s.Array=Array,Array.__name__="Array",Date.prototype.__class__=s.Date=Date,Date.__name__="Date";var lo={},ho={},oo=Number,_o=Boolean,co={},uo={};Ss.__toStr={}.toString,aa.content=[{name:"R_bullet_png",data:"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAT0lEQVQ4T2P04ZjZwEABYAQZwPifgZ8cM/4zMnyEG8DM+G8iKYb8/c+UP2rAaBhA0gHTh+GUkEjJBzC10DCYXQ8R+MeIMITpPyofl/FM/wGIxnTktEiRwAAAAABJRU5ErkJggg"},{name:"R_agent_png",data:"iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAxklEQVRoQ+2asQ2DMBQFjWiyRgZijQzFGgyUNdKgoDRIFIhrTtjOc/30/P9daQ+l8TM0Pn/pa4HpMX9bMLJ8Xjv4g4FuFhjL+qzRxFrG92+uSwNZQNIXAxJYXBsDGJUUjAEJLK6NAYxKCsaABBbXxgBGJQVjQAKLa2MAo5KCMSCBxbUxgFFJwRiQwOLaGMCopGAMSGBxbQxgVFIwBiSwuDYGMCopGAMSWFz7PwYwkpuCl6+UN82Frz1dADdUFOzrr0RFYPEoG56yGkDaBNqaAAAAAElFTkSuQmCC"}],Ca.count=0,na.add(al.updateCursor,-1),_.world=null,d.frameCount=0,E.defaultChunkCapacity=64,R.hexChars=function(e){let t="0123456789abcdef".split(""),s=new Array(t.length);{let e=0,r=t.length;for(;e<r;){let r,n=e++,i=c.cca(t[n],0);if(null==i)throw $i.thrown(D.emptyString());r=i,s[n]=r}}return s.slice(0)}(),X._hx_skip_constructor=!1,ge.CONFIG_JS_STD={A:0,B:1,X:2,Y:3,LB:4,RB:5,LT:6,RT:7,back:8,start:9,analogClick:10,ranalogClick:11,dpadUp:12,dpadDown:13,dpadLeft:14,dpadRight:15,analogX:17,analogY:18,ranalogX:19,ranalogY:20,names:["A","B","X","Y","LB","RB","LT","RT","Select","Start","LCLK","RCLK","DUp","DDown","DLeft","DRight","LX","LY","RX","RY"]},ge.CONFIG_JS_DS4={A:0,B:1,X:2,Y:3,LB:4,RB:5,LT:6,RT:7,back:8,start:9,analogClick:10,ranalogClick:11,dpadUp:12,dpadDown:13,dpadLeft:14,dpadRight:15,analogX:18,analogY:19,ranalogX:20,ranalogY:21,names:["A","B","X","Y","LB","RB","LT","RT","Select","Start","LCLK","RCLK","DUp","DDown","DLeft","DRight","LX","LY","RX","RY"]},ge.CONFIG_JS_DS4_FF={A:1,B:2,X:0,Y:3,LB:4,RB:5,LT:6,RT:7,back:8,start:9,analogClick:10,ranalogClick:11,dpadUp:9e3,dpadDown:9e3,dpadLeft:9e3,dpadRight:9e3,analogX:18,analogY:19,ranalogX:20,ranalogY:23,names:["A","B","X","Y","LB","RB","LT","RT","Select","Start","LCLK","RCLK","DUp","DDown","DLeft","DRight","LX","LY","RX","RY"]},ge.DEFAULT_CONFIG=ge.CONFIG_JS_STD,ge.initDone=!1,ge.pads=new ya,be.NULL=ge.createDummy(),me.ports=me.createPorts(8),Ce._hx_skip_constructor=!1,Fe.bitmapFadeOutTimerPool=function(e){let t=new Me(4);return t.newTag("Scene FadeOutTimer pool"),t}(),Re.frameCount=0,Re.masterVolumeChangeTimer=function(e){let t=new Array(1);return t[0]=null,t}(),Re.queuedSounds=new ne(1),wt._hx_skip_constructor=!1,St.position=new kt,St.velocity=new vt,St.direction=new yt,St.shot=new Ct,St.random=new Bt,It._hx_skip_constructor=!1,rs._hx_skip_constructor=!1,Ts.version=new Is("firedancer-vm",(function(){return"0.1.0"}),(function(e){return null!=e?vs.Some(x.string(e)):vs.None}),Ms.Optional("0.0.0")),Hs.Reserved=1,Hs.V1_Bitrates=[[Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad],[Zs.BR_Free,Zs.BR_32,Zs.BR_40,Zs.BR_48,Zs.BR_56,Zs.BR_64,Zs.BR_80,Zs.BR_96,Zs.BR_112,Zs.BR_128,Zs.BR_160,Zs.BR_192,Zs.BR_224,Zs.BR_256,Zs.BR_320,Zs.BR_Bad],[Zs.BR_Free,Zs.BR_32,Zs.BR_48,Zs.BR_56,Zs.BR_64,Zs.BR_80,Zs.BR_96,Zs.BR_112,Zs.BR_128,Zs.BR_160,Zs.BR_192,Zs.BR_224,Zs.BR_256,Zs.BR_320,Zs.BR_384,Zs.BR_Bad],[Zs.BR_Free,Zs.BR_32,Zs.BR_64,Zs.BR_96,Zs.BR_128,Zs.BR_160,Zs.BR_192,Zs.BR_224,Zs.BR_256,Zs.BR_288,Zs.BR_320,Zs.BR_352,Zs.BR_384,Zs.BR_416,Zs.BR_448,Zs.BR_Bad]],Hs.V2_Bitrates=[[Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad,Zs.BR_Bad],[Zs.BR_Free,Zs.BR_8,Zs.BR_16,Zs.BR_24,Zs.BR_32,Zs.BR_40,Zs.BR_48,Zs.BR_56,Zs.BR_64,Zs.BR_80,Zs.BR_96,Zs.BR_112,Zs.BR_128,Zs.BR_144,Zs.BR_160,Zs.BR_Bad],[Zs.BR_Free,Zs.BR_8,Zs.BR_16,Zs.BR_24,Zs.BR_32,Zs.BR_40,Zs.BR_48,Zs.BR_56,Zs.BR_64,Zs.BR_80,Zs.BR_96,Zs.BR_112,Zs.BR_128,Zs.BR_144,Zs.BR_160,Zs.BR_Bad],[Zs.BR_Free,Zs.BR_32,Zs.BR_48,Zs.BR_56,Zs.BR_64,Zs.BR_80,Zs.BR_96,Zs.BR_112,Zs.BR_128,Zs.BR_144,Zs.BR_160,Zs.BR_176,Zs.BR_192,Zs.BR_224,Zs.BR_256,Zs.BR_Bad]],Hs.SamplingRates=[[Xs.SR_11025,Xs.SR_12000,Xs.SR_8000,Xs.SR_Bad],[Xs.SR_Bad,Xs.SR_Bad,Xs.SR_Bad,Xs.SR_Bad],[Xs.SR_22050,Xs.SR_24000,Xs.SR_12000,Xs.SR_Bad],[Xs.SR_44100,Xs.SR_48000,Xs.SR_32000,Xs.SR_Bad]],Ks.LReserved=0,gr._hx_skip_constructor=!1,Cr._hx_skip_constructor=!1,Gr.GUID=0,Wr.SOFTWARE_DRIVER=!1,Wr.ANTIALIASING=0,an.UID=0,an.CACHE=new va,cn.ALLOW_WEBGL2=!0,cn.outOfMemoryCheck=!1,cn.TFILTERS=[[[9728,9728],[9729,9729]],[[9728,9984],[9729,9985]],[[9728,9986],[9729,9987]]],cn.TWRAP=[33071,10497],cn.FACES=[0,1028,1029,1032],cn.BLEND=[1,0,770,768,772,774,771,769,773,775,32769,32771,32770,32772,776],cn.COMPARE=[519,512,514,517,516,518,513,515],cn.STENCIL_OP=[7680,0,7681,7682,34055,7683,34056,5386],cn.OP=[32774,32778,32779,32775,32776],cn.CUBE_FACES=[34069,34070,34071,34072,34073,34074],cn.CBUFFERS=function(e){let t=[];{let e=0;for(;e<32;){let s=[],r=0,n=e++;for(;r<n;){let e=r++;s.push(36064+e)}t.push(s)}}return t}(),pn.ALL_FLAGS=Lr.__empty_constructs__.slice(),bn._hx_skip_constructor=!1,Mn.defaultKillAlphaThreshold=.5,Mn.loadingTextureColor=-65281,Dn.current=new Dn("Default"),Pn._hx_skip_constructor=!1,Pn.UID=0,Pn.PREVENT_AUTO_DISPOSE=2147483647,Pn.nativeFormat=On.RGBA,Ln._hx_skip_constructor=!1,Gn._hx_skip_constructor=!1,zn.__meta__={obj:{ignore:["shader"]}},Un._hx_skip_constructor=!1,Wn.SRC="HXSLF2gzZC5zaGFkZXIuU2NyZWVuU2hhZGVyBwEFaW5wdXQNAQICCHBvc2l0aW9uBQoBAQADAnV2BQoBAQABAAAEBWZsaXBZAwIAAAUGb3V0cHV0DQICBghwb3NpdGlvbgUMBAUABwVjb2xvcgUMBAUABAAACApwaXhlbENvbG9yBQwEAAAJDGNhbGN1bGF0ZWRVVgUKBAAACghfX2luaXRfXw4GAAALBnZlcnRleA4GAAACAgoAAAUCBgQCBwUMAggFDAUMBgQCCQUKAgMFCgUKAAALAAAFAQYEAgYFDAkDKg4ECgICBQoAAAMGAQoCAgUKBAADAgQDAwEDAAAAAAAAAAADAQMAAAAAAADwPwMFDAUMAA",Nn.SRC="HXSLHWgzZC5wYXNzLl9Cb3JkZXIuQm9yZGVyU2hhZGVyCQEFaW5wdXQNAQICCHBvc2l0aW9uBQoBAQADAnV2BQoBAQABAAAEBWZsaXBZAwIAAAUGb3V0cHV0DQICBghwb3NpdGlvbgUMBAUABwVjb2xvcgUMBAUABAAACApwaXhlbENvbG9yBQwEAAAJDGNhbGN1bGF0ZWRVVgUKBAAACgVjb2xvcgUMAgAACwhfX2luaXRfXw4GAAAMBnZlcnRleA4GAAANCGZyYWdtZW50DgYAAAMCCwAABQIGBAIHBQwCCAUMBQwGBAIJBQoCAwUKBQoAAAwAAAUBBgQCBgUMCQMqDgQKAgIFCgAAAwYBCgICBQoEAAMCBAMDAQMAAAAAAAAAAAMBAwAAAAAAAPA/AwUMBQwAAQ0AAAUBBgQCCAUMAgoFDAUMAA",Yn.SRC="HXSLHmgzZC5wYXNzLl9Db3B5LkFycmF5Q29weVNoYWRlcgoBBWlucHV0DQECAghwb3NpdGlvbgUKAQEAAwJ1dgUKAQEAAQAABAVmbGlwWQMCAAAFBm91dHB1dA0CAgYIcG9zaXRpb24FDAQFAAcFY29sb3IFDAQFAAQAAAgKcGl4ZWxDb2xvcgUMBAAACQxjYWxjdWxhdGVkVVYFCgQAAAoHdGV4dHVyZQsCAAALBWxheWVyAQIAAAwIX19pbml0X18OBgAADQZ2ZXJ0ZXgOBgAADghmcmFnbWVudA4GAAADAgwAAAUCBgQCBwUMAggFDAUMBgQCCQUKAgMFCgUKAAANAAAFAQYEAgYFDAkDKg4ECgICBQoAAAMGAQoCAgUKBAADAgQDAwEDAAAAAAAAAAADAQMAAAAAAADwPwMFDAUMAAEOAAAFAQYEAggFDAkDIQ4CAgoLCQMpDgICCQUKCQMmDgECCwEDBQsFDAUMAA",Xn.SRC="HXSLGWgzZC5wYXNzLl9Db3B5LkNvcHlTaGFkZXIJAQVpbnB1dA0BAgIIcG9zaXRpb24FCgEBAAMCdXYFCgEBAAEAAAQFZmxpcFkDAgAABQZvdXRwdXQNAgIGCHBvc2l0aW9uBQwEBQAHBWNvbG9yBQwEBQAEAAAICnBpeGVsQ29sb3IFDAQAAAkMY2FsY3VsYXRlZFVWBQoEAAAKB3RleHR1cmUKAgAACwhfX2luaXRfXw4GAAAMBnZlcnRleA4GAAANCGZyYWdtZW50DgYAAAMCCwAABQIGBAIHBQwCCAUMBQwGBAIJBQoCAwUKBQoAAAwAAAUBBgQCBgUMCQMqDgQKAgIFCgAAAwYBCgICBQoEAAMCBAMDAQMAAAAAAAAAAAMBAwAAAAAAAPA/AwUMBQwAAQ0AAAUBBgQCCAUMCQMhDgICCgoCCQUKBQwFDAA",Hn.SRC="HXSLIWgzZC5wYXNzLl9DdWJlQ29weS5DdWJlQ29weVNoYWRlcgoBBWlucHV0DQECAghwb3NpdGlvbgUKAQEAAwJ1dgUKAQEAAQAABAVmbGlwWQMCAAAFBm91dHB1dA0CAgYIcG9zaXRpb24FDAQFAAcFY29sb3IFDAQFAAQAAAgKcGl4ZWxDb2xvcgUMBAAACQxjYWxjdWxhdGVkVVYFCgQAAAoHdGV4dHVyZQwCAAALA21hdAYCAAAMCF9faW5pdF9fDgYAAA0GdmVydGV4DgYAAA4IZnJhZ21lbnQOBgAAAwIMAAAFAgYEAgcFDAIIBQwFDAYEAgkFCgIDBQoFCgAADQAABQEGBAIGBQwJAyoOBAoCAgUKAAADBgEKAgIFCgQAAwIEAwMBAwAAAAAAAAAAAwEDAAAAAAAA8D8DBQwFDAABDgAABQIIDwJ1dgUKBAAABgMGAQIJBQoBAwAAAAAAAABAAwUKAQMAAAAAAADwPwMFCgAGBAIIBQwJAyEOAgIKDAkDHw4BBgEJAykOAgIPBQoBAwAAAAAAAPA/AwULAgsGBQsFCwUMBQwA",ei.SRC="HXSLIWgzZC5wYXNzLl9IYXJkd2FyZVBpY2suRml4ZWRDb2xvcgUBB2NvbG9ySUQFDAIAAAIIdmlld3BvcnQFDAIAAAMGb3V0cHV0DQECBAhwb3NpdGlvbgUMBAMABQdjb2xvcklEBQwEAwAEAAAGBnZlcnRleA4GAAAHCGZyYWdtZW50DgYAAAIABgAABQEGBAIEBQwGAQQGAAIEBQwGAQkDKg4DCgICBQwRAAUKAQMAAAAAAAAAAAMBAwAAAAAAAAAAAwUMCgIEBQwMAAMFDAUMBQwJAyoOAwoCAgUMOQAFCgEDAAAAAAAA8D8DAQMAAAAAAADwPwMFDAUMBQwAAQcAAAUBBgQCBQUMAgEFDAUMAA",ni.STRICT=!0,ci._hx_skip_constructor=!1,fi._hx_skip_constructor=!1,mi._hx_skip_constructor=!1,Ci.SRC="HXSLF2gzZC5zaGFkZXIuQW1iaWVudExpZ2h0CgEGZ2xvYmFsDQECAgxhbWJpZW50TGlnaHQFCwABAAMQcGVyUGl4ZWxMaWdodGluZwIAAQEAAAAAAAAAAAQKcGl4ZWxDb2xvcgUMBAAABQ9saWdodFBpeGVsQ29sb3IFCwQAAAYKbGlnaHRDb2xvcgULBAAABwhhZGRpdGl2ZQICAAEAAAAAAAgIX19pbml0X18OBgAACRBfX2luaXRfX2ZyYWdtZW50DgYAAAoJY2FsY0xpZ2h0DgYAAAsGdmVydGV4DgYAAAwIZnJhZ21lbnQOBgAABQIIAAAFAQYEAgYFCwsCBwICAgULCQMpDgEBAwAAAAAAAAAAAwULBQsFCwACCQAABQEGBAIFBQsLAgcCAgIFCwkDKQ4BAQMAAAAAAAAAAAMFCwULBQsAAwoBDQpsaWdodENvbG9yBQsEAAAFCwUBDQsCBwICDQULBAYAAgIFCwYBCQMWDgIEBgMBAwAAAAAAAPA/AwICBQsFCwULAQMAAAAAAAAAAAMFCwINBQsFCwULBQsFCwAAAAsAAAUBCwcCAgMCAgaBCgIEBQySAAULCQIKDgECBgULBQsFCwAAAAEMAAAFAQsCAwIGgQoCBAUMkgAFCwkCCg4BAgUFCwULBQsAAAA",vi.SRC="HXSLEWgzZC5zaGFkZXIuQmFzZTJkGgEFaW5wdXQNAQMCCHBvc2l0aW9uBQoBAQADAnV2BQoBAQAEBWNvbG9yBQwBAQABAAAFBm91dHB1dA0CAgYIcG9zaXRpb24FDAQFAAcFY29sb3IFDAQFAAQAAAgEdGltZQMAAAAJBnpWYWx1ZQMCAAAKB3RleHR1cmUKAgAACw5zcHJpdGVQb3NpdGlvbgUMBAAADBBhYnNvbHV0ZVBvc2l0aW9uBQwEAAANCnBpeGVsQ29sb3IFDAQAAA4MdGV4dHVyZUNvbG9yBQwEAAAPDGNhbGN1bGF0ZWRVVgUKAwAAEAppc1JlbGF0aXZlAgIAAQAAAAAAEQVjb2xvcgUMAgAAEg9hYnNvbHV0ZU1hdHJpeEEFCwIAABMPYWJzb2x1dGVNYXRyaXhCBQsCAAAUDWZpbHRlck1hdHJpeEEFCwIAABUNZmlsdGVyTWF0cml4QgULAgAAFghoYXNVVlBvcwICAAEAAAAAABcFdXZQb3MFDAIAABgJa2lsbEFscGhhAgIAAQAAAAAAGQpwaXhlbEFsaWduAgIAAQAAAAAAGhBoYWxmUGl4ZWxJbnZlcnNlBQoCAAAbCHZpZXdwb3J0BQwCAAAcDm91dHB1dFBvc2l0aW9uBQwEAAAdCF9faW5pdF9fDgYAAB4GdmVydGV4DgYAAB8IZnJhZ21lbnQOBgAAAwIdAAAFBgYEAgsFDAkDKg4DAgIFCgIJAwEDAAAAAAAA8D8DBQwFDAsCEAIFAwYECgIMBQwAAAMJAx0OAgkDKQ4CCgILBQwRAAUKAQMAAAAAAADwPwMFCwISBQsDAwYECgIMBQwEAAMJAx0OAgkDKQ4CCgILBQwRAAUKAQMAAAAAAADwPwMFCwITBQsDAwYECgIMBQw5AAUKCgILBQw5AAUKBQoABgQCDAUMAgsFDAUMAAYEAg8FCgsCFgIGAAYBAgMFCgoCFwUMOQAFCgUKCgIXBQwRAAUKBQoCAwUKBQoFCgYEAg0FDAsCEAIGAQIRBQwCBAUMBQwCBAUMBQwFDAYEAg4FDAkDIQ4CAgoKAg8FCgUMBQwGgQINBQwCDgUMBQwAAB4AAAUFCCADdG1wBQsEAAAJAykOAgoCDAUMEQAFCgEDAAAAAAAA8D8DBQsABgQCHAUMCQMqDgMJAx0OAgIgBQsCFAULAwkDHQ4CAiAFCwIVBQsDCgIMBQw5AAUKBQwFDAYECgIcBQwRAAUKBgEEBgAKAhwFDBEABQoKAhsFDBEABQoFCgUKCgIbBQw5AAUKBQoFCgsCGQIGgwoCHAUMEQAFCgIaBQoFCgAABgQCBgUMAhwFDAUMAAEfAAAFAgsGDgIYAgYJCgINBQwMAAMBA/yp8dJNYlA/AwICDAAAAAYEAgcFDAINBQwFDAA",Si.SRC="HXSLE2gzZC5zaGFkZXIuQmFzZU1lc2gXAQZjYW1lcmENAQoCBHZpZXcHAAEAAwRwcm9qBwABAAQIcG9zaXRpb24FCwABAAUIcHJvakZsaXADAAEABghwcm9qRGlhZwULAAEABwh2aWV3UHJvagcAAQAID2ludmVyc2VWaWV3UHJvagcAAQAJBXpOZWFyAwABAAoEekZhcgMAAQALA2RpcgULAwEAAAAADAZnbG9iYWwNAgQNBHRpbWUDAAwADglwaXhlbFNpemUFCgAMAA8JbW9kZWxWaWV3BwAMAQMQEG1vZGVsVmlld0ludmVyc2UHAAwBAwAAABEFaW5wdXQNAwISCHBvc2l0aW9uBQsBEQATBm5vcm1hbAULAREAAQAAFAZvdXRwdXQNBAUVCHBvc2l0aW9uBQwEFAAWBWNvbG9yBQwEFAAXBWRlcHRoAwQUABgGbm9ybWFsBQsEFAAZCXdvcmxkRGlzdAMEFAAEAAAaEHJlbGF0aXZlUG9zaXRpb24FCwQAABsTdHJhbnNmb3JtZWRQb3NpdGlvbgULBAAAHBhwaXhlbFRyYW5zZm9ybWVkUG9zaXRpb24FCwQAAB0RdHJhbnNmb3JtZWROb3JtYWwFCwQAAB4RcHJvamVjdGVkUG9zaXRpb24FDAQAAB8KcGl4ZWxDb2xvcgUMBAAAIAVkZXB0aAMEAAAhCHNjcmVlblVWBQoEAAAiCXNwZWNQb3dlcgMEAAAjCXNwZWNDb2xvcgULBAAAJAl3b3JsZERpc3QDBAAAJQVjb2xvcgUMAgAAJg1zcGVjdWxhclBvd2VyAwIAAQcAAAAAAAAAAAAAAAAAAFlAJw5zcGVjdWxhckFtb3VudAMCAAEHAAAAAAAAAAAAAAAAAAAkQCgNc3BlY3VsYXJDb2xvcgULAgAAKQhfX2luaXRfXw4GAAAqEF9faW5pdF9fZnJhZ21lbnQOBgAAKwZ2ZXJ0ZXgOBgAALAhmcmFnbWVudA4GAAAEAikAAAULBgQCGgULAhIFCwULBgQCGwULBgECGgULCQM0DgECDwcIBQsFCwYEAh4FDAYBCQMqDgICGwULAQMAAAAAAADwPwMFDAIHBwUMBQwGBAIdBQsJAx8OAQQGAQITBQsJAzIOAQIPBwYFCwULBQsFCwYEAgsFCwkDHw4BBAYDAgQFCwIbBQsFCwULBQsFCwYEAh8FDAIlBQwFDAYEAiIDAiYDAwYEAiMFCwYBAigFCwInAwULBQsGBAIhBQoJAzoOAQYCCgIeBQwRAAUKCgIeBQwMAAMFCgUKBQoGBAIgAwYCCgIeBQwIAAMKAh4FDAwAAwMDBgQCJAMGAgkDGw4BBgMCGwULAgQFCwULAwIKAwMDAAIqAAAFBQYEAh0FCwkDHw4BAh0FCwULBQsGBAIhBQoJAzoOAQYCCgIeBQwRAAUKCgIeBQwMAAMFCgUKBQoGBAIgAwYCCgIeBQwIAAMKAh4FDAwAAwMDBgQCIgMCJgMDBgQCIwULBgECKAULAicDBQsFCwAAKwAABQIGBAIVBQwGAQIeBQwJAyoOBAEDAAAAAAAA8D8DAgUDAQMAAAAAAADwPwMBAwAAAAAAAPA/AwUMBQwFDAYEAhwFCwIbBQsFCwABLAAABQQGBAIWBQwCHwUMBQwGBAIXAwIgAwMGBAIYBQsCHQULBQsGBAIZAwIkAwMA",Mi.SRC="HXSLD2gzZC5zaGFkZXIuQmx1choBBWlucHV0DQECAghwb3NpdGlvbgUKAQEAAwJ1dgUKAQEAAQAABAVmbGlwWQMCAAAFBm91dHB1dA0CAgYIcG9zaXRpb24FDAQFAAcFY29sb3IFDAQFAAQAAAgKcGl4ZWxDb2xvcgUMBAAACQxjYWxjdWxhdGVkVVYFCgQAAAoVY2FtZXJhSW52ZXJzZVZpZXdQcm9qBwIAAAsHdGV4dHVyZQoCAAAMDGRlcHRoVGV4dHVyZQoCAAANB1F1YWxpdHkBAgABAAAAAAAOB2lzRGVwdGgCAgABAAAAAAAPBnZhbHVlcw8DDQIAABAHb2Zmc2V0cw8DDQIAABEFcGl4ZWwFCgIAABINaGFzRml4ZWRDb2xvcgICAAEAAAAAABMQc21vb3RoRml4ZWRDb2xvcgICAAEAAAAAABQKZml4ZWRDb2xvcgUMAgAAFRBpc0RlcHRoRGVwZW5kYW50AgIAAQAAAAAAFgloYXNOb3JtYWwCAgABAAAAAAAXDW5vcm1hbFRleHR1cmUKAgAAGAZpc0N1YmUCAgABAAAAAAAZC2N1YmVUZXh0dXJlDAIAABoHY3ViZURpcgYCAAAbCF9faW5pdF9fDgYAABwGdmVydGV4DgYAAB0IZnJhZ21lbnQOBgAAHgtnZXRQb3NpdGlvbg4GAAAEAhsAAAUCBgQCBwUMAggFDAUMBgQCCQUKAgMFCgUKAAAcAAAFAQYEAgYFDAkDKg4ECgICBQoAAAMGAQoCAgUKBAADAgQDAwEDAAAAAAAAAAADAQMAAAAAAADwPwMFDAUMAAEdAAAFAgsCFQIFBggfBHBjdXIFCwQAAAkCHg4BAgMFCgULAAggBGNjdXIFDAQAAAkDIQ4CAgsKAgMFCgUMAAghBWNvbG9yBQwEAAAJAyoOBAEDAAAAAAAAAAADAQMAAAAAAAAAAAMBAwAAAAAAAAAAAwEDAAAAAAAAAAADBQwACCIEbmN1cgULBAAACQM5DgEJAyEOAgIXCgIDBQoFDAULABUGdW5yb2xsAA4jAWkBBAAABhUGAAcDAg0BAQECAQAAAAEBAg0BDwEAAAUICCQCdXYFCgQAAAYAAgMFCgYBAhEFChECEA8DDQsGCQIjAQECAAAAAAECBwMCIwEBAiMBAQMFCgUKAAglAWMFDAQAAAkDIQ4CAgsKAiQFCgUMAAgmAXAFCwQAAAkCHg4BAiQFCgULAAgnAWQDBAAACQMdDgIEBgMCJgULAh8FCwULBQsGAwImBQsCHwULBQsDAAgoAW4FCwQAAAkDOQ4BCQMhDgICFwoCJAUKBQwFCwAGBAIlBQwJAxgOAwIgBQwCJQUMCQMdDgICIgULAigFCwMFDAUMBgQCJQUMCQMYDgMCJQUMAiAFDAkDFQ4CBAYBCQMWDgIEBgMCJwMBA/yp8dJNYlA/AwMDAQMAAAAAAAAAAAMDAQMAAAAAAGr4QAMDAwEDAAAAAAAA8D8DAwUMBQwGgAIhBQwGAQIlBQwRAg8PAw0LBgkCIwEBAgAAAAABAgcDAiMBAQIjAQEDBQwFDAAAAAYEAggFDAIhBQwFDAALAg4CBQMIKQN2YWwDBAAAAQMAAAAAAAAAAAMAFQZ1bnJvbGwADioBaQEEAAAGFQYABwMCDQEBAQIBAAAAAQECDQEPAQAABQELAhgCBoACKQMGAQkDNw4BCQMhDgICGQwGAQkDKQ4CBgMGAQQGAAIDBQoGAQYBAhEFChECEA8DDQsGCQIqAQECAAAAAAECBwMCKgEBAioBAQMFCgkDJg4BAioBAwUKBQoFCgEDAAAAAAAAAEADBQoBAwAAAAAAAPA/AwUKAQMAAAAAAADwPwMFCwIaBgULBQwDEQIPDwMNCwYJAioBAQIAAAAAAQIHAwIqAQECKgEBAwMDBoACKQMGAQkDNw4BCQMhDgICCwoGAAIDBQoGAQYBAhEFChECEA8DDQsGCQIqAQECAAAAAAECBwMCKgEBAioBAQMFCgkDJg4BAioBAwUKBQoFDAMRAg8PAw0LBgkCKgEBAgAAAAABAgcDAioBAQIqAQEDAwMAAAAABgQCCAUMCQM2DgEJAxUOAgIpAwEDyxpQyv//7z8DAwUMBQwABQMIKwVjb2xvcgUMBAAACQMqDgQBAwAAAAAAAAAAAwEDAAAAAAAAAAADAQMAAAAAAAAAAAMBAwAAAAAAAAAAAwUMABUGdW5yb2xsAA4sAWkBBAAABhUGAAcDAg0BAQECAQAAAAEBAg0BDwEAAAUBCwIYAgaAAisFDAYBCQMhDgICGQwGAQkDKQ4CBgMGAQQGAAIDBQoGAQYBAhEFChECEA8DDQsGCQIsAQECAAAAAAECBwMCLAEBAiwBAQMFCgkDJg4BAiwBAwUKBQoFCgEDAAAAAAAAAEADBQoBAwAAAAAAAPA/AwUKAQMAAAAAAADwPwMFCwIaBgULBQwRAg8PAw0LBgkCLAEBAgAAAAABAgcDAiwBAQIsAQEDBQwFDAaAAisFDAYBCQMhDgICCwoGAAIDBQoGAQYBAhEFChECEA8DDQsGCQIsAQECAAAAAAECBwMCLAEBAiwBAQMFCgkDJg4BAiwBAwUKBQoFDBECDw8DDQsGCQIsAQECAAAAAAECBwMCLAEBAiwBAQMFDAUMAAAAAAYEAggFDAIrBQwFDAAAAAsCEgIFAgsCEwIGgQoCCAUMDAADCgIUBQwMAAMDBgQKAggFDAwAAwYBCgIUBQwMAAMJAyYOAQYHCgIIBQwMAAMBAwAAAAAAAAAAAwIDAwMABgQKAggFDJIABQsGAQoCFAUMkgAFCwoCCAUMDAADBQsFCwAAAAADHgEtAnV2BQoEAAAFCwUECC4FZGVwdGgDBAAACQM3DgEJAyEOAgIMCgItBQoFDAMACC8EdGVtcAUMBAAABgEJAyoOAwkDOw4BAi0FCgUKAi4DAQMAAAAAAADwPwMFDAIKBwUMAAgwCG9yaWdpbldTBQsEAAAGAgoCLwUMkgAFCwoCLwUMDAADBQsADQIwBQsAAA",Fi.SRC="HXSLE2gzZC5zaGFkZXIuQ29sb3JBZGQDAQpwaXhlbENvbG9yBQwEAAACBWNvbG9yBQsCAAADCGZyYWdtZW50DgYAAAEBAwAABQEGgAoCAQUMkgAFCwICBQsFCwA",Ei.SRC="HXSLE2gzZC5zaGFkZXIuQ29sb3JLZXkDAQhjb2xvcktleQUMAgAAAgx0ZXh0dXJlQ29sb3IFDAQAAAMIZnJhZ21lbnQOBgAAAQEDAAAFAggEBWNkaWZmBQwEAAAGAwICBQwCAQUMBQwACwYJCQMdDgICBAUMAgQFDAMBA/Fo44i1+OQ+AwIMAAAAAA",Di.SRC="HXSLFmgzZC5zaGFkZXIuQ29sb3JNYXRyaXgDAQpwaXhlbENvbG9yBQwEAAACBm1hdHJpeAcCAAADCGZyYWdtZW50DgYAAAEBAwAABQEGBAIBBQwJAyoOAgoEBgEJAyoOAgoCAQUMkgAFCwEDAAAAAAAA8D8DBQwCAgcFDAUMkgAFCwoEBgECAQUMAgIHBQwFDAwAAwUMBQwA",Ri.SRC="HXSLFGgzZC5zaGFkZXIuRGlyU2hhZG93EgEGZW5hYmxlAgIAAQAAAAAAAgdVU0VfRVNNAgIAAQAAAAAAAwtzaGFkb3dQb3dlcgMCAAAEB1VTRV9QQ0YCAgABAAAAAAAFCnBjZlF1YWxpdHkBAgABAAAAAAAGCHBjZlNjYWxlAwIAAAcJc2hhZG93UmVzBQoCAAAICXNoYWRvd01hcBEBAgAACQpzaGFkb3dQcm9qCAIAAAoKc2hhZG93QmlhcwMCAAALE3RyYW5zZm9ybWVkUG9zaXRpb24FCwQAAAwGc2hhZG93AwQAAA0JZGlyU2hhZG93AwQAAA4OcG9pc3NvbkRpc2tMb3cPBQwABAIAAA8PcG9pc3NvbkRpc2tIaWdoDwUMAAwCAAAQE3BvaXNzb25EaXNrVmVyeUhpZ2gPBQwAQAIAABEEcmFuZA4GAAASCGZyYWdtZW50DgYAAAIDEQETAXYDBAAAAwUCCBQCZHADBAAACQMdDgIJAyoOAQITAwUMCQMqDgQBA18pyxDH+ilAAwED9P3UeOmOU0ADAQOiRbbz/ZRGQAMBA1CNl24Sq1dAAwUMAwANCQMTDgEGAQkDAg4BAhQDAwEDUPwYc9Fd5UADAwMAAAESAAAFAgsCAQIFAQsCBAIFBwYEAgwDAQMAAAAAAADwPwMDCBUJdGV4ZWxTaXplBQoEAAAGAgEDAAAAAAAA8D8DAgcFCgUKAAgWCXNoYWRvd1BvcwULBAAABgECCwULAgkIBQsACBcIc2hhZG93VXYFCgQAAAkDOg4BCgIWBQsRAAUKBQoACBgEek1heAMEAAAJAzUOAQoCFgULCAADAwAIGQNyb3QDBAAABgEGAQkCEQ4BBgAGAAoCCwULAAADCgILBQsEAAMDCgILBQsIAAMDAwEDH4XrUbgeCUADAwEDAAAAAAAAAEADAwATBAIFAQEDAQECAQAAAAEFAggaDnNhbXBsZVN0cmVuZ3RoAwQAAAYCAQMAAAAAAADwPwMBAwAAAAAAABBAAwMADhsBaQEEAAAGFQECAAAAAAEBAgQAAAABDwEAAAUECBwGb2Zmc2V0BQoEAAAGAQYBChECDg8FDAAEAhsBBQwRAAUKAhUFCgUKAgYDBQoABgQCHAUKCQMoDgIGAwYBCQMDDgECGQMDCgIcBQoAAAMDBgEJAwIOAQIZAwMKAhwFCgQAAwMDBgAGAQkDAw4BAhkDAwoCHAUKBAADAwYBCQMCDgECGQMDCgIcBQoAAAMDAwUKBQoIHQVkZXB0aAMEAAAJA0AOAwIIEQEGAAIXBQoCHAUKBQoBAwAAAAAAAAAAAwMACwYHBgMCGAMCCgMDAh0DAgaDAgwDAhoDAwAAAAAAAQECAgAAAAEFAggeDnNhbXBsZVN0cmVuZ3RoAwQAAAYCAQMAAAAAAADwPwMBAwAAAAAAAChAAwMADh8BaQEEAAAGFQECAAAAAAEBAgwAAAABDwEAAAUECCAGb2Zmc2V0BQoEAAAGAQYBChECDw8FDAAMAh8BBQwRAAUKAhUFCgUKAgYDBQoABgQCIAUKCQMoDgIGAwYBCQMDDgECGQMDCgIgBQoAAAMDBgEJAwIOAQIZAwMKAiAFCgQAAwMDBgAGAQkDAw4BAhkDAwoCIAUKBAADAwYBCQMCDgECGQMDCgIgBQoAAAMDAwUKBQoIIQVkZXB0aAMEAAAJA0AOAwIIEQEGAAIXBQoCIAUKBQoBAwAAAAAAAAAAAwMACwYHBgMCGAMCCgMDAiEDAgaDAgwDAh4DAwAAAAAAAQECAwAAAAEFAggiDnNhbXBsZVN0cmVuZ3RoAwQAAAYCAQMAAAAAAADwPwMBAwAAAAAAAFBAAwMADiMBaQEEAAAGFQECAAAAAAEBAkAAAAABDwEAAAUECCQGb2Zmc2V0BQoEAAAGAQYBChECEA8FDABAAiMBBQwRAAUKAhUFCgUKAgYDBQoABgQCJAUKCQMoDgIGAwYBCQMDDgECGQMDCgIkBQoAAAMDBgEJAwIOAQIZAwMKAiQFCgQAAwMDBgAGAQkDAw4BAhkDAwoCJAUKBAADAwYBCQMCDgECGQMDCgIkBQoAAAMDAwUKBQoIJQVkZXB0aAMEAAAJA0AOAwIIEQEGAAIXBQoCJAUKBQoBAwAAAAAAAAAAAwMACwYHBgMCGAMCCgMDAiUDAgaDAgwDAiIDAwAAAAAAAAAACwICAgUFCCYJc2hhZG93UG9zBQsEAAAGAQILBQsCCQgFCwAIJwVkZXB0aAMEAAAJAz8OAgIIEQEJAzoOAQoCJgULEQAFCgUKAwAIKAR6TWF4AwQAAAkDNQ4BCgImBQsIAAMDAAgpBWRlbHRhAwQAAAYDCQMVDgIEBgACJwMCCgMDAwIoAwMCKAMDAAYEAgwDCQM1DgEJAwkOAQYBAgMDAikDAwMDAwAFBAgqCXNoYWRvd1BvcwULBAAABgECCwULAgkIBQsACCsIc2hhZG93VXYFCgQAAAkDOg4BCgIqBQsRAAUKBQoACCwFZGVwdGgDBAAACQM/DgICCBEBCgIrBQoRAAUKAwAGBAIMAwsGBwYDCgIqBQsIAAMCCgMDAiwDAgEDAAAAAAAAAAADAQMAAAAAAADwPwMDAwAAAAAAAAYEAg0DAgwDAwA",Vi.SRC="HXSLFWgzZC5zaGFkZXIuR2VuVGV4dHVyZQoBBWlucHV0DQECAghwb3NpdGlvbgUKAQEAAwJ1dgUKAQEAAQAABAVmbGlwWQMCAAAFBm91dHB1dA0CAgYIcG9zaXRpb24FDAQFAAcFY29sb3IFDAQFAAQAAAgKcGl4ZWxDb2xvcgUMBAAACQxjYWxjdWxhdGVkVVYFCgQAAAoEbW9kZQECAAEAAAAAAAsFY29sb3IFDAIAAAwIX19pbml0X18OBgAADQZ2ZXJ0ZXgOBgAADghmcmFnbWVudA4GAAADAgwAAAUCBgQCBwUMAggFDAUMBgQCCQUKAgMFCgUKAAANAAAFAQYEAgYFDAkDKg4ECgICBQoAAAMGAQoCAgUKBAADAgQDAwEDAAAAAAAAAAADAQMAAAAAAADwPwMFDAUMAAEOAAAFARMEAgoBAQEBAQIAAAAAAQUBBgQCCAUMCwYHCQMbDgEKAgYFDBEABQoDAQMAAAAAAADwPwMCCQMqDgEBAwAAAAAAAAAAAwUMAgsFDAUMBQwAAAAA",Oi.SRC="HXSLFWgzZC5zaGFkZXIuTGluZVNoYWRlcgwBBmNhbWVyYQ0BAwIEdmlldwcAAQADBHByb2oHAAEABAh2aWV3UHJvagcAAQAAAAAFBmdsb2JhbA0CAgYJcGl4ZWxTaXplBQoABQAHCW1vZGVsVmlldwcABQEDAAAACAVpbnB1dA0DAwkIcG9zaXRpb24FCwEIAAoGbm9ybWFsBQsBCAALAnV2BQoBCAABAAAMBm91dHB1dA0EAQ0IcG9zaXRpb24FDAQMAAQAAA4RdHJhbnNmb3JtZWROb3JtYWwFCwQAAA8TdHJhbnNmb3JtZWRQb3NpdGlvbgULBAAAEBFwcm9qZWN0ZWRQb3NpdGlvbgUMBAAAEQtsZW5ndGhTY2FsZQMCAAASBXdpZHRoAwIAABMEcGRpcgUMBAAAFAhfX2luaXRfXw4GAAAVBnZlcnRleA4GAAACAhQAAAUBBQUIFgNkaXIFCwQAAAYBAgoFCwkDMg4BAgcHBgULAAYEAhMFDAYBCQMqDgIGAQIWBQsJAzIOAQICBwYFCwEDAAAAAAAA8D8DBQwCAwcFDAUMBoEKAhMFDBEABQoGAgEDAAAAAAAA8D8DCQMNDgEGAAYBCgITBQwAAAMKAhMFDAAAAwMGAQoCEwUMBAADCgITBQwEAAMDAwMDBQoGgAIPBQsGAQYBAhYFCwoCCwUKAAADBQsCEQMFCwULBgQCDgULCQMfDgECFgULBQsFCwAAABUAAAUBBoAKAhAFDBEABQoGAQYBBgEGAQQGAQoCEwUMBQAFCgkDKA4CAQMAAAAAAADwPwMBAwAAAAAAAPC/AwUKBQoFCgQGAwoCCwUKBAADAQMAAAAAAADgPwMDAwUKCgIQBQwIAAMFCgIGBQoFCgISAwUKBQoA",Pi.SRC="HXSLF2gzZC5zaGFkZXIuTWluTWF4U2hhZGVyCwEFaW5wdXQNAQICCHBvc2l0aW9uBQoBAQADAnV2BQoBAQABAAAEBWZsaXBZAwIAAAUGb3V0cHV0DQICBghwb3NpdGlvbgUMBAUABwVjb2xvcgUMBAUABAAACApwaXhlbENvbG9yBQwEAAAJDGNhbGN1bGF0ZWRVVgUKBAAACgR0ZXhBCgIAAAsEdGV4QgoCAAAMBWlzTWF4AgIAAQAAAAAADQhfX2luaXRfXw4GAAAOBnZlcnRleA4GAAAPCGZyYWdtZW50DgYAAAMCDQAABQIGBAIHBQwCCAUMBQwGBAIJBQoCAwUKBQoAAA4AAAUBBgQCBgUMCQMqDgQKAgIFCgAAAwYBCgICBQoEAAMCBAMDAQMAAAAAAAAAAAMBAwAAAAAAAPA/AwUMBQwAAQ8AAAUDCBABYQUMBAAACQMhDgICCgoCCQUKBQwACBEBYgUMBAAACQMhDgICCwoCCQUKBQwABgQCCAUMCwIMAgkDFg4CAhAFDAIRBQwFDAkDFQ4CAhAFDAIRBQwFDAUMBQwA",Qi.SRC="HXSLG2gzZC5zaGFkZXIuQ3ViZU1pbk1heFNoYWRlcgwBBWlucHV0DQECAghwb3NpdGlvbgUKAQEAAwJ1dgUKAQEAAQAABAVmbGlwWQMCAAAFBm91dHB1dA0CAgYIcG9zaXRpb24FDAQFAAcFY29sb3IFDAQFAAQAAAgKcGl4ZWxDb2xvcgUMBAAACQxjYWxjdWxhdGVkVVYFCgQAAAoEdGV4QQwCAAALBHRleEIMAgAADAVpc01heAICAAEAAAAAAA0DbWF0BgIAAA4IX19pbml0X18OBgAADwZ2ZXJ0ZXgOBgAAEAhmcmFnbWVudA4GAAADAg4AAAUCBgQCBwUMAggFDAUMBgQCCQUKAgMFCgUKAAAPAAAFAQYEAgYFDAkDKg4ECgICBQoAAAMGAQoCAgUKBAADAgQDAwEDAAAAAAAAAAADAQMAAAAAAADwPwMFDAUMAAEQAAAFBQgRAnV2BQoEAAAGAwYBAgkFCgEDAAAAAAAAAEADBQoBAwAAAAAAAPA/AwUKAAgSA2RpcgULBAAABgEJAykOAgIRBQoBAwAAAAAAAPA/AwULAg0GBQsACBMBYQUMBAAACQMhDgICCgwCEgULBQwACBQBYgUMBAAACQMhDgICCwwCEgULBQwABgQCCAUMCwIMAgkDFg4CAhMFDAIUBQwFDAkDFQ4CAhMFDAIUBQwFDAUMBQwA",Li.SRC="HXSLFGgzZC5zaGFkZXIuTm9ybWFsTWFwCgEGY2FtZXJhDQECAghwb3NpdGlvbgULAAEAAwNkaXIFCwMBAAAAAAQGZ2xvYmFsDQIBBQltb2RlbFZpZXcHAAQBAwAAAAYFaW5wdXQNAwIHBm5vcm1hbAULAQYACAd0YW5nZW50BQsBBgABAAAJB3RleHR1cmUKAgAACgxjYWxjdWxhdGVkVVYFCgQAAAsTdHJhbnNmb3JtZWRQb3NpdGlvbgULBAAADBF0cmFuc2Zvcm1lZE5vcm1hbAULBAAADRJ0cmFuc2Zvcm1lZFRhbmdlbnQFDAMAAA4OX19pbml0X192ZXJ0ZXgOBgAADwhmcmFnbWVudA4GAAACAg4AAAUBBgQCDQUMCQMqDgIGAQIIBQsJAzIOAQIFBwYFCwsGBwkDHQ4CAggFCwIIBQsDAQMAAAAAAADgPwMCAQMAAAAAAADwPwMBAwAAAAAAAPC/AwMFDAUMAAEPAAAFBQgQAW4FCwQAAAIMBQsACBECbmYFCwQAAAkDOQ4BCQMhDgICCQoCCgUKBQwFCwAIEgR0YW5YBQsEAAAJAx8OAQoCDQUMkgAFCwULAAgTBHRhblkFCwQAAAYBCQMeDgICEAULAhIFCwULBwMKAg0FDAwAAwMFCwAGBAIMBQsJAx8OAQQGAAYABgEKAhEFCwAAAwISBQsFCwYBCgIRBQsEAAMCEwULBQsFCwYBCgIRBQsIAAMCEAULBQsFCwULBQsFCwA",Gi.SRC="HXSLEWgzZC5zaGFkZXIuU2hhZG93BgEGc2hhZG93DQEFAgNtYXARAQABAAMEcHJvaggAAQAEBWNvbG9yBQsAAQAFBXBvd2VyAwABAAYEYmlhcwMAAQAAAAAHCnBpeGVsQ29sb3IFDAQAAAgTdHJhbnNmb3JtZWRQb3NpdGlvbgULBAAACRhwaXhlbFRyYW5zZm9ybWVkUG9zaXRpb24FCwQAAAoJc2hhZG93UG9zBQsDAAEBCwhmcmFnbWVudA4GAAABAQsAAAUGCAwJc2hhZG93UG9zBQsEAAAGAQIJBQsCAwgFCwAIDQVkZXB0aAMEAAAJAz8OAgICEQEJAzoOAQoCDAULEQAFCgUKAwAIDgR6TWF4AwQAAAkDNQ4BCgIMBQsIAAMDAAgPBWRlbHRhAwQAAAYDCQMVDgIEBgACDQMCBgMDAwIOAwMCDgMDAAgQBXNoYWRlAwQAAAkDNQ4BCQMJDgEGAQIFAwIPAwMDAwAGgQoCBwUMkgAFCwYABgEEBgMBAwAAAAAAAPA/AwIQAwMDCgIEBQuSAAULBQsCEAMFCwULAA",zi.SRC="HXSLE2gzZC5zaGFkZXIuU2tpbkJhc2UFARByZWxhdGl2ZVBvc2l0aW9uBQsEAAACE3RyYW5zZm9ybWVkUG9zaXRpb24FCwQAAAMRdHJhbnNmb3JtZWROb3JtYWwFCwQAAAQITWF4Qm9uZXMBAgABAAAAAAAFDWJvbmVzTWF0cml4ZXMPCAQCAAEIAA",Ui.SRC="HXSLD2gzZC5zaGFkZXIuU2tpbggBEHJlbGF0aXZlUG9zaXRpb24FCwQAAAITdHJhbnNmb3JtZWRQb3NpdGlvbgULBAAAAxF0cmFuc2Zvcm1lZE5vcm1hbAULBAAABAhNYXhCb25lcwECAAEAAAAAAAUNYm9uZXNNYXRyaXhlcw8IBAIAAQgGBWlucHV0DQEEBwhwb3NpdGlvbgULAQYACAZub3JtYWwFCwEGAAkHd2VpZ2h0cwULAQYACgdpbmRleGVzCQQAAAABBgABAAALEnRyYW5zZm9ybWVkVGFuZ2VudAUMBAAADAZ2ZXJ0ZXgOBgAAAQAMAAAFAgYEAgIFCwYABgAGAQQGAQIBBQsRAgUPCAQKAgoJBAAAAAAAAQgFCwULCgIJBQsAAAMFCwYBBAYBAgEFCxECBQ8IBAoCCgkEAAAABAABCAULBQsKAgkFCwQAAwULBQsGAQQGAQIBBQsRAgUPCAQKAgoJBAAAAAgAAQgFCwULCgIJBQsIAAMFCwULBQsGBAIDBQsJAx8OAQYABgAGAQQGAQIIBQsJAzIOARECBQ8IBAoCCgkEAAAAAAABCAYFCwULCgIJBQsAAAMFCwYBBAYBAggFCwkDMg4BEQIFDwgECgIKCQQAAAAEAAEIBgULBQsKAgkFCwQAAwULBQsGAQQGAQIIBQsJAzIOARECBQ8IBAoCCgkEAAAACAABCAYFCwULCgIJBQsIAAMFCwULBQsFCwA",Wi.SRC="HXSLFmgzZC5zaGFkZXIuU2tpblRhbmdlbnQIARByZWxhdGl2ZVBvc2l0aW9uBQsEAAACE3RyYW5zZm9ybWVkUG9zaXRpb24FCwQAAAMRdHJhbnNmb3JtZWROb3JtYWwFCwQAAAQITWF4Qm9uZXMBAgABAAAAAAAFDWJvbmVzTWF0cml4ZXMPCAQCAAEIBgVpbnB1dA0BBQcIcG9zaXRpb24FCwEGAAgGbm9ybWFsBQsBBgAJB3RhbmdlbnQFCwEGAAoHd2VpZ2h0cwULAQYACwdpbmRleGVzCQQAAAABBgABAAAMEnRyYW5zZm9ybWVkVGFuZ2VudAUMBAAADQZ2ZXJ0ZXgOBgAAAQANAAAFAwYEAgIFCwYABgAGAQQGAQIBBQsRAgUPCAQKAgsJBAAAAAAAAQgFCwULCgIKBQsAAAMFCwYBBAYBAgEFCxECBQ8IBAoCCwkEAAAABAABCAULBQsKAgoFCwQAAwULBQsGAQQGAQIBBQsRAgUPCAQKAgsJBAAAAAgAAQgFCwULCgIKBQsIAAMFCwULBQsGBAIDBQsJAx8OAQYABgAGAQQGAQIIBQsJAzIOARECBQ8IBAoCCwkEAAAAAAABCAYFCwULCgIKBQsAAAMFCwYBBAYBAggFCwkDMg4BEQIFDwgECgILCQQAAAAEAAEIBgULBQsKAgoFCwQAAwULBQsGAQQGAQIIBQsJAzIOARECBQ8IBAoCCwkEAAAACAABCAYFCwULCgIKBQsIAAMFCwULBQsFCwYEAgwFDAkDKg4CCQMfDgEGAAYABgEEBgEKAgkFC5IABQsJAzIOARECBQ8IBAoCCwkEAAAAAAABCAYFCwULCgIKBQsAAAMFCwYBBAYBCgIJBQuSAAULCQMyDgERAgUPCAQKAgsJBAAAAAQAAQgGBQsFCwoCCgULBAADBQsFCwYBBAYBCgIJBQuSAAULCQMyDgERAgUPCAQKAgsJBAAAAAgAAQgGBQsFCwoCCgULCAADBQsFCwULCgIMBQwMAAMFDAUMAA",Ni.SRC="HXSLGmgzZC5zaGFkZXIuU3BlY3VsYXJUZXh0dXJlBAEHdGV4dHVyZQoCAAACDGNhbGN1bGF0ZWRVVgUKBAAAAwlzcGVjQ29sb3IFCwQAAAQIZnJhZ21lbnQOBgAAAQEEAAAFAQaBAgMFCwoJAyEOAgIBCgICBQoFDJIABQsFCwA",ji.SRC="HXSLEmgzZC5zaGFkZXIuVGV4dHVyZQsBBWlucHV0DQEBAgJ1dgUKAQEAAQAAAwhhZGRpdGl2ZQICAAEAAAAAAAQJa2lsbEFscGhhAgIAAQAAAAAABQ1zcGVjdWxhckFscGhhAgIAAQAAAAAABhJraWxsQWxwaGFUaHJlc2hvbGQDAgABBwAAAAAAAAAAAAAAAAAA8D8HB3RleHR1cmUKAgAACAxjYWxjdWxhdGVkVVYFCgQAAAkKcGl4ZWxDb2xvcgUMBAAACglzcGVjQ29sb3IFCwQAAAsGdmVydGV4DgYAAAwIZnJhZ21lbnQOBgAAAgALAAAFAQYEAggFCgICBQoFCgABDAAABQQIDQFjBQwEAAAJAyEOAgIHCgIIBQoFDAALBg4CBAIGCQYDCgINBQwMAAMCBgMDAQMAAAAAAAAAAAMCAgwAAAALAgMCBoACCQUMAg0FDAUMBoECCQUMAg0FDAUMAAsCBQIGgQIKBQsKAg0FDP4ABQsFCwAAAA",Yi.SRC="HXSLEmgzZC5zaGFkZXIuVVZEZWx0YQQBB3V2RGVsdGEFCgIAAAIHdXZTY2FsZQUKAgAAAwxjYWxjdWxhdGVkVVYFCgQAAAQGdmVydGV4DgYAAAEABAAABQEGBAIDBQoGAAYBAgMFCgICBQoFCgIBBQoFCgUKAA",Xi.SRC="HXSLG2gzZC5zaGFkZXIuVmVydGV4Q29sb3JBbHBoYQQBBWlucHV0DQEBAgVjb2xvcgUMAQEAAQAAAwpwaXhlbENvbG9yBQwEAAAECGFkZGl0aXZlAgIAAQAAAAAABQhmcmFnbWVudA4GAAABAQUAAAUBCwIEAgaAAgMFDAICBQwFDAaBAgMFDAICBQwFDAAA",Zi.SRC="HXSLFmgzZC5zaGFkZXIuVm9sdW1lRGVjYWwYAQZjYW1lcmENAQoCBHZpZXcHAAEAAwRwcm9qBwABAAQIcG9zaXRpb24FCwABAAUIcHJvakZsaXADAAEABghwcm9qRGlhZwULAAEABwh2aWV3UHJvagcAAQAID2ludmVyc2VWaWV3UHJvagcAAQAJBXpOZWFyAwABAAoEekZhcgMAAQALA2RpcgULAwEAAAAADAZnbG9iYWwNAgQNBHRpbWUDAAwADglwaXhlbFNpemUFCgAMAA8JbW9kZWxWaWV3BwAMAQMQEG1vZGVsVmlld0ludmVyc2UHAAwBAwAAABEFaW5wdXQNAwISCHBvc2l0aW9uBQsBEQATBm5vcm1hbAULAREAAQAAFAZvdXRwdXQNBAUVCHBvc2l0aW9uBQwEFAAWBWNvbG9yBQwEFAAXBWRlcHRoAwQUABgGbm9ybWFsBQsEFAAZCXdvcmxkRGlzdAMEFAAEAAAaEHJlbGF0aXZlUG9zaXRpb24FCwQAABsTdHJhbnNmb3JtZWRQb3NpdGlvbgULBAAAHBhwaXhlbFRyYW5zZm9ybWVkUG9zaXRpb24FCwQAAB0RdHJhbnNmb3JtZWROb3JtYWwFCwQAAB4RcHJvamVjdGVkUG9zaXRpb24FDAQAAB8KcGl4ZWxDb2xvcgUMBAAAIAVkZXB0aAMEAAAhCHNjcmVlblVWBQoEAAAiCXNwZWNQb3dlcgMEAAAjCXNwZWNDb2xvcgULBAAAJAl3b3JsZERpc3QDBAAAJQhkZXB0aE1hcBEBAAAAJgVzY2FsZQUKAgAAJwZub3JtYWwFCwIAACgHdGFuZ2VudAULAgAAKQppc0NlbnRlcmVkAgIAAQAAAAAAKgxjYWxjdWxhdGVkVVYFCgQAACsSdHJhbnNmb3JtZWRUYW5nZW50BQwEAAAsDl9faW5pdF9fdmVydGV4DgYAAC0IZnJhZ21lbnQOBgAAAgIsAAAFAgYEAh0FCwkDHw4BBAYBAicFCwkDMg4BAg8HBgULBQsFCwULBgQCKwUMCQMqDgIJAx8OAQQGAQIoBQsJAzIOAQIPBwYFCwULBQsBAwAAAAAAAPA/AwUMBQwAAS0AAAUJCC4GbWF0cml4BwQAAAYBAggHAhAHBwAILwlzY3JlZW5Qb3MFCgQAAAYCCgIeBQwRAAUKCgIeBQwMAAMFCgAIMANydXYFDAQAAAkDKg4DAi8FCgkDPw4CAiURAQkDOg4BAi8FCgUKAwEDAAAAAAAA8D8DBQwACDEEd3BvcwUMBAAABgECMAUMAi4HBQwACDIEcHBvcwUMBAAABgECMAUMAggHBQwABgQCHAULBgIKAjIFDJIABQsKAjIFDAwAAwULBQsGBAIqBQoGAQImBQoEBgIKAjEFDBEABQoKAjEFDAwAAwUKBQoFCgUKCwIpAgaAAioFCgEDAAAAAAAA4D8DBQoAAAsGCQkDFQ4CCQMVDgIKAioFCgAAAwoCKgUKBAADAwkDFQ4CBgMBAwAAAAAAAPA/AwoCKgUKAAADAwYDAQMAAAAAAADwPwMKAioFCgQAAwMDAwEDAAAAAAAAAAADAgwAAAAA",Ji.pending=[],Ji.threadCount=0,ea._mul=null!=Math.imul?Math.imul:function(e,t){return e*(65535&t)+(e*(t>>>16)<<16|0)|0},la.USE_CACHE=!1,la.USE_ENUM_INDEX=!1,la.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:",_a.DEFAULT_RESOLVER=new oa,_a.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:",fa.CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fa.BYTES=da.ofString(fa.CHARS),Va.helper=new DataView(new ArrayBuffer(8)),Wa.LEN_EXTRA_BITS_TBL=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,-1,-1],Wa.LEN_BASE_VAL_TBL=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],Wa.DIST_EXTRA_BITS_TBL=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,-1,-1],Wa.DIST_BASE_VAL_TBL=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],Wa.CODE_LENGTHS_POS=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],qa.initDone=!1,qa.keyPressed=[],qa.ALLOW_KEY_REPEAT=!1,nl.wantedFPS=60,nl.maxDeltaTime=.5,nl.smoothFactor=.95,nl.lastTimeStamp=c.now()/1e3,nl.elapsedTime=0,nl.frameCount=0,nl.dt=1/nl.wantedFPS,nl.currentDT=1/nl.wantedFPS,al.setCursor=al.setNativeCursor,al.loopInit=!1,cl.invalidChars=new l("[^A-Za-z0-9_]","g"),xl._hx_skip_constructor=!1,xl.LIVE_UPDATE=!1,gl.ALLOW_NPOT=!0,gl.DEFAULT_FILTER=Bn.Linear,gl.DEFAULT_ASYNC=!1,gl.ENABLE_AUTO_WATCH=!0,yl.ENABLE_AUTO_WATCH=!0,kl._hx_skip_constructor=!1,Bl.ID=0,Ml._hx_skip_constructor=!1,Dl.ID=0,Vl.STREAM_DURATION=5,Vl.STREAM_BUFFER_SAMPLE_COUNT=44100,Vl.BUFFER_QUEUE_LENGTH=2,Vl.MAX_SOURCES=16,Vl.SOUND_BUFFER_CACHE_SIZE=256,Vl.VIRTUAL_VOLUME_THRESHOLD=1e-5,Vl.BUFFER_STREAM_SPLIT=16,oh.UID=0,oh.SWIZ=lh.__empty_constructs__.slice(),oh.MAX_CHANNELS_BITS=3,ch.SRC="HXSLEGh4c2wuQmF0Y2hTaGFkZXICAQtCYXRjaF9Db3VudAECAAEAAAABAAIMQmF0Y2hfQnVmZmVyEAUMAQIAAAA",kh.KWD_LIST=["input","output","discard","dvec2","dvec3","dvec4","hvec2","hvec3","hvec4","fvec2","fvec3","fvec4","int","float","bool","long","short","double","half","fixed","unsigned","superp","lowp","mediump","highp","precision","invariant","discard","struct","asm","union","template","this","packed","goto","sizeof","namespace","noline","volatile","external","flat","input","output","out","attribute","const","uniform","varying","inout","void"],kh.KWDS=function(e){let t=new va;{let e=0,s=kh.KWD_LIST;for(;e<s.length;){let r=s[e];++e,t.h[r]=!0}}return t}(),kh.GLOBALS=function(e){let t=new wa;{let e=0,s=ah.__empty_constructs__.slice();for(;e<s.length;){let r=s[e];++e;let n=""+x.string(r);n=n.charAt(0).toLowerCase()+c.substr(n,1,null),t.set(r,n)}}t.set(ah.ToInt,"int"),t.set(ah.ToFloat,"float"),t.set(ah.ToBool,"bool"),t.set(ah.LReflect,"reflect"),t.set(ah.Mat3x4,"_mat3x4"),t.set(ah.VertexID,"gl_VertexID"),t.set(ah.InstanceID,"gl_InstanceID"),t.set(ah.IVec2,"ivec2"),t.set(ah.IVec3,"ivec3"),t.set(ah.IVec4,"ivec4"),t.set(ah.BVec2,"bvec2"),t.set(ah.BVec3,"bvec3"),t.set(ah.BVec4,"bvec4"),t.set(ah.FragCoord,"gl_FragCoord");{let e=t.iterator();for(;e.hasNext();){let t=e.next();kh.KWDS.h[t]=!0}}return t}(),kh.MAT34="struct _mat3x4 { vec4 a; vec4 b; vec4 c; };",Ch.UID=0,Mh.SWIZ=["x","y","z","w"],Dh.UID=0,Rh.TVECS=new ya,Rh.BOPS=function(e){let t=Pa.__empty_constructs__.slice();return t.splice(Pa.OpAssignOp(null)._hx_index,0,null),t}(),Rh.UNOPS=Qa.__empty_constructs__.slice(),Rh.TGLOBALS=ah.__empty_constructs__.slice(),Rh.TSWIZ=new ya,Rh.REGS=[lh.X,lh.Y,lh.Z,lh.W],Rh.VKINDS=th.__empty_constructs__.slice(),Rh.PRECS=rh.__empty_constructs__.slice(),Rh.FKIND=ih.__empty_constructs__.slice(),Rh.SIGN=9139229,Lh.UNROLL_LOOPS=!1,jh.dot=".",Zh.hideFilePath=!1,Zh.hidePackagePath=!0,Zh.separator=" ",Hh.appendCallStackDefault=!1,qh.noPositionInfo="(No position info)",to.buffer=new Jh((function(e){to.lastPrinted=e,console.log(e)}),null,null),so.useBuffer=!1,io.anonymous=new no("no name",-1),p.main(),Ji.run()}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);
